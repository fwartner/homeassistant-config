(()=>{"use strict";function e(e){if(e=(e=e&&e.shadowRoot)&&e.querySelector("hui-root")){var t=e.lovelace;return t.current_view=e.___curView,t}}const t="custom:";class a{constructor(){var t,a;this.addCardsToHeader(e(this.panel)),this.entityWatch(),t=this.main,a=t=>{window.HeaderCards.addCardsToHeader(e(t)),this.toolbar&&!this.toolbarObserver&&this.setupToolbarObserver(),this.panel&&!this.panelObserver&&this.setupPanelObserver()},new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let t of e)"ha-panel-lovelace"==t.localName&&setTimeout((()=>{a(t)}),100)}))})).observe(t.shadowRoot.querySelector("partial-panel-resolver"),{childList:!0}),this.header&&this.setupToolbarObserver(),this.panel&&this.setupPanelObserver()}setupToolbarObserver(){var t,a;this.toolbarObserver=(t=this.header,a=()=>{window.HeaderCards.addCardsToHeader(e(this.panel))},new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let t of e)"app-toolbar"==t.localName&&"edit-mode"!=t.className&&setTimeout((()=>{a()}),100)}))})).observe(t,{childList:!0}))}setupPanelObserver(){var e,t;this.panelObserver=(e=this.panel,t=()=>{this.setupToolbarObserver()},new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let a of e)"hui-root"==a.localName&&setTimeout((()=>{t()}),100)}))})).observe(e.shadowRoot,{childList:!0}))}get main(){let e=document.querySelector("home-assistant");return e=e&&e.shadowRoot,e=e&&e.querySelector("home-assistant-main"),e}get panel(){let e=this.main&&this.main.shadowRoot;return e=e&&e.querySelector("ha-drawer partial-panel-resolver"),e=e&&e.shadowRoot||e,e=e&&e.querySelector("ha-panel-lovelace"),e}get header(){let e=this.panel;return e=e&&e.shadowRoot,e=e&&e.querySelector("hui-root"),e=e&&e.shadowRoot,e=e&&e.querySelector("div.header"),e}get toolbar(){return toolbar=this.header&&this.header.querySelector("div.toolbar"),toolbar}get hass(){return this.main&&this.main.hass}insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}async entityWatch(){(await window.hassConnection).conn.subscribeMessage((e=>this.entityWatchCallback(e)),{type:"subscribe_events",event_type:"state_changed"})}entityWatchCallback(e){if("state_changed"==e.event_type){let t=e.data.old_state&&e.data.old_state.state;(e.data.new_state&&e.data.new_state.state)!=t&&this.applyHass()}}addCard(e,t){e.type;let a=this.createCardElement(e);a.classList.add("header-card"),a.style.display="inline-block",a.hass=this.hass,t.appendChild(a)}addCardWhenDefined(e,a){let s=e.type;s.startsWith(t)?(s=s.substr(t.length),customElements.whenDefined(s).then((()=>{this.addCard(e,a)}))):this.addCard(e,a)}addBadge(e,t){let a=this.createBadgeElement(e);return a.classList.add("header-badge"),a.hass=this.hass,a.style.setProperty("--ha-label-badge-size","2em"),a.style.setProperty("--ha-label-badge-title-font-size","0.6em"),a.style.setProperty("--ha-label-badge-font-size","0.9em"),t.appendChild(a),a}applyHass(){if(this.hass&&this.toolbar){let e=this.toolbar.querySelectorAll("#headerCards div .header-card,.header-badge");e&&e.forEach((e=>{e.hass=this.hass}))}}addCardsToHeader(e){window.loadCardHelpers().then((({createCardElement:t,createBadgeElement:a})=>{this.createCardElement=t,this.createBadgeElement=a;let s=e&&e.config;s=e.config||{};let r=s.header_cards||{},i=r.cards||[],o=r.badges||[],l=r&&r.replace_tabs||!1,d=this.toolbar&&this.toolbar.querySelector("ha-tabs"),n=this.toolbar&&this.toolbar.querySelector("div[main-title]"),h=this.toolbar&&this.toolbar.querySelector("div.action-items"),c=this.toolbar.querySelector("#headerCards");c&&c.remove();let b=r.justify_content||"right";if(i.length>0||o.length>0){let e=document.createElement("div");if(e.id="headerCards",e.style.display="flex",e.style.visibility="hidden",e.style["-ms-flex-direction"]="row",e.style["-webkit-flex-direction"]="row",e.style["flex-direction"]="row",e.style["-ms-flex-align"]="center",e.style["-webkit-align-items"]="center",e.style["align-items"]="center",e.style["justify-content"]=b,e.style.flex="1",o.length>0){let t=document.createElement("div");t.style.width="auto",t.style.minWidth="max-content",o.forEach((e=>{this.addBadge(e,t)})),e.appendChild(t)}i.length>0&&i.forEach((t=>{let a=document.createElement("div");a.style.width="auto",a.style.minWidth="max-content",this.addCardWhenDefined(t,a),e.appendChild(a)})),h?this.toolbar.insertBefore(e,h):this.toolbar.appendChild(e),d||n?l?((d||n).style.display="none",e.style.visibility="visible"):setTimeout((function(){if(d){let t=d.shadowRoot&&d.shadowRoot.querySelector("#tabsContent");t.style.setProperty("width","auto","important");let a=t.offsetWidth;console.log("Tabs Width",a),d.style.width=`${a}px`,d.style.paddingRight="10px",e.style.visibility="visible"}else n.style.flex="0",n.style.paddingRight="10px",n.style.width="auto",n.style.minWidth="max-content",e.style.display="flex",e.style.visibility="visible"}),200):e.style.visibility="visible"}}))}}Promise.resolve(customElements.whenDefined("hui-view")).then((()=>{window.HeaderCards=new a}))})();