function t(t,e,i,n){var r,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,i,o):r(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const e=window,i=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),r=new WeakMap;class s{constructor(t,e,i){if(this._$cssResult$=!0,i!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(i&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=r.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&r.set(e,t))}return t}toString(){return this.cssText}}const o=(t,...e)=>{const i=1===t.length?t[0]:e.reduce(((e,i,n)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[n+1]),t[0]);return new s(i,t,n)},a=i?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>new s("string"==typeof t?t:t+"",void 0,n))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var c;const h=window,d=h.trustedTypes,l=d?d.emptyScript:"",u=h.reactiveElementPolyfillSupport,f={toAttribute(t,e){switch(e){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},p=(t,e)=>e!==t&&(e==e||t==t),m={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:p};class v extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,i)=>{const n=this._$Ep(i,e);void 0!==n&&(this._$Ev.set(n,i),t.push(n))})),t}static createProperty(t,e=m){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const i="symbol"==typeof t?Symbol():"__"+t,n=this.getPropertyDescriptor(t,i,e);void 0!==n&&Object.defineProperty(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(n){const r=this[t];this[e]=n,this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||m}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of e)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(a(t))}else void 0!==t&&e.push(a(t));return e}static _$Ep(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}u(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,i;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(i=t.hostConnected)||void 0===i||i.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const n=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,n)=>{i?t.adoptedStyleSheets=n.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):n.forEach((i=>{const n=document.createElement("style"),r=e.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=i.cssText,t.appendChild(n)}))})(n,this.constructor.elementStyles),n}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EO(t,e,i=m){var n;const r=this.constructor._$Ep(t,i);if(void 0!==r&&!0===i.reflect){const s=(void 0!==(null===(n=i.converter)||void 0===n?void 0:n.toAttribute)?i.converter:f).toAttribute(e,i.type);this._$El=t,null==s?this.removeAttribute(r):this.setAttribute(r,s),this._$El=null}}_$AK(t,e){var i;const n=this.constructor,r=n._$Ev.get(t);if(void 0!==r&&this._$El!==r){const t=n.getPropertyOptions(r),s="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(i=t.converter)||void 0===i?void 0:i.fromAttribute)?t.converter:f;this._$El=r,this[r]=s.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,i){let n=!0;void 0!==t&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||p)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===i.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,i))):n=!1),!this.isUpdatePending&&n&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,e)=>this[e]=t)),this._$Ei=void 0);let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(i)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$EO(e,this[e],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var w;v.finalized=!0,v.elementProperties=new Map,v.elementStyles=[],v.shadowRootOptions={mode:"open"},null==u||u({ReactiveElement:v}),(null!==(c=h.reactiveElementVersions)&&void 0!==c?c:h.reactiveElementVersions=[]).push("1.6.1");const y=window,C=y.trustedTypes,x=C?C.createPolicy("lit-html",{createHTML:t=>t}):void 0,b=`lit$${(Math.random()+"").slice(9)}$`,_="?"+b,R=`<${_}>`,S=document,D=(t="")=>S.createComment(t),k=t=>null===t||"object"!=typeof t&&"function"!=typeof t,A=Array.isArray,E=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,B=/-->/g,$=/>/g,T=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),M=/'/g,N=/"/g,P=/^(?:script|style|textarea|title)$/i,L=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),U=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),O=new WeakMap,F=S.createTreeWalker(S,129,null,!1),H=(t,e)=>{const i=t.length-1,n=[];let r,s=2===e?"<svg>":"",o=E;for(let e=0;e<i;e++){const i=t[e];let a,c,h=-1,d=0;for(;d<i.length&&(o.lastIndex=d,c=o.exec(i),null!==c);)d=o.lastIndex,o===E?"!--"===c[1]?o=B:void 0!==c[1]?o=$:void 0!==c[2]?(P.test(c[2])&&(r=RegExp("</"+c[2],"g")),o=T):void 0!==c[3]&&(o=T):o===T?">"===c[0]?(o=null!=r?r:E,h=-1):void 0===c[1]?h=-2:(h=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?T:'"'===c[3]?N:M):o===N||o===M?o=T:o===B||o===$?o=E:(o=T,r=void 0);const l=o===T&&t[e+1].startsWith("/>")?" ":"";s+=o===E?i+R:h>=0?(n.push(a),i.slice(0,h)+"$lit$"+i.slice(h)+b+l):i+b+(-2===h?(n.push(void 0),e):l)}const a=s+(t[i]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==x?x.createHTML(a):a,n]};class I{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,s=0;const o=t.length-1,a=this.parts,[c,h]=H(t,e);if(this.el=I.createElement(c,i),F.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(n=F.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes()){const t=[];for(const e of n.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(b)){const i=h[s++];if(t.push(e),void 0!==i){const t=n.getAttribute(i.toLowerCase()+"$lit$").split(b),e=/([.?@])?(.*)/.exec(i);a.push({type:1,index:r,name:e[2],strings:t,ctor:"."===e[1]?G:"?"===e[1]?Y:"@"===e[1]?Z:q})}else a.push({type:6,index:r})}for(const e of t)n.removeAttribute(e)}if(P.test(n.tagName)){const t=n.textContent.split(b),e=t.length-1;if(e>0){n.textContent=C?C.emptyScript:"";for(let i=0;i<e;i++)n.append(t[i],D()),F.nextNode(),a.push({type:2,index:++r});n.append(t[e],D())}}}else if(8===n.nodeType)if(n.data===_)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=n.data.indexOf(b,t+1));)a.push({type:7,index:r}),t+=b.length-1}r++}}static createElement(t,e){const i=S.createElement("template");return i.innerHTML=t,i}}function j(t,e,i=t,n){var r,s,o,a;if(e===U)return e;let c=void 0!==n?null===(r=i._$Co)||void 0===r?void 0:r[n]:i._$Cl;const h=k(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==h&&(null===(s=null==c?void 0:c._$AO)||void 0===s||s.call(c,!1),void 0===h?c=void 0:(c=new h(t),c._$AT(t,i,n)),void 0!==n?(null!==(o=(a=i)._$Co)&&void 0!==o?o:a._$Co=[])[n]=c:i._$Cl=c),void 0!==c&&(e=j(t,c._$AS(t,e.values),c,n)),e}class V{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:i},parts:n}=this._$AD,r=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:S).importNode(i,!0);F.currentNode=r;let s=F.nextNode(),o=0,a=0,c=n[0];for(;void 0!==c;){if(o===c.index){let e;2===c.type?e=new z(s,s.nextSibling,this,t):1===c.type?e=new c.ctor(s,c.name,c.strings,this,t):6===c.type&&(e=new Q(s,this,t)),this.u.push(e),c=n[++a]}o!==(null==c?void 0:c.index)&&(s=F.nextNode(),o++)}return r}p(t){let e=0;for(const i of this.u)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class z{constructor(t,e,i,n){var r;this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cm=null===(r=null==n?void 0:n.isConnected)||void 0===r||r}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=j(this,t,e),k(t)?t===W||null==t||""===t?(this._$AH!==W&&this._$AR(),this._$AH=W):t!==this._$AH&&t!==U&&this.g(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>A(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==W&&k(this._$AH)?this._$AA.nextSibling.data=t:this.T(S.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r="number"==typeof n?this._$AC(t):(void 0===n.el&&(n.el=I.createElement(n.h,this.options)),n);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===r)this._$AH.p(i);else{const t=new V(r,this),e=t.v(this.options);t.p(i),this.T(e),this._$AH=t}}_$AC(t){let e=O.get(t.strings);return void 0===e&&O.set(t.strings,e=new I(t)),e}k(t){A(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new z(this.O(D()),this.O(D()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cm=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class q{constructor(t,e,i,n,r){this.type=1,this._$AH=W,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=W}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,n){const r=this.strings;let s=!1;if(void 0===r)t=j(this,t,e,0),s=!k(t)||t!==this._$AH&&t!==U,s&&(this._$AH=t);else{const n=t;let o,a;for(t=r[0],o=0;o<r.length-1;o++)a=j(this,n[i+o],e,o),a===U&&(a=this._$AH[o]),s||(s=!k(a)||a!==this._$AH[o]),a===W?t=W:t!==W&&(t+=(null!=a?a:"")+r[o+1]),this._$AH[o]=a}s&&!n&&this.j(t)}j(t){t===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class G extends q{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===W?void 0:t}}const X=C?C.emptyScript:"";class Y extends q{constructor(){super(...arguments),this.type=4}j(t){t&&t!==W?this.element.setAttribute(this.name,X):this.element.removeAttribute(this.name)}}class Z extends q{constructor(t,e,i,n,r){super(t,e,i,n,r),this.type=5}_$AI(t,e=this){var i;if((t=null!==(i=j(this,t,e,0))&&void 0!==i?i:W)===U)return;const n=this._$AH,r=t===W&&n!==W||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==W&&(n===W||r);r&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this._$AH.handleEvent(t)}}class Q{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){j(this,t)}}const K=y.litHtmlPolyfillSupport;null==K||K(I,z),(null!==(w=y.litHtmlVersions)&&void 0!==w?w:y.litHtmlVersions=[]).push("2.6.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var J,tt;class et extends v{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=i.firstChild),i}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,i)=>{var n,r;const s=null!==(n=null==i?void 0:i.renderBefore)&&void 0!==n?n:e;let o=s._$litPart$;if(void 0===o){const t=null!==(r=null==i?void 0:i.renderBefore)&&void 0!==r?r:null;s._$litPart$=o=new z(e.insertBefore(D(),t),t,void 0,null!=i?i:{})}return o._$AI(t),o})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return U}}et.finalized=!0,et._$litElement$=!0,null===(J=globalThis.litElementHydrateSupport)||void 0===J||J.call(globalThis,{LitElement:et});const it=globalThis.litElementPolyfillSupport;null==it||it({LitElement:et}),(null!==(tt=globalThis.litElementVersions)&&void 0!==tt?tt:globalThis.litElementVersions=[]).push("3.2.2");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function nt(t,e){return(({finisher:t,descriptor:e})=>(i,n)=>{var r;if(void 0===n){const n=null!==(r=i.originalKey)&&void 0!==r?r:i.key,s=null!=e?{kind:"method",placement:"prototype",key:n,descriptor:e(i.key)}:{...i,key:n};return null!=t&&(s.finisher=function(e){t(e,n)}),s}{const r=i.constructor;void 0!==e&&Object.defineProperty(i,n,e(n)),null==t||t(r,n)}})({descriptor:i=>{const n={get(){var e,i;return null!==(i=null===(e=this.renderRoot)||void 0===e?void 0:e.querySelector(t))&&void 0!==i?i:null},enumerable:!0,configurable:!0};if(e){const e="symbol"==typeof i?Symbol():"__"+i;n.get=function(){var i,n;return void 0===this[e]&&(this[e]=null!==(n=null===(i=this.renderRoot)||void 0===i?void 0:i.querySelector(t))&&void 0!==n?n:null),this[e]}}return n}})}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var rt;null===(rt=window.HTMLSlotElement)||void 0===rt||rt.prototype.assignedElements;class st{}st.defaultCardinalDirectionLetters="NESW",st.defaultWindspeedBarLocation="bottom",st.defaultHoursToShow=4,st.defaultRefreshInterval=300,st.defaultWindDirectionCount=16,st.defaultWindDirectionUnit="degrees",st.defaultInputSpeedUnit="auto",st.defaultOutputSpeedUnit="mps",st.defaultWindspeedBarFull=!0,st.defaultMatchingStategy="direction-first",st.defaultCenterCalmPercentage=!0,st.defaultSpeedRangeBeaufort=!0;class ot{constructor(t,e,i,n){this.range=t,this.minSpeed=e,this.maxSpeed=i,this.color=n}isRangeMatch(t){return t>=this.minSpeed&&(t<this.maxSpeed||-1===this.maxSpeed)}}class at{constructor(){const t=getComputedStyle(document.documentElement).getPropertyValue("--primary-text-color");this.roseLines="rgb(160, 160, 160)",this.roseDirectionLetters=t,this.roseCenterPercentage="auto",this.rosePercentages=t,this.roseCurrentDirectionArrow="red",this.barBorder="rgb(160, 160, 160)",this.barUnitName=t,this.barName=t,this.barUnitValues=t,this.barPercentages="auto"}}class ct{static setLevel(t){switch(t){case"NONE":this.level=0;break;case"ERROR":this.level=1;break;case"WARN":this.level=2;break;case"INFO":this.level=3;break;case"DEBUG":this.level=4;break;case"TRACE":this.level=5;break;default:this.level=0,this.error("Unkonwn log level set: ",t," default to WARN")}this.level>2&&console.log("WR LOG level set to:",t)}static checkLogLevel(t){if(void 0===t)return"WARN";if("NONE"===t||"ERROR"===t||"WARN"===t||"INFO"===t||"DEBUG"===t||"TRACE"===t)return t;throw new Error("Unkonwn log level configurated: "+t)}static error(t,...e){this.level>=1&&(0===e.length?console.error("WR ERROR "+t):console.error("WR ERROR "+t,e[0]))}static warn(t,...e){this.level>=2&&(0===e.length?console.warn("WR WARN "+t):console.warn("WR WARN "+t,e[0]))}static info(t,...e){this.level>=3&&this.log("INFO "+t,e)}static debug(t,...e){this.level>=4&&this.log("DEBUG "+t,e)}static trace(t,...e){5===this.level&&this.log("TRACE "+t,e)}static log(t,...e){0===e[0].length?console.log("WR "+t):console.log("WR "+t,e[0])}}ct.level=0;class ht{constructor(t,e,i,n,r){this.entity=t,this.name=e,this.useStatistics=i,this.renderRelativeScale=n,this.speedUnit=r}}class dt{constructor(t,e,i,n,r){this.entity=t,this.useStatistics=e,this.directionUnit=i,this.directionCompensation=n,this.directionLetters=r}}class lt{constructor(t,e){this.hourstoShow=t,this.fromHourOfDay=e}}class ut{constructor(t,e){this.autoRotate=t,this.entity=e}}class ft{static exampleConfig(){return{title:"Wind direction",data_period:{hours_to_show:st.defaultHoursToShow},refresh_interval:st.defaultRefreshInterval,windspeed_bar_location:st.defaultWindspeedBarLocation,windspeed_bar_full:st.defaultWindspeedBarFull,wind_direction_entity:{entity:"",direction_unit:st.defaultWindDirectionUnit,use_statistics:!1,direction_compensation:0},windspeed_entities:[{entity:"",name:"",speed_unit:st.defaultInputSpeedUnit,use_statistics:!1}],output_speed_unit:st.defaultOutputSpeedUnit,speed_range_beaufort:st.defaultSpeedRangeBeaufort,speed_range_step:void 0,speed_range_max:void 0,speed_ranges:void 0,windrose_draw_north_offset:0,show_current_direction_arrow:!0,compass_direction:{auto_rotate:!1,entity:""},cardinal_direction_letters:st.defaultCardinalDirectionLetters,matching_strategy:st.defaultMatchingStategy,center_calm_percentage:st.defaultCenterCalmPercentage,log_level:st.defaultLogLevel}}constructor(t){this.cardConfig=t,this.speedRanges=[],this.title=this.cardConfig.title,this.dataPeriod=this.checkDataPeriod(t.hours_to_show,t.data_period),this.refreshInterval=this.checkRefreshInterval(),this.windDirectionEntity=this.checkWindDirectionEntity(),this.windspeedEntities=this.checkWindspeedEntities(),this.windRoseDrawNorthOffset=this.checkwindRoseDrawNorthOffset(),this.showCurrentDirectionArrow=this.checkBooleanDefaultFalse(t.show_current_direction_arrow),this.windspeedBarLocation=this.checkWindspeedBarLocation(),this.windspeedBarFull=this.checkBooleanDefaultTrue(t.windspeed_bar_full),this.hideWindspeedBar=this.checkBooleanDefaultFalse(t.hide_windspeed_bar),this.centerCalmPercentage=this.checkBooleanDefaultTrue(t.center_calm_percentage),this.cardinalDirectionLetters=this.checkCardinalDirectionLetters(),this.windDirectionCount=this.checkWindDirectionCount(),this.outputSpeedUnit=this.checkOutputSpeedUnit(),this.outputSpeedUnitLabel=this.checkOutputSpeedUnitLabel(),this.speedRangeBeaufort=this.checkBooleanDefaultTrue(t.speed_range_beaufort),this.speedRangeStep=this.checkSpeedRangeStep(),this.speedRangeMax=this.checkSpeedRangeMax(),this.speedRanges=this.checkSpeedRanges(),this.checkSpeedRangeCombi(),this.matchingStrategy=this.checkMatchingStrategy(),this.filterEntitiesQueryParameter=this.createEntitiesQueryParameter(),this.cardColor=this.checkCardColors(),this.compassConfig=this.checkCompassConfig(t.compass_direction),this.logLevel=ct.checkLogLevel(this.cardConfig.log_level),ct.info("Config check OK")}windBarCount(){return this.hideWindspeedBar?0:this.windspeedEntities.length}checkDataPeriod(t,e){const i=this.checkHoursToShow(t),n=this.checkHoursToShow(null==e?void 0:e.hours_to_show),r=this.checkFromHourOfDay(null==e?void 0:e.from_hour_of_day);if(i)return ct.warn("WindRoseCard: hours_to_show config is deprecated, use the data_period object."),new lt(t,void 0);if(n&&r)throw new Error("WindRoseCard: Only one is allowed: hours_to_show or from_hour_of_day");if(!n&&!r)throw new Error("WindRoseCard: One config option object data_period should be filled.");return new lt(e.hours_to_show,e.from_hour_of_day)}checkHoursToShow(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number above 0.");return!!t}checkFromHourOfDay(t){if(t&&(isNaN(t)||t<0||t>23))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number between 0 and 23, hour of the day..");return null!=t&&t>=0}checkRefreshInterval(){if(this.cardConfig.refresh_interval&&isNaN(this.cardConfig.refresh_interval))throw new Error("WindRoseCard: Invalid refresh_interval, should be a number in seconds.");return this.cardConfig.refresh_interval?this.cardConfig.refresh_interval:st.defaultRefreshInterval}checkWindDirectionEntity(){if(this.cardConfig.wind_direction_entity){const t=this.cardConfig.wind_direction_entity;if(void 0===t.entity)throw new Error("WindRoseCard: No wind_direction_entity.entity configured.");const e=t.entity,i=this.checkBooleanDefaultFalse(t.use_statistics),n=this.checkWindDirectionUnit(t.direction_unit),r=this.checkDirectionCompensation(t.direction_compensation),s=this.checkDirectionLetters(n,t.direction_letters);return new dt(e,i,n,r,s)}throw new Error("WindRoseCard: No wind_direction_entity configured.")}checkWindDirectionUnit(t){if(t){if("degrees"!==t&&"letters"!==t)throw new Error("Invalid wind direction unit configured: "+t+". Valid options: degrees, letters");return t}return st.defaultWindDirectionUnit}checkWindspeedEntities(){if(!this.cardConfig.windspeed_entities||0==this.cardConfig.windspeed_entities.length)throw new Error("WindRoseCard: No wind_speed_entities configured, minimal 1 needed.");const t=[];for(const e of this.cardConfig.windspeed_entities){const i=e.entity,n=e.name,r=this.checkBooleanDefaultFalse(e.use_statistics),s=this.checkInputSpeedUnit(e.speed_unit),o=this.checkBooleanDefaultTrue(e.render_relative_scale);t.push(new ht(i,n,r,o,s))}return t}checkInputSpeedUnit(t){if(t){if("mps"!==t&&"bft"!==t&&"kph"!==t&&"mph"!==t&&"fps"!==t&&"knots"!==t&&"auto"!==t)throw new Error("Invalid windspeed unit configured: "+t+". Valid options: mps, bft, fps, kph, mph, knots, auto");return t}return st.defaultInputSpeedUnit}checkDirectionCompensation(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid direction compensation, should be a number in degress between 0 and 360.");return t||0}checkDirectionLetters(t,e){if(e){if("letters"===t){if(e&&5===e.length)return e.toUpperCase();throw new Error("WindRoseCard: direction_letters config should be 5 letters.")}throw new Error("WindRoseCard: config direction_letters should only be use in combination with direction_unit letters.")}}checkwindRoseDrawNorthOffset(){if(this.cardConfig.windrose_draw_north_offset&&isNaN(this.cardConfig.windrose_draw_north_offset))throw new Error("WindRoseCard: Invalid render direction offset, should be a number in degress between 0 and 360.");return this.cardConfig.windrose_draw_north_offset?this.cardConfig.windrose_draw_north_offset:0}checkWindspeedBarLocation(){if(this.cardConfig.windspeed_bar_location){if("bottom"!==this.cardConfig.windspeed_bar_location&&"right"!==this.cardConfig.windspeed_bar_location)throw new Error("Invalid windspeed bar location "+this.cardConfig.windspeed_bar_location+". Valid options: bottom, right");return this.cardConfig.windspeed_bar_location}return st.defaultWindspeedBarLocation}checkBooleanDefaultFalse(t){return null!=t&&t}checkBooleanDefaultTrue(t){return null==t||t}checkCardinalDirectionLetters(){if(this.cardConfig.cardinal_direction_letters){if(4!==this.cardConfig.cardinal_direction_letters.length)throw new Error("Cardinal direction letters option should contain 4 letters.");return this.cardConfig.cardinal_direction_letters}return st.defaultCardinalDirectionLetters}checkWindDirectionCount(){if(this.cardConfig.wind_direction_count){if(isNaN(this.cardConfig.wind_direction_count)||this.cardConfig.wind_direction_count<4||this.cardConfig.wind_direction_count>32)throw new Error("Wind direction count can a number between 4 and 32");return this.cardConfig.wind_direction_count}return st.defaultWindDirectionCount}checkOutputSpeedUnit(){if(this.cardConfig.output_speed_unit){if("mps"!==this.cardConfig.output_speed_unit&&"kph"!==this.cardConfig.output_speed_unit&&"mph"!==this.cardConfig.output_speed_unit&&"fps"!==this.cardConfig.output_speed_unit&&"knots"!==this.cardConfig.output_speed_unit)throw new Error("Invalid output windspeed unit configured: "+this.cardConfig.output_speed_unit+". Valid options: mps, fps, kph, mph, knots");return this.cardConfig.output_speed_unit}return st.defaultOutputSpeedUnit}checkOutputSpeedUnitLabel(){if(this.cardConfig.output_speed_unit_label)return this.cardConfig.output_speed_unit_label}checkSpeedRangeStep(){if(this.cardConfig.speed_range_step&&isNaN(this.cardConfig.speed_range_step))throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step<=0)throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step)return this.cardConfig.speed_range_step}checkSpeedRangeMax(){if(this.cardConfig.speed_range_max&&isNaN(this.cardConfig.speed_range_max))throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max<=0)throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max)return this.cardConfig.speed_range_max}checkSpeedRanges(){const t=[];if(this.cardConfig.speed_ranges&&this.cardConfig.speed_ranges.length>0){const e=this.cardConfig.speed_ranges.slice();e.sort(((t,e)=>t.from_value-e.from_value));const i=e.length-1;for(let n=0;n<i;n++)t.push(new ot(n,e[n].from_value,e[n+1].from_value,e[n].color));t.push(new ot(i,e[i].from_value,-1,e[i].color))}return t}checkSpeedRangeCombi(){if("bft"===this.outputSpeedUnit&&(this.speedRangeStep||this.speedRangeMax))throw new Error("WindRoseCard: speed_range_step and/or speed_range_max should not be set when using output speed unit Beaufort (bft). Beaufort uses fixed speed ranges.");if(this.speedRangeStep&&!this.speedRangeMax||!this.speedRangeStep&&this.speedRangeMax)throw new Error("WindRoseCard: speed_range_step and speed_range_max should both be set.")}checkMatchingStrategy(){if(this.cardConfig.matching_strategy){if("direction-first"!==this.cardConfig.matching_strategy&&"speed-first"!==this.cardConfig.matching_strategy)throw new Error("Invalid matching stategy "+this.cardConfig.matching_strategy+". Valid options: direction-first, speed-first");return this.cardConfig.matching_strategy}return st.defaultMatchingStategy}createEntitiesQueryParameter(){return this.windDirectionEntity+","+this.windspeedEntities.map((t=>t.entity)).join(",")}checkCompassConfig(t){let e,i=!1;if(t&&(i=this.checkBooleanDefaultFalse(t.auto_rotate),i)){if(!t.entity)throw new Error("WindRoseCard: compass direction auto rotate set to true, but no entity configured.");e=t.entity}return new ut(i,e)}createRawEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics||t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>!t.useStatistics)).map((t=>t.entity)))}createStatisticsEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics&&t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>t.useStatistics)).map((t=>t.entity)))}checkCardColors(){const t=new at;return this.cardConfig.colors&&(this.cardConfig.colors.rose_direction_letters&&(t.roseDirectionLetters=this.cardConfig.colors.rose_direction_letters),this.cardConfig.colors.rose_lines&&(t.roseLines=this.cardConfig.colors.rose_lines),this.cardConfig.colors.rose_percentages&&(t.rosePercentages=this.cardConfig.colors.rose_percentages),this.cardConfig.colors.rose_center_percentage&&(t.roseCenterPercentage=this.cardConfig.colors.rose_center_percentage),this.cardConfig.colors.rose_current_direction_arrow&&(t.roseCurrentDirectionArrow=this.cardConfig.colors.rose_current_direction_arrow),this.cardConfig.colors.bar_border&&(t.barBorder=this.cardConfig.colors.bar_border),this.cardConfig.colors.bar_name&&(t.barName=this.cardConfig.colors.bar_name),this.cardConfig.colors.bar_percentages&&(t.barPercentages=this.cardConfig.colors.bar_percentages),this.cardConfig.colors.bar_unit_name&&(t.barUnitName=this.cardConfig.colors.bar_unit_name),this.cardConfig.colors.bar_unit_values&&(t.barUnitValues=this.cardConfig.colors.bar_unit_values)),t}}class gt{static toRadians(t){return t*(Math.PI/180)}}var pt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function mt(t,e){return t(e={exports:{}},e.exports),e.exports}var vt=mt((function(t){!function(e){var i,n,r="0.5.4",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,c=function(t,e){return t-e},h={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},l=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=Object.prototype.toString,f=String,g=Array.isArray||function(t){return t instanceof Array||"[object Array]"==u.call(t)},p=function(t,e){var r,s=n,o=Array.prototype.slice.call(arguments,2),a=p.listeners(t),h=0,u=[],f={},g=[],m=i;g.firstDefined=d,g.lastDefined=l,i=t,n=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(u.push(a[v].zIndex),a[v].zIndex<0&&(f[a[v].zIndex]=a[v]));for(u.sort(c);u[h]<0;)if(r=f[u[h++]],g.push(r.apply(e,o)),n)return n=s,g;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==u[h]){if(g.push(r.apply(e,o)),n)break;do{if((r=f[u[++h]])&&g.push(r.apply(e,o)),n)break}while(r)}else f[r.zIndex]=r;else if(g.push(r.apply(e,o)),n)break;return n=s,i=m,g};p._events=h,p.listeners=function(t){var e,i,n,r,s,a,c,d,l=g(t)?t:t.split(o),u=h,f=[u],p=[];for(r=0,s=l.length;r<s;r++){for(d=[],a=0,c=f.length;a<c;a++)for(i=[(u=f[a].n)[l[r]],u["*"]],n=2;n--;)(e=i[n])&&(d.push(e),p=p.concat(e.f||[]));f=d}return p},p.separator=function(t){t?(t="["+(t=f(t).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",o=new RegExp(t)):o=/[\.\/]/},p.on=function(t,e){if("function"!=typeof e)return function(){};for(var i=g(t)?g(t[0])?t:[t]:f(t).split(a),n=0,r=i.length;n<r;n++)!function(t){for(var i,n=g(t)?t:f(t).split(o),r=h,s=0,a=n.length;s<a;s++)r=(r=r.n).hasOwnProperty(n[s])&&r[n[s]]||(r[n[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){i=!0;break}!i&&r.f.push(e)}(i[n]);return function(t){+t==+t&&(e.zIndex=+t)}},p.f=function(t){var e=[].slice.call(arguments,1);return function(){p.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},p.stop=function(){n=1},p.nt=function(t){var e=g(i)?i.join("."):i;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},p.nts=function(){return g(i)?i:i.split(o)},p.off=p.unbind=function(t,e){if(t){var i=g(t)?g(t[0])?t:[t]:f(t).split(a);if(i.length>1)for(var n=0,r=i.length;n<r;n++)p.off(i[n],e);else{i=g(t)?t:f(t).split(o);var c,d,l,u,m,v=[h],w=[];for(n=0,r=i.length;n<r;n++)for(u=0;u<v.length;u+=l.length-2){if(l=[u,1],c=v[u].n,"*"!=i[n])c[i[n]]&&(l.push(c[i[n]]),w.unshift({n:c,name:i[n]}));else for(d in c)c[s](d)&&(l.push(c[d]),w.unshift({n:c,name:d}));v.splice.apply(v,l)}for(n=0,r=v.length;n<r;n++)for(c=v[n];c.n;){if(e){if(c.f){for(u=0,m=c.f.length;u<m;u++)if(c.f[u]==e){c.f.splice(u,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[s](d)&&c.n[d].f){var y=c.n[d].f;for(u=0,m=y.length;u<m;u++)if(y[u]==e){y.splice(u,1);break}!y.length&&delete c.n[d].f}}else for(d in delete c.f,c.n)c.n[s](d)&&c.n[d].f&&delete c.n[d].f;c=c.n}t:for(n=0,r=w.length;n<r;n++){for(d in(c=w[n]).n[c.name].f)continue t;for(d in c.n[c.name].n)continue t;delete c.n[c.name]}}}else p._events=h={n:{}}},p.once=function(t,e){var i=function(){return p.off(t,i),e.apply(this,arguments)};return p.on(t,i)},p.version=r,p.toString=function(){return"You are running Eve "+r},e.eve=p,t.exports?t.exports=p:e.eve=p}("undefined"!=typeof window?window:pt)})),wt=mt((function(t,e){var i,n;!function(e){var i,n,r="0.4.2",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,c=function(t,e){return t-e},h={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},l=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=function(t,e){t=String(t);var r,s=n,o=Array.prototype.slice.call(arguments,2),a=u.listeners(t),h=0,f=[],g={},p=[],m=i;p.firstDefined=d,p.lastDefined=l,i=t,n=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(f.push(a[v].zIndex),a[v].zIndex<0&&(g[a[v].zIndex]=a[v]));for(f.sort(c);f[h]<0;)if(r=g[f[h++]],p.push(r.apply(e,o)),n)return n=s,p;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==f[h]){if(p.push(r.apply(e,o)),n)break;do{if((r=g[f[++h]])&&p.push(r.apply(e,o)),n)break}while(r)}else g[r.zIndex]=r;else if(p.push(r.apply(e,o)),n)break;return n=s,i=m,p};u._events=h,u.listeners=function(t){var e,i,n,r,s,a,c,d,l=t.split(o),u=h,f=[u],g=[];for(r=0,s=l.length;r<s;r++){for(d=[],a=0,c=f.length;a<c;a++)for(i=[(u=f[a].n)[l[r]],u["*"]],n=2;n--;)(e=i[n])&&(d.push(e),g=g.concat(e.f||[]));f=d}return g},u.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var i=t.split(a),n=0,r=i.length;n<r;n++)!function(t){for(var i,n=t.split(o),r=h,s=0,a=n.length;s<a;s++)r=(r=r.n).hasOwnProperty(n[s])&&r[n[s]]||(r[n[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){i=!0;break}!i&&r.f.push(e)}(i[n]);return function(t){+t==+t&&(e.zIndex=+t)}},u.f=function(t){var e=[].slice.call(arguments,1);return function(){u.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},u.stop=function(){n=1},u.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(i):i},u.nts=function(){return i.split(o)},u.off=u.unbind=function(t,e){if(t){var i=t.split(a);if(i.length>1)for(var n=0,r=i.length;n<r;n++)u.off(i[n],e);else{i=t.split(o);var c,d,l,f,g,p=[h];for(n=0,r=i.length;n<r;n++)for(f=0;f<p.length;f+=l.length-2){if(l=[f,1],c=p[f].n,"*"!=i[n])c[i[n]]&&l.push(c[i[n]]);else for(d in c)c[s](d)&&l.push(c[d]);p.splice.apply(p,l)}for(n=0,r=p.length;n<r;n++)for(c=p[n];c.n;){if(e){if(c.f){for(f=0,g=c.f.length;f<g;f++)if(c.f[f]==e){c.f.splice(f,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[s](d)&&c.n[d].f){var m=c.n[d].f;for(f=0,g=m.length;f<g;f++)if(m[f]==e){m.splice(f,1);break}!m.length&&delete c.n[d].f}}else for(d in delete c.f,c.n)c.n[s](d)&&c.n[d].f&&delete c.n[d].f;c=c.n}}}else u._events=h={n:{}}},u.once=function(t,e){var i=function(){return u.unbind(t,i),e.apply(this,arguments)};return u.on(t,i)},u.version=r,u.toString=function(){return"You are running Eve "+r},t.exports?t.exports=u:e.eve=u}(pt),i=window||pt,n=vt,t.exports=function(t,e){var i=function(e){var i={},n=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},r=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},s=0,o="M"+(+new Date).toString(36),a=function(){return o+(s++).toString(36)},c=Date.now||function(){return+new Date},h=function(t){var e=this;if(null==t)return e.s;var i=e.s-t;e.b+=e.dur*i,e.B+=e.dur*i,e.s=t},d=function(t){var e=this;if(null==t)return e.spd;e.spd=t},l=function(t){var e=this;if(null==t)return e.dur;e.s=e.s*t/e.dur,e.dur=t},u=function(){var t=this;delete i[t.id],t.update(),e("mina.stop."+t.id,t)},f=function(){var t=this;t.pdif||(delete i[t.id],t.update(),t.pdif=t.get()-t.b)},g=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,i[t.id]=t)},p=function(){var t,e=this;if(r(e.start)){t=[];for(var i=0,n=e.start.length;i<n;i++)t[i]=+e.start[i]+(e.end[i]-e.start[i])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},m=function(){var t=0;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],o=s.get();t++,s.s=(o-s.b)/(s.dur/s.spd),s.s>=1&&(delete i[r],s.s=1,t--,function(t){setTimeout((function(){e("mina.finish."+t.id,t)}))}(s)),s.update()}t&&n(m)},v=function(t,e,r,s,o,c,w){var y={id:a(),start:t,end:e,b:r,s:0,dur:s-r,spd:1,get:o,set:c,easing:w||v.linear,status:h,speed:d,duration:l,stop:u,pause:f,resume:g,update:p};i[y.id]=y;var C,x=0;for(C in i)if(i.hasOwnProperty(C)&&2==++x)break;return 1==x&&n(m),y};return v.time=c,v.getById=function(t){return i[t]||null},v.linear=function(t){return t},v.easeout=function(t){return Math.pow(t,1.7)},v.easein=function(t){return Math.pow(t,.48)},v.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,i=Math.sqrt(.1734+e*e),n=i-e,r=-i-e,s=Math.pow(Math.abs(n),1/3)*(n<0?-1:1)+Math.pow(Math.abs(r),1/3)*(r<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},v.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},v.backout=function(t){if(0==t)return 0;var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},v.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},v.bounce=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},t.mina=v,v}(void 0===e?function(){}:e),n=function(t){function i(t,e){if(t){if(t.nodeType)return it(t);if(T(t,"array")&&i.set)return i.set.apply(i,t);if(t instanceof K)return t;if(null==e)return it(t=n.doc.querySelector(String(t)))}return new et(t=null==t?"100%":t,e=null==e?"100%":e)}i.version="0.4.0",i.toString=function(){return"Snap v"+this.version},i._={};var n={win:t.window,doc:t.window.document};i._.glob=n;var r="hasOwnProperty",s=String,o=parseFloat,a=parseInt,c=Math,h=c.max,d=c.min,l=c.abs,u=c.PI,f="",p=Object.prototype.toString,m=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i;i._.separator=/[,\s]+/;var v,w,y,C=/[\s]*,[\s]*/,x={hs:1,rg:1},b=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,_=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,R=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,S=0,D="S"+(+new Date).toString(36),k=function(t){return(t&&t.type?t.type:f)+D+(S++).toString(36)},A="http://www.w3.org/1999/xlink",E="http://www.w3.org/2000/svg",B={};function $(t,e){if(e){if("#text"==t&&(t=n.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=n.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=$(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(A,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(E,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var i in e)if(e[r](i)){var o=s(e[i]);o?"xlink:"==i.substring(0,6)?t.setAttributeNS(A,i.substring(6),o):"xml:"==i.substring(0,4)?t.setAttributeNS(E,i.substring(4),o):t.setAttribute(i,o):t.removeAttribute(i)}}else"text"in e&&(t.nodeValue=e.text)}else t=n.doc.createElementNS(E,t);return t}function T(t,e){return"finite"==(e=s.prototype.toLowerCase.call(e))?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||p.call(t).slice(8,-1).toLowerCase()==e}function M(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[r](i)&&(e[i]=M(t[i]));return e}function N(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function P(t,e,i){function n(){var s=Array.prototype.slice.call(arguments,0),o=s.join("␀"),a=n.cache=n.cache||{},c=n.count=n.count||[];return a[r](o)?(N(c,o),i?i(a[o]):a[o]):(c.length>=1e3&&delete a[c.shift()],c.push(o),a[o]=t.apply(e,s),i?i(a[o]):a[o])}return n}function L(t,e,i,n,r,s){if(null==r){var o=t-i,a=e-n;return o||a?(180+180*c.atan2(-a,-o)/u+360)%360:0}return L(t,e,r,s)-L(i,n,r,s)}function U(t){return t%360*u/180}function W(t){return 180*t/u%360}i.url=function(t){return"url('#"+t+"')"},i._.$=$,i._.id=k,i.format=(v=/\{([^\}]+)\}/g,w=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,y=function(t,e,i){var n=i;return e.replace(w,(function(t,e,i,r,s){e=e||r,n&&(e in n&&(n=n[e]),"function"==typeof n&&s&&(n=n()))})),n=(null==n||n==i?t:n)+""},function(t,e){return s(t).replace(v,(function(t,i){return y(t,i,e)}))}),i._.clone=M,i._.cacher=P,i.rad=U,i.deg=W,i.sin=function(t){return c.sin(i.rad(t))},i.tan=function(t){return c.tan(i.rad(t))},i.cos=function(t){return c.cos(i.rad(t))},i.asin=function(t){return i.deg(c.asin(t))},i.acos=function(t){return i.deg(c.acos(t))},i.atan=function(t){return i.deg(c.atan(t))},i.atan2=function(t){return i.deg(c.atan2(t))},i.angle=L,i.len=function(t,e,n,r){return Math.sqrt(i.len2(t,e,n,r))},i.len2=function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},i.closestPoint=function(t,e,i){function n(t){var n=t.x-e,r=t.y-i;return n*n+r*r}for(var r,s,o,a,c=t.node,h=c.getTotalLength(),d=h/c.pathSegList.numberOfItems*.125,l=1/0,u=0;u<=h;u+=d)(a=n(o=c.getPointAtLength(u)))<l&&(r=o,s=u,l=a);for(d*=.5;d>.5;){var f,g,p,m,v,w;(p=s-d)>=0&&(v=n(f=c.getPointAtLength(p)))<l?(r=f,s=p,l=v):(m=s+d)<=h&&(w=n(g=c.getPointAtLength(m)))<l?(r=g,s=m,l=w):d*=.5}return r={x:r.x,y:r.y,length:s,distance:Math.sqrt(l)}},i.is=T,i.snapTo=function(t,e,i){if(i=T(i,"finite")?i:10,T(t,"array")){for(var n=t.length;n--;)if(l(t[n]-e)<=i)return t[n]}else{var r=e%(t=+t);if(r<i)return e-r;if(r>t-i)return e-r+t}return e},i.getRGB=P((function(t){if(!t||(t=s(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:I};if(!x[r](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=O(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I};var e,n,l,u,f,g,p=t.match(m);return p?(p[2]&&(l=a(p[2].substring(5),16),n=a(p[2].substring(3,5),16),e=a(p[2].substring(1,3),16)),p[3]&&(l=a((f=p[3].charAt(3))+f,16),n=a((f=p[3].charAt(2))+f,16),e=a((f=p[3].charAt(1))+f,16)),p[4]&&(g=p[4].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e*=2.55),n=o(g[1]),"%"==g[1].slice(-1)&&(n*=2.55),l=o(g[2]),"%"==g[2].slice(-1)&&(l*=2.55),"rgba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100)),p[5]?(g=p[5].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),n=o(g[1]),"%"==g[1].slice(-1)&&(n/=100),l=o(g[2]),"%"==g[2].slice(-1)&&(l/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),i.hsb2rgb(e,n,l,u)):p[6]?(g=p[6].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),n=o(g[1]),"%"==g[1].slice(-1)&&(n/=100),l=o(g[2]),"%"==g[2].slice(-1)&&(l/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsla"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),i.hsl2rgb(e,n,l,u)):(e=d(c.round(e),255),n=d(c.round(n),255),l=d(c.round(l),255),u=d(h(u,0),1),(p={r:e,g:n,b:l,toString:I}).hex="#"+(16777216|l|n<<8|e<<16).toString(16).slice(1),p.opacity=T(u,"finite")?u:1,p)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I}}),i),i.hsb=P((function(t,e,n){return i.hsb2rgb(t,e,n).hex})),i.hsl=P((function(t,e,n){return i.hsl2rgb(t,e,n).hex})),i.rgb=P((function(t,e,i,n){if(T(n,"finite")){var r=c.round;return"rgba("+[r(t),r(e),r(i),+n.toFixed(2)]+")"}return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)}));var O=function(t){var e=n.doc.getElementsByTagName("head")[0]||n.doc.getElementsByTagName("svg")[0],i="rgb(255, 0, 0)";return O=P((function(t){if("red"==t.toLowerCase())return i;e.style.color=i,e.style.color=t;var r=n.doc.defaultView.getComputedStyle(e,f).getPropertyValue("color");return r==i?null:r})),O(t)},F=function(){return"hsb("+[this.h,this.s,this.b]+")"},H=function(){return"hsl("+[this.h,this.s,this.l]+")"},I=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},j=function(t,e,n){if(null==e&&T(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(n=t.b,e=t.g,t=t.r),null==e&&T(t,string)){var r=i.getRGB(t);t=r.r,e=r.g,n=r.b}return(t>1||e>1||n>1)&&(t/=255,e/=255,n/=255),[t,e,n]},V=function(t,e,n,r){var s={r:t=c.round(255*t),g:e=c.round(255*e),b:n=c.round(255*n),opacity:T(r,"finite")?r:1,hex:i.rgb(t,e,n),toString:I};return T(r,"finite")&&(s.opacity=r),s};i.color=function(t){var e;return T(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=i.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):T(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=i.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):(T(t,"string")&&(t=i.getRGB(t)),T(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(e=i.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=i.rgb2hsb(t),t.v=e.b):((t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=I,t},i.hsb2rgb=function(t,e,i,n){var r,s,o,a,c;return T(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,n=t.o,t=t.h),a=(c=i*e)*(1-l((t=(t*=360)%360/60)%2-1)),r=s=o=i-c,V(r+=[c,a,0,0,a,c][t=~~t],s+=[a,c,c,a,0,0][t],o+=[0,0,a,c,c,a][t],n)},i.hsl2rgb=function(t,e,i,n){var r,s,o,a,c;return T(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),a=(c=2*e*(i<.5?i:1-i))*(1-l((t=(t*=360)%360/60)%2-1)),r=s=o=i-c/2,V(r+=[c,a,0,0,a,c][t=~~t],s+=[a,c,c,a,0,0][t],o+=[0,0,a,c,c,a][t],n)},i.rgb2hsb=function(t,e,i){var n,r;return t=(i=j(t,e,i))[0],e=i[1],i=i[2],{h:((0==(r=(n=h(t,e,i))-d(t,e,i))?null:n==t?(e-i)/r:n==e?(i-t)/r+2:(t-e)/r+4)+360)%6*60/360,s:0==r?0:r/n,b:n,toString:F}},i.rgb2hsl=function(t,e,i){var n,r,s,o;return t=(i=j(t,e,i))[0],e=i[1],i=i[2],n=((r=h(t,e,i))+(s=d(t,e,i)))/2,{h:((0==(o=r-s)?null:r==t?(e-i)/o:r==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360,s:0==o?0:n<.5?o/(2*n):o/(2-2*n),l:n,toString:H}},i.parsePathString=function(t){if(!t)return null;var e=i.path(t);if(e.arr)return i.path.clone(e.arr);var n={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return T(t,"array")&&T(t[0],"array")&&(r=i.path.clone(t)),r.length||s(t).replace(b,(function(t,e,i){var s=[],o=e.toLowerCase();if(i.replace(R,(function(t,e){e&&s.push(+e)})),"m"==o&&s.length>2&&(r.push([e].concat(s.splice(0,2))),o="l",e="m"==e?"l":"L"),"o"==o&&1==s.length&&r.push([e,s[0]]),"r"==o)r.push([e].concat(s));else for(;s.length>=n[o]&&(r.push([e].concat(s.splice(0,n[o]))),n[o]););})),r.toString=i.path.toString,e.arr=i.path.clone(r),r};var z=i.parseTransformString=function(t){if(!t)return null;var e=[];return T(t,"array")&&T(t[0],"array")&&(e=i.path.clone(t)),e.length||s(t).replace(_,(function(t,i,n){var r=[];i.toLowerCase(),n.replace(R,(function(t,e){e&&r.push(+e)})),e.push([i].concat(r))})),e.toString=i.path.toString,e};function q(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,(function(t,i,n){return n=n.split(/\s*,\s*|\s+/),"rotate"==i&&1==n.length&&n.push(0,0),"scale"==i&&(n.length>2?n=n.slice(0,2):2==n.length&&n.push(0,0),1==n.length&&n.push(n[0],0,0)),"skewX"==i?e.push(["m",1,0,c.tan(U(n[0])),1,0,0]):"skewY"==i?e.push(["m",1,c.tan(U(n[0])),0,1,0,0]):e.push([i.charAt(0)].concat(n)),t})),e}function G(t,e){var n=z(t),r=new i.Matrix;if(n)for(var o=0,a=n.length;o<a;o++){var c,h,d,l,u,f=n[o],g=f.length,p=s(f[0]).toLowerCase(),m=f[0]!=p,v=m?r.invert():0;"t"==p&&2==g?r.translate(f[1],0):"t"==p&&3==g?m?(c=v.x(0,0),h=v.y(0,0),d=v.x(f[1],f[2]),l=v.y(f[1],f[2]),r.translate(d-c,l-h)):r.translate(f[1],f[2]):"r"==p?2==g?(u=u||e,r.rotate(f[1],u.x+u.width/2,u.y+u.height/2)):4==g&&(m?(d=v.x(f[2],f[3]),l=v.y(f[2],f[3]),r.rotate(f[1],d,l)):r.rotate(f[1],f[2],f[3])):"s"==p?2==g||3==g?(u=u||e,r.scale(f[1],f[g-1],u.x+u.width/2,u.y+u.height/2)):4==g?m?(d=v.x(f[2],f[3]),l=v.y(f[2],f[3]),r.scale(f[1],f[1],d,l)):r.scale(f[1],f[1],f[2],f[3]):5==g&&(m?(d=v.x(f[3],f[4]),l=v.y(f[3],f[4]),r.scale(f[1],f[2],d,l)):r.scale(f[1],f[2],f[3],f[4])):"m"==p&&7==g&&r.add(f[1],f[2],f[3],f[4],f[5],f[6])}return r}function X(t){var e=t.node.ownerSVGElement&&it(t.node.ownerSVGElement)||t.node.parentNode&&it(t.node.parentNode)||i.select("svg")||i(0,0),n=e.select("defs"),r=null!=n&&n.node;return r||(r=tt("defs",e.node).node),r}function Y(t){return t.node.ownerSVGElement&&it(t.node.ownerSVGElement)||i.select("svg")}function Z(t,e,i){var n=Y(t).node,r={},s=n.querySelector(".svg---mgr");function o(t){if(null==t)return f;if(t==+t)return t;$(s,{width:t});try{return s.getBBox().width}catch(t){return 0}}function a(t){if(null==t)return f;if(t==+t)return t;$(s,{height:t});try{return s.getBBox().height}catch(t){return 0}}function c(n,s){null==e?r[n]=s(t.attr(n)||0):n==e&&(r=s(null==i?t.attr(n)||0:i))}switch(s||(s=$("rect"),$(s,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),n.appendChild(s)),t.type){case"rect":c("rx",o),c("ry",a);case"image":c("width",o),c("height",a);case"text":c("x",o),c("y",a);break;case"circle":c("cx",o),c("cy",a),c("r",o);break;case"ellipse":c("cx",o),c("cy",a),c("rx",o),c("ry",a);break;case"line":c("x1",o),c("x2",o),c("y1",a),c("y2",a);break;case"marker":c("refX",o),c("markerWidth",o),c("refY",a),c("markerHeight",a);break;case"radialGradient":c("fx",o),c("fy",a);break;case"tspan":c("dx",o),c("dy",a);break;default:c(e,o)}return n.removeChild(s),r}function Q(t){T(t,"array")||(t=Array.prototype.slice.call(arguments,0));for(var e=0,i=0,n=this.node;this[e];)delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach((function(t){n.appendChild(t.node)})):n.appendChild(t[e].node);var r=n.childNodes;for(e=0;e<r.length;e++)this[i++]=it(r[e]);return this}function K(t){if(t.snap in B)return B[t.snap];var e;try{e=t.ownerSVGElement}catch(t){}this.node=t,e&&(this.paper=new et(e)),this.type=t.tagName||t.nodeName;var i=this.id=k(this);if(this.anims={},this._={transform:[]},t.snap=i,B[i]=this,"g"==this.type&&(this.add=Q),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var n in et.prototype)et.prototype[r](n)&&(this[n]=et.prototype[n])}function J(t){this.node=t}function tt(t,e){var i=$(t);return e.appendChild(i),it(i)}function et(t,e){var i,s,o,a=et.prototype;if(t&&"svg"==t.tagName){if(t.snap in B)return B[t.snap];var c=t.ownerDocument;for(var h in i=new K(t),s=t.getElementsByTagName("desc")[0],o=t.getElementsByTagName("defs")[0],s||((s=$("desc")).appendChild(c.createTextNode("Created with Snap")),i.node.appendChild(s)),o||(o=$("defs"),i.node.appendChild(o)),i.defs=o,a)a[r](h)&&(i[h]=a[h]);i.paper=i.root=i}else $((i=tt("svg",n.doc.body)).node,{height:e,version:1.1,width:t,xmlns:E});return i}function it(t){return t?t instanceof K||t instanceof J?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new et(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new et(t.contentDocument.getElementsByTagName("svg")[0]):new K(t):t}function nt(t,e){for(var i=0,n=t.length;i<n;i++){var r={type:t[i].type,attr:t[i].attr()},s=t[i].children();e.push(r),s.length&&nt(s,r.childNodes=[])}}i._.svgTransform2string=q,i._.rgTransform=/^[a-z][\s]*-?\.?\d/i,i._.transform2matrix=G,i._unit2px=Z,n.doc.contains||n.doc.compareDocumentPosition,i._.getSomeDefs=X,i._.getSomeSVG=Y,i.select=function(t){return t=s(t).replace(/([^\\]):/g,"$1\\:"),it(n.doc.querySelector(t))},i.selectAll=function(t){for(var e=n.doc.querySelectorAll(t),r=(i.set||Array)(),s=0;s<e.length;s++)r.push(it(e[s]));return r},setInterval((function(){for(var t in B)if(B[r](t)){var e=B[t],i=e.node;("svg"!=e.type&&!i.ownerSVGElement||"svg"==e.type&&(!i.parentNode||"ownerSVGElement"in i.parentNode&&!i.ownerSVGElement))&&delete B[t]}}),1e4),K.prototype.attr=function(t,i){var n=this,s=n.node;if(!t){if(1!=s.nodeType)return{text:s.nodeValue};for(var o=s.attributes,a={},c=0,h=o.length;c<h;c++)a[o[c].nodeName]=o[c].nodeValue;return a}if(T(t,"string")){if(!(arguments.length>1))return e("snap.util.getattr."+t,n).firstDefined();var d={};d[t]=i,t=d}for(var l in t)t[r](l)&&e("snap.util.attr."+l,n,t[l]);return n},i.parse=function(t){var e=n.doc.createDocumentFragment(),i=!0,r=n.doc.createElement("div");if((t=s(t)).match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",i=!1),r.innerHTML=t,t=r.getElementsByTagName("svg")[0])if(i)e=t;else for(;t.firstChild;)e.appendChild(t.firstChild);return new J(e)},i.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),e=n.doc.createDocumentFragment(),r=0,s=t.length;r<s;r++){var o=t[r];o.node&&o.node.nodeType&&e.appendChild(o.node),o.nodeType&&e.appendChild(o),"string"==typeof o&&e.appendChild(i.parse(o).node)}return new J(e)},i._.make=tt,i._.wrap=it,et.prototype.el=function(t,e){var i=tt(t,this.node);return e&&i.attr(e),i},K.prototype.children=function(){for(var t=[],e=this.node.childNodes,n=0,r=e.length;n<r;n++)t[n]=i(e[n]);return t},K.prototype.toJSON=function(){var t=[];return nt([this],t),t[0]},e.on("snap.util.getattr",(function(){var t=e.nt(),i=(t=t.substring(t.lastIndexOf(".")+1)).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return rt[r](i)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(i):$(this.node,t)}));var rt={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",(function(t){var i=e.nt(),n={};n[i=i.substring(i.lastIndexOf(".")+1)]=t;var s=i.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()})),o=i.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));rt[r](o)?this.node.style[s]=null==t?f:t:$(this.node,n)})),et.prototype,i.ajax=function(t,i,n,r){var s=new XMLHttpRequest,o=k();if(s){if(T(i,"function"))r=n,n=i,i=null;else if(T(i,"object")){var a=[];for(var c in i)i.hasOwnProperty(c)&&a.push(encodeURIComponent(c)+"="+encodeURIComponent(i[c]));i=a.join("&")}return s.open(i?"POST":"GET",t,!0),i&&(s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),n&&(e.once("snap.ajax."+o+".0",n),e.once("snap.ajax."+o+".200",n),e.once("snap.ajax."+o+".304",n)),s.onreadystatechange=function(){4==s.readyState&&e("snap.ajax."+o+"."+s.status,r,s)},4==s.readyState||s.send(i),s}},i.load=function(t,e,n){i.ajax(t,(function(t){var r=i.parse(t.responseText);n?e.call(n,r):e(r)}))};var st=function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,r=i.documentElement,s=r.clientTop||n.clientTop||0,o=r.clientLeft||n.clientLeft||0;return{y:e.top+(g.win.pageYOffset||r.scrollTop||n.scrollTop)-s,x:e.left+(g.win.pageXOffset||r.scrollLeft||n.scrollLeft)-o}};return i.getElementByPoint=function(t,e){this.canvas;var i=n.doc.elementFromPoint(t,e);if(n.win.opera&&"svg"==i.tagName){var r=st(i),s=i.createSVGRect();s.x=t-r.x,s.y=e-r.y,s.width=s.height=1;var o=i.getIntersectionList(s,null);o.length&&(i=o[o.length-1])}return i?it(i):null},i.plugin=function(t){t(i,K,et,n,J)},n.win.Snap=i,i}(t||this);return n.plugin((function(n,r,s,o,a){var c=r.prototype,h=n.is,d=String,l=n._unit2px,u=n._.$,f=n._.make,g=n._.getSomeDefs,p="hasOwnProperty",m=n._.wrap;c.getBBox=function(t){if(!n.Matrix||!n.path)return this.node.getBBox();var e=this,i=new n.Matrix;if(e.removed)return n._.box();for(;"use"==e.type;)if(t||(i=i.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else{var r=e.attr("xlink:href");e=e.original=e.node.ownerDocument.getElementById(r.substring(r.indexOf("#")+1))}var s=e._,o=n.path.get[e.type]||n.path.get.deflt;try{return t?(s.bboxwt=o?n.path.getBBox(e.realPath=o(e)):n._.box(e.node.getBBox()),n._.box(s.bboxwt)):(e.realPath=o(e),e.matrix=e.transform().localMatrix,s.bbox=n.path.getBBox(n.path.map(e.realPath,i.add(e.matrix))),n._.box(s.bbox))}catch(t){return n._.box()}};var v=function(){return this.string};function w(t,e){if(null==e){var i=!0;if(!(e="linearGradient"==t.type||"radialGradient"==t.type?t.node.getAttribute("gradientTransform"):"pattern"==t.type?t.node.getAttribute("patternTransform"):t.node.getAttribute("transform")))return new n.Matrix;e=n._.svgTransform2string(e)}else e=n._.rgTransform.test(e)?d(e).replace(/\.{3}|\u2026/g,t._.transform||""):n._.svgTransform2string(e),h(e,"array")&&(e=n.path?n.path.toString.call(e):d(e)),t._.transform=e;var r=n._.transform2matrix(e,t.getBBox(1));if(i)return r;t.matrix=r}function y(t){var e,i=t.selectAll("*"),n=/^\s*url\(("|'|)(.*)\1\)\s*$/,r=[],s={};function o(t,e){var i=u(t.node,e);(i=(i=i&&i.match(n))&&i[2])&&"#"==i.charAt()&&(i=i.substring(1))&&(s[i]=(s[i]||[]).concat((function(i){var n={};n[e]=URL(i),u(t.node,n)})))}function a(t){var e=u(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1))&&(s[e]=(s[e]||[]).concat((function(e){t.attr("xlink:href","#"+e)})))}for(var c=0,h=i.length;c<h;c++){o(e=i[c],"fill"),o(e,"stroke"),o(e,"filter"),o(e,"mask"),o(e,"clip-path"),a(e);var d=u(e.node,"id");d&&(u(e.node,{id:e.id}),r.push({old:d,id:e.id}))}for(c=0,h=r.length;c<h;c++){var l=s[r[c].old];if(l)for(var f=0,g=l.length;f<g;f++)l[f](r[c].id)}}function C(t,e,i){return function(n){var r=n.slice(t,e);return 1==r.length&&(r=r[0]),i?i(r):r}}c.transform=function(t){var e=this._;if(null==t){for(var i,r=this,s=new n.Matrix(this.node.getCTM()),o=w(this),a=[o],c=new n.Matrix,h=o.toTransformString(),l=d(o)==d(this.matrix)?d(e.transform):h;"svg"!=r.type&&(r=r.parent());)a.push(w(r));for(i=a.length;i--;)c.add(a[i]);return{string:l,globalMatrix:s,totalMatrix:c,localMatrix:o,diffMatrix:s.clone().add(o.invert()),global:s.toTransformString(),total:c.toTransformString(),local:h,toString:v}}return t instanceof n.Matrix?(this.matrix=t,this._.transform=t.toTransformString()):w(this,t),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?u(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?u(this.node,{patternTransform:this.matrix}):u(this.node,{transform:this.matrix})),this},c.parent=function(){return m(this.node.parentNode)},c.append=c.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach((function(t){e.add(t)})),this}t=m(t),this.node.appendChild(t.node),t.paper=this.paper}return this},c.appendTo=function(t){return t&&(t=m(t)).append(this),this},c.prepend=function(t){if(t){if("set"==t.type){var e,i=this;return t.forEach((function(t){e?e.after(t):i.prepend(t),e=t})),this}var n=(t=m(t)).parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),n&&n.add()}return this},c.prependTo=function(t){return(t=m(t)).prepend(this),this},c.before=function(t){if("set"==t.type){var e=this;return t.forEach((function(t){var i=t.parent();e.node.parentNode.insertBefore(t.node,e.node),i&&i.add()})),this.parent().add(),this}var i=(t=m(t)).parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),i&&i.add(),t.paper=this.paper,this},c.after=function(t){var e=(t=m(t)).parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},c.insertBefore=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},c.insertAfter=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},c.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},c.select=function(t){return m(this.node.querySelector(t))},c.selectAll=function(t){for(var e=this.node.querySelectorAll(t),i=(n.set||Array)(),r=0;r<e.length;r++)i.push(m(e[r]));return i},c.asPX=function(t,e){return null==e&&(e=this.attr(t)),+l(this,t,e)},c.use=function(){var t,e=this.node.id;return e||(e=this.id,u(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?f(this.type,this.node.parentNode):f("use",this.node.parentNode),u(t.node,{"xlink:href":"#"+e}),t.original=this,t},c.clone=function(){var t=m(this.node.cloneNode(!0));return u(t.node,"id")&&u(t.node,{id:t.id}),y(t),t.insertAfter(this),t},c.toDefs=function(){return g(this).appendChild(this.node),this},c.pattern=c.toPattern=function(t,e,i,n){var r=f("pattern",g(this));return null==t&&(t=this.getBBox()),h(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,t=t.x),u(r.node,{x:t,y:e,width:i,height:n,patternUnits:"userSpaceOnUse",id:r.id,viewBox:[t,e,i,n].join(" ")}),r.node.appendChild(this.node),r},c.marker=function(t,e,i,n,r,s){var o=f("marker",g(this));return null==t&&(t=this.getBBox()),h(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,r=t.refX||t.cx,s=t.refY||t.cy,t=t.x),u(o.node,{viewBox:[t,e,i,n].join(" "),markerWidth:i,markerHeight:n,orient:"auto",refX:r||0,refY:s||0,id:o.id}),o.node.appendChild(this.node),o};var x=function(t,e,n,r){"function"!=typeof n||n.length||(r=n,n=i.linear),this.attr=t,this.dur=e,n&&(this.easing=n),r&&(this.callback=r)};n._.Animation=x,n.animation=function(t,e,i,n){return new x(t,e,i,n)},c.inAnim=function(){var t=this,e=[];for(var i in t.anims)t.anims[p](i)&&function(t){e.push({anim:new x(t._attrs,t.dur,t.easing,t._callback),mina:t,curStatus:t.status(),status:function(e){return t.status(e)},stop:function(){t.stop()}})}(t.anims[i]);return e},n.animate=function(t,n,r,s,o,a){"function"!=typeof o||o.length||(a=o,o=i.linear);var c=i.time(),h=i(t,n,c,c+s,i.time,r,o);return a&&e.once("mina.finish."+h.id,a),h},c.stop=function(){for(var t=this.inAnim(),e=0,i=t.length;e<i;e++)t[e].stop();return this},c.animate=function(t,n,r,s){"function"!=typeof r||r.length||(s=r,r=i.linear),t instanceof x&&(s=t.callback,r=t.easing,n=t.dur,t=t.attr);var o,a,c,l,u=[],f=[],g={},m=this;for(var v in t)if(t[p](v)){m.equal?(o=(l=m.equal(v,d(t[v]))).from,a=l.to,c=l.f):(o=+m.attr(v),a=+t[v]);var w=h(o,"array")?o.length:1;g[v]=C(u.length,u.length+w,c),u=u.concat(o),f=f.concat(a)}var y=i.time(),b=i(u,f,y,y+n,i.time,(function(t){var e={};for(var i in g)g[p](i)&&(e[i]=g[i](t));m.attr(e)}),r);return m.anims[b.id]=b,b._attrs=t,b._callback=s,e("snap.animcreated."+m.id,b),e.once("mina.finish."+b.id,(function(){delete m.anims[b.id],s&&s.call(m)})),e.once("mina.stop."+b.id,(function(){delete m.anims[b.id]})),m};var b={};function _(t){return function(){var e=t?"<"+this.type:"",i=this.node.attributes,n=this.node.childNodes;if(t)for(var r=0,s=i.length;r<s;r++)e+=" "+i[r].name+'="'+i[r].value.replace(/"/g,'\\"')+'"';if(n.length){for(t&&(e+=">"),r=0,s=n.length;r<s;r++)3==n[r].nodeType?e+=n[r].nodeValue:1==n[r].nodeType&&(e+=m(n[r]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}c.data=function(t,i){var r=b[this.id]=b[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,r,null),r;if(1==arguments.length){if(n.is(t,"object")){for(var s in t)t[p](s)&&this.data(s,t[s]);return this}return e("snap.data.get."+this.id,this,r[t],t),r[t]}return r[t]=i,e("snap.data.set."+this.id,this,i,t),this},c.removeData=function(t){return null==t?b[this.id]={}:b[this.id]&&delete b[this.id][t],this},c.outerSVG=c.toString=_(1),c.innerSVG=_(),c.toDataURL=function(){if(t&&t.btoa){var e=this.getBBox(),i=n.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))}},a.prototype.select=c.select,a.prototype.selectAll=c.selectAll})),n.plugin((function(t,e,i,n,r){var s=Object.prototype.toString,o=String,a=Math,c="";function h(t,e,i,n,r,o){if(null==e&&"[object SVGMatrix]"==s.call(t))return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f);null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+n,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}!function(e){function i(t){return t[0]*t[0]+t[1]*t[1]}function n(t){var e=a.sqrt(i(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,i,n,r,s){var o,a,c,d,l=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[t,i,r],[e,n,s],[0,0,1]];for(t&&t instanceof h&&(f=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;o<3;o++)for(a=0;a<3;a++){for(d=0,c=0;c<3;c++)d+=u[o][c]*f[c][a];l[o][a]=d}return this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2],this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new h(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new h(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.add(1,0,0,1,t,e)},e.scale=function(t,e,i,n){return null==e&&(e=t),(i||n)&&this.add(1,0,0,1,i,n),this.add(t,0,0,e,0,0),(i||n)&&this.add(1,0,0,1,-i,-n),this},e.rotate=function(e,i,n){e=t.rad(e),i=i||0,n=n||0;var r=+a.cos(e).toFixed(9),s=+a.sin(e).toFixed(9);return this.add(r,s,-s,r,i,n),this.add(1,0,0,1,-i,-n)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[o.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var r=[[this.a,this.c],[this.b,this.d]];e.scalex=a.sqrt(i(r[0])),n(r[0]),e.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*e.shear,r[1][1]-r[0][1]*e.shear],e.scaley=a.sqrt(i(r[1])),n(r[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var s=-r[0][1],o=r[1][1];return o<0?(e.rotate=t.deg(a.acos(o)),s<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(a.asin(s)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:c)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:c)+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:c))}}(h.prototype),t.Matrix=h,t.matrix=function(t,e,i,n,r,s){return new h(t,e,i,n,r,s)}})),n.plugin((function(t,i,n,r,s){var o,a=t._.make,c=t._.wrap,h=t.is,d=t._.getSomeDefs,l=/^url\(#?([^)]+)\)$/,u=t._.$,f=t.url,g=String,p=t._.separator,m="";function v(n){return function(r){if(e.stop(),r instanceof s&&1==r.node.childNodes.length&&("radialGradient"==r.node.firstChild.tagName||"linearGradient"==r.node.firstChild.tagName||"pattern"==r.node.firstChild.tagName)&&(r=r.node.firstChild,d(this).appendChild(r),r=c(r)),r instanceof i)if("radialGradient"==r.type||"linearGradient"==r.type||"pattern"==r.type){r.node.id||u(r.node,{id:r.id});var o=f(r.node.id)}else o=r.attr(n);else if((o=r).error){var a=t(d(this).ownerSVGElement).gradient(r);a?(a.node.id||u(a.node,{id:a.id}),o=f(a.node.id)):o=r}else o=g(o);var h={};h[n]=o,u(this.node,h),this.node.style[n]=m}}e.on("snap.util.attr.mask",(function(t){if(t instanceof i||t instanceof s){if(e.stop(),t instanceof s&&1==t.node.childNodes.length&&(t=t.node.firstChild,d(this).appendChild(t),t=c(t)),"mask"==t.type)var n=t;else(n=a("mask",d(this))).node.appendChild(t.node);!n.node.id&&u(n.node,{id:n.id}),u(this.node,{mask:f(n.id)})}})),o=function(t){if(t instanceof i||t instanceof s){if(e.stop(),"clipPath"==t.type)var n=t;else(n=a("clipPath",d(this))).node.appendChild(t.node),!n.node.id&&u(n.node,{id:n.id});u(this.node,{"clip-path":f(n.node.id||n.id)})}},e.on("snap.util.attr.clip",o),e.on("snap.util.attr.clip-path",o),e.on("snap.util.attr.clipPath",o),e.on("snap.util.attr.fill",v("fill")),e.on("snap.util.attr.stroke",v("stroke"));var w=/^([lr])(?:\(([^)]*)\))?(.*)$/i;function y(t){e.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function C(t){for(var e=[],i=t.childNodes,n=0,r=i.length;n<r;n++){var s=i[n];3==s.nodeType&&e.push(s.nodeValue),"tspan"==s.tagName&&(1==s.childNodes.length&&3==s.firstChild.nodeType?e.push(s.firstChild.nodeValue):e.push(C(s)))}return e}function x(){return e.stop(),this.node.style.fontSize}e.on("snap.util.grad.parse",(function(t){var e=(t=g(t)).match(w);if(!e)return null;var i=e[1],n=e[2],r=e[3];return 1==(n=n.split(/\s*,\s*/).map((function(t){return+t==t?+t:t}))).length&&0==n[0]&&(n=[]),{type:i,params:n,stops:r=(r=r.split("-")).map((function(t){var e={color:(t=t.split(":"))[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}))}})),e.on("snap.util.attr.d",(function(i){e.stop(),h(i,"array")&&h(i[0],"array")&&(i=t.path.toString.call(i)),(i=g(i)).match(/[ruo]/i)&&(i=t.path.toAbsolute(i)),u(this.node,{d:i})}))(-1),e.on("snap.util.attr.#text",(function(t){e.stop(),t=g(t);for(var i=r.doc.createTextNode(t);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(i)}))(-1),e.on("snap.util.attr.path",(function(t){e.stop(),this.attr({d:t})}))(-1),e.on("snap.util.attr.class",(function(t){e.stop(),this.node.className.baseVal=t}))(-1),e.on("snap.util.attr.viewBox",(function(t){var i;i=h(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):h(t,"array")?t.join(" "):t,u(this.node,{viewBox:i}),e.stop()}))(-1),e.on("snap.util.attr.transform",(function(t){this.transform(t),e.stop()}))(-1),e.on("snap.util.attr.r",(function(t){"rect"==this.type&&(e.stop(),u(this.node,{rx:t,ry:t}))}))(-1),e.on("snap.util.attr.textpath",(function(t){if(e.stop(),"text"==this.type){var n,r,s;if(!t&&this.textPath){for(r=this.textPath;r.node.firstChild;)this.node.appendChild(r.node.firstChild);return r.remove(),void delete this.textPath}if(h(t,"string")){var o=d(this),a=c(o.parentNode).path(t);o.appendChild(a.node),n=a.id,a.attr({id:n})}else(t=c(t))instanceof i&&((n=t.attr("id"))||(n=t.id,t.attr({id:n})));if(n)if(r=this.textPath,s=this.node,r)r.attr({"xlink:href":"#"+n});else{for(r=u("textPath",{"xlink:href":"#"+n});s.firstChild;)r.appendChild(s.firstChild);s.appendChild(r),this.textPath=c(r)}}}))(-1),e.on("snap.util.attr.text",(function(t){if("text"==this.type){for(var i=this.node,n=function(t){var e=u("tspan");if(h(t,"array"))for(var i=0;i<t.length;i++)e.appendChild(n(t[i]));else e.appendChild(r.doc.createTextNode(t));return e.normalize&&e.normalize(),e};i.firstChild;)i.removeChild(i.firstChild);for(var s=n(t);s.firstChild;)i.appendChild(s.firstChild)}e.stop()}))(-1),e.on("snap.util.attr.fontSize",y)(-1),e.on("snap.util.attr.font-size",y)(-1),e.on("snap.util.getattr.transform",(function(){return e.stop(),this.transform()}))(-1),e.on("snap.util.getattr.textpath",(function(){return e.stop(),this.textPath}))(-1),function(){function i(i){return function(){e.stop();var n=r.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+i);return"none"==n?n:t(r.doc.getElementById(n.match(l)[1]))}}function n(t){return function(i){e.stop();var n="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""!=i&&i){if("marker"==i.type){var r=i.node.id;return r||u(i.node,{id:i.id}),void(this.node.style[n]=f(r))}}else this.node.style[n]="none"}}e.on("snap.util.getattr.marker-end",i("end"))(-1),e.on("snap.util.getattr.markerEnd",i("end"))(-1),e.on("snap.util.getattr.marker-start",i("start"))(-1),e.on("snap.util.getattr.markerStart",i("start"))(-1),e.on("snap.util.getattr.marker-mid",i("mid"))(-1),e.on("snap.util.getattr.markerMid",i("mid"))(-1),e.on("snap.util.attr.marker-end",n("end"))(-1),e.on("snap.util.attr.markerEnd",n("end"))(-1),e.on("snap.util.attr.marker-start",n("start"))(-1),e.on("snap.util.attr.markerStart",n("start"))(-1),e.on("snap.util.attr.marker-mid",n("mid"))(-1),e.on("snap.util.attr.markerMid",n("mid"))(-1)}(),e.on("snap.util.getattr.r",(function(){if("rect"==this.type&&u(this.node,"rx")==u(this.node,"ry"))return e.stop(),u(this.node,"rx")}))(-1),e.on("snap.util.getattr.text",(function(){if("text"==this.type||"tspan"==this.type){e.stop();var t=C(this.node);return 1==t.length?t[0]:t}}))(-1),e.on("snap.util.getattr.#text",(function(){return this.node.textContent}))(-1),e.on("snap.util.getattr.viewBox",(function(){e.stop();var i=u(this.node,"viewBox");return i?(i=i.split(p),t._.box(+i[0],+i[1],+i[2],+i[3])):void 0}))(-1),e.on("snap.util.getattr.points",(function(){var t=u(this.node,"points");return e.stop(),t?t.split(p):void 0}))(-1),e.on("snap.util.getattr.path",(function(){var t=u(this.node,"d");return e.stop(),t}))(-1),e.on("snap.util.getattr.class",(function(){return this.node.className.baseVal}))(-1),e.on("snap.util.getattr.fontSize",x)(-1),e.on("snap.util.getattr.font-size",x)(-1)})),n.plugin((function(t,e,i,n,r){var s=/\S+/g,o=String,a=e.prototype;a.addClass=function(t){var e,i,n,r=o(t||"").match(s)||[],a=this.node,c=a.className.baseVal,h=c.match(s)||[];if(r.length){for(e=0;i=r[e++];)~h.indexOf(i)||h.push(i);c!=(n=h.join(" "))&&(a.className.baseVal=n)}return this},a.removeClass=function(t){var e,i,n,r,a=o(t||"").match(s)||[],c=this.node,h=c.className.baseVal,d=h.match(s)||[];if(d.length){for(e=0;n=a[e++];)~(i=d.indexOf(n))&&d.splice(i,1);h!=(r=d.join(" "))&&(c.className.baseVal=r)}return this},a.hasClass=function(t){return!!~(this.node.className.baseVal.match(s)||[]).indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var i,n,r,o,a=(t||"").match(s)||[],c=this.node,h=c.className.baseVal,d=h.match(s)||[];for(i=0;r=a[i++];)~(n=d.indexOf(r))?d.splice(n,1):d.push(r);return h!=(o=d.join(" "))&&(c.className.baseVal=o),this}})),n.plugin((function(t,i,n,r,s){var o={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},a=String,c=/[a-z]+$/i,h=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;function d(t){return t}function l(t){return function(e){return+e.toFixed(3)+t}}e.on("snap.util.attr",(function(t){var i=a(t).match(h);if(i){var n=e.nt(),r=n.substring(n.lastIndexOf(".")+1),s=this.attr(r),d={};e.stop();var l=i[3]||"",u=s.match(c),f=o[i[1]];if(u&&u==l?t=f(parseFloat(s),+i[2]):(s=this.asPX(r),t=f(this.asPX(r),this.asPX(r,i[2]+l))),isNaN(s)||isNaN(t))return;d[r]=t,this.attr(d)}}))(-10),e.on("snap.util.equal",(function(t,i){var n=a(this.attr(t)||""),r=a(i).match(h);if(r){e.stop();var s=r[3]||"",u=n.match(c),f=o[r[1]];return u&&u==s?{from:parseFloat(n),to:f(parseFloat(n),+r[2]),f:l(u)}:{from:n=this.asPX(t),to:f(n,this.asPX(t,r[2]+s)),f:d}}}))(-10)})),n.plugin((function(i,n,r,s,o){var a=r.prototype,c=i.is;a.rect=function(t,e,i,n,r,s){var o;return null==s&&(s=r),c(t,"object")&&"[object Object]"==t?o=t:null!=t&&(o={x:t,y:e,width:i,height:n},null!=r&&(o.rx=r,o.ry=s)),this.el("rect",o)},a.circle=function(t,e,i){var n;return c(t,"object")&&"[object Object]"==t?n=t:null!=t&&(n={cx:t,cy:e,r:i}),this.el("circle",n)};var h=function(){function t(){this.parentNode.removeChild(this)}return function(e,i){var n=s.doc.createElement("img"),r=s.doc.body;n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){i.call(n),n.onload=n.onerror=null,r.removeChild(n)},n.onerror=t,r.appendChild(n),n.src=e}}();a.image=function(t,e,n,r,s){var o=this.el("image");if(c(t,"object")&&"src"in t)o.attr(t);else if(null!=t){var a={"xlink:href":t,preserveAspectRatio:"none"};null!=e&&null!=n&&(a.x=e,a.y=n),null!=r&&null!=s?(a.width=r,a.height=s):h(t,(function(){i._.$(o.node,{width:this.offsetWidth,height:this.offsetHeight})})),i._.$(o.node,a)}return o},a.ellipse=function(t,e,i,n){var r;return c(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,rx:i,ry:n}),this.el("ellipse",r)},a.path=function(t){var e;return c(t,"object")&&!c(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},a.group=a.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.svg=function(t,e,i,n,r,s,o,a){var h={};return c(t,"object")&&null==e?h=t:(null!=t&&(h.x=t),null!=e&&(h.y=e),null!=i&&(h.width=i),null!=n&&(h.height=n),null!=r&&null!=s&&null!=o&&null!=a&&(h.viewBox=[r,s,o,a])),this.el("svg",h)},a.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.ptrn=function(t,e,i,n,r,s,o,a){if(c(t,"object"))var h=t;else h={patternUnits:"userSpaceOnUse"},t&&(h.x=t),e&&(h.y=e),null!=i&&(h.width=i),null!=n&&(h.height=n),h.viewBox=null!=r&&null!=s&&null!=o&&null!=a?[r,s,o,a]:[t||0,e||0,i||0,n||0];return this.el("pattern",h)},a.use=function(t){return null!=t?(t instanceof n&&(t.attr("id")||t.attr({id:i._.id(t)}),t=t.attr("id")),"#"==String(t).charAt()&&(t=t.substring(1)),this.el("use",{"xlink:href":"#"+t})):n.prototype.use.call(this)},a.symbol=function(t,e,i,n){var r={};return null!=t&&null!=e&&null!=i&&null!=n&&(r.viewBox=[t,e,i,n]),this.el("symbol",r)},a.text=function(t,e,i){var n={};return c(t,"object")?n=t:null!=t&&(n={x:t,y:e,text:i||""}),this.el("text",n)},a.line=function(t,e,i,n){var r={};return c(t,"object")?r=t:null!=t&&(r={x1:t,x2:i,y1:e,y2:n}),this.el("line",r)},a.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return c(t,"object")&&!c(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},a.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return c(t,"object")&&!c(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){var n=i._.$;function r(){return this.selectAll("stop")}function s(t,e){var r=n("stop"),s={offset:+e+"%"};return t=i.color(t),s["stop-color"]=t.hex,t.opacity<1&&(s["stop-opacity"]=t.opacity),n(r,s),this.node.appendChild(r),this}function o(){if("linearGradient"==this.type){var t=n(this.node,"x1")||0,e=n(this.node,"x2")||1,r=n(this.node,"y1")||0,s=n(this.node,"y2")||0;return i._.box(t,r,math.abs(e-t),math.abs(s-r))}var o=this.node.cx||.5,a=this.node.cy||.5,c=this.node.r||0;return i._.box(o-c,a-c,2*c,2*c)}function c(t,i){var r,s=e("snap.util.grad.parse",null,i).firstDefined();if(!s)return null;s.params.unshift(t),r="l"==s.type.toLowerCase()?h.apply(0,s.params):d.apply(0,s.params),s.type!=s.type.toLowerCase()&&n(r.node,{gradientUnits:"userSpaceOnUse"});var o=s.stops,a=o.length,c=0,l=0;function u(t,e){for(var i=(e-c)/(t-l),n=l;n<t;n++)o[n].offset=+(+c+i*(n-l)).toFixed(2);l=t,c=e}a--;for(var f=0;f<a;f++)"offset"in o[f]&&u(f,o[f].offset);for(o[a].offset=o[a].offset||100,u(a,o[a].offset),f=0;f<=a;f++){var g=o[f];r.addStop(g.color,g.offset)}return r}function h(t,e,a,c,h){var d=i._.make("linearGradient",t);return d.stops=r,d.addStop=s,d.getBBox=o,null!=e&&n(d.node,{x1:e,y1:a,x2:c,y2:h}),d}function d(t,e,a,c,h,d){var l=i._.make("radialGradient",t);return l.stops=r,l.addStop=s,l.getBBox=o,null!=e&&n(l.node,{cx:e,cy:a,r:c}),null!=h&&null!=d&&n(l.node,{fx:h,fy:d}),l}a.gradient=function(t){return c(this.defs,t)},a.gradientLinear=function(t,e,i,n){return h(this.defs,t,e,i,n)},a.gradientRadial=function(t,e,i,n,r){return d(this.defs,t,e,i,n,r)},a.toString=function(){var t,e=this.node.ownerDocument,n=e.createDocumentFragment(),r=e.createElement("div"),s=this.node.cloneNode(!0);return n.appendChild(r),r.appendChild(s),i._.$(s,{xmlns:"http://www.w3.org/2000/svg"}),t=r.innerHTML,n.removeChild(n.firstChild),t},a.toDataURL=function(){if(t&&t.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){for(var t,e=this.node.firstChild;e;)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):a.clear.call({node:e}),e=t}}()})),n.plugin((function(t,e,i,n){var r=e.prototype,s=t.is,o=t._.clone,a="hasOwnProperty",c=/,?([a-z]),?/gi,h=parseFloat,d=Math,l=d.PI,u=d.min,f=d.max,g=d.pow,p=d.abs;function m(t){var e=m.ps=m.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var i in e)e[a](i)&&i!=t&&(e[i].sleep--,!e[i].sleep&&delete e[i])})),e[t]}function v(t,e,i,n){return null==t&&(t=e=i=n=0),null==e&&(e=t.y,i=t.width,n=t.height,t=t.x),{x:t,y:e,width:i,w:i,height:n,h:n,x2:t+i,y2:e+n,cx:t+i/2,cy:e+n/2,r1:d.min(i,n)/2,r2:d.max(i,n)/2,r0:d.sqrt(i*i+n*n)/2,path:O(t,e,i,n),vb:[t,e,i,n].join(" ")}}function w(){return this.join(",").replace(c,"$1")}function y(t){var e=o(t);return e.toString=w,e}function C(t,e,i,n,r,s,o,a,c){return null==c?B(t,e,i,n,r,s,o,a):S(t,e,i,n,r,s,o,a,$(t,e,i,n,r,s,o,a,c))}function x(i,n){function r(t){return+(+t).toFixed(3)}return t._.cacher((function(t,s,o){t instanceof e&&(t=t.attr("d"));for(var a,c,h,d,l,u="",f={},g=0,p=0,m=(t=Y(t)).length;p<m;p++){if("M"==(h=t[p])[0])a=+h[1],c=+h[2];else{if(g+(d=C(a,c,h[1],h[2],h[3],h[4],h[5],h[6]))>s){if(n&&!f.start){if(u+=["C"+r((l=C(a,c,h[1],h[2],h[3],h[4],h[5],h[6],s-g)).start.x),r(l.start.y),r(l.m.x),r(l.m.y),r(l.x),r(l.y)],o)return u;f.start=u,u=["M"+r(l.x),r(l.y)+"C"+r(l.n.x),r(l.n.y),r(l.end.x),r(l.end.y),r(h[5]),r(h[6])].join(),g+=d,a=+h[5],c=+h[6];continue}if(!i&&!n)return l=C(a,c,h[1],h[2],h[3],h[4],h[5],h[6],s-g)}g+=d,a=+h[5],c=+h[6]}u+=h.shift()+h}return f.end=u,l=i?g:n?f:S(a,c,h[0],h[1],h[2],h[3],h[4],h[5],1)}),null,t._.clone)}var b=x(1),_=x(),R=x(0,1);function S(t,e,i,n,r,s,o,a,c){var h=1-c,u=g(h,3),f=g(h,2),p=c*c,m=p*c,v=t+2*c*(i-t)+p*(r-2*i+t),w=e+2*c*(n-e)+p*(s-2*n+e),y=i+2*c*(r-i)+p*(o-2*r+i),C=n+2*c*(s-n)+p*(a-2*s+n);return{x:u*t+3*f*c*i+3*h*c*c*r+m*o,y:u*e+3*f*c*n+3*h*c*c*s+m*a,m:{x:v,y:w},n:{x:y,y:C},start:{x:h*t+c*i,y:h*e+c*n},end:{x:h*r+c*o,y:h*s+c*a},alpha:90-180*d.atan2(v-y,w-C)/l}}function D(e,i,n,r,s,o,a,c){t.is(e,"array")||(e=[e,i,n,r,s,o,a,c]);var h=X.apply(null,e);return v(h.min.x,h.min.y,h.max.x-h.min.x,h.max.y-h.min.y)}function k(t,e,i){return e>=t.x&&e<=t.x+t.width&&i>=t.y&&i<=t.y+t.height}function A(t,e){return t=v(t),k(e=v(e),t.x,t.y)||k(e,t.x2,t.y)||k(e,t.x,t.y2)||k(e,t.x2,t.y2)||k(t,e.x,e.y)||k(t,e.x2,e.y)||k(t,e.x,e.y2)||k(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function E(t,e,i,n,r){return t*(t*(-3*e+9*i-9*n+3*r)+6*e-12*i+6*n)-3*e+3*i}function B(t,e,i,n,r,s,o,a,c){null==c&&(c=1);for(var h=(c=c>1?1:c<0?0:c)/2,l=12,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],g=0,p=0;p<l;p++){var m=h*u[p]+h,v=E(m,t,i,r,o),w=E(m,e,n,s,a),y=v*v+w*w;g+=f[p]*d.sqrt(y)}return h*g}function $(t,e,i,n,r,s,o,a,c){if(!(c<0||B(t,e,i,n,r,s,o,a)<c)){var h,d=1,l=d/2,u=d-l,f=.01;for(h=B(t,e,i,n,r,s,o,a,u);p(h-c)>f;)h=B(t,e,i,n,r,s,o,a,u+=(h<c?1:-1)*(l/=2));return u}}function T(t,e,i,n,r,s,o,a){if(!(f(t,i)<u(r,o)||u(t,i)>f(r,o)||f(e,n)<u(s,a)||u(e,n)>f(s,a))){var c=(t-i)*(s-a)-(e-n)*(r-o);if(c){var h=((t*n-e*i)*(r-o)-(t-i)*(r*a-s*o))/c,d=((t*n-e*i)*(s-a)-(e-n)*(r*a-s*o))/c,l=+h.toFixed(2),g=+d.toFixed(2);if(!(l<+u(t,i).toFixed(2)||l>+f(t,i).toFixed(2)||l<+u(r,o).toFixed(2)||l>+f(r,o).toFixed(2)||g<+u(e,n).toFixed(2)||g>+f(e,n).toFixed(2)||g<+u(s,a).toFixed(2)||g>+f(s,a).toFixed(2)))return{x:h,y:d}}}}function M(t,e,i){if(!A(D(t),D(e)))return i?0:[];for(var n=~~(B.apply(0,t)/8),r=~~(B.apply(0,e)/8),s=[],o=[],a={},c=i?0:[],h=0;h<n+1;h++){var d=S.apply(0,t.concat(h/n));s.push({x:d.x,y:d.y,t:h/n})}for(h=0;h<r+1;h++)d=S.apply(0,e.concat(h/r)),o.push({x:d.x,y:d.y,t:h/r});for(h=0;h<n;h++)for(var l=0;l<r;l++){var u=s[h],f=s[h+1],g=o[l],m=o[l+1],v=p(f.x-u.x)<.001?"y":"x",w=p(m.x-g.x)<.001?"y":"x",y=T(u.x,u.y,f.x,f.y,g.x,g.y,m.x,m.y);if(y){if(a[y.x.toFixed(4)]==y.y.toFixed(4))continue;a[y.x.toFixed(4)]=y.y.toFixed(4);var C=u.t+p((y[v]-u[v])/(f[v]-u[v]))*(f.t-u.t),x=g.t+p((y[w]-g[w])/(m[w]-g[w]))*(m.t-g.t);C>=0&&C<=1&&x>=0&&x<=1&&(i?c++:c.push({x:y.x,y:y.y,t1:C,t2:x}))}}return c}function N(t,e){return L(t,e)}function P(t,e){return L(t,e,1)}function L(t,e,i){t=Y(t),e=Y(e);for(var n,r,s,o,a,c,h,d,l,u,f=i?0:[],g=0,p=t.length;g<p;g++){var m=t[g];if("M"==m[0])n=a=m[1],r=c=m[2];else{"C"==m[0]?(l=[n,r].concat(m.slice(1)),n=l[6],r=l[7]):(l=[n,r,n,r,a,c,a,c],n=a,r=c);for(var v=0,w=e.length;v<w;v++){var y=e[v];if("M"==y[0])s=h=y[1],o=d=y[2];else{"C"==y[0]?(u=[s,o].concat(y.slice(1)),s=u[6],o=u[7]):(u=[s,o,s,o,h,d,h,d],s=h,o=d);var C=M(l,u,i);if(i)f+=C;else{for(var x=0,b=C.length;x<b;x++)C[x].segment1=g,C[x].segment2=v,C[x].bez1=l,C[x].bez2=u;f=f.concat(C)}}}}}return f}function U(t,e,i){var n=W(t);return k(n,e,i)&&L(t,[["M",e,i],["H",n.x2+10]],1)%2==1}function W(t){var e=m(t);if(e.bbox)return o(e.bbox);if(!t)return v();for(var i,n=0,r=0,s=[],a=[],c=0,h=(t=Y(t)).length;c<h;c++)if("M"==(i=t[c])[0])n=i[1],r=i[2],s.push(n),a.push(r);else{var d=X(n,r,i[1],i[2],i[3],i[4],i[5],i[6]);s=s.concat(d.min.x,d.max.x),a=a.concat(d.min.y,d.max.y),n=i[5],r=i[6]}var l=u.apply(0,s),g=u.apply(0,a),p=v(l,g,f.apply(0,s)-l,f.apply(0,a)-g);return e.bbox=o(p),p}function O(t,e,i,n,r){if(r)return[["M",+t+ +r,e],["l",i-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-i,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]];var s=[["M",t,e],["l",i,0],["l",0,n],["l",-i,0],["z"]];return s.toString=w,s}function F(t,e,i,n,r){if(null==r&&null==n&&(n=i),t=+t,e=+e,i=+i,n=+n,null!=r)var s=Math.PI/180,o=t+i*Math.cos(-n*s),a=t+i*Math.cos(-r*s),c=[["M",o,e+i*Math.sin(-n*s)],["A",i,i,0,+(r-n>180),0,a,e+i*Math.sin(-r*s)]];else c=[["M",t,e],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]];return c.toString=w,c}var H=t._unit2px,I={path:function(t){return t.attr("path")},circle:function(t){var e=H(t);return F(e.cx,e.cy,e.r)},ellipse:function(t){var e=H(t);return F(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=H(t);return O(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=H(t);return O(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return O(e.x,e.y,e.width,e.height)}};function j(e){var i=m(e),n=String.prototype.toLowerCase;if(i.rel)return y(i.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var r=[],s=0,o=0,a=0,c=0,h=0;"M"==e[0][0]&&(a=s=e[0][1],c=o=e[0][2],h++,r.push(["M",s,o]));for(var d=h,l=e.length;d<l;d++){var u=r[d]=[],f=e[d];if(f[0]!=n.call(f[0]))switch(u[0]=n.call(f[0]),u[0]){case"a":u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=+(f[6]-s).toFixed(3),u[7]=+(f[7]-o).toFixed(3);break;case"v":u[1]=+(f[1]-o).toFixed(3);break;case"m":a=f[1],c=f[2];default:for(var g=1,p=f.length;g<p;g++)u[g]=+(f[g]-(g%2?s:o)).toFixed(3)}else{u=r[d]=[],"m"==f[0]&&(a=f[1]+s,c=f[2]+o);for(var v=0,C=f.length;v<C;v++)r[d][v]=f[v]}var x=r[d].length;switch(r[d][0]){case"z":s=a,o=c;break;case"h":s+=+r[d][x-1];break;case"v":o+=+r[d][x-1];break;default:s+=+r[d][x-2],o+=+r[d][x-1]}}return r.toString=w,i.rel=y(r),r}function V(e){var i=m(e);if(i.abs)return y(i.abs);if(s(e,"array")&&s(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n,r=[],o=0,a=0,c=0,h=0,d=0;"M"==e[0][0]&&(c=o=+e[0][1],h=a=+e[0][2],d++,r[0]=["M",o,a]);for(var l,u,f=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),g=d,p=e.length;g<p;g++){if(r.push(l=[]),(n=(u=e[g])[0])!=n.toUpperCase())switch(l[0]=n.toUpperCase(),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+u[6]+o,l[7]=+u[7]+a;break;case"V":l[1]=+u[1]+a;break;case"H":l[1]=+u[1]+o;break;case"R":for(var v=[o,a].concat(u.slice(1)),C=2,x=v.length;C<x;C++)v[C]=+v[C]+o,v[++C]=+v[C]+a;r.pop(),r=r.concat(Q(v,f));break;case"O":r.pop(),(v=F(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);break;case"U":r.pop(),r=r.concat(F(o,a,u[1],u[2],u[3])),l=["U"].concat(r[r.length-1].slice(-2));break;case"M":c=+u[1]+o,h=+u[2]+a;default:for(C=1,x=u.length;C<x;C++)l[C]=+u[C]+(C%2?o:a)}else if("R"==n)v=[o,a].concat(u.slice(1)),r.pop(),r=r.concat(Q(v,f)),l=["R"].concat(u.slice(-2));else if("O"==n)r.pop(),(v=F(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);else if("U"==n)r.pop(),r=r.concat(F(o,a,u[1],u[2],u[3])),l=["U"].concat(r[r.length-1].slice(-2));else for(var b=0,_=u.length;b<_;b++)l[b]=u[b];if("O"!=(n=n.toUpperCase()))switch(l[0]){case"Z":o=+c,a=+h;break;case"H":o=l[1];break;case"V":a=l[1];break;case"M":c=l[l.length-2],h=l[l.length-1];default:o=l[l.length-2],a=l[l.length-1]}}return r.toString=w,i.abs=y(r),r}function z(t,e,i,n){return[t,e,i,n,i,n]}function q(t,e,i,n,r,s){var o=1/3,a=2/3;return[o*t+a*i,o*e+a*n,o*r+a*i,o*s+a*n,r,s]}function G(e,i,n,r,s,o,a,c,h,u){var f,g=120*l/180,m=l/180*(+s||0),v=[],w=t._.cacher((function(t,e,i){return{x:t*d.cos(i)-e*d.sin(i),y:t*d.sin(i)+e*d.cos(i)}}));if(u)k=u[0],A=u[1],S=u[2],D=u[3];else{e=(f=w(e,i,-m)).x,i=f.y;var y=(e-(c=(f=w(c,h,-m)).x))/2,C=(i-(h=f.y))/2,x=y*y/(n*n)+C*C/(r*r);x>1&&(n*=x=d.sqrt(x),r*=x);var b=n*n,_=r*r,R=(o==a?-1:1)*d.sqrt(p((b*_-b*C*C-_*y*y)/(b*C*C+_*y*y))),S=R*n*C/r+(e+c)/2,D=R*-r*y/n+(i+h)/2,k=d.asin(((i-D)/r).toFixed(9)),A=d.asin(((h-D)/r).toFixed(9));(k=e<S?l-k:k)<0&&(k=2*l+k),(A=c<S?l-A:A)<0&&(A=2*l+A),a&&k>A&&(k-=2*l),!a&&A>k&&(A-=2*l)}var E=A-k;if(p(E)>g){var B=A,$=c,T=h;A=k+g*(a&&A>k?1:-1),v=G(c=S+n*d.cos(A),h=D+r*d.sin(A),n,r,s,0,a,$,T,[A,B,S,D])}E=A-k;var M=d.cos(k),N=d.sin(k),P=d.cos(A),L=d.sin(A),U=d.tan(E/4),W=4/3*n*U,O=4/3*r*U,F=[e,i],H=[e+W*N,i-O*M],I=[c+W*L,h-O*P],j=[c,h];if(H[0]=2*F[0]-H[0],H[1]=2*F[1]-H[1],u)return[H,I,j].concat(v);for(var V=[],z=0,q=(v=[H,I,j].concat(v).join().split(",")).length;z<q;z++)V[z]=z%2?w(v[z-1],v[z],m).y:w(v[z],v[z+1],m).x;return V}function X(t,e,i,n,r,s,o,a){for(var c,h,l,g,m,v,w,y,C=[],x=[[],[]],b=0;b<2;++b)if(0==b?(h=6*t-12*i+6*r,c=-3*t+9*i-9*r+3*o,l=3*i-3*t):(h=6*e-12*n+6*s,c=-3*e+9*n-9*s+3*a,l=3*n-3*e),p(c)<1e-12){if(p(h)<1e-12)continue;0<(g=-l/h)&&g<1&&C.push(g)}else w=h*h-4*l*c,y=d.sqrt(w),w<0||(0<(m=(-h+y)/(2*c))&&m<1&&C.push(m),0<(v=(-h-y)/(2*c))&&v<1&&C.push(v));for(var _,R=C.length,S=R;R--;)_=1-(g=C[R]),x[0][R]=_*_*_*t+3*_*_*g*i+3*_*g*g*r+g*g*g*o,x[1][R]=_*_*_*e+3*_*_*g*n+3*_*g*g*s+g*g*g*a;return x[0][S]=t,x[1][S]=e,x[0][S+1]=o,x[1][S+1]=a,x[0].length=x[1].length=S+2,{min:{x:u.apply(0,x[0]),y:u.apply(0,x[1])},max:{x:f.apply(0,x[0]),y:f.apply(0,x[1])}}}function Y(t,e){var i=!e&&m(t);if(!e&&i.curve)return y(i.curve);for(var n=V(t),r=e&&V(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,i){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(G.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*e.x-e.bx,r=2*e.y-e.by):(n=e.x,r=e.y),t=["C",n,r].concat(t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(q(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(q(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(z(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(z(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(z(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(z(e.x,e.y,e.X,e.Y))}return t},c=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)l[e]="A",r&&(u[e]="A"),t.splice(e++,0,["C"].concat(i.splice(0,6)));t.splice(e,1),w=f(n.length,r&&r.length||0)}},d=function(t,e,i,s,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],w=f(n.length,r&&r.length||0))},l=[],u=[],g="",p="",v=0,w=f(n.length,r&&r.length||0);v<w;v++){n[v]&&(g=n[v][0]),"C"!=g&&(l[v]=g,v&&(p=l[v-1])),n[v]=a(n[v],s,p),"A"!=l[v]&&"C"==g&&(l[v]="C"),c(n,v),r&&(r[v]&&(g=r[v][0]),"C"!=g&&(u[v]=g,v&&(p=u[v-1])),r[v]=a(r[v],o,p),"A"!=u[v]&&"C"==g&&(u[v]="C"),c(r,v)),d(n,r,s,o,v),d(r,n,o,s,v);var C=n[v],x=r&&r[v],b=C.length,_=r&&x.length;s.x=C[b-2],s.y=C[b-1],s.bx=h(C[b-4])||s.x,s.by=h(C[b-3])||s.y,o.bx=r&&(h(x[_-4])||o.x),o.by=r&&(h(x[_-3])||o.y),o.x=r&&x[_-2],o.y=r&&x[_-1]}return r||(i.curve=y(n)),r?[n,r]:n}function Z(t,e){if(!e)return t;var i,n,r,s,o,a,c;for(r=0,o=(t=Y(t)).length;r<o;r++)for(s=1,a=(c=t[r]).length;s<a;s+=2)i=e.x(c[s],c[s+1]),n=e.y(c[s],c[s+1]),c[s]=i,c[s+1]=n;return t}function Q(t,e){for(var i=[],n=0,r=t.length;r-2*!e>n;n+=2){var s=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?r-4==n?s[3]={x:+t[0],y:+t[1]}:r-2==n&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[r-2],y:+t[r-1]}:r-4==n?s[3]=s[2]:n||(s[0]={x:+t[n],y:+t[n+1]}),i.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return i}t.path=m,t.path.getTotalLength=b,t.path.getPointAtLength=_,t.path.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return R(t,e).end;var n=R(t,i,1);return e?R(n,e).end:n},r.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},r.getPointAtLength=function(t){return _(this.attr("d"),t)},r.getSubpath=function(e,i){return t.path.getSubpath(this.attr("d"),e,i)},t._.box=v,t.path.findDotsAtSegment=S,t.path.bezierBBox=D,t.path.isPointInsideBBox=k,t.closest=function(e,i,n,r){for(var s=100,o=v(e-s/2,i-s/2,s,s),a=[],c=n[0].hasOwnProperty("x")?function(t){return{x:n[t].x,y:n[t].y}}:function(t){return{x:n[t],y:r[t]}},h=0;s<=1e6&&!h;){for(var d=0,l=n.length;d<l;d++){var u=c(d);if(k(o,u.x,u.y)){h++,a.push(u);break}}h||(o=v(e-(s*=2)/2,i-s/2,s,s))}if(1e6!=s){var f,g=1/0;for(d=0,l=a.length;d<l;d++){var p=t.len(e,i,a[d].x,a[d].y);g>p&&(g=p,a[d].len=p,f=a[d])}return f}},t.path.isBBoxIntersect=A,t.path.intersection=N,t.path.intersectionNumber=P,t.path.isPointInside=U,t.path.getBBox=W,t.path.get=I,t.path.toRelative=j,t.path.toAbsolute=V,t.path.toCubic=Y,t.path.map=Z,t.path.toString=w,t.path.clone=y})),n.plugin((function(t,n,r,s){var o=Math.max,a=Math.min,c=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,i=t.length;e<i;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},h=c.prototype;h.push=function(){for(var t,e,i=0,n=arguments.length;i<n;i++)(t=arguments[i])&&(this[e=this.items.length]=this.items[e]=t,this.length++);return this},h.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},h.forEach=function(t,e){for(var i=0,n=this.items.length;i<n;i++)if(!1===t.call(e,this.items[i],i))return this;return this},h.animate=function(n,r,s,o){"function"!=typeof s||s.length||(o=s,s=i.linear),n instanceof t._.Animation&&(o=n.callback,s=n.easing,r=s.dur,n=n.attr);var a=arguments;if(t.is(n,"array")&&t.is(a[a.length-1],"array"))var c=!0;var h,d=function(){h?this.b=h:h=this.b},l=0,u=this,f=o&&function(){++l==u.length&&o.call(this)};return this.forEach((function(t,i){e.once("snap.animcreated."+t.id,d),c?a[i]&&t.animate.apply(t,a[i]):t.animate(n,r,s,f)}))},h.remove=function(){for(;this.length;)this.pop().remove();return this},h.bind=function(t,e,i){var n={};if("function"==typeof e)this.bindings[t]=e;else{var r=i||t;this.bindings[t]=function(t){n[r]=t,e.attr(n)}}return this},h.attr=function(t){var e={};for(var i in t)this.bindings[i]?this.bindings[i](t[i]):e[i]=t[i];for(var n=0,r=this.items.length;n<r;n++)this.items[n].attr(e);return this},h.clear=function(){for(;this.length;)this.pop()},h.splice=function(t,e,i){t=t<0?o(this.length+t,0):t,e=o(0,a(this.length-t,e));var n,r=[],s=[],h=[];for(n=2;n<arguments.length;n++)h.push(arguments[n]);for(n=0;n<e;n++)s.push(this[t+n]);for(;n<this.length-t;n++)r.push(this[t+n]);var d=h.length;for(n=0;n<d+r.length;n++)this.items[t+n]=this[t+n]=n<d?h[n]:r[n-d];for(n=this.items.length=this.length-=e-d;this[n];)delete this[n++];return new c(s)},h.exclude=function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},h.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},h.getBBox=function(){for(var t=[],e=[],i=[],n=[],r=this.items.length;r--;)if(!this.items[r].removed){var s=this.items[r].getBBox();t.push(s.x),e.push(s.y),i.push(s.x+s.width),n.push(s.y+s.height)}return{x:t=a.apply(0,t),y:e=a.apply(0,e),x2:i=o.apply(0,i),y2:n=o.apply(0,n),width:i-t,height:n-e,cx:t+(i-t)/2,cy:e+(n-e)/2}},h.clone=function(t){t=new c;for(var e=0,i=this.items.length;e<i;e++)t.push(this.items[e].clone());return t},h.toString=function(){return"Snap‘s set"},h.type="set",t.Set=c,t.set=function(){var t=new c;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}})),n.plugin((function(t,i,n,r){var s={},o=/[a-z]+$/i,a=String;function c(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function h(e,i,n){i=a(i).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],i=t.parseTransformString(i)||[];for(var r,s,o,h,d=Math.max(e.length,i.length),l=[],u=[],f=0;f<d;f++){if(o=e[f]||c(i[f]),h=i[f]||c(o),o[0]!=h[0]||"r"==o[0].toLowerCase()&&(o[2]!=h[2]||o[3]!=h[3])||"s"==o[0].toLowerCase()&&(o[3]!=h[3]||o[4]!=h[4])){e=t._.transform2matrix(e,n()),i=t._.transform2matrix(i,n()),l=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],u=[["m",i.a,i.b,i.c,i.d,i.e,i.f]];break}for(l[f]=[],u[f]=[],r=0,s=Math.max(o.length,h.length);r<s;r++)r in o&&(l[f][r]=o[r]),r in h&&(u[f][r]=h[r])}return{from:p(l),to:p(u),f:g(l)}}function d(t){return t}function l(t){return function(e){return+e.toFixed(3)+t}}function u(t){return t.join(" ")}function f(e){return t.rgb(e[0],e[1],e[2])}function g(t){var e,i,n,r,s,o,a=0,c=[];for(e=0,i=t.length;e<i;e++){for(s="[",o=['"'+t[e][0]+'"'],n=1,r=t[e].length;n<r;n++)o[n]="val["+a+++"]";s+=o+"]",c[e]=s}return Function("val","return Snap.path.toString.call(["+c+"])")}function p(t){for(var e=[],i=0,n=t.length;i<n;i++)for(var r=1,s=t[i].length;r<s;r++)e.push(t[i][r]);return e}function m(t){return isFinite(parseFloat(t))}function v(e,i){return!(!t.is(e,"array")||!t.is(i,"array"))&&e.toString()==i.toString()}s.stroke=s.fill="colour",i.prototype.equal=function(t,i){return e("snap.util.equal",this,t,i).firstDefined()},e.on("snap.util.equal",(function(e,i){var n,r,c=a(this.attr(e)||""),w=this;if(m(c)&&m(i))return{from:parseFloat(c),to:parseFloat(i),f:d};if("colour"==s[e])return n=t.color(c),r=t.color(i),{from:[n.r,n.g,n.b,n.opacity],to:[r.r,r.g,r.b,r.opacity],f:f};if("viewBox"==e)return{from:n=this.attr(e).vb.split(" ").map(Number),to:r=i.split(" ").map(Number),f:u};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return i instanceof t.Matrix&&(i=i.toTransformString()),t._.rgTransform.test(i)||(i=t._.svgTransform2string(i)),h(c,i,(function(){return w.getBBox(1)}));if("d"==e||"path"==e)return{from:p((n=t.path.toCubic(c,i))[0]),to:p(n[1]),f:g(n[0])};if("points"==e)return{from:n=a(c).split(t._.separator),to:r=a(i).split(t._.separator),f:function(t){return t}};var y=c.match(o),C=a(i).match(o);return y&&v(y,C)?{from:parseFloat(c),to:parseFloat(i),f:l(y)}:{from:this.asPX(e),to:this.asPX(e,i),f:d}}))})),n.plugin((function(t,i,n,r){for(var s=i.prototype,o="hasOwnProperty",a=("createTouch"in r.doc),c=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],h={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},d=function(t,e){var i="y"==t?"scrollTop":"scrollLeft",n=e&&e.node?e.node.ownerDocument:r.doc;return n[i in n.documentElement?"documentElement":"body"][i]},l=function(){return this.originalEvent.preventDefault()},u=function(){return this.originalEvent.stopPropagation()},f=function(t,e,i,n){var r=a&&h[e]?h[e]:e,s=function(r){var s=d("y",n),c=d("x",n);if(a&&h[o](e))for(var f=0,g=r.targetTouches&&r.targetTouches.length;f<g;f++)if(r.targetTouches[f].target==t||t.contains(r.targetTouches[f].target)){var p=r;(r=r.targetTouches[f]).originalEvent=p,r.preventDefault=l,r.stopPropagation=u;break}var m=r.clientX+c,v=r.clientY+s;return i.call(n,r,m,v)};return e!==r&&t.addEventListener(e,s,!1),t.addEventListener(r,s,!1),function(){return e!==r&&t.removeEventListener(e,s,!1),t.removeEventListener(r,s,!1),!0}},g=[],p=function(t){for(var i,n=t.clientX,r=t.clientY,s=d("y"),o=d("x"),c=g.length;c--;){if(i=g[c],a){for(var h,l=t.touches&&t.touches.length;l--;)if((h=t.touches[l]).identifier==i.el._drag.id||i.el.node.contains(h.target)){n=h.clientX,r=h.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var u=i.el.node;u.nextSibling,u.parentNode,u.style.display,n+=o,r+=s,e("snap.drag.move."+i.el.id,i.move_scope||i.el,n-i.el._drag.x,r-i.el._drag.y,n,r,t)}},m=function(i){t.unmousemove(p).unmouseup(m);for(var n,r=g.length;r--;)(n=g[r]).el._drag={},e("snap.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,i),e.off("snap.drag.*."+n.el.id);g=[]},v=c.length;v--;)!function(e){t[e]=s[e]=function(i,n){if(t.is(i,"function"))this.events=this.events||[],this.events.push({name:e,f:i,unbind:f(this.node||document,e,i,n||this)});else for(var r=0,s=this.events.length;r<s;r++)if(this.events[r].name==e)try{this.events[r].f.call(this)}catch(t){}return this},t["un"+e]=s["un"+e]=function(t){for(var i=this.events||[],n=i.length;n--;)if(i[n].name==e&&(i[n].f==t||!t))return i[n].unbind(),i.splice(n,1),!i.length&&delete this.events,this;return this}}(c[v]);s.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},s.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var w=[];s.drag=function(i,n,r,s,o,a){var c,h=this;if(!arguments.length)return h.drag((function(t,e){this.attr({transform:c+(c?"T":"t")+[t,e]})}),(function(){c=this.transform().local}));function d(c,d,l){(c.originalEvent||c).preventDefault(),h._drag.x=d,h._drag.y=l,h._drag.id=c.identifier,!g.length&&t.mousemove(p).mouseup(m),g.push({el:h,move_scope:s,start_scope:o,end_scope:a}),n&&e.on("snap.drag.start."+h.id,n),i&&e.on("snap.drag.move."+h.id,i),r&&e.on("snap.drag.end."+h.id,r),e("snap.drag.start."+h.id,o||s||h,d,l,c)}function l(t,i,n){e("snap.draginit."+h.id,h,t,i,n)}return e.on("snap.draginit."+h.id,d),h._drag={},w.push({el:h,start:d,init:l}),h.mousedown(l),h},s.undrag=function(){for(var i=w.length;i--;)w[i].el==this&&(this.unmousedown(w[i].init),w.splice(i,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!w.length&&t.unmousemove(p).unmouseup(m),this}})),n.plugin((function(t,i,n,r){i.prototype;var s=n.prototype,o=/^\s*url\((.+)\)/,a=String,c=t._.$;t.filter={},s.filter=function(e){var n=this;"svg"!=n.type&&(n=n.paper);var r=t.parse(a(e)),s=t._.id();n.node.offsetWidth,n.node.offsetHeight;var o=c("filter");return c(o,{id:s,filterUnits:"userSpaceOnUse"}),o.appendChild(r.node),n.defs.appendChild(o),new i(o)},e.on("snap.util.getattr.filter",(function(){e.stop();var i=c(this.node,"filter");if(i){var n=a(i).match(o);return n&&t.select(n[1])}})),e.on("snap.util.attr.filter",(function(n){if(n instanceof i&&"filter"==n.type){e.stop();var r=n.node.id;r||(c(n.node,{id:n.id}),r=n.id),c(this.node,{filter:t.url(r)})}n&&"none"!=n||(e.stop(),this.node.removeAttribute("filter"))})),t.filter.blur=function(e,i){null==e&&(e=2);var n=null==i?e:[e,i];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:n})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,i,n,r,s){return"string"==typeof n&&(s=r=n,n=4),"string"!=typeof r&&(s=r,r="#000"),r=r||"#000",null==n&&(n=4),null==s&&(s=1),null==e&&(e=0,i=2),null==i&&(i=e),r=t.color(r),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:r,dx:e,dy:i,blur:n,opacity:s})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}})),n.plugin((function(t,e,i,n,r){var s=t._.box,o=t.is,a=/^[^a-z]*([tbmlrc])/i,c=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&o(t,"string")&&(e=t,t=null);var i=(t=t||this.paper).getBBox?t.getBBox():s(t),n=this.getBBox(),r={};switch(e=(e=e&&e.match(a))?e[1].toLowerCase():"c"){case"t":r.dx=0,r.dy=i.y-n.y;break;case"b":r.dx=0,r.dy=i.y2-n.y2;break;case"m":r.dx=0,r.dy=i.cy-n.cy;break;case"l":r.dx=i.x-n.x,r.dy=0;break;case"r":r.dx=i.x2-n.x2,r.dy=0;break;default:r.dx=i.cx-n.cx,r.dy=0}return r.toString=c,r},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}})),n}(i,n)}));class yt{static roseLegendAttribute(t){return{fill:t,"font-size":25,"font-family":"arial","text-anchor":"middle","dominant-baseline":"middle"}}static windBarAttribute(t,e,i,n){return{fill:t,"font-size":e,"font-family":"Arial","text-anchor":n,"dominant-baseline":i}}}yt.directionLettersAttribute={fill:"white","font-size":50,"font-family":"arial"};class Ct{constructor(t){this.svg=t}drawLine(t){return this.svg.line(t.startPoint.x,t.startPoint.y,t.endPoint.x,t.endPoint.y)}drawRect(t){return this.svg.rect(t.startPoint.x,t.startPoint.y,t.width,t.height)}drawPolyRect(t){return this.svg.path(wt.format("M {x} {y} l {w} 0 l 0 {h} l {wn} 0 Z",{x:t.startPoint.x,y:t.startPoint.y,w:t.width,wn:-1*t.width,h:t.height}))}drawTriangle(t,e,i,n,r,s){return this.svg.path(wt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} Z",{x:t,y:e,dx1:i,dy1:n,dx2:r,dy2:s}))}drawArrow(t,e,i){return this.svg.path(wt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} l {dx3} {dy3} Z",{x:t,y:e,dx1:i,dy1:-i/2,dx2:-i/4,dy2:i/2,dx3:i/4,dy3:i/2}))}drawWindDirectionText(t,e,i,n){var r=this.drawText(t,e,yt.windBarAttribute(n,50,"middle","middle"));return this.rotate(r,i,t),r}rotate(t,e,i){t.transform(wt.format("r{deg},{x},{y}",{deg:e,x:i.x,y:i.y}))}drawCircle(t){return this.svg.circle(t.centerPoint.x,t.centerPoint.y,t.radius)}drawText(t,e,i){var n=this.svg.text(t.x,t.y,e);return n.attr(i),n}}class xt{constructor(t,e){this.startPoint=t,this.endPoint=e}}class bt{constructor(t,e){this.x=t,this.y=e}}class _t{constructor(t,e){this.centerPoint=t,this.radius=e}}class Rt{constructor(t){this.cfg=t}roseCenter(){return new bt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius)}crossHorizontalLine(){var t=this.cfg.marginTop+this.cfg.roseRadius;return new xt(new bt(this.cfg.marginLeft,t),new bt(this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius,t))}crossVerticalLine(){var t=this.cfg.marginLeft+this.cfg.roseRadius;return new xt(new bt(t,this.cfg.marginTop),new bt(t,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius))}roseCircle(t){return new _t(new bt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius),t)}viewBox(){if("right"===this.cfg.barLocation)return this.viewBoxBarRight();if("bottom"===this.cfg.barLocation)return this.viewBoxBarBotton();throw new Error("Bar location should be right or bottom not: "+this.cfg.barLocation)}viewBoxBarRight(){var t=this.cfg.barRight,e=this.cfg.roseRadius+this.cfg.roseRadius,i=this.cfg.marginTop+e+this.cfg.marginBottom;return"0 0 "+(1===this.cfg.barCount?this.cfg.marginLeft+e+this.cfg.marginRight+t.barMarginLeft+t.barWidth+t.barMarginRight:this.cfg.marginLeft+e+this.cfg.marginRight+t.barWidth*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+this.cfg.marginRight)+" "+i}viewBoxBarBotton(){var t=this.cfg.barBottom,e=this.cfg.roseRadius+this.cfg.roseRadius;return"0 0 "+(this.cfg.marginLeft+e+this.cfg.marginRight)+" "+(1===this.cfg.barCount?this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight+t.barMarginBottom:this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+t.barMarginBottom)}north(){return new bt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop-this.cfg.directionLetterMargin)}east(){return new bt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}south(){return new bt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin)}west(){return new bt(this.cfg.marginLeft-this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}}class St{constructor(t,e,i,n,r){this.config=t,this.speedRanges=i,this.svg=n,this.degreesCalculator=r,this.svgUtil=new Ct(n),this.dimensionCalculator=new Rt(e),this.roseCenter=this.dimensionCalculator.roseCenter()}drawWindRose(t){if(void 0===t)return void ct.error("drawWindRose(): Can't draw, no windrose data set.");ct.trace("drawWindRose()",t),this.svg.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const e=this.drawBackgroundLines(),i=this.drawWindDirectionText(),n=this.drawWindDirections();this.roseGroup=this.svg.group(i,n,e),this.roseGroup.transform("R"+this.degreesCalculator.getRoseRenderDegrees()+","+this.roseCenter.x+","+this.roseCenter.y),this.drawCircleLegend()}rotateWindRose(){if(void 0===this.roseGroup)return;const t=this.degreesCalculator.getRoseRenderDegrees(),e="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;this.roseGroup.animate({transform:e},700,mina.easeinout);const i="R"+-t+","+this.dimensionCalculator.north().x+","+this.dimensionCalculator.north().y;this.northText.animate({transform:i},700,mina.easeinout);const n="R"+-t+","+this.dimensionCalculator.east().x+","+this.dimensionCalculator.east().y;this.eastText.animate({transform:n},700,mina.easeinout);const r="R"+-t+","+this.dimensionCalculator.south().x+","+this.dimensionCalculator.south().y;this.southText.animate({transform:r},700,mina.easeinout);const s="R"+-t+","+this.dimensionCalculator.west().x+","+this.dimensionCalculator.west().y;this.westText.animate({transform:s},700,mina.easeinout)}drawWindDirections(){const t=this.svg.group();for(let e=0;e<this.windRoseData.directionPercentages.length;e++)t.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[e],this.windRoseData.directionPercentages[e],this.windRoseData.directionDegrees[e]));return t}drawWindDirection(t,e,i){const n=this.svg.group();if(0===e)return n;const r=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(r[e]=t[e],t[e]>0)for(let i=e-1;i>=0;i--)r[e]+=t[i];const s=e*this.dimensionCalculator.cfg.roseRadius/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=s*(r[t]/100);e>0&&(ct.trace("Degrees: "+(i-90)+" radius: "+e+" percentage: "+r[t]),n.add(this.drawSpeedPart(this.svg,i-90,e,this.speedRanges[t].color)))}return n}drawSpeedPart(t,e,i,n){ct.trace("Degrees 1"+(e-this.config.leaveArc/2)),ct.trace("Degrees 2"+(e+this.config.leaveArc/2)),ct.trace("Color: "+n);var r=gt.toRadians(e-this.config.leaveArc/2),s=gt.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*i),c=o.y+Math.round(Math.sin(r)*i),h=o.x+Math.round(Math.cos(s)*i),d=o.y+Math.round(Math.sin(s)*i);return ct.trace("Coords: ",o.x,o.y,a,c,h,d,n),t.path(wt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:c,x2:h,y2:d,radius:i})).attr({fill:n,stroke:this.config.roseLinesColor})}drawBackgroundLines(){var t=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),e=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=this.svg.group(t,e);const n=this.windRoseData.circleCount,r=this.dimensionCalculator.cfg.roseRadius/n;for(let t=1;t<=n;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(r*t)));return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(){const t=this.degreesCalculator.getRoseRenderDegrees();return this.config.cardinalDirectionLetters,this.northText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-t,this.config.roseDirectionLettersColor),this.eastText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-t,this.config.roseDirectionLettersColor),this.southText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-t,this.config.roseDirectionLettersColor),this.westText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-t,this.config.roseDirectionLettersColor),this.svg.group(this.northText,this.eastText,this.southText,this.westText)}drawCircleLegend(){const t=this.svg.group(),e=this.dimensionCalculator.cfg.roseRadius/this.windRoseData.circleCount,i=Math.cos(gt.toRadians(45))*e,n=this.dimensionCalculator.roseCenter();for(let e=1;e<=this.windRoseData.circleCount;e++){const r=new bt(n.x+i*e,n.y+i*e),s=this.svgUtil.drawText(r,this.windRoseData.percentagePerCircle*e+"%",yt.roseLegendAttribute(this.config.rosePercentagesColor));t.add(s)}return t}}class Dt{constructor(t,e,i){this.startPoint=t,this.width=e,this.height=i}}class kt{constructor(t){this.cfg=t}barRectBottom(t){var e=this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginBottom;return t>0&&(e+=(this.cfg.barBottom.barHeight+this.cfg.barBottom.multiBarSpacing)*t),new Dt(new bt(this.cfg.barBottom.barMarginLeft,e),this.cfg.barBottom.barLength,this.cfg.barBottom.barHeight)}barRectRight(t){var e=this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginRight+this.cfg.barRight.barMarginLeft;return t>0&&(e+=(this.cfg.barRight.barWidth+this.cfg.barRight.multiBarSpacing)*t),new Dt(new bt(e,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius),this.cfg.barRight.barWidth,this.cfg.barRight.barHeight)}}class At{getColorArray(t){const e=[];for(let i=0;i<t;i++){const n=240-240/(t-1)*i;e.push(`hsl(${n}, 100%, 60%)`)}return e}static getTextColorBasedOnBackground(t){const e=At.getRgbColor(t);if(void 0===e)return"black";let i=e[0],n=e[1],r=e[2];return i/=255,n/=255,r/=255,i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*i+.7152*n+.0722*r>.179?"#000000":"#FFFFFF"}static getRgbColor(t){let e=document.createElement("div");e.style.color=t,document.body.appendChild(e);let i=window.getComputedStyle(e).color;if(document.body.removeChild(e),i)return i.match(/\d+/g).map(Number)}}class Et{constructor(t,e,i,n,r){ct.debug("WindBarRenderer init",t,i),this.config=t,this.svg=r,t.outputUnitLabel?this.outputUnitName=t.outputUnitLabel:t.speedRangeBeaufort?this.outputUnitName="Beaufort":this.outputUnitName=i.name,this.speedRanges=i.speedRanges,this.positionIndex=n,this.svgUtil=new Ct(this.svg),this.dimensionCalculator=new kt(e)}drawWindBar(t){void 0!==t?(ct.trace("drawWindBar(): ",t),"horizontal"===this.config.orientation?this.drawBarLegendHorizontal(t.speedRangePercentages):"vertical"===this.config.orientation&&this.drawBarLegendVertical(t.speedRangePercentages)):ct.error("drawWindBar(): Can't draw bar, windRoseData not set.")}drawBarLegendVertical(t){const e=40,i=this.dimensionCalculator.barRectRight(this.positionIndex);let n=t.length;this.config.full||(n=this.getIndexHighestRangeWithMeasurements(t));const r=this.dimensionCalculator.cfg.barRight.barHeight/n,s=this.speedRanges[n-1].minSpeed;this.svgUtil.drawText(new bt(i.startPoint.x-10,i.startPoint.y),this.config.label,yt.windBarAttribute(this.config.barNameColor,e,"auto","left")).transform("r270,"+(i.startPoint.x-10)+","+i.startPoint.y);const o=i.startPoint.x;let a=i.startPoint.y;for(let d=0;d<n;d++){this.config.renderRelativeScale&&d!==n-1?length=(this.speedRanges[d+1].minSpeed-this.speedRanges[d].minSpeed)*((this.dimensionCalculator.cfg.barRight.barHeight-r)/s)*-1:length=-1*r;if(this.svgUtil.drawPolyRect(new Dt(new bt(o,a),i.width,length)).attr({fill:this.speedRanges[d].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort?12==d?this.svgUtil.drawText(new bt(o+i.width+10,a),d+"",yt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new bt(o+i.width+10,a+length/2),d+"",yt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new bt(o+i.width+10,a),this.speedRanges[d].minSpeed+"",yt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),t[d]>0){var c=Math.round(t[d]),h=100===c?35:e;let n=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[d].color);this.svgUtil.drawText(new bt(o+i.width/2,a+length/2),`${c}%`,yt.windBarAttribute(n,h,"middle","middle"))}a+=length}!this.config.speedRangeBeaufort&&!this.config.full&&n<t.length&&this.svgUtil.drawText(new bt(o+i.width+10,a),this.speedRanges[n].minSpeed+"",yt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),this.svgUtil.drawText(new bt(o+i.width/2,i.startPoint.y-i.height-15),this.outputUnitName,yt.windBarAttribute(this.config.barUnitNameColor,e,"auto","middle"))}drawBarLegendHorizontal(t){const e=this.dimensionCalculator.barRectBottom(this.positionIndex);let i=t.length;this.config.full||(i=this.getIndexHighestRangeWithMeasurements(t));const n=this.dimensionCalculator.cfg.barBottom.barLength/i,r=this.speedRanges[i-1].minSpeed,s=new bt(e.startPoint.x,e.startPoint.y-10);this.svgUtil.drawText(s,this.config.label,yt.windBarAttribute(this.config.barNameColor,35,"auto","start"));let o=e.startPoint.x;const a=e.startPoint.y;for(let s=0;s<i;s++){if(this.config.renderRelativeScale&&s!==i-1?length=(this.speedRanges[s+1].minSpeed-this.speedRanges[s].minSpeed)*((this.dimensionCalculator.cfg.barBottom.barLength-n)/r):length=n,this.svgUtil.drawRect(new Dt(new bt(o,a),length,e.height)).attr({fill:this.speedRanges[s].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort){const t=new bt(o+length/2,a+e.height+10);this.svgUtil.drawText(t,s+"",yt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}else{const t=new bt(o,a+e.height+10);this.svgUtil.drawText(t,this.speedRanges[s].minSpeed+"",yt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}if(t[s]>0){const i=new bt(o+length/2,a+e.height/2+2);let n=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[s].color);this.svgUtil.drawText(i,`${Math.round(t[s])}%`,yt.windBarAttribute(n,35,"middle","middle"))}o+=length}if(!this.config.speedRangeBeaufort&&!this.config.full&&i<t.length){const t=new bt(o,a+e.height+3);this.svgUtil.drawText(t,this.speedRanges[i].minSpeed+"",yt.windBarAttribute(this.config.barUnitValuesColor,35,"hanging","middle"))}const c=new bt(e.startPoint.x+e.width,e.startPoint.y-10);this.svgUtil.drawText(c,this.outputUnitName,yt.windBarAttribute(this.config.barUnitNameColor,35,"auto","end"))}getIndexHighestRangeWithMeasurements(t){for(let e=t.length-1;e>=0;e--)if(t[e]>0)return e+1;return t.length}getPercentageTextColor(t,e){return"auto"===t?At.getTextColorBasedOnBackground(e):t}}class Bt{constructor(t,e,i,n,r,s,o){this.speedRangePercentages=t,this.directionSpeedRangePercentages=e,this.directionPercentages=i,this.directionDegrees=n,this.circleCount=r,this.percentagePerCircle=s,this.maxCirclePercentage=o}}class $t{calculate(t){const e=Math.max(...t.directionTotals);ct.trace("Max direction total:",e);const i=this.calculateSpeedRangePercentages(t.speedRangeCounts,t.total);ct.trace("Speed range percentages:",i);const n=this.calculateDirectionSpeedRangePercentages(t.directionSpeedRangeCounts,t.directionTotals);ct.trace("Direction speed range percentages:",n);const r=this.calculateDirectionPercentages(t.directionTotals,t.total);ct.trace("Direction percentages:",r);const s=t.speedRangeDegrees;ct.trace("Direction degrees:",s);const o=this.calculateCirclePercentages(e,t.total);return ct.trace("Number of circles:",o[0]),ct.trace("Percentage per circle:",o[1]),ct.trace("Max circle percentage:",o[2]),new Bt(i,n,r,s,o[0],o[1],o[2])}calculateSpeedRangePercentages(t,e){const i=e/100,n=[];for(const e of t)n.push(e/i);return n}calculateDirectionSpeedRangePercentages(t,e){const i=[];for(let n=0;n<e.length;n++){const r=[],s=e[n]/100;for(const e of t[n])0===s?r.push(0):r.push(e/s);i.push(r)}return i}calculateDirectionPercentages(t,e){const i=e/100,n=[];for(const e of t)n.push(e/i);return n}calculateCirclePercentages(t,e){const i=t/(e/100);let n=0,r=0;return i<=30?(n=Math.ceil(i/6),r=Math.ceil(i/n)):(n=Math.ceil(i/5),r=5),[r,n,r*n]}}class Tt{constructor(t,e,i,n,r,s){this.name=t,this.configs=e,this.toMpsFunc=i,this.fromMpsFunc=n,this.speedRangeStep=r,this.speedRangeMax=s,this.speedRanges=[]}}class Mt{constructor(t,e,i,n,r){this.outputUnit=t,this.rangeBeaufort=e,this.rangeStep=i,this.rangeMax=n,this.speedRanges=r,this.bft=new Tt("Beaufort",["bft","Beaufort"],(t=>{switch(t){case 0:default:return 0;case 1:return 1;case 2:return 2.5;case 3:return 4;case 4:return 6.5;case 5:return 9;case 6:return 12;case 7:return 15.5;case 8:return 18.5;case 9:return 22.5;case 10:return 26.5;case 11:return 30;case 12:return 34}}),(t=>t),void 0,void 0),this.mps=new Tt("m/s",["mps","m/s"],(t=>t),(t=>t),5,30),this.kph=new Tt("km/h",["kph","km/h"],(t=>t/3.6),(t=>3.6*t),10,100),this.mph=new Tt("m/h",["mph","m/h"],(t=>t/2.2369),(t=>2.2369*t),10,70),this.fps=new Tt("ft/s",["fps","ft/s"],(t=>t/3.2808399),(t=>3.2808399*t),10,100),this.knots=new Tt("knots",["knots","kts","knts","kn"],(t=>t/1.9438444924406),(t=>1.9438444924406*t),5,60),this.units=[this.bft,this.mps,this.kph,this.mph,this.fps,this.knots],this.outputSpeedUnit=this.getSpeedUnit(this.outputUnit),!0===e?this.outputSpeedUnit.speedRanges=this.generateBeaufortSpeedRanges(t):r&&r.length>0?this.outputSpeedUnit.speedRanges=r:this.outputSpeedUnit.speedRanges=i&&n?this.generateSpeedRanges(i,n):this.generateSpeedRanges(this.outputSpeedUnit.speedRangeStep,this.outputSpeedUnit.speedRangeMax),ct.trace("Speed ranges: ",this.outputSpeedUnit.speedRanges)}getOutputSpeedUnit(){return this.outputSpeedUnit}getSpeedConverter(t){if(t===this.outputUnit)return t=>t;if("mps"===t)return this.outputSpeedUnit.fromMpsFunc;const e=this.getSpeedUnit(t).toMpsFunc,i=this.outputSpeedUnit.fromMpsFunc;return t=>i(e(t))}getRangeFunction(){return t=>{const e=this.outputSpeedUnit.speedRanges.find((e=>e.isRangeMatch(t)));if(e)return e.range;throw new Error("Speed is not in a speedrange: "+t+" unit: "+this.outputUnit)}}getSpeedRanges(){return this.outputSpeedUnit.speedRanges}getSpeedUnit(t){const e=this.units.find((e=>e.configs.includes(t)));if(void 0===e)throw new Error("Unknown speed unit: "+t);return ct.debug(`Matched speedunit ${e.name}`),e}generateSpeedRanges(t,e){const i=(new At).getColorArray(Math.floor(e/t)+1),n=[];let r=0,s=0;for(;r<=e-t;)n.push(new ot(s,r,r+t,i[s])),s++,r+=t;return n.push(new ot(s,r,-1,i[s])),n}generateBeaufortSpeedRanges(t){const e=(new At).getColorArray(13);if(void 0===t||"mps"===t)return[new ot(0,0,.5,e[0]),new ot(1,.5,1.6,e[1]),new ot(2,1.6,3.4,e[2]),new ot(3,3.4,5.5,e[3]),new ot(4,5.5,8,e[4]),new ot(5,8,10.8,e[5]),new ot(6,10.8,13.9,e[6]),new ot(7,13.9,17.2,e[7]),new ot(8,17.2,20.8,e[8]),new ot(9,20.8,24.5,e[9]),new ot(10,24.5,28.5,e[10]),new ot(11,28.5,32.7,e[11]),new ot(12,32.7,-1,e[12])];if("kph"===t)return[new ot(0,0,2,e[0]),new ot(1,2,6,e[1]),new ot(2,6,12,e[2]),new ot(3,12,20,e[3]),new ot(4,20,29,e[4]),new ot(5,29,39,e[5]),new ot(6,39,50,e[6]),new ot(7,50,62,e[7]),new ot(8,62,75,e[8]),new ot(9,75,89,e[9]),new ot(10,89,103,e[10]),new ot(11,103,118,e[11]),new ot(12,118,-1,e[12])];if("mph"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,8,e[2]),new ot(3,8,13,e[3]),new ot(4,13,19,e[4]),new ot(5,19,25,e[5]),new ot(6,25,32,e[6]),new ot(7,32,39,e[7]),new ot(8,39,47,e[8]),new ot(9,47,55,e[9]),new ot(10,55,64,e[10]),new ot(11,64,73,e[11]),new ot(12,73,-1,e[12])];if("fps"===t)return[new ot(0,0,1.6,e[0]),new ot(1,1.6,5.2,e[1]),new ot(2,5.2,11.2,e[2]),new ot(3,11.2,18,e[3]),new ot(4,18,26.2,e[4]),new ot(5,26.2,35.4,e[5]),new ot(6,35.4,45.6,e[6]),new ot(7,45.6,56.4,e[7]),new ot(8,56.4,68.2,e[8]),new ot(9,68.2,80.4,e[9]),new ot(10,80.4,93.5,e[10]),new ot(11,93.5,107,e[11]),new ot(12,107,-1,e[12])];if("knots"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,7,e[2]),new ot(3,7,11,e[3]),new ot(4,11,17,e[4]),new ot(5,17,22,e[5]),new ot(6,22,28,e[6]),new ot(7,28,34,e[7]),new ot(8,34,41,e[8]),new ot(9,41,48,e[9]),new ot(10,48,56,e[10]),new ot(11,56,64,e[11]),new ot(12,64,-1,e[12])];throw new Error("No Bft reanges for type: "+t)}}class Nt{constructor(t,e,i,n,r,s,o,a,c,h,d,l,u){this.centerRadius=t,this.windDirectionCount=e,this.windDirectionUnit=i,this.windDirectionLetters=n,this.leaveArc=r,this.cardinalDirectionLetters=s,this.directionCompensation=o,this.windRoseDrawNorthOffset=a,this.roseLinesColor=c,this.roseDirectionLettersColor=h,this.roseCenterPercentageColor=d,this.rosePercentagesColor=l,this.roseCurrentDirectionArrowColor=u}}class Pt{constructor(t,e,i,n,r,s,o,a,c,h,d){this.label=t,this.orientation=e,this.full=i,this.renderRelativeScale=n,this.outputUnitLabel=r,this.speedRangeBeaufort=s,this.barBorderColor=o,this.barUnitNameColor=a,this.barNameColor=c,this.barUnitValuesColor=h,this.barPercentagesColor=d}}class Lt{constructor(t){this.cardConfig=t}createWindRoseConfig(){return new Nt(60,this.cardConfig.windDirectionCount,this.cardConfig.windDirectionEntity.directionUnit,this.cardConfig.windDirectionEntity.directionLetters,360/this.cardConfig.windDirectionCount-8,this.cardConfig.cardinalDirectionLetters,this.cardConfig.windDirectionEntity.directionCompensation,this.cardConfig.windRoseDrawNorthOffset,this.cardConfig.cardColor.roseLines,this.cardConfig.cardColor.roseDirectionLetters,this.cardConfig.cardColor.roseCenterPercentage,this.cardConfig.cardColor.rosePercentages,this.cardConfig.cardColor.roseCurrentDirectionArrow)}createWindBarConfigs(){const t=[];for(let e=0;e<this.cardConfig.windspeedEntities.length;e++){const i=this.cardConfig.windspeedEntities[e];let n;if("bottom"===this.cardConfig.windspeedBarLocation)n=new Pt(i.name,"horizontal",this.cardConfig.windspeedBarFull,i.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages);else{if("right"!==this.cardConfig.windspeedBarLocation)throw Error("Unknown windspeed bar location: "+this.cardConfig.windspeedBarLocation);n=new Pt(i.name,"vertical",this.cardConfig.windspeedBarFull,i.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages)}t.push(n)}return t}}class Ut{constructor(){this.total=0,this.speedRangeDegrees=[],this.speedRangeCounts=[],this.directionTotals=[],this.directionSpeedRangeCounts=[]}init(t,e){this.total=0,this.speedRangeCounts=new Array(t).fill(0),this.directionTotals=new Array(e).fill(0),this.directionSpeedRangeCounts=new Array(e).fill([]);for(let e=0;e<this.directionSpeedRangeCounts.length;e++)this.directionSpeedRangeCounts[e]=new Array(t).fill(0)}add(t,e){this.total++,this.speedRangeCounts[e]++,this.directionTotals[t]++,this.directionSpeedRangeCounts[t][e]++}}class Wt{constructor(t,e){this.minDegrees=t,this.maxDegrees=e}checkDirection(t){return this.minDegrees<0?t-360>this.minDegrees||t<=this.maxDegrees:t>this.minDegrees&&t<=this.maxDegrees}}class Ot{constructor(t){this.windDirectionLetters=t,this.defaultLetters=["N","E","S","W"],this.directions={N:0,NXE:11.25,NNE:22.5,NEXN:33.75,NE:45,NEXE:56.25,ENE:67.5,EXN:78.75,E:90,EXS:101.25,ESE:112.5,SEXE:123.75,SE:135,SEXS:146.25,SSE:157.5,SXE:168.75,S:180,SXW:191.25,SSW:202.5,SWXS:213.75,SW:225,SWXW:236.25,WSW:247.5,WXS:258.75,W:270,WXN:281.25,WNW:292.5,NWXW:303.75,NW:315,NWXN:326.25,NNW:337.5,NXW:348.5,CALM:0}}getDirection(t){let e=t.toUpperCase();return this.windDirectionLetters&&(e=this.convertDirectionLetters(t)),this.directions[e]}convertDirectionLetters(t){let e="";for(let i=0;i<t.length;i++){const n=this.windDirectionLetters.indexOf(t[i]);n<0&&ct.info("Could not translate cardinal direction, letters not found in config wind_direction_entity.direction_letters"),e+=this.defaultLetters[n]}return e}}class Ft{constructor(t){this.config=t,this.windDirectionLettersConverter=new Ot(t.cardinalDirectionLetters)}convertDirection(t){let e=0;if("letters"===this.config.windDirectionUnit){if(e=this.windDirectionLettersConverter.getDirection(t),isNaN(e))return void ct.info("Could not convert direction "+t+" to degrees.")}else{if(isNaN(t))return void ct.info("Direction "+t+" is not a number.");e=t}return this.compensateDirection(e)}compensateDirection(t){let e=t;return 0!==this.config.directionCompensation&&(e=+e+this.config.directionCompensation,e<0?e=360+e:e>=360&&(e-=360)),e}}class Ht{constructor(t,e){this.windDirections=[],this.windData=new Ut,this.config=t,this.windSpeedConverter=e,this.windDirectionConverter=new Ft(t),this.speedRangeFunction=this.windSpeedConverter.getRangeFunction();const i=360/t.windDirectionCount;for(let e=0;e<t.windDirectionCount;e++){const t=e*i,n=t-i/2,r=t+i/2;this.windDirections.push(new Wt(n,r)),this.windData.speedRangeDegrees.push(t)}}init(t){this.windData.init(this.windSpeedConverter.getSpeedRanges().length,this.config.windDirectionCount),this.speedConverterFunction=this.windSpeedConverter.getSpeedConverter(t)}getMeasurementCounts(){return ct.debug("Wind counts: ",this.windData),this.windData}addWindMeasurements(t,e){const i=this.speedConverterFunction(e),n=this.speedRangeFunction(i),r=this.windDirectionConverter.convertDirection(t);if(void 0===r)return;const s=this.windDirections.findIndex((t=>t.checkDirection(r)));ct.trace("Wind measurement: ",t,e,s,n),this.windData.add(s,n)}}class It{constructor(t,e,i,n,r){this.config=t,this.speedRanges=i,this.svg=n,this.svgUtil=new Ct(n),this.dimensionCalculator=new Rt(e),this.degreesCalculator=r,this.roseCenter=this.dimensionCalculator.roseCenter()}drawWindRose(t){if(void 0===t)return void ct.error("drawWindRose(): Can't draw, no windrose data.");ct.trace("drawWindRose()",t),this.svg.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const e=this.drawWindDirectionText(),i=this.drawWindDirections(),n=this.drawBackground();this.roseGroup=this.svg.group(e,i,n),this.roseGroup.transform("R"+this.degreesCalculator.getRoseRenderDegrees()+","+this.roseCenter.x+","+this.roseCenter.y),this.drawCircleLegend(),this.drawCenterZeroSpeed()}rotateWindRose(){if(void 0===this.roseGroup)return;const t=this.degreesCalculator.getRoseRenderDegrees(),e="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;this.roseGroup.animate({transform:e},700,mina.easeinout);const i="R"+-t+","+this.dimensionCalculator.north().x+","+this.dimensionCalculator.north().y;this.northText.animate({transform:i},700,mina.easeinout);const n="R"+-t+","+this.dimensionCalculator.east().x+","+this.dimensionCalculator.east().y;this.eastText.animate({transform:n},700,mina.easeinout);const r="R"+-t+","+this.dimensionCalculator.south().x+","+this.dimensionCalculator.south().y;this.southText.animate({transform:r},700,mina.easeinout);const s="R"+-t+","+this.dimensionCalculator.west().x+","+this.dimensionCalculator.west().y;this.westText.animate({transform:s},700,mina.easeinout)}drawWindDirections(){const t=this.svg.group();for(let e=0;e<this.windRoseData.directionPercentages.length;e++)t.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[e],this.windRoseData.directionPercentages[e],this.windRoseData.directionDegrees[e]));return t}drawWindDirection(t,e,i){const n=this.svg.group();if(0===e)return n;const r=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(r[e]=t[e],t[e]>0)for(let i=e-1;i>=0;i--)r[e]+=t[i];const s=e*(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=this.drawSpeedPart(this.svg,i-90,s*(r[t]/100)+this.config.centerRadius,this.speedRanges[t].color);n.add(e)}return n}drawSpeedPart(t,e,i,n){var r=gt.toRadians(e-this.config.leaveArc/2),s=gt.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*i),c=o.y+Math.round(Math.sin(r)*i),h=o.x+Math.round(Math.cos(s)*i),d=o.y+Math.round(Math.sin(s)*i);return t.path(wt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:c,x2:h,y2:d,radius:i})).attr({fill:n,stroke:this.config.roseLinesColor})}drawBackground(){var t=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),e=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=this.svg.group(t,e);const n=this.windRoseData.circleCount,r=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/n;let s=this.config.centerRadius+r;for(let t=1;t<=n;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(s))),s+=r;return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(){const t=this.degreesCalculator.getRoseRenderDegrees();return this.config.cardinalDirectionLetters,this.northText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-t,this.config.roseDirectionLettersColor),this.eastText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-t,this.config.roseDirectionLettersColor),this.southText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-t,this.config.roseDirectionLettersColor),this.westText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-t,this.config.roseDirectionLettersColor),this.svg.group(this.northText,this.eastText,this.southText,this.westText)}drawCircleLegend(){const t=this.svg.group(),e=this.dimensionCalculator.roseCenter(),i=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.circleCount,n=Math.cos(gt.toRadians(45))*this.config.centerRadius,r=Math.cos(gt.toRadians(45))*i;for(let i=1;i<=this.windRoseData.circleCount;i++){const s=n+r*i+e.x,o=n+r*i+e.y,a=this.svgUtil.drawText(new bt(s,o),this.windRoseData.percentagePerCircle*i+"%",yt.roseLegendAttribute(this.config.rosePercentagesColor));t.add(a)}return t}drawCenterZeroSpeed(){const t=this.dimensionCalculator.roseCenter(),e=this.svgUtil.drawCircle(new _t(t,this.config.centerRadius));e.attr({fill:this.speedRanges[0].color});let i=this.config.roseCenterPercentageColor;"auto"===this.config.roseCenterPercentageColor&&(i=At.getTextColorBasedOnBackground(this.speedRanges[0].color));const n=this.svgUtil.drawText(t,Math.round(this.windRoseData.speedRangePercentages[0])+"%",yt.windBarAttribute(i,40,"middle","middle"));return this.svg.group(e,n)}}class jt extends $t{calculate(t){for(let e=0;e<t.directionTotals.length;e++){t.directionSpeedRangeCounts[e][0]=0;const i=t.directionSpeedRangeCounts[e].reduce(((t,e)=>t+e),0);t.directionTotals[e]=i}return super.calculate(t)}}class Vt{constructor(t,e){this.barCount=t,this.barLocation=e,this.roseRadius=500,this.marginLeft=80,this.marginRight=80,this.marginTop=80,this.marginBottom=100,this.directionLetterMargin=45,this.barBottom={barLength:2*this.roseRadius,barHeight:40,barMarginLeft:this.marginLeft,barMarginBottom:40,multiBarSpacing:90},this.barRight={barWidth:90,barHeight:2*this.roseRadius,barMarginLeft:20,barMarginRight:80,multiBarSpacing:100}}}class zt{constructor(t,e,i){this.indicator=void 0,this.config=t,this.dimensionCalculator=new Rt(e),this.svg=i,this.svgUtil=new Ct(i),this.cfg=this.dimensionCalculator.cfg,this.roseCenter=this.dimensionCalculator.roseCenter()}drawCurrentWindDirection(t,e){if(void 0===this.indicator||e){this.dimensionCalculator.roseCenter();const t=this.roseCenter.x+this.cfg.roseRadius-20,e=this.roseCenter.y;this.indicator=this.svgUtil.drawArrow(t,e,40),this.indicator.attr({stroke:this.config.roseCurrentDirectionArrowColor,fill:this.config.roseCurrentDirectionArrowColor})}if(!isNaN(+t)){var i="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;ct.debug("Animate",t,i),this.indicator.animate({transform:i},700,mina.easeinout)}}}class qt{static setLevel(t){switch(t){case"NONE":this.level=0;break;case"ERROR":this.level=1;break;case"WARN":this.level=2;break;case"INFO":this.level=3;break;case"DEBUG":this.level=4;break;case"TRACE":this.level=5;break;default:this.level=0,console.log("WR ERROR Unkonwn log level set: ",t," default to WARN")}this.level>2&&console.log("WR LOG level set to:",t)}static checkLogLevel(t){if(void 0===t)return"WARN";if("NONE"===t||"ERROR"===t||"WARN"===t||"INFO"===t||"DEBUG"===t||"TRACE"===t)return t;throw new Error("Unkonwn log level configurated: "+t)}constructor(t){this.prefix=t}error(t,...e){qt.level>=1&&this.log("ERROR",t,e)}warn(t,...e){qt.level>=2&&this.log("WARN",t,e)}info(t,...e){qt.level>=3&&this.log("INFO",t,e)}debug(t,...e){qt.level>=4&&this.log("DEBUG",t,e)}trace(t,...e){5===qt.level&&this.log("TRACE",t,e)}log(t,e,...i){0===i[0].length?console.log("WR "+t+" "+this.prefix+": "+e):console.log("WR "+t+" "+this.prefix+": "+e,i[0])}}qt.level=0;class Gt{constructor(t,e){this.northOfffset=t,this.autoRotate=e,this.log=new qt("DegreesCalculator"),this.compassDegrees=0,this.windDirectionDegrees=0,this.roseRenderDegrees=0,this.windDirectionRenderDegrees=0,this.log.debug("constructor"),this.updateRenderDegrees()}updateRenderDegrees(){this.autoRotate?(this.roseRenderDegrees=+this.northOfffset+this.compassDegrees,this.windDirectionRenderDegrees=-90+this.northOfffset+this.compassDegrees+this.windDirectionDegrees):(this.roseRenderDegrees=this.northOfffset,this.windDirectionRenderDegrees=-90+this.northOfffset+this.windDirectionDegrees),this.log.debug("updateRenderDegrees: Degrees sensor: ",this.windDirectionDegrees,this.compassDegrees),this.log.debug("updateRenderDegrees: Degrees for rendering: ",this.roseRenderDegrees,this.windDirectionRenderDegrees)}getWindDirectionRenderDegrees(){return this.windDirectionRenderDegrees}getRoseRenderDegrees(){return this.roseRenderDegrees}setWindDirectionDegrees(t){this.log.debug("setWindDirectionDegrees: Set windsensor degrees: "+t),this.windDirectionDegrees=t,this.updateRenderDegrees()}setCompassDegrees(t){this.compassDegrees=t,this.updateRenderDegrees()}}class Xt{constructor(t){this.log=new qt("WindRoseDirigent"),this.windBarRenderers=[],this.windRoseData=[],this.initReady=!1,this.measurementsReady=!1,this.svg=t}init(t,e,i){this.log.debug("init()"),this.initReady=!0,this.measurementsReady=!1,this.cardConfig=t,this.measurementProvider=e,this.entityStatesProcessor=i,this.configFactory=new Lt(t);const n=this.configFactory.createWindRoseConfig();if(this.windSpeedConverter=new Mt(t.outputSpeedUnit,t.speedRangeBeaufort,t.speedRangeStep,t.speedRangeMax,t.speedRanges),this.measurementCounter=new Ht(n,this.windSpeedConverter),this.dimensionConfig=new Vt(t.windBarCount(),t.windspeedBarLocation),this.degreesCalculator=new Gt(t.windRoseDrawNorthOffset,t.compassConfig.autoRotate),this.cardConfig.centerCalmPercentage?(this.percentageCalculator=new jt,this.windRoseRenderer=new It(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges(),this.svg,this.degreesCalculator)):(this.percentageCalculator=new $t,this.windRoseRenderer=new St(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges(),this.svg,this.degreesCalculator)),this.currentDirectionRenderer=new zt(n,this.dimensionConfig,this.svg),this.windBarRenderers=[],!t.hideWindspeedBar){const e=this.configFactory.createWindBarConfigs();for(let i=0;i<t.windBarCount();i++)this.windBarRenderers.push(new Et(e[i],this.dimensionConfig,this.windSpeedConverter.getOutputSpeedUnit(),i,this.svg))}this.windRoseData=[]}refreshData(){return this.initReady?(this.log.debug("refreshData()"),this.measurementProvider.getMeasurements().then((t=>{this.windRoseData=[],this.log.debug("Matched measurements:",t);for(let e=0;e<t.length;e++){this.measurementCounter.init(this.cardConfig.windspeedEntities[e].speedUnit);for(const i of t[e])this.measurementCounter.addWindMeasurements(i.direction,i.speed);const i=this.measurementCounter.getMeasurementCounts();this.windRoseData.push(this.percentageCalculator.calculate(i))}return this.measurementsReady=!0,Promise.resolve(!0)}))):(this.log.debug("refreshData() ignored, not inited yet"),Promise.resolve(!1))}render(){if(this.svg.clear(),this.initReady&&this.measurementsReady){this.log.debug("render()",this.svg,this.windRoseData,this.windBarRenderers),this.windRoseRenderer.drawWindRose(this.windRoseData[0]);for(let t=0;t<this.windBarRenderers.length;t++)this.windBarRenderers[t].drawWindBar(this.windRoseData[t]);this.cardConfig.showCurrentDirectionArrow&&this.currentDirectionRenderer.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!0)}else this.log.error("render(): Could not render, init or measurementsn not ready "+this.initReady+" - "+this.measurementsReady)}updateRender(){this.entityStatesProcessor.hasWindDirectionUpdate()&&(this.degreesCalculator.setWindDirectionDegrees(this.entityStatesProcessor.getWindDirection()),this.currentDirectionRenderer.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!1)),this.entityStatesProcessor.hasCompassDirectionUpdate()&&(this.degreesCalculator.setCompassDegrees(this.entityStatesProcessor.getCompassDirection()),this.currentDirectionRenderer.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!1),this.windRoseRenderer.rotateWindRose())}}class Yt{constructor(t,e){this.direction=t,this.speed=e}}class Zt{constructor(t){if(this.matchingStrategy=t,ct.debug("Matching init:",t),"direction-first"!==this.matchingStrategy&&"speed-first"!==this.matchingStrategy)throw Error("Unkown matchfing strategy: "+this.matchingStrategy)}matchStatsHistory(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findHistoryInPeriod(n,e);t?this.isInvalidSpeed(t.s)?ct.warn("Speed "+t.s+" at timestamp "+n.start+" is not a number."):i.push(new Yt(n.mean,+t.s)):ct.trace("No matching speed found for direction "+n.mean+" at timestamp "+n.start)}else for(const n of e){const e=this.findStatsAtTime(1e3*n.lu,t);e?(i.push(new Yt(e.mean,+n.s)),""===n.s||null===n.s||isNaN(+n.s)?ct.warn("Speed "+n.s+" at timestamp "+e.start+" is not a number."):i.push(new Yt(e.mean,+n.s))):ct.trace("No matching direction found for speed "+n.s+" at timestamp "+n.lu)}return i}matchHistoryStats(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findStatsAtTime(1e3*n.lu,e);t?i.push(new Yt(n.s,t.mean)):ct.trace("No matching speed found for direction "+n.s+" at timestamp "+n.lu)}else for(const n of e){const e=this.findHistoryInPeriod(n,t);e?""===e.s||null===e.s||isNaN(+e.s)?ct.warn("Direction "+e.s+" at timestamp "+e.lu+" is not a number."):i.push(new Yt(e.s,n.mean)):ct.trace("No matching direction found for speed "+n.start+" at timestamp "+n.mean)}return i}matchHistoryHistory(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findHistoryBackAtTime(n.lu,e);t?this.isInvalidSpeed(t.s)?ct.warn("Speed "+t.s+" at timestamp "+t.lu+" is not a number."):i.push(new Yt(n.s,+t.s)):ct.trace("No matching speed found for direction "+n.s+" at timestamp "+n.lu)}else for(const n of e)if(this.isValidSpeed(n.s)){const e=this.findHistoryBackAtTime(n.lu,t);e?""===e.s||null===e.s||isNaN(+e.s)?ct.warn("Speed "+n.s+" at timestamp "+n.lu+" is not a number."):i.push(new Yt(e.s,+n.s)):ct.trace("No matching direction found for speed "+n.s+" at timestamp "+n.lu)}return i}matchStatsStats(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findMatchingStatistic(n,e);t?i.push(new Yt(n.mean,t.mean)):ct.trace(`No matching speed found for direction ${n.mean} at timestamp start:${n.start} end:${n.end}`)}else for(const n of e){const e=this.findMatchingStatistic(n,t);e?i.push(new Yt(e.mean,n.mean)):ct.trace(`No matching direction found for speed ${n.mean} at timestamp start:${n.start} end:${n.end}`)}return i}findStatsAtTime(t,e){return e.find((e=>e.start<=t&&t<=e.end))}findHistoryInPeriod(t,e){const i=t.start/1e3,n=t.end/1e3,r=e.filter((t=>i<t.lu&&n>=t.lu));return 1==r.length?r[0]:r.length>1?(r.sort(((t,e)=>e.lu-t.lu)),r[Math.trunc(r.length/2)]):void 0}findMatchingStatistic(t,e){return e.find((e=>t.start===e.start&&t.end===e.end))}findHistoryBackAtTime(t,e){let i;for(const n of e){if(!(n.lu<=t))break;i=n}return i}isInvalidSpeed(t){return""===t||null==t||isNaN(+t)}isValidSpeed(t){return""!==t&&null!=t&&!isNaN(+t)}}class Qt{constructor(t){this.waitingForMeasurements=!1,this.cardConfig=t,this.rawEntities=t.createRawEntitiesArray(),this.statsEntities=t.createStatisticsEntitiesArray(),this.measurementMatcher=new Zt(this.cardConfig.matchingStrategy)}setHass(t){this.hass=t}getMeasurements(){return ct.debug("getMeasurements()"),void 0===this.hass?(ct.error("Cant read measurements, HASS not set."),Promise.resolve([])):this.waitingForMeasurements?(ct.error("Measurements already requested, waiting"),Promise.resolve([])):(this.waitingForMeasurements=!0,Promise.all([this.getHistory(),this.getStatistics()]).then((t=>{this.checkLoadedData(t),this.waitingForMeasurements=!1,ct.debug("Measurements loaded:",t);const e=[];if(this.cardConfig.windDirectionEntity.useStatistics){const i=t[1][this.cardConfig.windDirectionEntity.entity];for(let n of this.cardConfig.windspeedEntities)if(n.useStatistics){const r=t[1][n.entity],s=this.measurementMatcher.matchStatsStats(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}else{const r=t[0][n.entity],s=this.measurementMatcher.matchStatsHistory(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}}else{const i=t[0][this.cardConfig.windDirectionEntity.entity];for(let n of this.cardConfig.windspeedEntities)if(n.useStatistics){const r=t[1][n.entity],s=this.measurementMatcher.matchHistoryStats(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}else{const r=t[0][n.entity],s=this.measurementMatcher.matchHistoryHistory(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}}return Promise.resolve(e)})))}checkLoadedData(t){const e=this.cardConfig.windDirectionEntity.entity;if(void 0===t[0][e]&&void 0===t[1][e])throw new Error(`Entity ${e} did not return data, is this the correct entity name?`);for(const e of this.cardConfig.windspeedEntities)if(void 0===t[0][e.entity]&&void 0===t[1][e.entity])throw new Error(`Entity ${e.entity} did not return data, is this the correct entity name?`)}logMatchingStats(t,e,i,n){ct.info(`Loaded measurements: directions: ${e}, speeds: ${i}, entity: ${t}`),"direction-first"===this.cardConfig.matchingStrategy?n<e?ct.warn(`Matching results entity ${t}, ${e-n} not matched of total ${e} direction measurements`):ct.info(`Matched measurements, direction-first: ${n}`):n<i?ct.warn(`Matching results entity ${t}, ${i-n}  not matched of total ${i} speed measurements`):ct.info(`Matched measurements, speed-first: ${n}`)}getHistory(){if(0===this.rawEntities.length)return Promise.resolve({});const t={type:"history/history_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),end_time:new Date,minimal_response:!0,no_attributes:!0,entity_ids:this.rawEntities};return this.hass.callWS(t)}getStatistics(){if(0===this.statsEntities.length)return Promise.resolve({});const t={type:"recorder/statistics_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),period:"5minute",statistic_ids:this.statsEntities,types:["mean"]};return this.hass.callWS(t)}calculateStartTime(t){const e=new Date;if(t.hourstoShow)e.setHours(e.getHours()-t.hourstoShow);else{if(!(t.fromHourOfDay&&t.fromHourOfDay>0||0===t.fromHourOfDay))throw new Error("No data period config option available.");e.getHours()<t.fromHourOfDay&&e.setDate(e.getDate()-1),e.setHours(t.fromHourOfDay,0,0,0)}return ct.info("Using start time for data query",e),e}}class Kt{checkEntities(t,e){this.checkEntity(t.windDirectionEntity.entity,e);for(const i of t.windspeedEntities)this.checkEntity(i.entity,e),"auto"===i.speedUnit&&void 0!==e.states[i.entity].attributes.unit_of_measurement&&(i.speedUnit=e.states[i.entity].attributes.unit_of_measurement);t.compassConfig&&t.compassConfig.autoRotate&&t.compassConfig.entity&&this.checkEntity(t.compassConfig.entity,e)}checkEntity(t,e){if(void 0===e.states[t])throw new Error(`Entity ${t} not found.`)}}class Jt{constructor(){this.initReady=!1,this.windDirectionUpdated=!1,this.compassDirectionUpdated=!1}init(t){this.cardConfig=t,this.windDirectionConverter=new Ft(new Lt(t).createWindRoseConfig()),this.initReady=!0}updateHass(t){if(this.initReady){if(this.cardConfig.showCurrentDirectionArrow){const e=t.states[this.cardConfig.windDirectionEntity.entity].state;void 0!==e&&this.windDirectionState!==e&&(this.windDirectionUpdated=!0,this.windDirectionState=e)}if(this.cardConfig.compassConfig.autoRotate){const e=t.states[this.cardConfig.compassConfig.entity].state;void 0!==e&&this.compassDirectionState!==e&&(this.compassDirectionUpdated=!0,this.compassDirectionState=e)}}}hasUpdates(){return this.windDirectionUpdated||this.compassDirectionUpdated}hasWindDirectionUpdate(){return this.windDirectionUpdated}getWindDirection(){if(void 0===this.windDirectionState)throw new Error("Current wind direction is undefined.");const t=this.windDirectionConverter.convertDirection(this.windDirectionState);if(void 0===t)throw new Error("Current converted wind direction is undefined.");return this.windDirectionUpdated=!1,+t}hasCompassDirectionUpdate(){return this.compassDirectionUpdated}getCompassDirection(){if(void 0===this.compassDirectionState)throw new Error("Current compass direction is undefined.");return this.compassDirectionUpdated=!1,+this.compassDirectionState}}window.customCards=window.customCards||[],window.customCards.push({type:"windrose-card",name:"Windrose Card",description:"A card to show wind speed and direction in a windrose."}),console.info("%c  WINROSE-CARD  %c Version 1.6.0 ","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray");let te=class extends et{static getStubConfig(){return ft.exampleConfig()}constructor(){super(),this.log=new qt("WindRoseCard"),this.refreshCardConfigOnHass=!1,this.svg=wt("100%","100%"),this.windRoseDirigent=new Xt(this.svg),this.entityStateProcessor=new Jt,this.entityChecker=new Kt}setConfig(t){this.config=t,this.cardConfig=new ft(t),ct.setLevel(this.cardConfig.logLevel),qt.setLevel(this.cardConfig.logLevel),this.log.debug("setConfig(): ",t,this._hass),this._hass?this.refreshCardConfig():this.refreshCardConfigOnHass=!0}set hass(t){this.refreshCardConfigOnHass&&(ct.debug("hass(), refreshCardConfigOnHass"),this.refreshCardConfigOnHass=!1,this._hass=t,this.refreshCardConfig()),this._hass=t,this.entityStateProcessor.updateHass(t),this.entityStateProcessor.hasUpdates()&&this.windRoseDirigent.updateRender()}refreshCardConfig(){this.log.debug("refreshCardConfig()"),this.entityChecker.checkEntities(this.cardConfig,this._hass),this.measurementProvider=new Qt(this.cardConfig),this.measurementProvider.setHass(this._hass),this.windRoseDirigent.init(this.cardConfig,this.measurementProvider,this.entityStateProcessor),this.entityStateProcessor.init(this.cardConfig),this.refreshMeasurements()}render(){var t;return super.render(),this.log.debug("card render()"),L`
            <ha-card header="${null===(t=this.cardConfig)||void 0===t?void 0:t.title}">
                <div class="card-content" id="svg-container">
                </div>
            </ha-card>
        `}firstUpdated(){this.log.debug("firstUpdated()"),this.log.debug("SVG container found: ",this.svgContainer,this.measurementProvider),this.svgContainer.appendChild(this.svg.node)}update(t){this.log.debug("update()"),super.update(t),this.windRoseDirigent.render()}initInterval(){this.log.debug("initInterval()"),this.cardConfig&&void 0===this.updateInterval&&(this.updateInterval=setInterval((()=>this.refreshMeasurements()),1e3*this.cardConfig.refreshInterval),this.log.info("Interval running with "+this.cardConfig.refreshInterval+" seconds."))}static get styles(){return o`
          :host {
            display: block;
          }
          canvas {
            background-color: var(--ha-card-background);
            max-height: var(--chart-max-height);
          }`}connectedCallback(){super.connectedCallback(),this.log.debug("connectedCallBack()"),this.initInterval()}disconnectedCallback(){super.disconnectedCallback(),this.log.debug("disconnectedCallback()"),clearInterval(this.updateInterval)}getCardSize(){return this.log.debug("getCardSize()"),9}refreshMeasurements(){this.windRoseDirigent.refreshData().then((t=>{this.log.debug("refreshData() ready, requesting update."),t&&this.requestUpdate()}))}};t([nt("#svg-container")],te.prototype,"svgContainer",void 0),t([nt(".card-content")],te.prototype,"parentDiv",void 0),te=t([(t=>e=>"function"==typeof e?((t,e)=>(customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:i,elements:n}=e;return{kind:i,elements:n,finisher(e){customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */)("windrose-card")],te);export{ct as Log,te as WindRoseCard};
