function t(t,e,n,i){var r,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,n,o):r(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const e=window,n=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),r=new WeakMap;class s{constructor(t,e,n){if(this._$cssResult$=!0,n!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(n&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=r.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&r.set(e,t))}return t}toString(){return this.cssText}}const o=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[i+1]),t[0]);return new s(n,t,i)},a=n?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new s("string"==typeof t?t:t+"",void 0,i))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var c;const h=window,d=h.trustedTypes,l=d?d.emptyScript:"",u=h.reactiveElementPolyfillSupport,f={toAttribute(t,e){switch(e){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},p=(t,e)=>e!==t&&(e==e||t==t),m={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:p};class v extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const i=this._$Ep(n,e);void 0!==i&&(this._$Ev.set(i,n),t.push(i))})),t}static createProperty(t,e=m){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,i=this.getPropertyDescriptor(t,n,e);void 0!==i&&Object.defineProperty(this.prototype,t,i)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(i){const r=this[t];this[e]=i,this.requestUpdate(t,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||m}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(a(t))}else void 0!==t&&e.push(a(t));return e}static _$Ep(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}u(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const i=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,i)=>{n?t.adoptedStyleSheets=i.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):i.forEach((n=>{const i=document.createElement("style"),r=e.litNonce;void 0!==r&&i.setAttribute("nonce",r),i.textContent=n.cssText,t.appendChild(i)}))})(i,this.constructor.elementStyles),i}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EO(t,e,n=m){var i;const r=this.constructor._$Ep(t,n);if(void 0!==r&&!0===n.reflect){const s=(void 0!==(null===(i=n.converter)||void 0===i?void 0:i.toAttribute)?n.converter:f).toAttribute(e,n.type);this._$El=t,null==s?this.removeAttribute(r):this.setAttribute(r,s),this._$El=null}}_$AK(t,e){var n;const i=this.constructor,r=i._$Ev.get(t);if(void 0!==r&&this._$El!==r){const t=i.getPropertyOptions(r),s="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(n=t.converter)||void 0===n?void 0:n.fromAttribute)?t.converter:f;this._$El=r,this[r]=s.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,n){let i=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||p)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,e)=>this[e]=t)),this._$Ei=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$EO(e,this[e],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var w;v.finalized=!0,v.elementProperties=new Map,v.elementStyles=[],v.shadowRootOptions={mode:"open"},null==u||u({ReactiveElement:v}),(null!==(c=h.reactiveElementVersions)&&void 0!==c?c:h.reactiveElementVersions=[]).push("1.6.1");const y=window,b=y.trustedTypes,x=b?b.createPolicy("lit-html",{createHTML:t=>t}):void 0,C=`lit$${(Math.random()+"").slice(9)}$`,_="?"+C,S=`<${_}>`,R=document,D=(t="")=>R.createComment(t),A=t=>null===t||"object"!=typeof t&&"function"!=typeof t,k=Array.isArray,E=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,B=/-->/g,$=/>/g,N=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),M=/'/g,P=/"/g,L=/^(?:script|style|textarea|title)$/i,T=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),U=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),O=new WeakMap,F=R.createTreeWalker(R,129,null,!1),H=(t,e)=>{const n=t.length-1,i=[];let r,s=2===e?"<svg>":"",o=E;for(let e=0;e<n;e++){const n=t[e];let a,c,h=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===E?"!--"===c[1]?o=B:void 0!==c[1]?o=$:void 0!==c[2]?(L.test(c[2])&&(r=RegExp("</"+c[2],"g")),o=N):void 0!==c[3]&&(o=N):o===N?">"===c[0]?(o=null!=r?r:E,h=-1):void 0===c[1]?h=-2:(h=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?N:'"'===c[3]?P:M):o===P||o===M?o=N:o===B||o===$?o=E:(o=N,r=void 0);const l=o===N&&t[e+1].startsWith("/>")?" ":"";s+=o===E?n+S:h>=0?(i.push(a),n.slice(0,h)+"$lit$"+n.slice(h)+C+l):n+C+(-2===h?(i.push(void 0),e):l)}const a=s+(t[n]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==x?x.createHTML(a):a,i]};class I{constructor({strings:t,_$litType$:e},n){let i;this.parts=[];let r=0,s=0;const o=t.length-1,a=this.parts,[c,h]=H(t,e);if(this.el=I.createElement(c,n),F.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(i=F.nextNode())&&a.length<o;){if(1===i.nodeType){if(i.hasAttributes()){const t=[];for(const e of i.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(C)){const n=h[s++];if(t.push(e),void 0!==n){const t=i.getAttribute(n.toLowerCase()+"$lit$").split(C),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:r,name:e[2],strings:t,ctor:"."===e[1]?G:"?"===e[1]?Y:"@"===e[1]?Z:q})}else a.push({type:6,index:r})}for(const e of t)i.removeAttribute(e)}if(L.test(i.tagName)){const t=i.textContent.split(C),e=t.length-1;if(e>0){i.textContent=b?b.emptyScript:"";for(let n=0;n<e;n++)i.append(t[n],D()),F.nextNode(),a.push({type:2,index:++r});i.append(t[e],D())}}}else if(8===i.nodeType)if(i.data===_)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(C,t+1));)a.push({type:7,index:r}),t+=C.length-1}r++}}static createElement(t,e){const n=R.createElement("template");return n.innerHTML=t,n}}function j(t,e,n=t,i){var r,s,o,a;if(e===U)return e;let c=void 0!==i?null===(r=n._$Co)||void 0===r?void 0:r[i]:n._$Cl;const h=A(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==h&&(null===(s=null==c?void 0:c._$AO)||void 0===s||s.call(c,!1),void 0===h?c=void 0:(c=new h(t),c._$AT(t,n,i)),void 0!==i?(null!==(o=(a=n)._$Co)&&void 0!==o?o:a._$Co=[])[i]=c:n._$Cl=c),void 0!==c&&(e=j(t,c._$AS(t,e.values),c,i)),e}class V{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:n},parts:i}=this._$AD,r=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:R).importNode(n,!0);F.currentNode=r;let s=F.nextNode(),o=0,a=0,c=i[0];for(;void 0!==c;){if(o===c.index){let e;2===c.type?e=new z(s,s.nextSibling,this,t):1===c.type?e=new c.ctor(s,c.name,c.strings,this,t):6===c.type&&(e=new Q(s,this,t)),this.u.push(e),c=i[++a]}o!==(null==c?void 0:c.index)&&(s=F.nextNode(),o++)}return r}p(t){let e=0;for(const n of this.u)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class z{constructor(t,e,n,i){var r;this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=i,this._$Cm=null===(r=null==i?void 0:i.isConnected)||void 0===r||r}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=j(this,t,e),A(t)?t===W||null==t||""===t?(this._$AH!==W&&this._$AR(),this._$AH=W):t!==this._$AH&&t!==U&&this.g(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>k(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==W&&A(this._$AH)?this._$AA.nextSibling.data=t:this.T(R.createTextNode(t)),this._$AH=t}$(t){var e;const{values:n,_$litType$:i}=t,r="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=I.createElement(i.h,this.options)),i);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===r)this._$AH.p(n);else{const t=new V(r,this),e=t.v(this.options);t.p(n),this.T(e),this._$AH=t}}_$AC(t){let e=O.get(t.strings);return void 0===e&&O.set(t.strings,e=new I(t)),e}k(t){k(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,i=0;for(const r of t)i===e.length?e.push(n=new z(this.O(D()),this.O(D()),this,this.options)):n=e[i],n._$AI(r),i++;i<e.length&&(this._$AR(n&&n._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cm=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class q{constructor(t,e,n,i,r){this.type=1,this._$AH=W,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=W}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,i){const r=this.strings;let s=!1;if(void 0===r)t=j(this,t,e,0),s=!A(t)||t!==this._$AH&&t!==U,s&&(this._$AH=t);else{const i=t;let o,a;for(t=r[0],o=0;o<r.length-1;o++)a=j(this,i[n+o],e,o),a===U&&(a=this._$AH[o]),s||(s=!A(a)||a!==this._$AH[o]),a===W?t=W:t!==W&&(t+=(null!=a?a:"")+r[o+1]),this._$AH[o]=a}s&&!i&&this.j(t)}j(t){t===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class G extends q{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===W?void 0:t}}const X=b?b.emptyScript:"";class Y extends q{constructor(){super(...arguments),this.type=4}j(t){t&&t!==W?this.element.setAttribute(this.name,X):this.element.removeAttribute(this.name)}}class Z extends q{constructor(t,e,n,i,r){super(t,e,n,i,r),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=j(this,t,e,0))&&void 0!==n?n:W)===U)return;const i=this._$AH,r=t===W&&i!==W||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==W&&(i===W||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class Q{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){j(this,t)}}const K=y.litHtmlPolyfillSupport;null==K||K(I,z),(null!==(w=y.litHtmlVersions)&&void 0!==w?w:y.litHtmlVersions=[]).push("2.6.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var J,tt;class et extends v{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{var i,r;const s=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:e;let o=s._$litPart$;if(void 0===o){const t=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:null;s._$litPart$=o=new z(e.insertBefore(D(),t),t,void 0,null!=n?n:{})}return o._$AI(t),o})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return U}}et.finalized=!0,et._$litElement$=!0,null===(J=globalThis.litElementHydrateSupport)||void 0===J||J.call(globalThis,{LitElement:et});const nt=globalThis.litElementPolyfillSupport;null==nt||nt({LitElement:et}),(null!==(tt=globalThis.litElementVersions)&&void 0!==tt?tt:globalThis.litElementVersions=[]).push("3.2.2");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function it(t,e){return(({finisher:t,descriptor:e})=>(n,i)=>{var r;if(void 0===i){const i=null!==(r=n.originalKey)&&void 0!==r?r:n.key,s=null!=e?{kind:"method",placement:"prototype",key:i,descriptor:e(n.key)}:{...n,key:i};return null!=t&&(s.finisher=function(e){t(e,i)}),s}{const r=n.constructor;void 0!==e&&Object.defineProperty(n,i,e(i)),null==t||t(r,i)}})({descriptor:n=>{const i={get(){var e,n;return null!==(n=null===(e=this.renderRoot)||void 0===e?void 0:e.querySelector(t))&&void 0!==n?n:null},enumerable:!0,configurable:!0};if(e){const e="symbol"==typeof n?Symbol():"__"+n;i.get=function(){var n,i;return void 0===this[e]&&(this[e]=null!==(i=null===(n=this.renderRoot)||void 0===n?void 0:n.querySelector(t))&&void 0!==i?i:null),this[e]}}return i}})}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var rt;null===(rt=window.HTMLSlotElement)||void 0===rt||rt.prototype.assignedElements;class st{}st.defaultCardinalDirectionLetters="NESW",st.defaultWindspeedBarLocation="bottom",st.defaultHoursToShow=4,st.defaultRefreshInterval=300,st.defaultWindDirectionCount=16,st.defaultWindDirectionUnit="degrees",st.defaultInputSpeedUnit="auto",st.defaultOutputSpeedUnit="mps",st.defaultWindspeedBarFull=!0,st.defaultMatchingStategy="direction-first",st.defaultCenterCalmPercentage=!0,st.defaultSpeedRangeBeaufort=!0;class ot{constructor(t,e,n,i){this.range=t,this.minSpeed=e,this.maxSpeed=n,this.color=i}isRangeMatch(t){return t>=this.minSpeed&&(t<this.maxSpeed||-1===this.maxSpeed)}}class at{constructor(){const t=getComputedStyle(document.documentElement).getPropertyValue("--primary-text-color");this.roseLines="rgb(160, 160, 160)",this.roseDirectionLetters=t,this.roseCenterPercentage="auto",this.rosePercentages=t,this.roseCurrentDirectionArrow="red",this.barBorder="rgb(160, 160, 160)",this.barUnitName=t,this.barName=t,this.barUnitValues=t,this.barPercentages="auto"}}class ct{static setLevel(t){switch(t){case"NONE":this.level=0;break;case"ERROR":this.level=1;break;case"WARN":this.level=2;break;case"INFO":this.level=3;break;case"DEBUG":this.level=4;break;case"TRACE":this.level=5;break;default:this.level=0,this.error("Unkonwn log level set: ",t," default to WARN")}this.level>2&&console.log("WR LOG level set to:",t)}static checkLogLevel(t){if(void 0===t)return"WARN";if("NONE"===t||"ERROR"===t||"WARN"===t||"INFO"===t||"DEBUG"===t||"TRACE"===t)return t;throw new Error("Unkonwn log level configurated: "+t)}static error(t,...e){this.level>=1&&(0===e.length?console.error("WR ERROR "+t):console.error("WR ERROR "+t,e[0]))}static warn(t,...e){this.level>=2&&(0===e.length?console.warn("WR WARN "+t):console.warn("WR WARN "+t,e[0]))}static info(t,...e){this.level>=3&&this.log("INFO "+t,e)}static debug(t,...e){this.level>=4&&this.log("DEBUG "+t,e)}static trace(t,...e){5===this.level&&this.log("TRACE "+t,e)}static log(t,...e){0===e[0].length?console.log("WR "+t):console.log("WR "+t,e[0])}}ct.level=0;class ht{constructor(t,e,n,i,r){this.entity=t,this.name=e,this.useStatistics=n,this.renderRelativeScale=i,this.speedUnit=r}}class dt{constructor(t,e,n,i,r){this.entity=t,this.useStatistics=e,this.directionUnit=n,this.directionCompensation=i,this.directionLetters=r}}class lt{constructor(t,e){this.hourstoShow=t,this.fromHourOfDay=e}}class ut{static exampleConfig(){return{title:"Wind direction",data_period:{hours_to_show:st.defaultHoursToShow},refresh_interval:st.defaultRefreshInterval,windspeed_bar_location:st.defaultWindspeedBarLocation,windspeed_bar_full:st.defaultWindspeedBarFull,wind_direction_entity:{entity:"",direction_unit:st.defaultWindDirectionUnit,use_statistics:!1,direction_compensation:0},windspeed_entities:[{entity:"",name:"",speed_unit:st.defaultInputSpeedUnit,use_statistics:!1}],output_speed_unit:st.defaultOutputSpeedUnit,speed_range_beaufort:st.defaultSpeedRangeBeaufort,speed_range_step:void 0,speed_range_max:void 0,speed_ranges:void 0,windrose_draw_north_offset:0,show_current_direction_arrow:!0,cardinal_direction_letters:st.defaultCardinalDirectionLetters,matching_strategy:st.defaultMatchingStategy,center_calm_percentage:st.defaultCenterCalmPercentage,log_level:st.defaultLogLevel}}constructor(t){this.cardConfig=t,this.speedRanges=[],this.title=this.cardConfig.title,this.dataPeriod=this.checkDataPeriod(t.hours_to_show,t.data_period),this.refreshInterval=this.checkRefreshInterval(),this.windDirectionEntity=this.checkWindDirectionEntity(),this.windspeedEntities=this.checkWindspeedEntities(),this.windRoseDrawNorthOffset=this.checkwindRoseDrawNorthOffset(),this.showCurrentDirectionArrow=this.checkBooleanDefaultFalse(t.show_current_direction_arrow),this.windspeedBarLocation=this.checkWindspeedBarLocation(),this.windspeedBarFull=this.checkBooleanDefaultTrue(t.windspeed_bar_full),this.hideWindspeedBar=this.checkBooleanDefaultFalse(t.hide_windspeed_bar),this.centerCalmPercentage=this.checkBooleanDefaultTrue(t.center_calm_percentage),this.cardinalDirectionLetters=this.checkCardinalDirectionLetters(),this.windDirectionCount=this.checkWindDirectionCount(),this.outputSpeedUnit=this.checkOutputSpeedUnit(),this.outputSpeedUnitLabel=this.checkOutputSpeedUnitLabel(),this.speedRangeBeaufort=this.checkBooleanDefaultTrue(t.speed_range_beaufort),this.speedRangeStep=this.checkSpeedRangeStep(),this.speedRangeMax=this.checkSpeedRangeMax(),this.speedRanges=this.checkSpeedRanges(),this.checkSpeedRangeCombi(),this.matchingStrategy=this.checkMatchingStrategy(),this.filterEntitiesQueryParameter=this.createEntitiesQueryParameter(),this.cardColor=this.checkCardColors(),this.logLevel=ct.checkLogLevel(this.cardConfig.log_level),ct.info("Config check OK")}windBarCount(){return this.hideWindspeedBar?0:this.windspeedEntities.length}checkDataPeriod(t,e){const n=this.checkHoursToShow(t),i=this.checkHoursToShow(null==e?void 0:e.hours_to_show),r=this.checkFromHourOfDay(null==e?void 0:e.from_hour_of_day);if(n)return ct.warn("WindRoseCard: hours_to_show config is deprecated, use the data_period object."),new lt(t,void 0);if(i&&r)throw new Error("WindRoseCard: Only one is allowed: hours_to_show or from_hour_of_day");if(!i&&!r)throw new Error("WindRoseCard: One config option object data_period should be filled.");return new lt(e.hours_to_show,e.from_hour_of_day)}checkHoursToShow(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number above 0.");return!!t}checkFromHourOfDay(t){if(t&&(isNaN(t)||t<0||t>23))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number between 0 and 23, hour of the day..");return null!=t&&t>=0}checkRefreshInterval(){if(this.cardConfig.refresh_interval&&isNaN(this.cardConfig.refresh_interval))throw new Error("WindRoseCard: Invalid refresh_interval, should be a number in seconds.");return this.cardConfig.refresh_interval?this.cardConfig.refresh_interval:st.defaultRefreshInterval}checkWindDirectionEntity(){if(this.cardConfig.wind_direction_entity){const t=this.cardConfig.wind_direction_entity;if(void 0===t.entity)throw new Error("WindRoseCard: No wind_direction_entity.entity configured.");const e=t.entity,n=this.checkBooleanDefaultFalse(t.use_statistics),i=this.checkWindDirectionUnit(t.direction_unit),r=this.checkDirectionCompensation(t.direction_compensation),s=this.checkDirectionLetters(i,t.direction_letters);return new dt(e,n,i,r,s)}throw new Error("WindRoseCard: No wind_direction_entity configured.")}checkWindDirectionUnit(t){if(t){if("degrees"!==t&&"letters"!==t)throw new Error("Invalid wind direction unit configured: "+t+". Valid options: degrees, letters");return t}return st.defaultWindDirectionUnit}checkWindspeedEntities(){if(!this.cardConfig.windspeed_entities||0==this.cardConfig.windspeed_entities.length)throw new Error("WindRoseCard: No wind_speed_entities configured, minimal 1 needed.");const t=[];for(const e of this.cardConfig.windspeed_entities){const n=e.entity,i=e.name,r=this.checkBooleanDefaultFalse(e.use_statistics),s=this.checkInputSpeedUnit(e.speed_unit),o=this.checkBooleanDefaultTrue(e.render_relative_scale);t.push(new ht(n,i,r,o,s))}return t}checkInputSpeedUnit(t){if(t){if("mps"!==t&&"bft"!==t&&"kph"!==t&&"mph"!==t&&"fps"!==t&&"knots"!==t&&"auto"!==t)throw new Error("Invalid windspeed unit configured: "+t+". Valid options: mps, bft, fps, kph, mph, knots, auto");return t}return st.defaultInputSpeedUnit}checkDirectionCompensation(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid direction compensation, should be a number in degress between 0 and 360.");return t||0}checkDirectionLetters(t,e){if(e){if("letters"===t){if(e&&5===e.length)return e.toUpperCase();throw new Error("WindRoseCard: direction_letters config should be 5 letters.")}throw new Error("WindRoseCard: config direction_letters should only be use in combination with direction_unit letters.")}}checkwindRoseDrawNorthOffset(){if(this.cardConfig.windrose_draw_north_offset&&isNaN(this.cardConfig.windrose_draw_north_offset))throw new Error("WindRoseCard: Invalid render direction offset, should be a number in degress between 0 and 360.");return this.cardConfig.windrose_draw_north_offset?this.cardConfig.windrose_draw_north_offset:0}checkWindspeedBarLocation(){if(this.cardConfig.windspeed_bar_location){if("bottom"!==this.cardConfig.windspeed_bar_location&&"right"!==this.cardConfig.windspeed_bar_location)throw new Error("Invalid windspeed bar location "+this.cardConfig.windspeed_bar_location+". Valid options: bottom, right");return this.cardConfig.windspeed_bar_location}return st.defaultWindspeedBarLocation}checkBooleanDefaultFalse(t){return null!=t&&t}checkBooleanDefaultTrue(t){return null==t||t}checkCardinalDirectionLetters(){if(this.cardConfig.cardinal_direction_letters){if(4!==this.cardConfig.cardinal_direction_letters.length)throw new Error("Cardinal direction letters option should contain 4 letters.");return this.cardConfig.cardinal_direction_letters}return st.defaultCardinalDirectionLetters}checkWindDirectionCount(){if(this.cardConfig.wind_direction_count){if(isNaN(this.cardConfig.wind_direction_count)||this.cardConfig.wind_direction_count<4||this.cardConfig.wind_direction_count>32)throw new Error("Wind direction count can a number between 4 and 32");return this.cardConfig.wind_direction_count}return st.defaultWindDirectionCount}checkOutputSpeedUnit(){if(this.cardConfig.output_speed_unit){if("mps"!==this.cardConfig.output_speed_unit&&"kph"!==this.cardConfig.output_speed_unit&&"mph"!==this.cardConfig.output_speed_unit&&"fps"!==this.cardConfig.output_speed_unit&&"knots"!==this.cardConfig.output_speed_unit)throw new Error("Invalid output windspeed unit configured: "+this.cardConfig.output_speed_unit+". Valid options: mps, fps, kph, mph, knots");return this.cardConfig.output_speed_unit}return st.defaultOutputSpeedUnit}checkOutputSpeedUnitLabel(){if(this.cardConfig.output_speed_unit_label)return this.cardConfig.output_speed_unit_label}checkSpeedRangeStep(){if(this.cardConfig.speed_range_step&&isNaN(this.cardConfig.speed_range_step))throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step<=0)throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step)return this.cardConfig.speed_range_step}checkSpeedRangeMax(){if(this.cardConfig.speed_range_max&&isNaN(this.cardConfig.speed_range_max))throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max<=0)throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max)return this.cardConfig.speed_range_max}checkSpeedRanges(){const t=[];if(this.cardConfig.speed_ranges&&this.cardConfig.speed_ranges.length>0){const e=this.cardConfig.speed_ranges.slice();e.sort(((t,e)=>t.from_value-e.from_value));const n=e.length-1;for(let i=0;i<n;i++)t.push(new ot(i,e[i].from_value,e[i+1].from_value,e[i].color));t.push(new ot(n,e[n].from_value,-1,e[n].color))}return t}checkSpeedRangeCombi(){if("bft"===this.outputSpeedUnit&&(this.speedRangeStep||this.speedRangeMax))throw new Error("WindRoseCard: speed_range_step and/or speed_range_max should not be set when using output speed unit Beaufort (bft). Beaufort uses fixed speed ranges.");if(this.speedRangeStep&&!this.speedRangeMax||!this.speedRangeStep&&this.speedRangeMax)throw new Error("WindRoseCard: speed_range_step and speed_range_max should both be set.")}checkMatchingStrategy(){if(this.cardConfig.matching_strategy){if("direction-first"!==this.cardConfig.matching_strategy&&"speed-first"!==this.cardConfig.matching_strategy)throw new Error("Invalid matching stategy "+this.cardConfig.matching_strategy+". Valid options: direction-first, speed-first");return this.cardConfig.matching_strategy}return st.defaultMatchingStategy}createEntitiesQueryParameter(){return this.windDirectionEntity+","+this.windspeedEntities.map((t=>t.entity)).join(",")}createRawEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics||t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>!t.useStatistics)).map((t=>t.entity)))}createStatisticsEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics&&t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>t.useStatistics)).map((t=>t.entity)))}checkCardColors(){const t=new at;return this.cardConfig.colors&&(this.cardConfig.colors.rose_direction_letters&&(t.roseDirectionLetters=this.cardConfig.colors.rose_direction_letters),this.cardConfig.colors.rose_lines&&(t.roseLines=this.cardConfig.colors.rose_lines),this.cardConfig.colors.rose_percentages&&(t.rosePercentages=this.cardConfig.colors.rose_percentages),this.cardConfig.colors.rose_center_percentage&&(t.roseCenterPercentage=this.cardConfig.colors.rose_center_percentage),this.cardConfig.colors.rose_current_direction_arrow&&(t.roseCurrentDirectionArrow=this.cardConfig.colors.rose_current_direction_arrow),this.cardConfig.colors.bar_border&&(t.barBorder=this.cardConfig.colors.bar_border),this.cardConfig.colors.bar_name&&(t.barName=this.cardConfig.colors.bar_name),this.cardConfig.colors.bar_percentages&&(t.barPercentages=this.cardConfig.colors.bar_percentages),this.cardConfig.colors.bar_unit_name&&(t.barUnitName=this.cardConfig.colors.bar_unit_name),this.cardConfig.colors.bar_unit_values&&(t.barUnitValues=this.cardConfig.colors.bar_unit_values)),t}}class ft{static toRadians(t){return t*(Math.PI/180)}}var gt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function pt(t,e){return t(e={exports:{}},e.exports),e.exports}var mt=pt((function(t){!function(e){var n,i,r="0.5.4",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,c=function(t,e){return t-e},h={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},l=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=Object.prototype.toString,f=String,g=Array.isArray||function(t){return t instanceof Array||"[object Array]"==u.call(t)},p=function(t,e){var r,s=i,o=Array.prototype.slice.call(arguments,2),a=p.listeners(t),h=0,u=[],f={},g=[],m=n;g.firstDefined=d,g.lastDefined=l,n=t,i=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(u.push(a[v].zIndex),a[v].zIndex<0&&(f[a[v].zIndex]=a[v]));for(u.sort(c);u[h]<0;)if(r=f[u[h++]],g.push(r.apply(e,o)),i)return i=s,g;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==u[h]){if(g.push(r.apply(e,o)),i)break;do{if((r=f[u[++h]])&&g.push(r.apply(e,o)),i)break}while(r)}else f[r.zIndex]=r;else if(g.push(r.apply(e,o)),i)break;return i=s,n=m,g};p._events=h,p.listeners=function(t){var e,n,i,r,s,a,c,d,l=g(t)?t:t.split(o),u=h,f=[u],p=[];for(r=0,s=l.length;r<s;r++){for(d=[],a=0,c=f.length;a<c;a++)for(n=[(u=f[a].n)[l[r]],u["*"]],i=2;i--;)(e=n[i])&&(d.push(e),p=p.concat(e.f||[]));f=d}return p},p.separator=function(t){t?(t="["+(t=f(t).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",o=new RegExp(t)):o=/[\.\/]/},p.on=function(t,e){if("function"!=typeof e)return function(){};for(var n=g(t)?g(t[0])?t:[t]:f(t).split(a),i=0,r=n.length;i<r;i++)!function(t){for(var n,i=g(t)?t:f(t).split(o),r=h,s=0,a=i.length;s<a;s++)r=(r=r.n).hasOwnProperty(i[s])&&r[i[s]]||(r[i[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){n=!0;break}!n&&r.f.push(e)}(n[i]);return function(t){+t==+t&&(e.zIndex=+t)}},p.f=function(t){var e=[].slice.call(arguments,1);return function(){p.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},p.stop=function(){i=1},p.nt=function(t){var e=g(n)?n.join("."):n;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},p.nts=function(){return g(n)?n:n.split(o)},p.off=p.unbind=function(t,e){if(t){var n=g(t)?g(t[0])?t:[t]:f(t).split(a);if(n.length>1)for(var i=0,r=n.length;i<r;i++)p.off(n[i],e);else{n=g(t)?t:f(t).split(o);var c,d,l,u,m,v=[h],w=[];for(i=0,r=n.length;i<r;i++)for(u=0;u<v.length;u+=l.length-2){if(l=[u,1],c=v[u].n,"*"!=n[i])c[n[i]]&&(l.push(c[n[i]]),w.unshift({n:c,name:n[i]}));else for(d in c)c[s](d)&&(l.push(c[d]),w.unshift({n:c,name:d}));v.splice.apply(v,l)}for(i=0,r=v.length;i<r;i++)for(c=v[i];c.n;){if(e){if(c.f){for(u=0,m=c.f.length;u<m;u++)if(c.f[u]==e){c.f.splice(u,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[s](d)&&c.n[d].f){var y=c.n[d].f;for(u=0,m=y.length;u<m;u++)if(y[u]==e){y.splice(u,1);break}!y.length&&delete c.n[d].f}}else for(d in delete c.f,c.n)c.n[s](d)&&c.n[d].f&&delete c.n[d].f;c=c.n}t:for(i=0,r=w.length;i<r;i++){for(d in(c=w[i]).n[c.name].f)continue t;for(d in c.n[c.name].n)continue t;delete c.n[c.name]}}}else p._events=h={n:{}}},p.once=function(t,e){var n=function(){return p.off(t,n),e.apply(this,arguments)};return p.on(t,n)},p.version=r,p.toString=function(){return"You are running Eve "+r},e.eve=p,t.exports?t.exports=p:e.eve=p}("undefined"!=typeof window?window:gt)})),vt=pt((function(t,e){var n,i;!function(e){var n,i,r="0.4.2",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,c=function(t,e){return t-e},h={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},l=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=function(t,e){t=String(t);var r,s=i,o=Array.prototype.slice.call(arguments,2),a=u.listeners(t),h=0,f=[],g={},p=[],m=n;p.firstDefined=d,p.lastDefined=l,n=t,i=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(f.push(a[v].zIndex),a[v].zIndex<0&&(g[a[v].zIndex]=a[v]));for(f.sort(c);f[h]<0;)if(r=g[f[h++]],p.push(r.apply(e,o)),i)return i=s,p;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==f[h]){if(p.push(r.apply(e,o)),i)break;do{if((r=g[f[++h]])&&p.push(r.apply(e,o)),i)break}while(r)}else g[r.zIndex]=r;else if(p.push(r.apply(e,o)),i)break;return i=s,n=m,p};u._events=h,u.listeners=function(t){var e,n,i,r,s,a,c,d,l=t.split(o),u=h,f=[u],g=[];for(r=0,s=l.length;r<s;r++){for(d=[],a=0,c=f.length;a<c;a++)for(n=[(u=f[a].n)[l[r]],u["*"]],i=2;i--;)(e=n[i])&&(d.push(e),g=g.concat(e.f||[]));f=d}return g},u.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var n=t.split(a),i=0,r=n.length;i<r;i++)!function(t){for(var n,i=t.split(o),r=h,s=0,a=i.length;s<a;s++)r=(r=r.n).hasOwnProperty(i[s])&&r[i[s]]||(r[i[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){n=!0;break}!n&&r.f.push(e)}(n[i]);return function(t){+t==+t&&(e.zIndex=+t)}},u.f=function(t){var e=[].slice.call(arguments,1);return function(){u.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},u.stop=function(){i=1},u.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(n):n},u.nts=function(){return n.split(o)},u.off=u.unbind=function(t,e){if(t){var n=t.split(a);if(n.length>1)for(var i=0,r=n.length;i<r;i++)u.off(n[i],e);else{n=t.split(o);var c,d,l,f,g,p=[h];for(i=0,r=n.length;i<r;i++)for(f=0;f<p.length;f+=l.length-2){if(l=[f,1],c=p[f].n,"*"!=n[i])c[n[i]]&&l.push(c[n[i]]);else for(d in c)c[s](d)&&l.push(c[d]);p.splice.apply(p,l)}for(i=0,r=p.length;i<r;i++)for(c=p[i];c.n;){if(e){if(c.f){for(f=0,g=c.f.length;f<g;f++)if(c.f[f]==e){c.f.splice(f,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[s](d)&&c.n[d].f){var m=c.n[d].f;for(f=0,g=m.length;f<g;f++)if(m[f]==e){m.splice(f,1);break}!m.length&&delete c.n[d].f}}else for(d in delete c.f,c.n)c.n[s](d)&&c.n[d].f&&delete c.n[d].f;c=c.n}}}else u._events=h={n:{}}},u.once=function(t,e){var n=function(){return u.unbind(t,n),e.apply(this,arguments)};return u.on(t,n)},u.version=r,u.toString=function(){return"You are running Eve "+r},t.exports?t.exports=u:e.eve=u}(gt),n=window||gt,i=mt,t.exports=function(t,e){var n=function(e){var n={},i=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},r=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},s=0,o="M"+(+new Date).toString(36),a=function(){return o+(s++).toString(36)},c=Date.now||function(){return+new Date},h=function(t){var e=this;if(null==t)return e.s;var n=e.s-t;e.b+=e.dur*n,e.B+=e.dur*n,e.s=t},d=function(t){var e=this;if(null==t)return e.spd;e.spd=t},l=function(t){var e=this;if(null==t)return e.dur;e.s=e.s*t/e.dur,e.dur=t},u=function(){var t=this;delete n[t.id],t.update(),e("mina.stop."+t.id,t)},f=function(){var t=this;t.pdif||(delete n[t.id],t.update(),t.pdif=t.get()-t.b)},g=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,n[t.id]=t)},p=function(){var t,e=this;if(r(e.start)){t=[];for(var n=0,i=e.start.length;n<i;n++)t[n]=+e.start[n]+(e.end[n]-e.start[n])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},m=function(){var t=0;for(var r in n)if(n.hasOwnProperty(r)){var s=n[r],o=s.get();t++,s.s=(o-s.b)/(s.dur/s.spd),s.s>=1&&(delete n[r],s.s=1,t--,function(t){setTimeout((function(){e("mina.finish."+t.id,t)}))}(s)),s.update()}t&&i(m)},v=function(t,e,r,s,o,c,w){var y={id:a(),start:t,end:e,b:r,s:0,dur:s-r,spd:1,get:o,set:c,easing:w||v.linear,status:h,speed:d,duration:l,stop:u,pause:f,resume:g,update:p};n[y.id]=y;var b,x=0;for(b in n)if(n.hasOwnProperty(b)&&2==++x)break;return 1==x&&i(m),y};return v.time=c,v.getById=function(t){return n[t]||null},v.linear=function(t){return t},v.easeout=function(t){return Math.pow(t,1.7)},v.easein=function(t){return Math.pow(t,.48)},v.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),i=n-e,r=-n-e,s=Math.pow(Math.abs(i),1/3)*(i<0?-1:1)+Math.pow(Math.abs(r),1/3)*(r<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},v.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},v.backout=function(t){if(0==t)return 0;var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},v.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},v.bounce=function(t){var e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},t.mina=v,v}(void 0===e?function(){}:e),i=function(t){function n(t,e){if(t){if(t.nodeType)return nt(t);if(N(t,"array")&&n.set)return n.set.apply(n,t);if(t instanceof K)return t;if(null==e)return nt(t=i.doc.querySelector(String(t)))}return new et(t=null==t?"100%":t,e=null==e?"100%":e)}n.version="0.4.0",n.toString=function(){return"Snap v"+this.version},n._={};var i={win:t.window,doc:t.window.document};n._.glob=i;var r="hasOwnProperty",s=String,o=parseFloat,a=parseInt,c=Math,h=c.max,d=c.min,l=c.abs,u=c.PI,f="",p=Object.prototype.toString,m=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i;n._.separator=/[,\s]+/;var v,w,y,b=/[\s]*,[\s]*/,x={hs:1,rg:1},C=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,_=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,S=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,R=0,D="S"+(+new Date).toString(36),A=function(t){return(t&&t.type?t.type:f)+D+(R++).toString(36)},k="http://www.w3.org/1999/xlink",E="http://www.w3.org/2000/svg",B={};function $(t,e){if(e){if("#text"==t&&(t=i.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=i.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=$(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(k,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(E,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var n in e)if(e[r](n)){var o=s(e[n]);o?"xlink:"==n.substring(0,6)?t.setAttributeNS(k,n.substring(6),o):"xml:"==n.substring(0,4)?t.setAttributeNS(E,n.substring(4),o):t.setAttribute(n,o):t.removeAttribute(n)}}else"text"in e&&(t.nodeValue=e.text)}else t=i.doc.createElementNS(E,t);return t}function N(t,e){return"finite"==(e=s.prototype.toLowerCase.call(e))?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||p.call(t).slice(8,-1).toLowerCase()==e}function M(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)t[r](n)&&(e[n]=M(t[n]));return e}function P(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}function L(t,e,n){function i(){var s=Array.prototype.slice.call(arguments,0),o=s.join("␀"),a=i.cache=i.cache||{},c=i.count=i.count||[];return a[r](o)?(P(c,o),n?n(a[o]):a[o]):(c.length>=1e3&&delete a[c.shift()],c.push(o),a[o]=t.apply(e,s),n?n(a[o]):a[o])}return i}function T(t,e,n,i,r,s){if(null==r){var o=t-n,a=e-i;return o||a?(180+180*c.atan2(-a,-o)/u+360)%360:0}return T(t,e,r,s)-T(n,i,r,s)}function U(t){return t%360*u/180}function W(t){return 180*t/u%360}n.url=function(t){return"url('#"+t+"')"},n._.$=$,n._.id=A,n.format=(v=/\{([^\}]+)\}/g,w=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,y=function(t,e,n){var i=n;return e.replace(w,(function(t,e,n,r,s){e=e||r,i&&(e in i&&(i=i[e]),"function"==typeof i&&s&&(i=i()))})),i=(null==i||i==n?t:i)+""},function(t,e){return s(t).replace(v,(function(t,n){return y(t,n,e)}))}),n._.clone=M,n._.cacher=L,n.rad=U,n.deg=W,n.sin=function(t){return c.sin(n.rad(t))},n.tan=function(t){return c.tan(n.rad(t))},n.cos=function(t){return c.cos(n.rad(t))},n.asin=function(t){return n.deg(c.asin(t))},n.acos=function(t){return n.deg(c.acos(t))},n.atan=function(t){return n.deg(c.atan(t))},n.atan2=function(t){return n.deg(c.atan2(t))},n.angle=T,n.len=function(t,e,i,r){return Math.sqrt(n.len2(t,e,i,r))},n.len2=function(t,e,n,i){return(t-n)*(t-n)+(e-i)*(e-i)},n.closestPoint=function(t,e,n){function i(t){var i=t.x-e,r=t.y-n;return i*i+r*r}for(var r,s,o,a,c=t.node,h=c.getTotalLength(),d=h/c.pathSegList.numberOfItems*.125,l=1/0,u=0;u<=h;u+=d)(a=i(o=c.getPointAtLength(u)))<l&&(r=o,s=u,l=a);for(d*=.5;d>.5;){var f,g,p,m,v,w;(p=s-d)>=0&&(v=i(f=c.getPointAtLength(p)))<l?(r=f,s=p,l=v):(m=s+d)<=h&&(w=i(g=c.getPointAtLength(m)))<l?(r=g,s=m,l=w):d*=.5}return r={x:r.x,y:r.y,length:s,distance:Math.sqrt(l)}},n.is=N,n.snapTo=function(t,e,n){if(n=N(n,"finite")?n:10,N(t,"array")){for(var i=t.length;i--;)if(l(t[i]-e)<=n)return t[i]}else{var r=e%(t=+t);if(r<n)return e-r;if(r>t-n)return e-r+t}return e},n.getRGB=L((function(t){if(!t||(t=s(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:I};if(!x[r](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=O(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I};var e,i,l,u,f,g,p=t.match(m);return p?(p[2]&&(l=a(p[2].substring(5),16),i=a(p[2].substring(3,5),16),e=a(p[2].substring(1,3),16)),p[3]&&(l=a((f=p[3].charAt(3))+f,16),i=a((f=p[3].charAt(2))+f,16),e=a((f=p[3].charAt(1))+f,16)),p[4]&&(g=p[4].split(b),e=o(g[0]),"%"==g[0].slice(-1)&&(e*=2.55),i=o(g[1]),"%"==g[1].slice(-1)&&(i*=2.55),l=o(g[2]),"%"==g[2].slice(-1)&&(l*=2.55),"rgba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100)),p[5]?(g=p[5].split(b),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),i=o(g[1]),"%"==g[1].slice(-1)&&(i/=100),l=o(g[2]),"%"==g[2].slice(-1)&&(l/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),n.hsb2rgb(e,i,l,u)):p[6]?(g=p[6].split(b),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),i=o(g[1]),"%"==g[1].slice(-1)&&(i/=100),l=o(g[2]),"%"==g[2].slice(-1)&&(l/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsla"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),n.hsl2rgb(e,i,l,u)):(e=d(c.round(e),255),i=d(c.round(i),255),l=d(c.round(l),255),u=d(h(u,0),1),(p={r:e,g:i,b:l,toString:I}).hex="#"+(16777216|l|i<<8|e<<16).toString(16).slice(1),p.opacity=N(u,"finite")?u:1,p)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:I}}),n),n.hsb=L((function(t,e,i){return n.hsb2rgb(t,e,i).hex})),n.hsl=L((function(t,e,i){return n.hsl2rgb(t,e,i).hex})),n.rgb=L((function(t,e,n,i){if(N(i,"finite")){var r=c.round;return"rgba("+[r(t),r(e),r(n),+i.toFixed(2)]+")"}return"#"+(16777216|n|e<<8|t<<16).toString(16).slice(1)}));var O=function(t){var e=i.doc.getElementsByTagName("head")[0]||i.doc.getElementsByTagName("svg")[0],n="rgb(255, 0, 0)";return O=L((function(t){if("red"==t.toLowerCase())return n;e.style.color=n,e.style.color=t;var r=i.doc.defaultView.getComputedStyle(e,f).getPropertyValue("color");return r==n?null:r})),O(t)},F=function(){return"hsb("+[this.h,this.s,this.b]+")"},H=function(){return"hsl("+[this.h,this.s,this.l]+")"},I=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},j=function(t,e,i){if(null==e&&N(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(i=t.b,e=t.g,t=t.r),null==e&&N(t,string)){var r=n.getRGB(t);t=r.r,e=r.g,i=r.b}return(t>1||e>1||i>1)&&(t/=255,e/=255,i/=255),[t,e,i]},V=function(t,e,i,r){var s={r:t=c.round(255*t),g:e=c.round(255*e),b:i=c.round(255*i),opacity:N(r,"finite")?r:1,hex:n.rgb(t,e,i),toString:I};return N(r,"finite")&&(s.opacity=r),s};n.color=function(t){var e;return N(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=n.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):N(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=n.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):(N(t,"string")&&(t=n.getRGB(t)),N(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(e=n.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=n.rgb2hsb(t),t.v=e.b):((t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=I,t},n.hsb2rgb=function(t,e,n,i){var r,s,o,a,c;return N(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(n=t.b,e=t.s,i=t.o,t=t.h),a=(c=n*e)*(1-l((t=(t*=360)%360/60)%2-1)),r=s=o=n-c,V(r+=[c,a,0,0,a,c][t=~~t],s+=[a,c,c,a,0,0][t],o+=[0,0,a,c,c,a][t],i)},n.hsl2rgb=function(t,e,n,i){var r,s,o,a,c;return N(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(n=t.l,e=t.s,t=t.h),(t>1||e>1||n>1)&&(t/=360,e/=100,n/=100),a=(c=2*e*(n<.5?n:1-n))*(1-l((t=(t*=360)%360/60)%2-1)),r=s=o=n-c/2,V(r+=[c,a,0,0,a,c][t=~~t],s+=[a,c,c,a,0,0][t],o+=[0,0,a,c,c,a][t],i)},n.rgb2hsb=function(t,e,n){var i,r;return t=(n=j(t,e,n))[0],e=n[1],n=n[2],{h:((0==(r=(i=h(t,e,n))-d(t,e,n))?null:i==t?(e-n)/r:i==e?(n-t)/r+2:(t-e)/r+4)+360)%6*60/360,s:0==r?0:r/i,b:i,toString:F}},n.rgb2hsl=function(t,e,n){var i,r,s,o;return t=(n=j(t,e,n))[0],e=n[1],n=n[2],i=((r=h(t,e,n))+(s=d(t,e,n)))/2,{h:((0==(o=r-s)?null:r==t?(e-n)/o:r==e?(n-t)/o+2:(t-e)/o+4)+360)%6*60/360,s:0==o?0:i<.5?o/(2*i):o/(2-2*i),l:i,toString:H}},n.parsePathString=function(t){if(!t)return null;var e=n.path(t);if(e.arr)return n.path.clone(e.arr);var i={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return N(t,"array")&&N(t[0],"array")&&(r=n.path.clone(t)),r.length||s(t).replace(C,(function(t,e,n){var s=[],o=e.toLowerCase();if(n.replace(S,(function(t,e){e&&s.push(+e)})),"m"==o&&s.length>2&&(r.push([e].concat(s.splice(0,2))),o="l",e="m"==e?"l":"L"),"o"==o&&1==s.length&&r.push([e,s[0]]),"r"==o)r.push([e].concat(s));else for(;s.length>=i[o]&&(r.push([e].concat(s.splice(0,i[o]))),i[o]););})),r.toString=n.path.toString,e.arr=n.path.clone(r),r};var z=n.parseTransformString=function(t){if(!t)return null;var e=[];return N(t,"array")&&N(t[0],"array")&&(e=n.path.clone(t)),e.length||s(t).replace(_,(function(t,n,i){var r=[];n.toLowerCase(),i.replace(S,(function(t,e){e&&r.push(+e)})),e.push([n].concat(r))})),e.toString=n.path.toString,e};function q(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,(function(t,n,i){return i=i.split(/\s*,\s*|\s+/),"rotate"==n&&1==i.length&&i.push(0,0),"scale"==n&&(i.length>2?i=i.slice(0,2):2==i.length&&i.push(0,0),1==i.length&&i.push(i[0],0,0)),"skewX"==n?e.push(["m",1,0,c.tan(U(i[0])),1,0,0]):"skewY"==n?e.push(["m",1,c.tan(U(i[0])),0,1,0,0]):e.push([n.charAt(0)].concat(i)),t})),e}function G(t,e){var i=z(t),r=new n.Matrix;if(i)for(var o=0,a=i.length;o<a;o++){var c,h,d,l,u,f=i[o],g=f.length,p=s(f[0]).toLowerCase(),m=f[0]!=p,v=m?r.invert():0;"t"==p&&2==g?r.translate(f[1],0):"t"==p&&3==g?m?(c=v.x(0,0),h=v.y(0,0),d=v.x(f[1],f[2]),l=v.y(f[1],f[2]),r.translate(d-c,l-h)):r.translate(f[1],f[2]):"r"==p?2==g?(u=u||e,r.rotate(f[1],u.x+u.width/2,u.y+u.height/2)):4==g&&(m?(d=v.x(f[2],f[3]),l=v.y(f[2],f[3]),r.rotate(f[1],d,l)):r.rotate(f[1],f[2],f[3])):"s"==p?2==g||3==g?(u=u||e,r.scale(f[1],f[g-1],u.x+u.width/2,u.y+u.height/2)):4==g?m?(d=v.x(f[2],f[3]),l=v.y(f[2],f[3]),r.scale(f[1],f[1],d,l)):r.scale(f[1],f[1],f[2],f[3]):5==g&&(m?(d=v.x(f[3],f[4]),l=v.y(f[3],f[4]),r.scale(f[1],f[2],d,l)):r.scale(f[1],f[2],f[3],f[4])):"m"==p&&7==g&&r.add(f[1],f[2],f[3],f[4],f[5],f[6])}return r}function X(t){var e=t.node.ownerSVGElement&&nt(t.node.ownerSVGElement)||t.node.parentNode&&nt(t.node.parentNode)||n.select("svg")||n(0,0),i=e.select("defs"),r=null!=i&&i.node;return r||(r=tt("defs",e.node).node),r}function Y(t){return t.node.ownerSVGElement&&nt(t.node.ownerSVGElement)||n.select("svg")}function Z(t,e,n){var i=Y(t).node,r={},s=i.querySelector(".svg---mgr");function o(t){if(null==t)return f;if(t==+t)return t;$(s,{width:t});try{return s.getBBox().width}catch(t){return 0}}function a(t){if(null==t)return f;if(t==+t)return t;$(s,{height:t});try{return s.getBBox().height}catch(t){return 0}}function c(i,s){null==e?r[i]=s(t.attr(i)||0):i==e&&(r=s(null==n?t.attr(i)||0:n))}switch(s||(s=$("rect"),$(s,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),i.appendChild(s)),t.type){case"rect":c("rx",o),c("ry",a);case"image":c("width",o),c("height",a);case"text":c("x",o),c("y",a);break;case"circle":c("cx",o),c("cy",a),c("r",o);break;case"ellipse":c("cx",o),c("cy",a),c("rx",o),c("ry",a);break;case"line":c("x1",o),c("x2",o),c("y1",a),c("y2",a);break;case"marker":c("refX",o),c("markerWidth",o),c("refY",a),c("markerHeight",a);break;case"radialGradient":c("fx",o),c("fy",a);break;case"tspan":c("dx",o),c("dy",a);break;default:c(e,o)}return i.removeChild(s),r}function Q(t){N(t,"array")||(t=Array.prototype.slice.call(arguments,0));for(var e=0,n=0,i=this.node;this[e];)delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach((function(t){i.appendChild(t.node)})):i.appendChild(t[e].node);var r=i.childNodes;for(e=0;e<r.length;e++)this[n++]=nt(r[e]);return this}function K(t){if(t.snap in B)return B[t.snap];var e;try{e=t.ownerSVGElement}catch(t){}this.node=t,e&&(this.paper=new et(e)),this.type=t.tagName||t.nodeName;var n=this.id=A(this);if(this.anims={},this._={transform:[]},t.snap=n,B[n]=this,"g"==this.type&&(this.add=Q),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var i in et.prototype)et.prototype[r](i)&&(this[i]=et.prototype[i])}function J(t){this.node=t}function tt(t,e){var n=$(t);return e.appendChild(n),nt(n)}function et(t,e){var n,s,o,a=et.prototype;if(t&&"svg"==t.tagName){if(t.snap in B)return B[t.snap];var c=t.ownerDocument;for(var h in n=new K(t),s=t.getElementsByTagName("desc")[0],o=t.getElementsByTagName("defs")[0],s||((s=$("desc")).appendChild(c.createTextNode("Created with Snap")),n.node.appendChild(s)),o||(o=$("defs"),n.node.appendChild(o)),n.defs=o,a)a[r](h)&&(n[h]=a[h]);n.paper=n.root=n}else $((n=tt("svg",i.doc.body)).node,{height:e,version:1.1,width:t,xmlns:E});return n}function nt(t){return t?t instanceof K||t instanceof J?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new et(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new et(t.contentDocument.getElementsByTagName("svg")[0]):new K(t):t}function it(t,e){for(var n=0,i=t.length;n<i;n++){var r={type:t[n].type,attr:t[n].attr()},s=t[n].children();e.push(r),s.length&&it(s,r.childNodes=[])}}n._.svgTransform2string=q,n._.rgTransform=/^[a-z][\s]*-?\.?\d/i,n._.transform2matrix=G,n._unit2px=Z,i.doc.contains||i.doc.compareDocumentPosition,n._.getSomeDefs=X,n._.getSomeSVG=Y,n.select=function(t){return t=s(t).replace(/([^\\]):/g,"$1\\:"),nt(i.doc.querySelector(t))},n.selectAll=function(t){for(var e=i.doc.querySelectorAll(t),r=(n.set||Array)(),s=0;s<e.length;s++)r.push(nt(e[s]));return r},setInterval((function(){for(var t in B)if(B[r](t)){var e=B[t],n=e.node;("svg"!=e.type&&!n.ownerSVGElement||"svg"==e.type&&(!n.parentNode||"ownerSVGElement"in n.parentNode&&!n.ownerSVGElement))&&delete B[t]}}),1e4),K.prototype.attr=function(t,n){var i=this,s=i.node;if(!t){if(1!=s.nodeType)return{text:s.nodeValue};for(var o=s.attributes,a={},c=0,h=o.length;c<h;c++)a[o[c].nodeName]=o[c].nodeValue;return a}if(N(t,"string")){if(!(arguments.length>1))return e("snap.util.getattr."+t,i).firstDefined();var d={};d[t]=n,t=d}for(var l in t)t[r](l)&&e("snap.util.attr."+l,i,t[l]);return i},n.parse=function(t){var e=i.doc.createDocumentFragment(),n=!0,r=i.doc.createElement("div");if((t=s(t)).match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",n=!1),r.innerHTML=t,t=r.getElementsByTagName("svg")[0])if(n)e=t;else for(;t.firstChild;)e.appendChild(t.firstChild);return new J(e)},n.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),e=i.doc.createDocumentFragment(),r=0,s=t.length;r<s;r++){var o=t[r];o.node&&o.node.nodeType&&e.appendChild(o.node),o.nodeType&&e.appendChild(o),"string"==typeof o&&e.appendChild(n.parse(o).node)}return new J(e)},n._.make=tt,n._.wrap=nt,et.prototype.el=function(t,e){var n=tt(t,this.node);return e&&n.attr(e),n},K.prototype.children=function(){for(var t=[],e=this.node.childNodes,i=0,r=e.length;i<r;i++)t[i]=n(e[i]);return t},K.prototype.toJSON=function(){var t=[];return it([this],t),t[0]},e.on("snap.util.getattr",(function(){var t=e.nt(),n=(t=t.substring(t.lastIndexOf(".")+1)).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return rt[r](n)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(n):$(this.node,t)}));var rt={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",(function(t){var n=e.nt(),i={};i[n=n.substring(n.lastIndexOf(".")+1)]=t;var s=n.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()})),o=n.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));rt[r](o)?this.node.style[s]=null==t?f:t:$(this.node,i)})),et.prototype,n.ajax=function(t,n,i,r){var s=new XMLHttpRequest,o=A();if(s){if(N(n,"function"))r=i,i=n,n=null;else if(N(n,"object")){var a=[];for(var c in n)n.hasOwnProperty(c)&&a.push(encodeURIComponent(c)+"="+encodeURIComponent(n[c]));n=a.join("&")}return s.open(n?"POST":"GET",t,!0),n&&(s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),i&&(e.once("snap.ajax."+o+".0",i),e.once("snap.ajax."+o+".200",i),e.once("snap.ajax."+o+".304",i)),s.onreadystatechange=function(){4==s.readyState&&e("snap.ajax."+o+"."+s.status,r,s)},4==s.readyState||s.send(n),s}},n.load=function(t,e,i){n.ajax(t,(function(t){var r=n.parse(t.responseText);i?e.call(i,r):e(r)}))};var st=function(t){var e=t.getBoundingClientRect(),n=t.ownerDocument,i=n.body,r=n.documentElement,s=r.clientTop||i.clientTop||0,o=r.clientLeft||i.clientLeft||0;return{y:e.top+(g.win.pageYOffset||r.scrollTop||i.scrollTop)-s,x:e.left+(g.win.pageXOffset||r.scrollLeft||i.scrollLeft)-o}};return n.getElementByPoint=function(t,e){this.canvas;var n=i.doc.elementFromPoint(t,e);if(i.win.opera&&"svg"==n.tagName){var r=st(n),s=n.createSVGRect();s.x=t-r.x,s.y=e-r.y,s.width=s.height=1;var o=n.getIntersectionList(s,null);o.length&&(n=o[o.length-1])}return n?nt(n):null},n.plugin=function(t){t(n,K,et,i,J)},i.win.Snap=n,n}(t||this);return i.plugin((function(i,r,s,o,a){var c=r.prototype,h=i.is,d=String,l=i._unit2px,u=i._.$,f=i._.make,g=i._.getSomeDefs,p="hasOwnProperty",m=i._.wrap;c.getBBox=function(t){if(!i.Matrix||!i.path)return this.node.getBBox();var e=this,n=new i.Matrix;if(e.removed)return i._.box();for(;"use"==e.type;)if(t||(n=n.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else{var r=e.attr("xlink:href");e=e.original=e.node.ownerDocument.getElementById(r.substring(r.indexOf("#")+1))}var s=e._,o=i.path.get[e.type]||i.path.get.deflt;try{return t?(s.bboxwt=o?i.path.getBBox(e.realPath=o(e)):i._.box(e.node.getBBox()),i._.box(s.bboxwt)):(e.realPath=o(e),e.matrix=e.transform().localMatrix,s.bbox=i.path.getBBox(i.path.map(e.realPath,n.add(e.matrix))),i._.box(s.bbox))}catch(t){return i._.box()}};var v=function(){return this.string};function w(t,e){if(null==e){var n=!0;if(!(e="linearGradient"==t.type||"radialGradient"==t.type?t.node.getAttribute("gradientTransform"):"pattern"==t.type?t.node.getAttribute("patternTransform"):t.node.getAttribute("transform")))return new i.Matrix;e=i._.svgTransform2string(e)}else e=i._.rgTransform.test(e)?d(e).replace(/\.{3}|\u2026/g,t._.transform||""):i._.svgTransform2string(e),h(e,"array")&&(e=i.path?i.path.toString.call(e):d(e)),t._.transform=e;var r=i._.transform2matrix(e,t.getBBox(1));if(n)return r;t.matrix=r}function y(t){var e,n=t.selectAll("*"),i=/^\s*url\(("|'|)(.*)\1\)\s*$/,r=[],s={};function o(t,e){var n=u(t.node,e);(n=(n=n&&n.match(i))&&n[2])&&"#"==n.charAt()&&(n=n.substring(1))&&(s[n]=(s[n]||[]).concat((function(n){var i={};i[e]=URL(n),u(t.node,i)})))}function a(t){var e=u(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1))&&(s[e]=(s[e]||[]).concat((function(e){t.attr("xlink:href","#"+e)})))}for(var c=0,h=n.length;c<h;c++){o(e=n[c],"fill"),o(e,"stroke"),o(e,"filter"),o(e,"mask"),o(e,"clip-path"),a(e);var d=u(e.node,"id");d&&(u(e.node,{id:e.id}),r.push({old:d,id:e.id}))}for(c=0,h=r.length;c<h;c++){var l=s[r[c].old];if(l)for(var f=0,g=l.length;f<g;f++)l[f](r[c].id)}}function b(t,e,n){return function(i){var r=i.slice(t,e);return 1==r.length&&(r=r[0]),n?n(r):r}}c.transform=function(t){var e=this._;if(null==t){for(var n,r=this,s=new i.Matrix(this.node.getCTM()),o=w(this),a=[o],c=new i.Matrix,h=o.toTransformString(),l=d(o)==d(this.matrix)?d(e.transform):h;"svg"!=r.type&&(r=r.parent());)a.push(w(r));for(n=a.length;n--;)c.add(a[n]);return{string:l,globalMatrix:s,totalMatrix:c,localMatrix:o,diffMatrix:s.clone().add(o.invert()),global:s.toTransformString(),total:c.toTransformString(),local:h,toString:v}}return t instanceof i.Matrix?(this.matrix=t,this._.transform=t.toTransformString()):w(this,t),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?u(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?u(this.node,{patternTransform:this.matrix}):u(this.node,{transform:this.matrix})),this},c.parent=function(){return m(this.node.parentNode)},c.append=c.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach((function(t){e.add(t)})),this}t=m(t),this.node.appendChild(t.node),t.paper=this.paper}return this},c.appendTo=function(t){return t&&(t=m(t)).append(this),this},c.prepend=function(t){if(t){if("set"==t.type){var e,n=this;return t.forEach((function(t){e?e.after(t):n.prepend(t),e=t})),this}var i=(t=m(t)).parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),i&&i.add()}return this},c.prependTo=function(t){return(t=m(t)).prepend(this),this},c.before=function(t){if("set"==t.type){var e=this;return t.forEach((function(t){var n=t.parent();e.node.parentNode.insertBefore(t.node,e.node),n&&n.add()})),this.parent().add(),this}var n=(t=m(t)).parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),n&&n.add(),t.paper=this.paper,this},c.after=function(t){var e=(t=m(t)).parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},c.insertBefore=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},c.insertAfter=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},c.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},c.select=function(t){return m(this.node.querySelector(t))},c.selectAll=function(t){for(var e=this.node.querySelectorAll(t),n=(i.set||Array)(),r=0;r<e.length;r++)n.push(m(e[r]));return n},c.asPX=function(t,e){return null==e&&(e=this.attr(t)),+l(this,t,e)},c.use=function(){var t,e=this.node.id;return e||(e=this.id,u(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?f(this.type,this.node.parentNode):f("use",this.node.parentNode),u(t.node,{"xlink:href":"#"+e}),t.original=this,t},c.clone=function(){var t=m(this.node.cloneNode(!0));return u(t.node,"id")&&u(t.node,{id:t.id}),y(t),t.insertAfter(this),t},c.toDefs=function(){return g(this).appendChild(this.node),this},c.pattern=c.toPattern=function(t,e,n,i){var r=f("pattern",g(this));return null==t&&(t=this.getBBox()),h(t,"object")&&"x"in t&&(e=t.y,n=t.width,i=t.height,t=t.x),u(r.node,{x:t,y:e,width:n,height:i,patternUnits:"userSpaceOnUse",id:r.id,viewBox:[t,e,n,i].join(" ")}),r.node.appendChild(this.node),r},c.marker=function(t,e,n,i,r,s){var o=f("marker",g(this));return null==t&&(t=this.getBBox()),h(t,"object")&&"x"in t&&(e=t.y,n=t.width,i=t.height,r=t.refX||t.cx,s=t.refY||t.cy,t=t.x),u(o.node,{viewBox:[t,e,n,i].join(" "),markerWidth:n,markerHeight:i,orient:"auto",refX:r||0,refY:s||0,id:o.id}),o.node.appendChild(this.node),o};var x=function(t,e,i,r){"function"!=typeof i||i.length||(r=i,i=n.linear),this.attr=t,this.dur=e,i&&(this.easing=i),r&&(this.callback=r)};i._.Animation=x,i.animation=function(t,e,n,i){return new x(t,e,n,i)},c.inAnim=function(){var t=this,e=[];for(var n in t.anims)t.anims[p](n)&&function(t){e.push({anim:new x(t._attrs,t.dur,t.easing,t._callback),mina:t,curStatus:t.status(),status:function(e){return t.status(e)},stop:function(){t.stop()}})}(t.anims[n]);return e},i.animate=function(t,i,r,s,o,a){"function"!=typeof o||o.length||(a=o,o=n.linear);var c=n.time(),h=n(t,i,c,c+s,n.time,r,o);return a&&e.once("mina.finish."+h.id,a),h},c.stop=function(){for(var t=this.inAnim(),e=0,n=t.length;e<n;e++)t[e].stop();return this},c.animate=function(t,i,r,s){"function"!=typeof r||r.length||(s=r,r=n.linear),t instanceof x&&(s=t.callback,r=t.easing,i=t.dur,t=t.attr);var o,a,c,l,u=[],f=[],g={},m=this;for(var v in t)if(t[p](v)){m.equal?(o=(l=m.equal(v,d(t[v]))).from,a=l.to,c=l.f):(o=+m.attr(v),a=+t[v]);var w=h(o,"array")?o.length:1;g[v]=b(u.length,u.length+w,c),u=u.concat(o),f=f.concat(a)}var y=n.time(),C=n(u,f,y,y+i,n.time,(function(t){var e={};for(var n in g)g[p](n)&&(e[n]=g[n](t));m.attr(e)}),r);return m.anims[C.id]=C,C._attrs=t,C._callback=s,e("snap.animcreated."+m.id,C),e.once("mina.finish."+C.id,(function(){delete m.anims[C.id],s&&s.call(m)})),e.once("mina.stop."+C.id,(function(){delete m.anims[C.id]})),m};var C={};function _(t){return function(){var e=t?"<"+this.type:"",n=this.node.attributes,i=this.node.childNodes;if(t)for(var r=0,s=n.length;r<s;r++)e+=" "+n[r].name+'="'+n[r].value.replace(/"/g,'\\"')+'"';if(i.length){for(t&&(e+=">"),r=0,s=i.length;r<s;r++)3==i[r].nodeType?e+=i[r].nodeValue:1==i[r].nodeType&&(e+=m(i[r]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}c.data=function(t,n){var r=C[this.id]=C[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,r,null),r;if(1==arguments.length){if(i.is(t,"object")){for(var s in t)t[p](s)&&this.data(s,t[s]);return this}return e("snap.data.get."+this.id,this,r[t],t),r[t]}return r[t]=n,e("snap.data.set."+this.id,this,n,t),this},c.removeData=function(t){return null==t?C[this.id]={}:C[this.id]&&delete C[this.id][t],this},c.outerSVG=c.toString=_(1),c.innerSVG=_(),c.toDataURL=function(){if(t&&t.btoa){var e=this.getBBox(),n=i.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)))}},a.prototype.select=c.select,a.prototype.selectAll=c.selectAll})),i.plugin((function(t,e,n,i,r){var s=Object.prototype.toString,o=String,a=Math,c="";function h(t,e,n,i,r,o){if(null==e&&"[object SVGMatrix]"==s.call(t))return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f);null!=t?(this.a=+t,this.b=+e,this.c=+n,this.d=+i,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}!function(e){function n(t){return t[0]*t[0]+t[1]*t[1]}function i(t){var e=a.sqrt(n(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,n,i,r,s){var o,a,c,d,l=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[t,n,r],[e,i,s],[0,0,1]];for(t&&t instanceof h&&(f=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;o<3;o++)for(a=0;a<3;a++){for(d=0,c=0;c<3;c++)d+=u[o][c]*f[c][a];l[o][a]=d}return this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2],this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new h(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new h(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.add(1,0,0,1,t,e)},e.scale=function(t,e,n,i){return null==e&&(e=t),(n||i)&&this.add(1,0,0,1,n,i),this.add(t,0,0,e,0,0),(n||i)&&this.add(1,0,0,1,-n,-i),this},e.rotate=function(e,n,i){e=t.rad(e),n=n||0,i=i||0;var r=+a.cos(e).toFixed(9),s=+a.sin(e).toFixed(9);return this.add(r,s,-s,r,n,i),this.add(1,0,0,1,-n,-i)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[o.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var r=[[this.a,this.c],[this.b,this.d]];e.scalex=a.sqrt(n(r[0])),i(r[0]),e.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*e.shear,r[1][1]-r[0][1]*e.shear],e.scaley=a.sqrt(n(r[1])),i(r[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var s=-r[0][1],o=r[1][1];return o<0?(e.rotate=t.deg(a.acos(o)),s<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(a.asin(s)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:c)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:c)+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:c))}}(h.prototype),t.Matrix=h,t.matrix=function(t,e,n,i,r,s){return new h(t,e,n,i,r,s)}})),i.plugin((function(t,n,i,r,s){var o,a=t._.make,c=t._.wrap,h=t.is,d=t._.getSomeDefs,l=/^url\(#?([^)]+)\)$/,u=t._.$,f=t.url,g=String,p=t._.separator,m="";function v(i){return function(r){if(e.stop(),r instanceof s&&1==r.node.childNodes.length&&("radialGradient"==r.node.firstChild.tagName||"linearGradient"==r.node.firstChild.tagName||"pattern"==r.node.firstChild.tagName)&&(r=r.node.firstChild,d(this).appendChild(r),r=c(r)),r instanceof n)if("radialGradient"==r.type||"linearGradient"==r.type||"pattern"==r.type){r.node.id||u(r.node,{id:r.id});var o=f(r.node.id)}else o=r.attr(i);else if((o=r).error){var a=t(d(this).ownerSVGElement).gradient(r);a?(a.node.id||u(a.node,{id:a.id}),o=f(a.node.id)):o=r}else o=g(o);var h={};h[i]=o,u(this.node,h),this.node.style[i]=m}}e.on("snap.util.attr.mask",(function(t){if(t instanceof n||t instanceof s){if(e.stop(),t instanceof s&&1==t.node.childNodes.length&&(t=t.node.firstChild,d(this).appendChild(t),t=c(t)),"mask"==t.type)var i=t;else(i=a("mask",d(this))).node.appendChild(t.node);!i.node.id&&u(i.node,{id:i.id}),u(this.node,{mask:f(i.id)})}})),o=function(t){if(t instanceof n||t instanceof s){if(e.stop(),"clipPath"==t.type)var i=t;else(i=a("clipPath",d(this))).node.appendChild(t.node),!i.node.id&&u(i.node,{id:i.id});u(this.node,{"clip-path":f(i.node.id||i.id)})}},e.on("snap.util.attr.clip",o),e.on("snap.util.attr.clip-path",o),e.on("snap.util.attr.clipPath",o),e.on("snap.util.attr.fill",v("fill")),e.on("snap.util.attr.stroke",v("stroke"));var w=/^([lr])(?:\(([^)]*)\))?(.*)$/i;function y(t){e.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function b(t){for(var e=[],n=t.childNodes,i=0,r=n.length;i<r;i++){var s=n[i];3==s.nodeType&&e.push(s.nodeValue),"tspan"==s.tagName&&(1==s.childNodes.length&&3==s.firstChild.nodeType?e.push(s.firstChild.nodeValue):e.push(b(s)))}return e}function x(){return e.stop(),this.node.style.fontSize}e.on("snap.util.grad.parse",(function(t){var e=(t=g(t)).match(w);if(!e)return null;var n=e[1],i=e[2],r=e[3];return 1==(i=i.split(/\s*,\s*/).map((function(t){return+t==t?+t:t}))).length&&0==i[0]&&(i=[]),{type:n,params:i,stops:r=(r=r.split("-")).map((function(t){var e={color:(t=t.split(":"))[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}))}})),e.on("snap.util.attr.d",(function(n){e.stop(),h(n,"array")&&h(n[0],"array")&&(n=t.path.toString.call(n)),(n=g(n)).match(/[ruo]/i)&&(n=t.path.toAbsolute(n)),u(this.node,{d:n})}))(-1),e.on("snap.util.attr.#text",(function(t){e.stop(),t=g(t);for(var n=r.doc.createTextNode(t);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(n)}))(-1),e.on("snap.util.attr.path",(function(t){e.stop(),this.attr({d:t})}))(-1),e.on("snap.util.attr.class",(function(t){e.stop(),this.node.className.baseVal=t}))(-1),e.on("snap.util.attr.viewBox",(function(t){var n;n=h(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):h(t,"array")?t.join(" "):t,u(this.node,{viewBox:n}),e.stop()}))(-1),e.on("snap.util.attr.transform",(function(t){this.transform(t),e.stop()}))(-1),e.on("snap.util.attr.r",(function(t){"rect"==this.type&&(e.stop(),u(this.node,{rx:t,ry:t}))}))(-1),e.on("snap.util.attr.textpath",(function(t){if(e.stop(),"text"==this.type){var i,r,s;if(!t&&this.textPath){for(r=this.textPath;r.node.firstChild;)this.node.appendChild(r.node.firstChild);return r.remove(),void delete this.textPath}if(h(t,"string")){var o=d(this),a=c(o.parentNode).path(t);o.appendChild(a.node),i=a.id,a.attr({id:i})}else(t=c(t))instanceof n&&((i=t.attr("id"))||(i=t.id,t.attr({id:i})));if(i)if(r=this.textPath,s=this.node,r)r.attr({"xlink:href":"#"+i});else{for(r=u("textPath",{"xlink:href":"#"+i});s.firstChild;)r.appendChild(s.firstChild);s.appendChild(r),this.textPath=c(r)}}}))(-1),e.on("snap.util.attr.text",(function(t){if("text"==this.type){for(var n=this.node,i=function(t){var e=u("tspan");if(h(t,"array"))for(var n=0;n<t.length;n++)e.appendChild(i(t[n]));else e.appendChild(r.doc.createTextNode(t));return e.normalize&&e.normalize(),e};n.firstChild;)n.removeChild(n.firstChild);for(var s=i(t);s.firstChild;)n.appendChild(s.firstChild)}e.stop()}))(-1),e.on("snap.util.attr.fontSize",y)(-1),e.on("snap.util.attr.font-size",y)(-1),e.on("snap.util.getattr.transform",(function(){return e.stop(),this.transform()}))(-1),e.on("snap.util.getattr.textpath",(function(){return e.stop(),this.textPath}))(-1),function(){function n(n){return function(){e.stop();var i=r.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+n);return"none"==i?i:t(r.doc.getElementById(i.match(l)[1]))}}function i(t){return function(n){e.stop();var i="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""!=n&&n){if("marker"==n.type){var r=n.node.id;return r||u(n.node,{id:n.id}),void(this.node.style[i]=f(r))}}else this.node.style[i]="none"}}e.on("snap.util.getattr.marker-end",n("end"))(-1),e.on("snap.util.getattr.markerEnd",n("end"))(-1),e.on("snap.util.getattr.marker-start",n("start"))(-1),e.on("snap.util.getattr.markerStart",n("start"))(-1),e.on("snap.util.getattr.marker-mid",n("mid"))(-1),e.on("snap.util.getattr.markerMid",n("mid"))(-1),e.on("snap.util.attr.marker-end",i("end"))(-1),e.on("snap.util.attr.markerEnd",i("end"))(-1),e.on("snap.util.attr.marker-start",i("start"))(-1),e.on("snap.util.attr.markerStart",i("start"))(-1),e.on("snap.util.attr.marker-mid",i("mid"))(-1),e.on("snap.util.attr.markerMid",i("mid"))(-1)}(),e.on("snap.util.getattr.r",(function(){if("rect"==this.type&&u(this.node,"rx")==u(this.node,"ry"))return e.stop(),u(this.node,"rx")}))(-1),e.on("snap.util.getattr.text",(function(){if("text"==this.type||"tspan"==this.type){e.stop();var t=b(this.node);return 1==t.length?t[0]:t}}))(-1),e.on("snap.util.getattr.#text",(function(){return this.node.textContent}))(-1),e.on("snap.util.getattr.viewBox",(function(){e.stop();var n=u(this.node,"viewBox");return n?(n=n.split(p),t._.box(+n[0],+n[1],+n[2],+n[3])):void 0}))(-1),e.on("snap.util.getattr.points",(function(){var t=u(this.node,"points");return e.stop(),t?t.split(p):void 0}))(-1),e.on("snap.util.getattr.path",(function(){var t=u(this.node,"d");return e.stop(),t}))(-1),e.on("snap.util.getattr.class",(function(){return this.node.className.baseVal}))(-1),e.on("snap.util.getattr.fontSize",x)(-1),e.on("snap.util.getattr.font-size",x)(-1)})),i.plugin((function(t,e,n,i,r){var s=/\S+/g,o=String,a=e.prototype;a.addClass=function(t){var e,n,i,r=o(t||"").match(s)||[],a=this.node,c=a.className.baseVal,h=c.match(s)||[];if(r.length){for(e=0;n=r[e++];)~h.indexOf(n)||h.push(n);c!=(i=h.join(" "))&&(a.className.baseVal=i)}return this},a.removeClass=function(t){var e,n,i,r,a=o(t||"").match(s)||[],c=this.node,h=c.className.baseVal,d=h.match(s)||[];if(d.length){for(e=0;i=a[e++];)~(n=d.indexOf(i))&&d.splice(n,1);h!=(r=d.join(" "))&&(c.className.baseVal=r)}return this},a.hasClass=function(t){return!!~(this.node.className.baseVal.match(s)||[]).indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var n,i,r,o,a=(t||"").match(s)||[],c=this.node,h=c.className.baseVal,d=h.match(s)||[];for(n=0;r=a[n++];)~(i=d.indexOf(r))?d.splice(i,1):d.push(r);return h!=(o=d.join(" "))&&(c.className.baseVal=o),this}})),i.plugin((function(t,n,i,r,s){var o={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},a=String,c=/[a-z]+$/i,h=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;function d(t){return t}function l(t){return function(e){return+e.toFixed(3)+t}}e.on("snap.util.attr",(function(t){var n=a(t).match(h);if(n){var i=e.nt(),r=i.substring(i.lastIndexOf(".")+1),s=this.attr(r),d={};e.stop();var l=n[3]||"",u=s.match(c),f=o[n[1]];if(u&&u==l?t=f(parseFloat(s),+n[2]):(s=this.asPX(r),t=f(this.asPX(r),this.asPX(r,n[2]+l))),isNaN(s)||isNaN(t))return;d[r]=t,this.attr(d)}}))(-10),e.on("snap.util.equal",(function(t,n){var i=a(this.attr(t)||""),r=a(n).match(h);if(r){e.stop();var s=r[3]||"",u=i.match(c),f=o[r[1]];return u&&u==s?{from:parseFloat(i),to:f(parseFloat(i),+r[2]),f:l(u)}:{from:i=this.asPX(t),to:f(i,this.asPX(t,r[2]+s)),f:d}}}))(-10)})),i.plugin((function(n,i,r,s,o){var a=r.prototype,c=n.is;a.rect=function(t,e,n,i,r,s){var o;return null==s&&(s=r),c(t,"object")&&"[object Object]"==t?o=t:null!=t&&(o={x:t,y:e,width:n,height:i},null!=r&&(o.rx=r,o.ry=s)),this.el("rect",o)},a.circle=function(t,e,n){var i;return c(t,"object")&&"[object Object]"==t?i=t:null!=t&&(i={cx:t,cy:e,r:n}),this.el("circle",i)};var h=function(){function t(){this.parentNode.removeChild(this)}return function(e,n){var i=s.doc.createElement("img"),r=s.doc.body;i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){n.call(i),i.onload=i.onerror=null,r.removeChild(i)},i.onerror=t,r.appendChild(i),i.src=e}}();a.image=function(t,e,i,r,s){var o=this.el("image");if(c(t,"object")&&"src"in t)o.attr(t);else if(null!=t){var a={"xlink:href":t,preserveAspectRatio:"none"};null!=e&&null!=i&&(a.x=e,a.y=i),null!=r&&null!=s?(a.width=r,a.height=s):h(t,(function(){n._.$(o.node,{width:this.offsetWidth,height:this.offsetHeight})})),n._.$(o.node,a)}return o},a.ellipse=function(t,e,n,i){var r;return c(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,rx:n,ry:i}),this.el("ellipse",r)},a.path=function(t){var e;return c(t,"object")&&!c(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},a.group=a.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.svg=function(t,e,n,i,r,s,o,a){var h={};return c(t,"object")&&null==e?h=t:(null!=t&&(h.x=t),null!=e&&(h.y=e),null!=n&&(h.width=n),null!=i&&(h.height=i),null!=r&&null!=s&&null!=o&&null!=a&&(h.viewBox=[r,s,o,a])),this.el("svg",h)},a.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.ptrn=function(t,e,n,i,r,s,o,a){if(c(t,"object"))var h=t;else h={patternUnits:"userSpaceOnUse"},t&&(h.x=t),e&&(h.y=e),null!=n&&(h.width=n),null!=i&&(h.height=i),h.viewBox=null!=r&&null!=s&&null!=o&&null!=a?[r,s,o,a]:[t||0,e||0,n||0,i||0];return this.el("pattern",h)},a.use=function(t){return null!=t?(t instanceof i&&(t.attr("id")||t.attr({id:n._.id(t)}),t=t.attr("id")),"#"==String(t).charAt()&&(t=t.substring(1)),this.el("use",{"xlink:href":"#"+t})):i.prototype.use.call(this)},a.symbol=function(t,e,n,i){var r={};return null!=t&&null!=e&&null!=n&&null!=i&&(r.viewBox=[t,e,n,i]),this.el("symbol",r)},a.text=function(t,e,n){var i={};return c(t,"object")?i=t:null!=t&&(i={x:t,y:e,text:n||""}),this.el("text",i)},a.line=function(t,e,n,i){var r={};return c(t,"object")?r=t:null!=t&&(r={x1:t,x2:n,y1:e,y2:i}),this.el("line",r)},a.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return c(t,"object")&&!c(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},a.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return c(t,"object")&&!c(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){var i=n._.$;function r(){return this.selectAll("stop")}function s(t,e){var r=i("stop"),s={offset:+e+"%"};return t=n.color(t),s["stop-color"]=t.hex,t.opacity<1&&(s["stop-opacity"]=t.opacity),i(r,s),this.node.appendChild(r),this}function o(){if("linearGradient"==this.type){var t=i(this.node,"x1")||0,e=i(this.node,"x2")||1,r=i(this.node,"y1")||0,s=i(this.node,"y2")||0;return n._.box(t,r,math.abs(e-t),math.abs(s-r))}var o=this.node.cx||.5,a=this.node.cy||.5,c=this.node.r||0;return n._.box(o-c,a-c,2*c,2*c)}function c(t,n){var r,s=e("snap.util.grad.parse",null,n).firstDefined();if(!s)return null;s.params.unshift(t),r="l"==s.type.toLowerCase()?h.apply(0,s.params):d.apply(0,s.params),s.type!=s.type.toLowerCase()&&i(r.node,{gradientUnits:"userSpaceOnUse"});var o=s.stops,a=o.length,c=0,l=0;function u(t,e){for(var n=(e-c)/(t-l),i=l;i<t;i++)o[i].offset=+(+c+n*(i-l)).toFixed(2);l=t,c=e}a--;for(var f=0;f<a;f++)"offset"in o[f]&&u(f,o[f].offset);for(o[a].offset=o[a].offset||100,u(a,o[a].offset),f=0;f<=a;f++){var g=o[f];r.addStop(g.color,g.offset)}return r}function h(t,e,a,c,h){var d=n._.make("linearGradient",t);return d.stops=r,d.addStop=s,d.getBBox=o,null!=e&&i(d.node,{x1:e,y1:a,x2:c,y2:h}),d}function d(t,e,a,c,h,d){var l=n._.make("radialGradient",t);return l.stops=r,l.addStop=s,l.getBBox=o,null!=e&&i(l.node,{cx:e,cy:a,r:c}),null!=h&&null!=d&&i(l.node,{fx:h,fy:d}),l}a.gradient=function(t){return c(this.defs,t)},a.gradientLinear=function(t,e,n,i){return h(this.defs,t,e,n,i)},a.gradientRadial=function(t,e,n,i,r){return d(this.defs,t,e,n,i,r)},a.toString=function(){var t,e=this.node.ownerDocument,i=e.createDocumentFragment(),r=e.createElement("div"),s=this.node.cloneNode(!0);return i.appendChild(r),r.appendChild(s),n._.$(s,{xmlns:"http://www.w3.org/2000/svg"}),t=r.innerHTML,i.removeChild(i.firstChild),t},a.toDataURL=function(){if(t&&t.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){for(var t,e=this.node.firstChild;e;)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):a.clear.call({node:e}),e=t}}()})),i.plugin((function(t,e,n,i){var r=e.prototype,s=t.is,o=t._.clone,a="hasOwnProperty",c=/,?([a-z]),?/gi,h=parseFloat,d=Math,l=d.PI,u=d.min,f=d.max,g=d.pow,p=d.abs;function m(t){var e=m.ps=m.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var n in e)e[a](n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])})),e[t]}function v(t,e,n,i){return null==t&&(t=e=n=i=0),null==e&&(e=t.y,n=t.width,i=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:i,h:i,x2:t+n,y2:e+i,cx:t+n/2,cy:e+i/2,r1:d.min(n,i)/2,r2:d.max(n,i)/2,r0:d.sqrt(n*n+i*i)/2,path:O(t,e,n,i),vb:[t,e,n,i].join(" ")}}function w(){return this.join(",").replace(c,"$1")}function y(t){var e=o(t);return e.toString=w,e}function b(t,e,n,i,r,s,o,a,c){return null==c?B(t,e,n,i,r,s,o,a):R(t,e,n,i,r,s,o,a,$(t,e,n,i,r,s,o,a,c))}function x(n,i){function r(t){return+(+t).toFixed(3)}return t._.cacher((function(t,s,o){t instanceof e&&(t=t.attr("d"));for(var a,c,h,d,l,u="",f={},g=0,p=0,m=(t=Y(t)).length;p<m;p++){if("M"==(h=t[p])[0])a=+h[1],c=+h[2];else{if(g+(d=b(a,c,h[1],h[2],h[3],h[4],h[5],h[6]))>s){if(i&&!f.start){if(u+=["C"+r((l=b(a,c,h[1],h[2],h[3],h[4],h[5],h[6],s-g)).start.x),r(l.start.y),r(l.m.x),r(l.m.y),r(l.x),r(l.y)],o)return u;f.start=u,u=["M"+r(l.x),r(l.y)+"C"+r(l.n.x),r(l.n.y),r(l.end.x),r(l.end.y),r(h[5]),r(h[6])].join(),g+=d,a=+h[5],c=+h[6];continue}if(!n&&!i)return l=b(a,c,h[1],h[2],h[3],h[4],h[5],h[6],s-g)}g+=d,a=+h[5],c=+h[6]}u+=h.shift()+h}return f.end=u,l=n?g:i?f:R(a,c,h[0],h[1],h[2],h[3],h[4],h[5],1)}),null,t._.clone)}var C=x(1),_=x(),S=x(0,1);function R(t,e,n,i,r,s,o,a,c){var h=1-c,u=g(h,3),f=g(h,2),p=c*c,m=p*c,v=t+2*c*(n-t)+p*(r-2*n+t),w=e+2*c*(i-e)+p*(s-2*i+e),y=n+2*c*(r-n)+p*(o-2*r+n),b=i+2*c*(s-i)+p*(a-2*s+i);return{x:u*t+3*f*c*n+3*h*c*c*r+m*o,y:u*e+3*f*c*i+3*h*c*c*s+m*a,m:{x:v,y:w},n:{x:y,y:b},start:{x:h*t+c*n,y:h*e+c*i},end:{x:h*r+c*o,y:h*s+c*a},alpha:90-180*d.atan2(v-y,w-b)/l}}function D(e,n,i,r,s,o,a,c){t.is(e,"array")||(e=[e,n,i,r,s,o,a,c]);var h=X.apply(null,e);return v(h.min.x,h.min.y,h.max.x-h.min.x,h.max.y-h.min.y)}function A(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function k(t,e){return t=v(t),A(e=v(e),t.x,t.y)||A(e,t.x2,t.y)||A(e,t.x,t.y2)||A(e,t.x2,t.y2)||A(t,e.x,e.y)||A(t,e.x2,e.y)||A(t,e.x,e.y2)||A(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function E(t,e,n,i,r){return t*(t*(-3*e+9*n-9*i+3*r)+6*e-12*n+6*i)-3*e+3*n}function B(t,e,n,i,r,s,o,a,c){null==c&&(c=1);for(var h=(c=c>1?1:c<0?0:c)/2,l=12,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],g=0,p=0;p<l;p++){var m=h*u[p]+h,v=E(m,t,n,r,o),w=E(m,e,i,s,a),y=v*v+w*w;g+=f[p]*d.sqrt(y)}return h*g}function $(t,e,n,i,r,s,o,a,c){if(!(c<0||B(t,e,n,i,r,s,o,a)<c)){var h,d=1,l=d/2,u=d-l,f=.01;for(h=B(t,e,n,i,r,s,o,a,u);p(h-c)>f;)h=B(t,e,n,i,r,s,o,a,u+=(h<c?1:-1)*(l/=2));return u}}function N(t,e,n,i,r,s,o,a){if(!(f(t,n)<u(r,o)||u(t,n)>f(r,o)||f(e,i)<u(s,a)||u(e,i)>f(s,a))){var c=(t-n)*(s-a)-(e-i)*(r-o);if(c){var h=((t*i-e*n)*(r-o)-(t-n)*(r*a-s*o))/c,d=((t*i-e*n)*(s-a)-(e-i)*(r*a-s*o))/c,l=+h.toFixed(2),g=+d.toFixed(2);if(!(l<+u(t,n).toFixed(2)||l>+f(t,n).toFixed(2)||l<+u(r,o).toFixed(2)||l>+f(r,o).toFixed(2)||g<+u(e,i).toFixed(2)||g>+f(e,i).toFixed(2)||g<+u(s,a).toFixed(2)||g>+f(s,a).toFixed(2)))return{x:h,y:d}}}}function M(t,e,n){if(!k(D(t),D(e)))return n?0:[];for(var i=~~(B.apply(0,t)/8),r=~~(B.apply(0,e)/8),s=[],o=[],a={},c=n?0:[],h=0;h<i+1;h++){var d=R.apply(0,t.concat(h/i));s.push({x:d.x,y:d.y,t:h/i})}for(h=0;h<r+1;h++)d=R.apply(0,e.concat(h/r)),o.push({x:d.x,y:d.y,t:h/r});for(h=0;h<i;h++)for(var l=0;l<r;l++){var u=s[h],f=s[h+1],g=o[l],m=o[l+1],v=p(f.x-u.x)<.001?"y":"x",w=p(m.x-g.x)<.001?"y":"x",y=N(u.x,u.y,f.x,f.y,g.x,g.y,m.x,m.y);if(y){if(a[y.x.toFixed(4)]==y.y.toFixed(4))continue;a[y.x.toFixed(4)]=y.y.toFixed(4);var b=u.t+p((y[v]-u[v])/(f[v]-u[v]))*(f.t-u.t),x=g.t+p((y[w]-g[w])/(m[w]-g[w]))*(m.t-g.t);b>=0&&b<=1&&x>=0&&x<=1&&(n?c++:c.push({x:y.x,y:y.y,t1:b,t2:x}))}}return c}function P(t,e){return T(t,e)}function L(t,e){return T(t,e,1)}function T(t,e,n){t=Y(t),e=Y(e);for(var i,r,s,o,a,c,h,d,l,u,f=n?0:[],g=0,p=t.length;g<p;g++){var m=t[g];if("M"==m[0])i=a=m[1],r=c=m[2];else{"C"==m[0]?(l=[i,r].concat(m.slice(1)),i=l[6],r=l[7]):(l=[i,r,i,r,a,c,a,c],i=a,r=c);for(var v=0,w=e.length;v<w;v++){var y=e[v];if("M"==y[0])s=h=y[1],o=d=y[2];else{"C"==y[0]?(u=[s,o].concat(y.slice(1)),s=u[6],o=u[7]):(u=[s,o,s,o,h,d,h,d],s=h,o=d);var b=M(l,u,n);if(n)f+=b;else{for(var x=0,C=b.length;x<C;x++)b[x].segment1=g,b[x].segment2=v,b[x].bez1=l,b[x].bez2=u;f=f.concat(b)}}}}}return f}function U(t,e,n){var i=W(t);return A(i,e,n)&&T(t,[["M",e,n],["H",i.x2+10]],1)%2==1}function W(t){var e=m(t);if(e.bbox)return o(e.bbox);if(!t)return v();for(var n,i=0,r=0,s=[],a=[],c=0,h=(t=Y(t)).length;c<h;c++)if("M"==(n=t[c])[0])i=n[1],r=n[2],s.push(i),a.push(r);else{var d=X(i,r,n[1],n[2],n[3],n[4],n[5],n[6]);s=s.concat(d.min.x,d.max.x),a=a.concat(d.min.y,d.max.y),i=n[5],r=n[6]}var l=u.apply(0,s),g=u.apply(0,a),p=v(l,g,f.apply(0,s)-l,f.apply(0,a)-g);return e.bbox=o(p),p}function O(t,e,n,i,r){if(r)return[["M",+t+ +r,e],["l",n-2*r,0],["a",r,r,0,0,1,r,r],["l",0,i-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-n,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-i],["a",r,r,0,0,1,r,-r],["z"]];var s=[["M",t,e],["l",n,0],["l",0,i],["l",-n,0],["z"]];return s.toString=w,s}function F(t,e,n,i,r){if(null==r&&null==i&&(i=n),t=+t,e=+e,n=+n,i=+i,null!=r)var s=Math.PI/180,o=t+n*Math.cos(-i*s),a=t+n*Math.cos(-r*s),c=[["M",o,e+n*Math.sin(-i*s)],["A",n,n,0,+(r-i>180),0,a,e+n*Math.sin(-r*s)]];else c=[["M",t,e],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]];return c.toString=w,c}var H=t._unit2px,I={path:function(t){return t.attr("path")},circle:function(t){var e=H(t);return F(e.cx,e.cy,e.r)},ellipse:function(t){var e=H(t);return F(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=H(t);return O(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=H(t);return O(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return O(e.x,e.y,e.width,e.height)}};function j(e){var n=m(e),i=String.prototype.toLowerCase;if(n.rel)return y(n.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var r=[],s=0,o=0,a=0,c=0,h=0;"M"==e[0][0]&&(a=s=e[0][1],c=o=e[0][2],h++,r.push(["M",s,o]));for(var d=h,l=e.length;d<l;d++){var u=r[d]=[],f=e[d];if(f[0]!=i.call(f[0]))switch(u[0]=i.call(f[0]),u[0]){case"a":u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=+(f[6]-s).toFixed(3),u[7]=+(f[7]-o).toFixed(3);break;case"v":u[1]=+(f[1]-o).toFixed(3);break;case"m":a=f[1],c=f[2];default:for(var g=1,p=f.length;g<p;g++)u[g]=+(f[g]-(g%2?s:o)).toFixed(3)}else{u=r[d]=[],"m"==f[0]&&(a=f[1]+s,c=f[2]+o);for(var v=0,b=f.length;v<b;v++)r[d][v]=f[v]}var x=r[d].length;switch(r[d][0]){case"z":s=a,o=c;break;case"h":s+=+r[d][x-1];break;case"v":o+=+r[d][x-1];break;default:s+=+r[d][x-2],o+=+r[d][x-1]}}return r.toString=w,n.rel=y(r),r}function V(e){var n=m(e);if(n.abs)return y(n.abs);if(s(e,"array")&&s(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var i,r=[],o=0,a=0,c=0,h=0,d=0;"M"==e[0][0]&&(c=o=+e[0][1],h=a=+e[0][2],d++,r[0]=["M",o,a]);for(var l,u,f=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),g=d,p=e.length;g<p;g++){if(r.push(l=[]),(i=(u=e[g])[0])!=i.toUpperCase())switch(l[0]=i.toUpperCase(),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+u[6]+o,l[7]=+u[7]+a;break;case"V":l[1]=+u[1]+a;break;case"H":l[1]=+u[1]+o;break;case"R":for(var v=[o,a].concat(u.slice(1)),b=2,x=v.length;b<x;b++)v[b]=+v[b]+o,v[++b]=+v[b]+a;r.pop(),r=r.concat(Q(v,f));break;case"O":r.pop(),(v=F(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);break;case"U":r.pop(),r=r.concat(F(o,a,u[1],u[2],u[3])),l=["U"].concat(r[r.length-1].slice(-2));break;case"M":c=+u[1]+o,h=+u[2]+a;default:for(b=1,x=u.length;b<x;b++)l[b]=+u[b]+(b%2?o:a)}else if("R"==i)v=[o,a].concat(u.slice(1)),r.pop(),r=r.concat(Q(v,f)),l=["R"].concat(u.slice(-2));else if("O"==i)r.pop(),(v=F(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);else if("U"==i)r.pop(),r=r.concat(F(o,a,u[1],u[2],u[3])),l=["U"].concat(r[r.length-1].slice(-2));else for(var C=0,_=u.length;C<_;C++)l[C]=u[C];if("O"!=(i=i.toUpperCase()))switch(l[0]){case"Z":o=+c,a=+h;break;case"H":o=l[1];break;case"V":a=l[1];break;case"M":c=l[l.length-2],h=l[l.length-1];default:o=l[l.length-2],a=l[l.length-1]}}return r.toString=w,n.abs=y(r),r}function z(t,e,n,i){return[t,e,n,i,n,i]}function q(t,e,n,i,r,s){var o=1/3,a=2/3;return[o*t+a*n,o*e+a*i,o*r+a*n,o*s+a*i,r,s]}function G(e,n,i,r,s,o,a,c,h,u){var f,g=120*l/180,m=l/180*(+s||0),v=[],w=t._.cacher((function(t,e,n){return{x:t*d.cos(n)-e*d.sin(n),y:t*d.sin(n)+e*d.cos(n)}}));if(u)A=u[0],k=u[1],R=u[2],D=u[3];else{e=(f=w(e,n,-m)).x,n=f.y;var y=(e-(c=(f=w(c,h,-m)).x))/2,b=(n-(h=f.y))/2,x=y*y/(i*i)+b*b/(r*r);x>1&&(i*=x=d.sqrt(x),r*=x);var C=i*i,_=r*r,S=(o==a?-1:1)*d.sqrt(p((C*_-C*b*b-_*y*y)/(C*b*b+_*y*y))),R=S*i*b/r+(e+c)/2,D=S*-r*y/i+(n+h)/2,A=d.asin(((n-D)/r).toFixed(9)),k=d.asin(((h-D)/r).toFixed(9));(A=e<R?l-A:A)<0&&(A=2*l+A),(k=c<R?l-k:k)<0&&(k=2*l+k),a&&A>k&&(A-=2*l),!a&&k>A&&(k-=2*l)}var E=k-A;if(p(E)>g){var B=k,$=c,N=h;k=A+g*(a&&k>A?1:-1),v=G(c=R+i*d.cos(k),h=D+r*d.sin(k),i,r,s,0,a,$,N,[k,B,R,D])}E=k-A;var M=d.cos(A),P=d.sin(A),L=d.cos(k),T=d.sin(k),U=d.tan(E/4),W=4/3*i*U,O=4/3*r*U,F=[e,n],H=[e+W*P,n-O*M],I=[c+W*T,h-O*L],j=[c,h];if(H[0]=2*F[0]-H[0],H[1]=2*F[1]-H[1],u)return[H,I,j].concat(v);for(var V=[],z=0,q=(v=[H,I,j].concat(v).join().split(",")).length;z<q;z++)V[z]=z%2?w(v[z-1],v[z],m).y:w(v[z],v[z+1],m).x;return V}function X(t,e,n,i,r,s,o,a){for(var c,h,l,g,m,v,w,y,b=[],x=[[],[]],C=0;C<2;++C)if(0==C?(h=6*t-12*n+6*r,c=-3*t+9*n-9*r+3*o,l=3*n-3*t):(h=6*e-12*i+6*s,c=-3*e+9*i-9*s+3*a,l=3*i-3*e),p(c)<1e-12){if(p(h)<1e-12)continue;0<(g=-l/h)&&g<1&&b.push(g)}else w=h*h-4*l*c,y=d.sqrt(w),w<0||(0<(m=(-h+y)/(2*c))&&m<1&&b.push(m),0<(v=(-h-y)/(2*c))&&v<1&&b.push(v));for(var _,S=b.length,R=S;S--;)_=1-(g=b[S]),x[0][S]=_*_*_*t+3*_*_*g*n+3*_*g*g*r+g*g*g*o,x[1][S]=_*_*_*e+3*_*_*g*i+3*_*g*g*s+g*g*g*a;return x[0][R]=t,x[1][R]=e,x[0][R+1]=o,x[1][R+1]=a,x[0].length=x[1].length=R+2,{min:{x:u.apply(0,x[0]),y:u.apply(0,x[1])},max:{x:f.apply(0,x[0]),y:f.apply(0,x[1])}}}function Y(t,e){var n=!e&&m(t);if(!e&&n.curve)return y(n.curve);for(var i=V(t),r=e&&V(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,n){var i,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(G.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(i=2*e.x-e.bx,r=2*e.y-e.by):(i=e.x,r=e.y),t=["C",i,r].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(q(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(q(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(z(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(z(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(z(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(z(e.x,e.y,e.X,e.Y))}return t},c=function(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)l[e]="A",r&&(u[e]="A"),t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),w=f(i.length,r&&r.length||0)}},d=function(t,e,n,s,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",s.x,s.y]),n.bx=0,n.by=0,n.x=t[o][1],n.y=t[o][2],w=f(i.length,r&&r.length||0))},l=[],u=[],g="",p="",v=0,w=f(i.length,r&&r.length||0);v<w;v++){i[v]&&(g=i[v][0]),"C"!=g&&(l[v]=g,v&&(p=l[v-1])),i[v]=a(i[v],s,p),"A"!=l[v]&&"C"==g&&(l[v]="C"),c(i,v),r&&(r[v]&&(g=r[v][0]),"C"!=g&&(u[v]=g,v&&(p=u[v-1])),r[v]=a(r[v],o,p),"A"!=u[v]&&"C"==g&&(u[v]="C"),c(r,v)),d(i,r,s,o,v),d(r,i,o,s,v);var b=i[v],x=r&&r[v],C=b.length,_=r&&x.length;s.x=b[C-2],s.y=b[C-1],s.bx=h(b[C-4])||s.x,s.by=h(b[C-3])||s.y,o.bx=r&&(h(x[_-4])||o.x),o.by=r&&(h(x[_-3])||o.y),o.x=r&&x[_-2],o.y=r&&x[_-1]}return r||(n.curve=y(i)),r?[i,r]:i}function Z(t,e){if(!e)return t;var n,i,r,s,o,a,c;for(r=0,o=(t=Y(t)).length;r<o;r++)for(s=1,a=(c=t[r]).length;s<a;s+=2)n=e.x(c[s],c[s+1]),i=e.y(c[s],c[s+1]),c[s]=n,c[s+1]=i;return t}function Q(t,e){for(var n=[],i=0,r=t.length;r-2*!e>i;i+=2){var s=[{x:+t[i-2],y:+t[i-1]},{x:+t[i],y:+t[i+1]},{x:+t[i+2],y:+t[i+3]},{x:+t[i+4],y:+t[i+5]}];e?i?r-4==i?s[3]={x:+t[0],y:+t[1]}:r-2==i&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[r-2],y:+t[r-1]}:r-4==i?s[3]=s[2]:i||(s[0]={x:+t[i],y:+t[i+1]}),n.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return n}t.path=m,t.path.getTotalLength=C,t.path.getPointAtLength=_,t.path.getSubpath=function(t,e,n){if(this.getTotalLength(t)-n<1e-6)return S(t,e).end;var i=S(t,n,1);return e?S(i,e).end:i},r.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},r.getPointAtLength=function(t){return _(this.attr("d"),t)},r.getSubpath=function(e,n){return t.path.getSubpath(this.attr("d"),e,n)},t._.box=v,t.path.findDotsAtSegment=R,t.path.bezierBBox=D,t.path.isPointInsideBBox=A,t.closest=function(e,n,i,r){for(var s=100,o=v(e-s/2,n-s/2,s,s),a=[],c=i[0].hasOwnProperty("x")?function(t){return{x:i[t].x,y:i[t].y}}:function(t){return{x:i[t],y:r[t]}},h=0;s<=1e6&&!h;){for(var d=0,l=i.length;d<l;d++){var u=c(d);if(A(o,u.x,u.y)){h++,a.push(u);break}}h||(o=v(e-(s*=2)/2,n-s/2,s,s))}if(1e6!=s){var f,g=1/0;for(d=0,l=a.length;d<l;d++){var p=t.len(e,n,a[d].x,a[d].y);g>p&&(g=p,a[d].len=p,f=a[d])}return f}},t.path.isBBoxIntersect=k,t.path.intersection=P,t.path.intersectionNumber=L,t.path.isPointInside=U,t.path.getBBox=W,t.path.get=I,t.path.toRelative=j,t.path.toAbsolute=V,t.path.toCubic=Y,t.path.map=Z,t.path.toString=w,t.path.clone=y})),i.plugin((function(t,i,r,s){var o=Math.max,a=Math.min,c=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,n=t.length;e<n;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},h=c.prototype;h.push=function(){for(var t,e,n=0,i=arguments.length;n<i;n++)(t=arguments[n])&&(this[e=this.items.length]=this.items[e]=t,this.length++);return this},h.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},h.forEach=function(t,e){for(var n=0,i=this.items.length;n<i;n++)if(!1===t.call(e,this.items[n],n))return this;return this},h.animate=function(i,r,s,o){"function"!=typeof s||s.length||(o=s,s=n.linear),i instanceof t._.Animation&&(o=i.callback,s=i.easing,r=s.dur,i=i.attr);var a=arguments;if(t.is(i,"array")&&t.is(a[a.length-1],"array"))var c=!0;var h,d=function(){h?this.b=h:h=this.b},l=0,u=this,f=o&&function(){++l==u.length&&o.call(this)};return this.forEach((function(t,n){e.once("snap.animcreated."+t.id,d),c?a[n]&&t.animate.apply(t,a[n]):t.animate(i,r,s,f)}))},h.remove=function(){for(;this.length;)this.pop().remove();return this},h.bind=function(t,e,n){var i={};if("function"==typeof e)this.bindings[t]=e;else{var r=n||t;this.bindings[t]=function(t){i[r]=t,e.attr(i)}}return this},h.attr=function(t){var e={};for(var n in t)this.bindings[n]?this.bindings[n](t[n]):e[n]=t[n];for(var i=0,r=this.items.length;i<r;i++)this.items[i].attr(e);return this},h.clear=function(){for(;this.length;)this.pop()},h.splice=function(t,e,n){t=t<0?o(this.length+t,0):t,e=o(0,a(this.length-t,e));var i,r=[],s=[],h=[];for(i=2;i<arguments.length;i++)h.push(arguments[i]);for(i=0;i<e;i++)s.push(this[t+i]);for(;i<this.length-t;i++)r.push(this[t+i]);var d=h.length;for(i=0;i<d+r.length;i++)this.items[t+i]=this[t+i]=i<d?h[i]:r[i-d];for(i=this.items.length=this.length-=e-d;this[i];)delete this[i++];return new c(s)},h.exclude=function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},h.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},h.getBBox=function(){for(var t=[],e=[],n=[],i=[],r=this.items.length;r--;)if(!this.items[r].removed){var s=this.items[r].getBBox();t.push(s.x),e.push(s.y),n.push(s.x+s.width),i.push(s.y+s.height)}return{x:t=a.apply(0,t),y:e=a.apply(0,e),x2:n=o.apply(0,n),y2:i=o.apply(0,i),width:n-t,height:i-e,cx:t+(n-t)/2,cy:e+(i-e)/2}},h.clone=function(t){t=new c;for(var e=0,n=this.items.length;e<n;e++)t.push(this.items[e].clone());return t},h.toString=function(){return"Snap‘s set"},h.type="set",t.Set=c,t.set=function(){var t=new c;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}})),i.plugin((function(t,n,i,r){var s={},o=/[a-z]+$/i,a=String;function c(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function h(e,n,i){n=a(n).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],n=t.parseTransformString(n)||[];for(var r,s,o,h,d=Math.max(e.length,n.length),l=[],u=[],f=0;f<d;f++){if(o=e[f]||c(n[f]),h=n[f]||c(o),o[0]!=h[0]||"r"==o[0].toLowerCase()&&(o[2]!=h[2]||o[3]!=h[3])||"s"==o[0].toLowerCase()&&(o[3]!=h[3]||o[4]!=h[4])){e=t._.transform2matrix(e,i()),n=t._.transform2matrix(n,i()),l=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],u=[["m",n.a,n.b,n.c,n.d,n.e,n.f]];break}for(l[f]=[],u[f]=[],r=0,s=Math.max(o.length,h.length);r<s;r++)r in o&&(l[f][r]=o[r]),r in h&&(u[f][r]=h[r])}return{from:p(l),to:p(u),f:g(l)}}function d(t){return t}function l(t){return function(e){return+e.toFixed(3)+t}}function u(t){return t.join(" ")}function f(e){return t.rgb(e[0],e[1],e[2])}function g(t){var e,n,i,r,s,o,a=0,c=[];for(e=0,n=t.length;e<n;e++){for(s="[",o=['"'+t[e][0]+'"'],i=1,r=t[e].length;i<r;i++)o[i]="val["+a+++"]";s+=o+"]",c[e]=s}return Function("val","return Snap.path.toString.call(["+c+"])")}function p(t){for(var e=[],n=0,i=t.length;n<i;n++)for(var r=1,s=t[n].length;r<s;r++)e.push(t[n][r]);return e}function m(t){return isFinite(parseFloat(t))}function v(e,n){return!(!t.is(e,"array")||!t.is(n,"array"))&&e.toString()==n.toString()}s.stroke=s.fill="colour",n.prototype.equal=function(t,n){return e("snap.util.equal",this,t,n).firstDefined()},e.on("snap.util.equal",(function(e,n){var i,r,c=a(this.attr(e)||""),w=this;if(m(c)&&m(n))return{from:parseFloat(c),to:parseFloat(n),f:d};if("colour"==s[e])return i=t.color(c),r=t.color(n),{from:[i.r,i.g,i.b,i.opacity],to:[r.r,r.g,r.b,r.opacity],f:f};if("viewBox"==e)return{from:i=this.attr(e).vb.split(" ").map(Number),to:r=n.split(" ").map(Number),f:u};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return n instanceof t.Matrix&&(n=n.toTransformString()),t._.rgTransform.test(n)||(n=t._.svgTransform2string(n)),h(c,n,(function(){return w.getBBox(1)}));if("d"==e||"path"==e)return{from:p((i=t.path.toCubic(c,n))[0]),to:p(i[1]),f:g(i[0])};if("points"==e)return{from:i=a(c).split(t._.separator),to:r=a(n).split(t._.separator),f:function(t){return t}};var y=c.match(o),b=a(n).match(o);return y&&v(y,b)?{from:parseFloat(c),to:parseFloat(n),f:l(y)}:{from:this.asPX(e),to:this.asPX(e,n),f:d}}))})),i.plugin((function(t,n,i,r){for(var s=n.prototype,o="hasOwnProperty",a=("createTouch"in r.doc),c=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],h={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},d=function(t,e){var n="y"==t?"scrollTop":"scrollLeft",i=e&&e.node?e.node.ownerDocument:r.doc;return i[n in i.documentElement?"documentElement":"body"][n]},l=function(){return this.originalEvent.preventDefault()},u=function(){return this.originalEvent.stopPropagation()},f=function(t,e,n,i){var r=a&&h[e]?h[e]:e,s=function(r){var s=d("y",i),c=d("x",i);if(a&&h[o](e))for(var f=0,g=r.targetTouches&&r.targetTouches.length;f<g;f++)if(r.targetTouches[f].target==t||t.contains(r.targetTouches[f].target)){var p=r;(r=r.targetTouches[f]).originalEvent=p,r.preventDefault=l,r.stopPropagation=u;break}var m=r.clientX+c,v=r.clientY+s;return n.call(i,r,m,v)};return e!==r&&t.addEventListener(e,s,!1),t.addEventListener(r,s,!1),function(){return e!==r&&t.removeEventListener(e,s,!1),t.removeEventListener(r,s,!1),!0}},g=[],p=function(t){for(var n,i=t.clientX,r=t.clientY,s=d("y"),o=d("x"),c=g.length;c--;){if(n=g[c],a){for(var h,l=t.touches&&t.touches.length;l--;)if((h=t.touches[l]).identifier==n.el._drag.id||n.el.node.contains(h.target)){i=h.clientX,r=h.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var u=n.el.node;u.nextSibling,u.parentNode,u.style.display,i+=o,r+=s,e("snap.drag.move."+n.el.id,n.move_scope||n.el,i-n.el._drag.x,r-n.el._drag.y,i,r,t)}},m=function(n){t.unmousemove(p).unmouseup(m);for(var i,r=g.length;r--;)(i=g[r]).el._drag={},e("snap.drag.end."+i.el.id,i.end_scope||i.start_scope||i.move_scope||i.el,n),e.off("snap.drag.*."+i.el.id);g=[]},v=c.length;v--;)!function(e){t[e]=s[e]=function(n,i){if(t.is(n,"function"))this.events=this.events||[],this.events.push({name:e,f:n,unbind:f(this.node||document,e,n,i||this)});else for(var r=0,s=this.events.length;r<s;r++)if(this.events[r].name==e)try{this.events[r].f.call(this)}catch(t){}return this},t["un"+e]=s["un"+e]=function(t){for(var n=this.events||[],i=n.length;i--;)if(n[i].name==e&&(n[i].f==t||!t))return n[i].unbind(),n.splice(i,1),!n.length&&delete this.events,this;return this}}(c[v]);s.hover=function(t,e,n,i){return this.mouseover(t,n).mouseout(e,i||n)},s.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var w=[];s.drag=function(n,i,r,s,o,a){var c,h=this;if(!arguments.length)return h.drag((function(t,e){this.attr({transform:c+(c?"T":"t")+[t,e]})}),(function(){c=this.transform().local}));function d(c,d,l){(c.originalEvent||c).preventDefault(),h._drag.x=d,h._drag.y=l,h._drag.id=c.identifier,!g.length&&t.mousemove(p).mouseup(m),g.push({el:h,move_scope:s,start_scope:o,end_scope:a}),i&&e.on("snap.drag.start."+h.id,i),n&&e.on("snap.drag.move."+h.id,n),r&&e.on("snap.drag.end."+h.id,r),e("snap.drag.start."+h.id,o||s||h,d,l,c)}function l(t,n,i){e("snap.draginit."+h.id,h,t,n,i)}return e.on("snap.draginit."+h.id,d),h._drag={},w.push({el:h,start:d,init:l}),h.mousedown(l),h},s.undrag=function(){for(var n=w.length;n--;)w[n].el==this&&(this.unmousedown(w[n].init),w.splice(n,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!w.length&&t.unmousemove(p).unmouseup(m),this}})),i.plugin((function(t,n,i,r){n.prototype;var s=i.prototype,o=/^\s*url\((.+)\)/,a=String,c=t._.$;t.filter={},s.filter=function(e){var i=this;"svg"!=i.type&&(i=i.paper);var r=t.parse(a(e)),s=t._.id();i.node.offsetWidth,i.node.offsetHeight;var o=c("filter");return c(o,{id:s,filterUnits:"userSpaceOnUse"}),o.appendChild(r.node),i.defs.appendChild(o),new n(o)},e.on("snap.util.getattr.filter",(function(){e.stop();var n=c(this.node,"filter");if(n){var i=a(n).match(o);return i&&t.select(i[1])}})),e.on("snap.util.attr.filter",(function(i){if(i instanceof n&&"filter"==i.type){e.stop();var r=i.node.id;r||(c(i.node,{id:i.id}),r=i.id),c(this.node,{filter:t.url(r)})}i&&"none"!=i||(e.stop(),this.node.removeAttribute("filter"))})),t.filter.blur=function(e,n){null==e&&(e=2);var i=null==n?e:[e,n];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:i})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,n,i,r,s){return"string"==typeof i&&(s=r=i,i=4),"string"!=typeof r&&(s=r,r="#000"),r=r||"#000",null==i&&(i=4),null==s&&(s=1),null==e&&(e=0,n=2),null==n&&(n=e),r=t.color(r),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:r,dx:e,dy:n,blur:i,opacity:s})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}})),i.plugin((function(t,e,n,i,r){var s=t._.box,o=t.is,a=/^[^a-z]*([tbmlrc])/i,c=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&o(t,"string")&&(e=t,t=null);var n=(t=t||this.paper).getBBox?t.getBBox():s(t),i=this.getBBox(),r={};switch(e=(e=e&&e.match(a))?e[1].toLowerCase():"c"){case"t":r.dx=0,r.dy=n.y-i.y;break;case"b":r.dx=0,r.dy=n.y2-i.y2;break;case"m":r.dx=0,r.dy=n.cy-i.cy;break;case"l":r.dx=n.x-i.x,r.dy=0;break;case"r":r.dx=n.x2-i.x2,r.dy=0;break;default:r.dx=n.cx-i.cx,r.dy=0}return r.toString=c,r},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}})),i}(n,i)}));class wt{static roseLegendAttribute(t){return{fill:t,"font-size":25,"font-family":"arial","text-anchor":"middle","dominant-baseline":"middle"}}static windBarAttribute(t,e,n,i){return{fill:t,"font-size":e,"font-family":"Arial","text-anchor":i,"dominant-baseline":n}}}wt.directionLettersAttribute={fill:"white","font-size":50,"font-family":"arial"};class yt{constructor(t){this.svg=t}drawLine(t){return this.svg.line(t.startPoint.x,t.startPoint.y,t.endPoint.x,t.endPoint.y)}drawRect(t){return this.svg.rect(t.startPoint.x,t.startPoint.y,t.width,t.height)}drawPolyRect(t){return this.svg.path(vt.format("M {x} {y} l {w} 0 l 0 {h} l {wn} 0 Z",{x:t.startPoint.x,y:t.startPoint.y,w:t.width,wn:-1*t.width,h:t.height}))}drawTriangle(t,e,n,i,r,s){return this.svg.path(vt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} Z",{x:t,y:e,dx1:n,dy1:i,dx2:r,dy2:s}))}drawArrow(t,e,n){return this.svg.path(vt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} l {dx3} {dy3} Z",{x:t,y:e,dx1:-n,dy1:-n/2,dx2:n/4,dy2:n/2,dx3:-n/4,dy3:n/2}))}drawWindDirectionText(t,e,n,i){var r=this.drawText(t,e,wt.windBarAttribute(i,50,"middle","middle"));return this.rotate(r,n,t),r}rotate(t,e,n){t.transform(vt.format("r{deg},{x},{y}",{deg:e,x:n.x,y:n.y}))}drawCircle(t){return this.svg.circle(t.centerPoint.x,t.centerPoint.y,t.radius)}drawText(t,e,n){var i=this.svg.text(t.x,t.y,e);return i.attr(n),i}}class bt{constructor(t,e){this.startPoint=t,this.endPoint=e}}class xt{constructor(t,e){this.x=t,this.y=e}}class Ct{constructor(t,e){this.centerPoint=t,this.radius=e}}class _t{constructor(t){this.cfg=t}roseCenter(){return new xt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius)}crossHorizontalLine(){var t=this.cfg.marginTop+this.cfg.roseRadius;return new bt(new xt(this.cfg.marginLeft,t),new xt(this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius,t))}crossVerticalLine(){var t=this.cfg.marginLeft+this.cfg.roseRadius;return new bt(new xt(t,this.cfg.marginTop),new xt(t,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius))}roseCircle(t){return new Ct(new xt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius),t)}viewBox(){if("right"===this.cfg.barLocation)return this.viewBoxBarRight();if("bottom"===this.cfg.barLocation)return this.viewBoxBarBotton();throw new Error("Bar location should be right or bottom not: "+this.cfg.barLocation)}viewBoxBarRight(){var t=this.cfg.barRight,e=this.cfg.roseRadius+this.cfg.roseRadius,n=this.cfg.marginTop+e+this.cfg.marginBottom;return"0 0 "+(1===this.cfg.barCount?this.cfg.marginLeft+e+this.cfg.marginRight+t.barMarginLeft+t.barWidth+t.barMarginRight:this.cfg.marginLeft+e+this.cfg.marginRight+t.barWidth*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+this.cfg.marginRight)+" "+n}viewBoxBarBotton(){var t=this.cfg.barBottom,e=this.cfg.roseRadius+this.cfg.roseRadius;return"0 0 "+(this.cfg.marginLeft+e+this.cfg.marginRight)+" "+(1===this.cfg.barCount?this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight+t.barMarginBottom:this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+t.barMarginBottom)}north(){return new xt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop-this.cfg.directionLetterMargin)}east(){return new xt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}south(){return new xt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin)}west(){return new xt(this.cfg.marginLeft-this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}}class St{constructor(t,e,n){this.config=t,this.speedRanges=n,this.dimensionCalculator=new _t(e)}drawWindRose(t,e){if(void 0===t)return void ct.error("drawWindRose(): Can't draw, no windrose data set.");ct.trace("drawWindRose()",t),this.svgUtil=new yt(e),e.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const n=this.drawBackgroundLines(e),i=this.drawWindDirectionText(e),r=this.drawWindDirections(e);if(0!=this.config.windRoseDrawNorthOffset){const t=e.group(i,r,n);var s=this.dimensionCalculator.roseCenter();t.transform("r"+this.config.windRoseDrawNorthOffset+","+s.x+","+s.y)}this.drawCircleLegend(e)}drawWindDirections(t){const e=t.group();for(let n=0;n<this.windRoseData.directionPercentages.length;n++)e.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[n],this.windRoseData.directionPercentages[n],this.windRoseData.directionDegrees[n],t));return e}drawWindDirection(t,e,n,i){const r=i.group();if(0===e)return r;const s=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(s[e]=t[e],t[e]>0)for(let n=e-1;n>=0;n--)s[e]+=t[n];const o=e*this.dimensionCalculator.cfg.roseRadius/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=o*(s[t]/100);e>0&&(ct.trace("Degrees: "+(n-90)+" radius: "+e+" percentage: "+s[t]),r.add(this.drawSpeedPart(i,n-90,e,this.speedRanges[t].color)))}return r}drawSpeedPart(t,e,n,i){ct.trace("Degrees 1"+(e-this.config.leaveArc/2)),ct.trace("Degrees 2"+(e+this.config.leaveArc/2)),ct.trace("Color: "+i);var r=ft.toRadians(e-this.config.leaveArc/2),s=ft.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*n),c=o.y+Math.round(Math.sin(r)*n),h=o.x+Math.round(Math.cos(s)*n),d=o.y+Math.round(Math.sin(s)*n);return ct.trace("Coords: ",o.x,o.y,a,c,h,d,i),t.path(vt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:c,x2:h,y2:d,radius:n})).attr({fill:i,stroke:this.config.roseLinesColor})}drawBackgroundLines(t){var e=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),n=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=t.group(e,n);const r=this.windRoseData.circleCount,s=this.dimensionCalculator.cfg.roseRadius/r;for(let t=1;t<=r;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(s*t)));return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(t){this.config.cardinalDirectionLetters;const e=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),n=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),i=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),r=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor);return t.group(e,n,i,r)}drawCircleLegend(t){const e=t.group(),n=this.dimensionCalculator.cfg.roseRadius/this.windRoseData.circleCount,i=Math.cos(ft.toRadians(45))*n,r=this.dimensionCalculator.roseCenter();for(let t=1;t<=this.windRoseData.circleCount;t++){const n=new xt(r.x+i*t,r.y+i*t),s=this.svgUtil.drawText(n,this.windRoseData.percentagePerCircle*t+"%",wt.roseLegendAttribute(this.config.rosePercentagesColor));e.add(s)}return e}}class Rt{constructor(t,e,n){this.startPoint=t,this.width=e,this.height=n}}class Dt{constructor(t){this.cfg=t}barRectBottom(t){var e=this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginBottom;return t>0&&(e+=(this.cfg.barBottom.barHeight+this.cfg.barBottom.multiBarSpacing)*t),new Rt(new xt(this.cfg.barBottom.barMarginLeft,e),this.cfg.barBottom.barLength,this.cfg.barBottom.barHeight)}barRectRight(t){var e=this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginRight+this.cfg.barRight.barMarginLeft;return t>0&&(e+=(this.cfg.barRight.barWidth+this.cfg.barRight.multiBarSpacing)*t),new Rt(new xt(e,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius),this.cfg.barRight.barWidth,this.cfg.barRight.barHeight)}}class At{getColorArray(t){const e=[];for(let n=0;n<t;n++){const i=240-240/(t-1)*n;e.push(`hsl(${i}, 100%, 60%)`)}return e}static getTextColorBasedOnBackground(t){const e=At.getRgbColor(t);if(void 0===e)return"black";let n=e[0],i=e[1],r=e[2];return n/=255,i/=255,r/=255,n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*n+.7152*i+.0722*r>.179?"#000000":"#FFFFFF"}static getRgbColor(t){let e=document.createElement("div");e.style.color=t,document.body.appendChild(e);let n=window.getComputedStyle(e).color;if(document.body.removeChild(e),n)return n.match(/\d+/g).map(Number)}}class kt{constructor(t,e,n,i){ct.debug("WindBarRenderer init",t,n),this.config=t,t.outputUnitLabel?this.outputUnitName=t.outputUnitLabel:t.speedRangeBeaufort?this.outputUnitName="Beaufort":this.outputUnitName=n.name,this.speedRanges=n.speedRanges,this.positionIndex=i,this.dimensionCalculator=new Dt(e)}drawWindBar(t,e){void 0!==t?(ct.trace("drawWindBar(): ",t),this.svgUtil=new yt(e),"horizontal"===this.config.orientation?this.drawBarLegendHorizontal(t.speedRangePercentages):"vertical"===this.config.orientation&&this.drawBarLegendVertical(t.speedRangePercentages)):ct.error("drawWindBar(): Can't draw bar, windRoseData not set.")}drawBarLegendVertical(t){const e=40,n=this.dimensionCalculator.barRectRight(this.positionIndex);let i=t.length;this.config.full||(i=this.getIndexHighestRangeWithMeasurements(t));const r=this.dimensionCalculator.cfg.barRight.barHeight/i,s=this.speedRanges[i-1].minSpeed;this.svgUtil.drawText(new xt(n.startPoint.x-10,n.startPoint.y),this.config.label,wt.windBarAttribute(this.config.barNameColor,e,"auto","left")).transform("r270,"+(n.startPoint.x-10)+","+n.startPoint.y);const o=n.startPoint.x;let a=n.startPoint.y;for(let d=0;d<i;d++){this.config.renderRelativeScale&&d!==i-1?length=(this.speedRanges[d+1].minSpeed-this.speedRanges[d].minSpeed)*((this.dimensionCalculator.cfg.barRight.barHeight-r)/s)*-1:length=-1*r;if(this.svgUtil.drawPolyRect(new Rt(new xt(o,a),n.width,length)).attr({fill:this.speedRanges[d].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort?12==d?this.svgUtil.drawText(new xt(o+n.width+10,a),d+"",wt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new xt(o+n.width+10,a+length/2),d+"",wt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new xt(o+n.width+10,a),this.speedRanges[d].minSpeed+"",wt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),t[d]>0){var c=Math.round(t[d]),h=100===c?35:e;let i=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[d].color);this.svgUtil.drawText(new xt(o+n.width/2,a+length/2),`${c}%`,wt.windBarAttribute(i,h,"middle","middle"))}a+=length}!this.config.speedRangeBeaufort&&!this.config.full&&i<t.length&&this.svgUtil.drawText(new xt(o+n.width+10,a),this.speedRanges[i].minSpeed+"",wt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),this.svgUtil.drawText(new xt(o+n.width/2,n.startPoint.y-n.height-15),this.outputUnitName,wt.windBarAttribute(this.config.barUnitNameColor,e,"auto","middle"))}drawBarLegendHorizontal(t){const e=this.dimensionCalculator.barRectBottom(this.positionIndex);let n=t.length;this.config.full||(n=this.getIndexHighestRangeWithMeasurements(t));const i=this.dimensionCalculator.cfg.barBottom.barLength/n,r=this.speedRanges[n-1].minSpeed,s=new xt(e.startPoint.x,e.startPoint.y-10);this.svgUtil.drawText(s,this.config.label,wt.windBarAttribute(this.config.barNameColor,35,"auto","start"));let o=e.startPoint.x;const a=e.startPoint.y;for(let s=0;s<n;s++){if(this.config.renderRelativeScale&&s!==n-1?length=(this.speedRanges[s+1].minSpeed-this.speedRanges[s].minSpeed)*((this.dimensionCalculator.cfg.barBottom.barLength-i)/r):length=i,this.svgUtil.drawRect(new Rt(new xt(o,a),length,e.height)).attr({fill:this.speedRanges[s].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort){const t=new xt(o+length/2,a+e.height+10);this.svgUtil.drawText(t,s+"",wt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}else{const t=new xt(o,a+e.height+10);this.svgUtil.drawText(t,this.speedRanges[s].minSpeed+"",wt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}if(t[s]>0){const n=new xt(o+length/2,a+e.height/2+2);let i=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[s].color);this.svgUtil.drawText(n,`${Math.round(t[s])}%`,wt.windBarAttribute(i,35,"middle","middle"))}o+=length}if(!this.config.speedRangeBeaufort&&!this.config.full&&n<t.length){const t=new xt(o,a+e.height+3);this.svgUtil.drawText(t,this.speedRanges[n].minSpeed+"",wt.windBarAttribute(this.config.barUnitValuesColor,35,"hanging","middle"))}const c=new xt(e.startPoint.x+e.width,e.startPoint.y-10);this.svgUtil.drawText(c,this.outputUnitName,wt.windBarAttribute(this.config.barUnitNameColor,35,"auto","end"))}getIndexHighestRangeWithMeasurements(t){for(let e=t.length-1;e>=0;e--)if(t[e]>0)return e+1;return t.length}getPercentageTextColor(t,e){return"auto"===t?At.getTextColorBasedOnBackground(e):t}}class Et{constructor(t,e,n,i,r,s,o){this.speedRangePercentages=t,this.directionSpeedRangePercentages=e,this.directionPercentages=n,this.directionDegrees=i,this.circleCount=r,this.percentagePerCircle=s,this.maxCirclePercentage=o}}class Bt{calculate(t){const e=Math.max(...t.directionTotals);ct.trace("Max direction total:",e);const n=this.calculateSpeedRangePercentages(t.speedRangeCounts,t.total);ct.trace("Speed range percentages:",n);const i=this.calculateDirectionSpeedRangePercentages(t.directionSpeedRangeCounts,t.directionTotals);ct.trace("Direction speed range percentages:",i);const r=this.calculateDirectionPercentages(t.directionTotals,t.total);ct.trace("Direction percentages:",r);const s=t.speedRangeDegrees;ct.trace("Direction degrees:",s);const o=this.calculateCirclePercentages(e,t.total);return ct.trace("Number of circles:",o[0]),ct.trace("Percentage per circle:",o[1]),ct.trace("Max circle percentage:",o[2]),new Et(n,i,r,s,o[0],o[1],o[2])}calculateSpeedRangePercentages(t,e){const n=e/100,i=[];for(const e of t)i.push(e/n);return i}calculateDirectionSpeedRangePercentages(t,e){const n=[];for(let i=0;i<e.length;i++){const r=[],s=e[i]/100;for(const e of t[i])0===s?r.push(0):r.push(e/s);n.push(r)}return n}calculateDirectionPercentages(t,e){const n=e/100,i=[];for(const e of t)i.push(e/n);return i}calculateCirclePercentages(t,e){const n=t/(e/100);let i=0,r=0;return n<=30?(i=Math.ceil(n/6),r=Math.ceil(n/i)):(i=Math.ceil(n/5),r=5),[r,i,r*i]}}class $t{constructor(t,e,n,i,r,s){this.name=t,this.configs=e,this.toMpsFunc=n,this.fromMpsFunc=i,this.speedRangeStep=r,this.speedRangeMax=s,this.speedRanges=[]}}class Nt{constructor(t,e,n,i,r){this.outputUnit=t,this.rangeBeaufort=e,this.rangeStep=n,this.rangeMax=i,this.speedRanges=r,this.bft=new $t("Beaufort",["bft","Beaufort"],(t=>{switch(t){case 0:default:return 0;case 1:return 1;case 2:return 2.5;case 3:return 4;case 4:return 6.5;case 5:return 9;case 6:return 12;case 7:return 15.5;case 8:return 18.5;case 9:return 22.5;case 10:return 26.5;case 11:return 30;case 12:return 34}}),(t=>t),void 0,void 0),this.mps=new $t("m/s",["mps","m/s"],(t=>t),(t=>t),5,30),this.kph=new $t("km/h",["kph","km/h"],(t=>t/3.6),(t=>3.6*t),10,100),this.mph=new $t("m/h",["mph","m/h"],(t=>t/2.2369),(t=>2.2369*t),10,70),this.fps=new $t("ft/s",["fps","ft/s"],(t=>t/3.2808399),(t=>3.2808399*t),10,100),this.knots=new $t("knots",["knots","kts","knts","kn"],(t=>t/1.9438444924406),(t=>1.9438444924406*t),5,60),this.units=[this.bft,this.mps,this.kph,this.mph,this.fps,this.knots],this.outputSpeedUnit=this.getSpeedUnit(this.outputUnit),!0===e?this.outputSpeedUnit.speedRanges=this.generateBeaufortSpeedRanges(t):r&&r.length>0?this.outputSpeedUnit.speedRanges=r:this.outputSpeedUnit.speedRanges=n&&i?this.generateSpeedRanges(n,i):this.generateSpeedRanges(this.outputSpeedUnit.speedRangeStep,this.outputSpeedUnit.speedRangeMax),ct.trace("Speed ranges: ",this.outputSpeedUnit.speedRanges)}getOutputSpeedUnit(){return this.outputSpeedUnit}getSpeedConverter(t){if(t===this.outputUnit)return t=>t;if("mps"===t)return this.outputSpeedUnit.fromMpsFunc;const e=this.getSpeedUnit(t).toMpsFunc,n=this.outputSpeedUnit.fromMpsFunc;return t=>n(e(t))}getRangeFunction(){return t=>{const e=this.outputSpeedUnit.speedRanges.find((e=>e.isRangeMatch(t)));if(e)return e.range;throw new Error("Speed is not in a speedrange: "+t+" unit: "+this.outputUnit)}}getSpeedRanges(){return this.outputSpeedUnit.speedRanges}getSpeedUnit(t){const e=this.units.find((e=>e.configs.includes(t)));if(void 0===e)throw new Error("Unknown speed unit: "+t);return ct.debug(`Matched speedunit ${e.name}`),e}generateSpeedRanges(t,e){const n=(new At).getColorArray(Math.floor(e/t)+1),i=[];let r=0,s=0;for(;r<=e-t;)i.push(new ot(s,r,r+t,n[s])),s++,r+=t;return i.push(new ot(s,r,-1,n[s])),i}generateBeaufortSpeedRanges(t){const e=(new At).getColorArray(13);if(void 0===t||"mps"===t)return[new ot(0,0,.5,e[0]),new ot(1,.5,1.6,e[1]),new ot(2,1.6,3.4,e[2]),new ot(3,3.4,5.5,e[3]),new ot(4,5.5,8,e[4]),new ot(5,8,10.8,e[5]),new ot(6,10.8,13.9,e[6]),new ot(7,13.9,17.2,e[7]),new ot(8,17.2,20.8,e[8]),new ot(9,20.8,24.5,e[9]),new ot(10,24.5,28.5,e[10]),new ot(11,28.5,32.7,e[11]),new ot(12,32.7,-1,e[12])];if("kph"===t)return[new ot(0,0,2,e[0]),new ot(1,2,6,e[1]),new ot(2,6,12,e[2]),new ot(3,12,20,e[3]),new ot(4,20,29,e[4]),new ot(5,29,39,e[5]),new ot(6,39,50,e[6]),new ot(7,50,62,e[7]),new ot(8,62,75,e[8]),new ot(9,75,89,e[9]),new ot(10,89,103,e[10]),new ot(11,103,118,e[11]),new ot(12,118,-1,e[12])];if("mph"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,8,e[2]),new ot(3,8,13,e[3]),new ot(4,13,19,e[4]),new ot(5,19,25,e[5]),new ot(6,25,32,e[6]),new ot(7,32,39,e[7]),new ot(8,39,47,e[8]),new ot(9,47,55,e[9]),new ot(10,55,64,e[10]),new ot(11,64,73,e[11]),new ot(12,73,-1,e[12])];if("fps"===t)return[new ot(0,0,1.6,e[0]),new ot(1,1.6,5.2,e[1]),new ot(2,5.2,11.2,e[2]),new ot(3,11.2,18,e[3]),new ot(4,18,26.2,e[4]),new ot(5,26.2,35.4,e[5]),new ot(6,35.4,45.6,e[6]),new ot(7,45.6,56.4,e[7]),new ot(8,56.4,68.2,e[8]),new ot(9,68.2,80.4,e[9]),new ot(10,80.4,93.5,e[10]),new ot(11,93.5,107,e[11]),new ot(12,107,-1,e[12])];if("knots"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,7,e[2]),new ot(3,7,11,e[3]),new ot(4,11,17,e[4]),new ot(5,17,22,e[5]),new ot(6,22,28,e[6]),new ot(7,28,34,e[7]),new ot(8,34,41,e[8]),new ot(9,41,48,e[9]),new ot(10,48,56,e[10]),new ot(11,56,64,e[11]),new ot(12,64,-1,e[12])];throw new Error("No Bft reanges for type: "+t)}}class Mt{constructor(t,e,n,i,r,s,o,a,c,h,d,l,u){this.centerRadius=t,this.windDirectionCount=e,this.windDirectionUnit=n,this.windDirectionLetters=i,this.leaveArc=r,this.cardinalDirectionLetters=s,this.directionCompensation=o,this.windRoseDrawNorthOffset=a,this.roseLinesColor=c,this.roseDirectionLettersColor=h,this.roseCenterPercentageColor=d,this.rosePercentagesColor=l,this.roseCurrentDirectionArrowColor=u}}class Pt{constructor(t,e,n,i,r,s,o,a,c,h,d){this.label=t,this.orientation=e,this.full=n,this.renderRelativeScale=i,this.outputUnitLabel=r,this.speedRangeBeaufort=s,this.barBorderColor=o,this.barUnitNameColor=a,this.barNameColor=c,this.barUnitValuesColor=h,this.barPercentagesColor=d}}class Lt{constructor(t){this.cardConfig=t}createWindRoseConfig(){return new Mt(60,this.cardConfig.windDirectionCount,this.cardConfig.windDirectionEntity.directionUnit,this.cardConfig.windDirectionEntity.directionLetters,360/this.cardConfig.windDirectionCount-8,this.cardConfig.cardinalDirectionLetters,this.cardConfig.windDirectionEntity.directionCompensation,this.cardConfig.windRoseDrawNorthOffset,this.cardConfig.cardColor.roseLines,this.cardConfig.cardColor.roseDirectionLetters,this.cardConfig.cardColor.roseCenterPercentage,this.cardConfig.cardColor.rosePercentages,this.cardConfig.cardColor.roseCurrentDirectionArrow)}createWindBarConfigs(){const t=[];for(let e=0;e<this.cardConfig.windspeedEntities.length;e++){const n=this.cardConfig.windspeedEntities[e];let i;if("bottom"===this.cardConfig.windspeedBarLocation)i=new Pt(n.name,"horizontal",this.cardConfig.windspeedBarFull,n.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages);else{if("right"!==this.cardConfig.windspeedBarLocation)throw Error("Unknown windspeed bar location: "+this.cardConfig.windspeedBarLocation);i=new Pt(n.name,"vertical",this.cardConfig.windspeedBarFull,n.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages)}t.push(i)}return t}}class Tt{constructor(){this.total=0,this.speedRangeDegrees=[],this.speedRangeCounts=[],this.directionTotals=[],this.directionSpeedRangeCounts=[]}init(t,e){this.total=0,this.speedRangeCounts=new Array(t).fill(0),this.directionTotals=new Array(e).fill(0),this.directionSpeedRangeCounts=new Array(e).fill([]);for(let e=0;e<this.directionSpeedRangeCounts.length;e++)this.directionSpeedRangeCounts[e]=new Array(t).fill(0)}add(t,e){this.total++,this.speedRangeCounts[e]++,this.directionTotals[t]++,this.directionSpeedRangeCounts[t][e]++}}class Ut{constructor(t,e){this.minDegrees=t,this.maxDegrees=e}checkDirection(t){return this.minDegrees<0?t-360>this.minDegrees||t<=this.maxDegrees:t>this.minDegrees&&t<=this.maxDegrees}}class Wt{constructor(t){this.windDirectionLetters=t,this.defaultLetters=["N","E","S","W"],this.directions={N:0,NXE:11.25,NNE:22.5,NEXN:33.75,NE:45,NEXE:56.25,ENE:67.5,EXN:78.75,E:90,EXS:101.25,ESE:112.5,SEXE:123.75,SE:135,SEXS:146.25,SSE:157.5,SXE:168.75,S:180,SXW:191.25,SSW:202.5,SWXS:213.75,SW:225,SWXW:236.25,WSW:247.5,WXS:258.75,W:270,WXN:281.25,WNW:292.5,NWXW:303.75,NW:315,NWXN:326.25,NNW:337.5,NXW:348.5,CALM:0}}getDirection(t){let e=t.toUpperCase();return this.windDirectionLetters&&(e=this.convertDirectionLetters(t)),this.directions[e]}convertDirectionLetters(t){let e="";for(let n=0;n<t.length;n++){const i=this.windDirectionLetters.indexOf(t[n]);i<0&&ct.info("Could not translate cardinal direction, letters not found in config wind_direction_entity.direction_letters"),e+=this.defaultLetters[i]}return e}}class Ot{constructor(t){this.config=t,this.windDirectionLettersConverter=new Wt(t.cardinalDirectionLetters)}convertDirection(t){let e=0;if("letters"===this.config.windDirectionUnit){if(e=this.windDirectionLettersConverter.getDirection(t),isNaN(e))return void ct.info("Could not convert direction "+t+" to degrees.")}else{if(isNaN(t))return void ct.info("Direction "+t+" is not a number.");e=t}return this.compensateDirection(e)}compensateDirection(t){let e=t;return 0!==this.config.directionCompensation&&(e=+e+this.config.directionCompensation,e<0?e=360+e:e>=360&&(e-=360)),e}}class Ft{constructor(t,e){this.windDirections=[],this.windData=new Tt,this.config=t,this.windSpeedConverter=e,this.windDirectionConverter=new Ot(t),this.speedRangeFunction=this.windSpeedConverter.getRangeFunction();const n=360/t.windDirectionCount;for(let e=0;e<t.windDirectionCount;e++){const t=e*n,i=t-n/2,r=t+n/2;this.windDirections.push(new Ut(i,r)),this.windData.speedRangeDegrees.push(t)}}init(t){this.windData.init(this.windSpeedConverter.getSpeedRanges().length,this.config.windDirectionCount),this.speedConverterFunction=this.windSpeedConverter.getSpeedConverter(t)}getMeasurementCounts(){return ct.debug("Wind counts: ",this.windData),this.windData}addWindMeasurements(t,e){const n=this.speedConverterFunction(e),i=this.speedRangeFunction(n),r=this.windDirectionConverter.convertDirection(t);if(void 0===r)return;const s=this.windDirections.findIndex((t=>t.checkDirection(r)));ct.trace("Wind measurement: ",t,e,s,i),this.windData.add(s,i)}}class Ht{constructor(t,e,n){this.config=t,this.speedRanges=n,this.dimensionCalculator=new _t(e)}drawWindRose(t,e){if(void 0===t)return void ct.error("drawWindRose(): Can't draw, no windrose data.");ct.trace("drawWindRose()",t),this.svgUtil=new yt(e),e.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const n=this.drawWindDirectionText(e),i=this.drawWindDirections(e),r=this.drawBackground(e);if(0!=this.config.windRoseDrawNorthOffset){const t=e.group(n,i,r);var s=this.dimensionCalculator.roseCenter();t.transform("r"+this.config.windRoseDrawNorthOffset+","+s.x+","+s.y)}this.drawCircleLegend(e),this.drawCenterZeroSpeed(e)}drawWindDirections(t){const e=t.group();for(let n=0;n<this.windRoseData.directionPercentages.length;n++)e.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[n],this.windRoseData.directionPercentages[n],this.windRoseData.directionDegrees[n],t));return e}drawWindDirection(t,e,n,i){const r=i.group();if(0===e)return r;const s=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(s[e]=t[e],t[e]>0)for(let n=e-1;n>=0;n--)s[e]+=t[n];const o=e*(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=this.drawSpeedPart(i,n-90,o*(s[t]/100)+this.config.centerRadius,this.speedRanges[t].color);r.add(e)}return r}drawSpeedPart(t,e,n,i){var r=ft.toRadians(e-this.config.leaveArc/2),s=ft.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*n),c=o.y+Math.round(Math.sin(r)*n),h=o.x+Math.round(Math.cos(s)*n),d=o.y+Math.round(Math.sin(s)*n);return t.path(vt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:c,x2:h,y2:d,radius:n})).attr({fill:i,stroke:this.config.roseLinesColor})}drawBackground(t){var e=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),n=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=t.group(e,n);const r=this.windRoseData.circleCount,s=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/r;let o=this.config.centerRadius+s;for(let t=1;t<=r;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(o))),o+=s;return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(t){this.config.cardinalDirectionLetters;const e=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),n=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),i=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor),r=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-this.config.windRoseDrawNorthOffset,this.config.roseDirectionLettersColor);return t.group(e,n,i,r)}drawCircleLegend(t){const e=t.group(),n=this.dimensionCalculator.roseCenter(),i=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.circleCount,r=Math.cos(ft.toRadians(45))*this.config.centerRadius,s=Math.cos(ft.toRadians(45))*i;for(let t=1;t<=this.windRoseData.circleCount;t++){const i=r+s*t+n.x,o=r+s*t+n.y,a=this.svgUtil.drawText(new xt(i,o),this.windRoseData.percentagePerCircle*t+"%",wt.roseLegendAttribute(this.config.rosePercentagesColor));e.add(a)}return e}drawCenterZeroSpeed(t){const e=this.dimensionCalculator.roseCenter(),n=this.svgUtil.drawCircle(new Ct(e,this.config.centerRadius));n.attr({fill:this.speedRanges[0].color});let i=this.config.roseCenterPercentageColor;"auto"===this.config.roseCenterPercentageColor&&(i=At.getTextColorBasedOnBackground(this.speedRanges[0].color));const r=this.svgUtil.drawText(e,Math.round(this.windRoseData.speedRangePercentages[0])+"%",wt.windBarAttribute(i,40,"middle","middle"));return t.group(n,r)}}class It extends Bt{calculate(t){for(let e=0;e<t.directionTotals.length;e++){t.directionSpeedRangeCounts[e][0]=0;const n=t.directionSpeedRangeCounts[e].reduce(((t,e)=>t+e),0);t.directionTotals[e]=n}return super.calculate(t)}}class jt{constructor(t,e){this.barCount=t,this.barLocation=e,this.roseRadius=500,this.marginLeft=80,this.marginRight=80,this.marginTop=80,this.marginBottom=100,this.directionLetterMargin=45,this.barBottom={barLength:2*this.roseRadius,barHeight:40,barMarginLeft:this.marginLeft,barMarginBottom:40,multiBarSpacing:90},this.barRight={barWidth:90,barHeight:2*this.roseRadius,barMarginLeft:20,barMarginRight:80,multiBarSpacing:100}}}class Vt{constructor(t,e){this.indicator=void 0,this.config=t,this.dimensionCalculator=new _t(e),this.cfg=this.dimensionCalculator.cfg,this.roseCenter=this.dimensionCalculator.roseCenter()}drawCurrentWindDirection(t,e){if(this.svgUtil=new yt(e),void 0===this.indicator){this.dimensionCalculator.roseCenter();const t=this.roseCenter.x+this.cfg.roseRadius+20,e=this.roseCenter.y;this.indicator=this.svgUtil.drawArrow(t,e,40),this.indicator.attr({stroke:this.config.roseCurrentDirectionArrowColor,fill:this.config.roseCurrentDirectionArrowColor})}if(isNaN(+t))return;const n=-90+this.config.windRoseDrawNorthOffset+ +t;var i="R"+n+","+this.roseCenter.x+","+this.roseCenter.y;ct.debug("Animate",n,t,i),this.indicator.animate({transform:i},700,mina.easeinout)}}class zt{constructor(){this.windBarRenderers=[],this.windRoseData=[],this.initReady=!1,this.measurementsReady=!1}init(t,e){this.initReady=!0,this.measurementsReady=!1,this.cardConfig=t,this.measurementProvider=e,this.configFactory=new Lt(t);const n=this.configFactory.createWindRoseConfig();if(this.windSpeedConverter=new Nt(t.outputSpeedUnit,t.speedRangeBeaufort,t.speedRangeStep,t.speedRangeMax,t.speedRanges),this.measurementCounter=new Ft(n,this.windSpeedConverter),this.dimensionConfig=new jt(t.windBarCount(),t.windspeedBarLocation),this.cardConfig.centerCalmPercentage?(this.percentageCalculator=new It,this.windRoseRenderer=new Ht(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges())):(this.percentageCalculator=new Bt,this.windRoseRenderer=new St(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges())),this.currentDirectionRenderer=new Vt(n,this.dimensionConfig),this.windBarRenderers=[],!t.hideWindspeedBar){const e=this.configFactory.createWindBarConfigs();for(let n=0;n<t.windBarCount();n++)this.windBarRenderers.push(new kt(e[n],this.dimensionConfig,this.windSpeedConverter.getOutputSpeedUnit(),n))}this.windRoseData=[]}refreshData(){return this.initReady?(ct.debug("refreshData()"),this.measurementProvider.getMeasurements().then((t=>{this.windRoseData=[],ct.debug("Matched measurements:",t);for(let e=0;e<t.length;e++){this.measurementCounter.init(this.cardConfig.windspeedEntities[e].speedUnit);for(const n of t[e])this.measurementCounter.addWindMeasurements(n.direction,n.speed);const n=this.measurementCounter.getMeasurementCounts();this.windRoseData.push(this.percentageCalculator.calculate(n))}return this.measurementsReady=!0,Promise.resolve(!0)}))):(ct.debug("refreshData() ignored, not inited yet"),Promise.resolve(!1))}render(t){if(t.clear(),t&&this.initReady&&this.measurementsReady){ct.debug("render()",t,this.windRoseData,this.windBarRenderers),this.windRoseRenderer.drawWindRose(this.windRoseData[0],t);for(let e=0;e<this.windBarRenderers.length;e++)this.windBarRenderers[e].drawWindBar(this.windRoseData[e],t)}else ct.error("render(): Could not render, no svg or windRoseData",t,this.windRoseData)}updateEntityStates(t,e){t.updateWindDirection&&this.currentDirectionRenderer.drawCurrentWindDirection(t.currentWindDirection,e)}}class qt{constructor(t,e){this.direction=t,this.speed=e}}class Gt{constructor(t){if(this.matchingStrategy=t,ct.debug("Matching init:",t),"direction-first"!==this.matchingStrategy&&"speed-first"!==this.matchingStrategy)throw Error("Unkown matchfing strategy: "+this.matchingStrategy)}matchStatsHistory(t,e){const n=[];if("direction-first"==this.matchingStrategy)for(const i of t){const t=this.findHistoryInPeriod(i,e);t?this.isInvalidSpeed(t.s)?ct.warn("Speed "+t.s+" at timestamp "+i.start+" is not a number."):n.push(new qt(i.mean,+t.s)):ct.trace("No matching speed found for direction "+i.mean+" at timestamp "+i.start)}else for(const i of e){const e=this.findStatsAtTime(1e3*i.lu,t);e?(n.push(new qt(e.mean,+i.s)),""===i.s||null===i.s||isNaN(+i.s)?ct.warn("Speed "+i.s+" at timestamp "+e.start+" is not a number."):n.push(new qt(e.mean,+i.s))):ct.trace("No matching direction found for speed "+i.s+" at timestamp "+i.lu)}return n}matchHistoryStats(t,e){const n=[];if("direction-first"==this.matchingStrategy)for(const i of t){const t=this.findStatsAtTime(1e3*i.lu,e);t?n.push(new qt(i.s,t.mean)):ct.trace("No matching speed found for direction "+i.s+" at timestamp "+i.lu)}else for(const i of e){const e=this.findHistoryInPeriod(i,t);e?""===e.s||null===e.s||isNaN(+e.s)?ct.warn("Direction "+e.s+" at timestamp "+e.lu+" is not a number."):n.push(new qt(e.s,i.mean)):ct.trace("No matching direction found for speed "+i.start+" at timestamp "+i.mean)}return n}matchHistoryHistory(t,e){const n=[];if("direction-first"==this.matchingStrategy)for(const i of t){const t=this.findHistoryBackAtTime(i.lu,e);t?this.isInvalidSpeed(t.s)?ct.warn("Speed "+t.s+" at timestamp "+t.lu+" is not a number."):n.push(new qt(i.s,+t.s)):ct.trace("No matching speed found for direction "+i.s+" at timestamp "+i.lu)}else for(const i of e)if(this.isValidSpeed(i.s)){const e=this.findHistoryBackAtTime(i.lu,t);e?""===e.s||null===e.s||isNaN(+e.s)?ct.warn("Speed "+i.s+" at timestamp "+i.lu+" is not a number."):n.push(new qt(e.s,+i.s)):ct.trace("No matching direction found for speed "+i.s+" at timestamp "+i.lu)}return n}matchStatsStats(t,e){const n=[];if("direction-first"==this.matchingStrategy)for(const i of t){const t=this.findMatchingStatistic(i,e);t?n.push(new qt(i.mean,t.mean)):ct.trace(`No matching speed found for direction ${i.mean} at timestamp start:${i.start} end:${i.end}`)}else for(const i of e){const e=this.findMatchingStatistic(i,t);e?n.push(new qt(e.mean,i.mean)):ct.trace(`No matching direction found for speed ${i.mean} at timestamp start:${i.start} end:${i.end}`)}return n}findStatsAtTime(t,e){return e.find((e=>e.start<=t&&t<=e.end))}findHistoryInPeriod(t,e){const n=t.start/1e3,i=t.end/1e3,r=e.filter((t=>n<t.lu&&i>=t.lu));return 1==r.length?r[0]:r.length>1?(r.sort(((t,e)=>e.lu-t.lu)),r[Math.trunc(r.length/2)]):void 0}findMatchingStatistic(t,e){return e.find((e=>t.start===e.start&&t.end===e.end))}findHistoryBackAtTime(t,e){let n;for(const i of e){if(!(i.lu<=t))break;n=i}return n}isInvalidSpeed(t){return""===t||null==t||isNaN(+t)}isValidSpeed(t){return""!==t&&null!=t&&!isNaN(+t)}}class Xt{constructor(t){this.waitingForMeasurements=!1,this.cardConfig=t,this.rawEntities=t.createRawEntitiesArray(),this.statsEntities=t.createStatisticsEntitiesArray(),this.measurementMatcher=new Gt(this.cardConfig.matchingStrategy)}setHass(t){this.hass=t}getMeasurements(){return ct.debug("getMeasurements()"),void 0===this.hass?(ct.error("Cant read measurements, HASS not set."),Promise.resolve([])):this.waitingForMeasurements?(ct.error("Measurements already requested, waiting"),Promise.resolve([])):(this.waitingForMeasurements=!0,Promise.all([this.getHistory(),this.getStatistics()]).then((t=>{this.checkLoadedData(t),this.waitingForMeasurements=!1,ct.debug("Measurements loaded:",t);const e=[];if(this.cardConfig.windDirectionEntity.useStatistics){const n=t[1][this.cardConfig.windDirectionEntity.entity];for(let i of this.cardConfig.windspeedEntities)if(i.useStatistics){const r=t[1][i.entity],s=this.measurementMatcher.matchStatsStats(n,r);e.push(s),this.logMatchingStats(i.entity,n.length,r.length,s.length)}else{const r=t[0][i.entity],s=this.measurementMatcher.matchStatsHistory(n,r);e.push(s),this.logMatchingStats(i.entity,n.length,r.length,s.length)}}else{const n=t[0][this.cardConfig.windDirectionEntity.entity];for(let i of this.cardConfig.windspeedEntities)if(i.useStatistics){const r=t[1][i.entity],s=this.measurementMatcher.matchHistoryStats(n,r);e.push(s),this.logMatchingStats(i.entity,n.length,r.length,s.length)}else{const r=t[0][i.entity],s=this.measurementMatcher.matchHistoryHistory(n,r);e.push(s),this.logMatchingStats(i.entity,n.length,r.length,s.length)}}return Promise.resolve(e)})))}checkLoadedData(t){const e=this.cardConfig.windDirectionEntity.entity;if(void 0===t[0][e]&&void 0===t[1][e])throw new Error(`Entity ${e} did not return data, is this the correct entity name?`);for(const e of this.cardConfig.windspeedEntities)if(void 0===t[0][e.entity]&&void 0===t[1][e.entity])throw new Error(`Entity ${e.entity} did not return data, is this the correct entity name?`)}logMatchingStats(t,e,n,i){ct.info(`Loaded measurements: directions: ${e}, speeds: ${n}, entity: ${t}`),"direction-first"===this.cardConfig.matchingStrategy?i<e?ct.warn(`Matching results entity ${t}, ${e-i} not matched of total ${e} direction measurements`):ct.info(`Matched measurements, direction-first: ${i}`):i<n?ct.warn(`Matching results entity ${t}, ${n-i}  not matched of total ${n} speed measurements`):ct.info(`Matched measurements, speed-first: ${i}`)}getHistory(){if(0===this.rawEntities.length)return Promise.resolve({});const t={type:"history/history_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),end_time:new Date,minimal_response:!0,no_attributes:!0,entity_ids:this.rawEntities};return this.hass.callWS(t)}getStatistics(){if(0===this.statsEntities.length)return Promise.resolve({});const t={type:"recorder/statistics_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),period:"5minute",statistic_ids:this.statsEntities,types:["mean"]};return this.hass.callWS(t)}calculateStartTime(t){const e=new Date;if(t.hourstoShow)e.setHours(e.getHours()-t.hourstoShow);else{if(!(t.fromHourOfDay&&t.fromHourOfDay>0||0===t.fromHourOfDay))throw new Error("No data period config option available.");e.getHours()<t.fromHourOfDay&&e.setDate(e.getDate()-1),e.setHours(t.fromHourOfDay,0,0,0)}return ct.info("Using start time for data query",e),e}}class Yt{constructor(t,e,n){this.entity=t,this.unit=e,this.error=n}}class Zt{async checkEntities(t,e){this.hass=e,this.hass||ct.warn("Can't check entities, hass not set.");const n=await this.getEntityStates(t);for(const e of n){if(e.error)throw new Error(`Entity ${e.entity} not found.`);if(e.unit){const n=t.windspeedEntities.find((t=>t.entity===e.entity));n&&"auto"===n.speedUnit&&(n.speedUnit=e.unit,ct.info(`Windspeed unit detected for ${n.entity}: ${e.unit}`))}}}async getEntityStates(t){const e=[];for(const n of t.windspeedEntities)e.push(await this.callEntityState(n.entity));return Promise.resolve(e)}async callEntityState(t){var e;try{const n=await this.hass.callApi("GET","states/"+t),i=null===(e=null==n?void 0:n.attributes)||void 0===e?void 0:e.unit_of_measurement;return new Yt(t,i,void 0)}catch(e){return new Yt(t,void 0,e)}}}class Qt{constructor(t,e){this.currentWindDirection=t,this.updateWindDirection=e}static doNothing(){return new Qt(void 0,!1)}}class Kt{constructor(){this.initReady=!1}init(t){this.cardConfig=t,this.windDirectionEntity=t.windDirectionEntity.entity,this.windDirectionConverter=new Ot(new Lt(t).createWindRoseConfig()),this.initReady=!0}updatedHass(t){if(this.initReady&&this.cardConfig.showCurrentDirectionArrow){const e=this.readCurrentWindDirection(t);return new Qt(e,void 0!==e?!0:!1)}return Qt.doNothing()}readCurrentWindDirection(t){const e=t.states[this.windDirectionEntity];if(e.state!=this.previousWindDirection)return this.previousWindDirection=e.state,ct.debug("Update current direction state: ",e.state),this.windDirectionConverter.convertDirection(e.state)}}window.customCards=window.customCards||[],window.customCards.push({type:"windrose-card",name:"Windrose Card",description:"A card to show wind speed and direction in a windrose."}),console.info("%c  WINROSE-CARD  %c Version 1.6.0 ","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray");let Jt=class extends et{static getStubConfig(){return ut.exampleConfig()}constructor(){super(),this.windRoseDirigent=new zt,this.entityStateProcessor=new Kt,this.entityChecker=new Zt,this.svg=vt("100%","100%")}set hass(t){this._hass=t;const e=this.entityStateProcessor.updatedHass(t);this.windRoseDirigent.updateEntityStates(e,this.svg)}render(){var t;return super.render(),ct.debug("card render()"),T`
            <ha-card header="${null===(t=this.cardConfig)||void 0===t?void 0:t.title}">
                <div class="card-content" id="svg-container">
                </div>
            </ha-card>
        `}firstUpdated(){ct.debug("firstUpdated()"),ct.debug("SVG container found: ",this.svgContainer,this.measurementProvider),this.svgContainer.appendChild(this.svg.node),this.refreshCardConfig()}update(t){ct.debug("update()"),super.update(t),this.windRoseDirigent.render(this.svg)}initInterval(){ct.debug("initInterval()"),this.cardConfig&&void 0===this.updateInterval&&(this.updateInterval=setInterval((()=>this.refreshMeasurements()),1e3*this.cardConfig.refreshInterval),ct.info("Interval running with "+this.cardConfig.refreshInterval+" seconds."))}static get styles(){return o`
          :host {
            display: block;
          }
          canvas {
            background-color: var(--ha-card-background);
            max-height: var(--chart-max-height);
          }`}connectedCallback(){super.connectedCallback(),ct.debug("connectedCallBack()"),this.initInterval()}disconnectedCallback(){super.disconnectedCallback(),ct.debug("disconnectedCallback()"),clearInterval(this.updateInterval)}setConfig(t){this.config=t,this.cardConfig=new ut(t),ct.setLevel(this.cardConfig.logLevel),ct.debug("setConfig(): ",t,this._hass),this._hass&&this.svg&&this.refreshCardConfig()}getCardSize(){return ct.debug("getCardSize()"),9}refreshCardConfig(){this.entityChecker.checkEntities(this.cardConfig,this._hass).then((()=>{this.measurementProvider=new Xt(this.cardConfig),this.measurementProvider.setHass(this._hass),this.windRoseDirigent.init(this.cardConfig,this.measurementProvider),this.entityStateProcessor.init(this.cardConfig),this.refreshMeasurements()}))}refreshMeasurements(){this.windRoseDirigent.refreshData().then((t=>{ct.debug("refreshData() ready, requesting update."),t&&this.requestUpdate()}))}};t([it("#svg-container")],Jt.prototype,"svgContainer",void 0),t([it(".card-content")],Jt.prototype,"parentDiv",void 0),Jt=t([(t=>e=>"function"==typeof e?((t,e)=>(customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:n,elements:i}=e;return{kind:n,elements:i,finisher(e){customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */)("windrose-card")],Jt);export{ct as Log,Jt as WindRoseCard};
