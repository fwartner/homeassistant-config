function t(t,e,i,n){var r,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,i,o):r(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const e=window,i=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),r=new WeakMap;class s{constructor(t,e,i){if(this._$cssResult$=!0,i!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(i&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=r.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&r.set(e,t))}return t}toString(){return this.cssText}}const o=(t,...e)=>{const i=1===t.length?t[0]:e.reduce(((e,i,n)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[n+1]),t[0]);return new s(i,t,n)},a=i?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>new s("string"==typeof t?t:t+"",void 0,n))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var h;const c=window,l=c.trustedTypes,d=l?l.emptyScript:"",u=c.reactiveElementPolyfillSupport,f={toAttribute(t,e){switch(e){case Boolean:t=t?d:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},p=(t,e)=>e!==t&&(e==e||t==t),m={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:p};class v extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,i)=>{const n=this._$Ep(i,e);void 0!==n&&(this._$Ev.set(n,i),t.push(n))})),t}static createProperty(t,e=m){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const i="symbol"==typeof t?Symbol():"__"+t,n=this.getPropertyDescriptor(t,i,e);void 0!==n&&Object.defineProperty(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(n){const r=this[t];this[e]=n,this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||m}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of e)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(a(t))}else void 0!==t&&e.push(a(t));return e}static _$Ep(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}u(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,i;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(i=t.hostConnected)||void 0===i||i.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const n=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,n)=>{i?t.adoptedStyleSheets=n.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):n.forEach((i=>{const n=document.createElement("style"),r=e.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=i.cssText,t.appendChild(n)}))})(n,this.constructor.elementStyles),n}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EO(t,e,i=m){var n;const r=this.constructor._$Ep(t,i);if(void 0!==r&&!0===i.reflect){const s=(void 0!==(null===(n=i.converter)||void 0===n?void 0:n.toAttribute)?i.converter:f).toAttribute(e,i.type);this._$El=t,null==s?this.removeAttribute(r):this.setAttribute(r,s),this._$El=null}}_$AK(t,e){var i;const n=this.constructor,r=n._$Ev.get(t);if(void 0!==r&&this._$El!==r){const t=n.getPropertyOptions(r),s="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(i=t.converter)||void 0===i?void 0:i.fromAttribute)?t.converter:f;this._$El=r,this[r]=s.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,i){let n=!0;void 0!==t&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||p)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===i.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,i))):n=!1),!this.isUpdatePending&&n&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,e)=>this[e]=t)),this._$Ei=void 0);let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(i)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$EO(e,this[e],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var w;v.finalized=!0,v.elementProperties=new Map,v.elementStyles=[],v.shadowRootOptions={mode:"open"},null==u||u({ReactiveElement:v}),(null!==(h=c.reactiveElementVersions)&&void 0!==h?h:c.reactiveElementVersions=[]).push("1.6.1");const y=window,C=y.trustedTypes,b=C?C.createPolicy("lit-html",{createHTML:t=>t}):void 0,x=`lit$${(Math.random()+"").slice(9)}$`,R="?"+x,S=`<${R}>`,_=document,D=(t="")=>_.createComment(t),A=t=>null===t||"object"!=typeof t&&"function"!=typeof t,k=Array.isArray,E=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,B=/-->/g,T=/>/g,L=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),N=/'/g,$=/"/g,P=/^(?:script|style|textarea|title)$/i,M=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),U=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),I=new WeakMap,O=_.createTreeWalker(_,129,null,!1),F=(t,e)=>{const i=t.length-1,n=[];let r,s=2===e?"<svg>":"",o=E;for(let e=0;e<i;e++){const i=t[e];let a,h,c=-1,l=0;for(;l<i.length&&(o.lastIndex=l,h=o.exec(i),null!==h);)l=o.lastIndex,o===E?"!--"===h[1]?o=B:void 0!==h[1]?o=T:void 0!==h[2]?(P.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=L):void 0!==h[3]&&(o=L):o===L?">"===h[0]?(o=null!=r?r:E,c=-1):void 0===h[1]?c=-2:(c=o.lastIndex-h[2].length,a=h[1],o=void 0===h[3]?L:'"'===h[3]?$:N):o===$||o===N?o=L:o===B||o===T?o=E:(o=L,r=void 0);const d=o===L&&t[e+1].startsWith("/>")?" ":"";s+=o===E?i+S:c>=0?(n.push(a),i.slice(0,c)+"$lit$"+i.slice(c)+x+d):i+x+(-2===c?(n.push(void 0),e):d)}const a=s+(t[i]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==b?b.createHTML(a):a,n]};class H{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,s=0;const o=t.length-1,a=this.parts,[h,c]=F(t,e);if(this.el=H.createElement(h,i),O.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(n=O.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes()){const t=[];for(const e of n.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(x)){const i=c[s++];if(t.push(e),void 0!==i){const t=n.getAttribute(i.toLowerCase()+"$lit$").split(x),e=/([.?@])?(.*)/.exec(i);a.push({type:1,index:r,name:e[2],strings:t,ctor:"."===e[1]?G:"?"===e[1]?Y:"@"===e[1]?Z:q})}else a.push({type:6,index:r})}for(const e of t)n.removeAttribute(e)}if(P.test(n.tagName)){const t=n.textContent.split(x),e=t.length-1;if(e>0){n.textContent=C?C.emptyScript:"";for(let i=0;i<e;i++)n.append(t[i],D()),O.nextNode(),a.push({type:2,index:++r});n.append(t[e],D())}}}else if(8===n.nodeType)if(n.data===R)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=n.data.indexOf(x,t+1));)a.push({type:7,index:r}),t+=x.length-1}r++}}static createElement(t,e){const i=_.createElement("template");return i.innerHTML=t,i}}function z(t,e,i=t,n){var r,s,o,a;if(e===U)return e;let h=void 0!==n?null===(r=i._$Co)||void 0===r?void 0:r[n]:i._$Cl;const c=A(e)?void 0:e._$litDirective$;return(null==h?void 0:h.constructor)!==c&&(null===(s=null==h?void 0:h._$AO)||void 0===s||s.call(h,!1),void 0===c?h=void 0:(h=new c(t),h._$AT(t,i,n)),void 0!==n?(null!==(o=(a=i)._$Co)&&void 0!==o?o:a._$Co=[])[n]=h:i._$Cl=h),void 0!==h&&(e=z(t,h._$AS(t,e.values),h,n)),e}class j{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:i},parts:n}=this._$AD,r=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:_).importNode(i,!0);O.currentNode=r;let s=O.nextNode(),o=0,a=0,h=n[0];for(;void 0!==h;){if(o===h.index){let e;2===h.type?e=new V(s,s.nextSibling,this,t):1===h.type?e=new h.ctor(s,h.name,h.strings,this,t):6===h.type&&(e=new Q(s,this,t)),this.u.push(e),h=n[++a]}o!==(null==h?void 0:h.index)&&(s=O.nextNode(),o++)}return r}p(t){let e=0;for(const i of this.u)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class V{constructor(t,e,i,n){var r;this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cm=null===(r=null==n?void 0:n.isConnected)||void 0===r||r}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=z(this,t,e),A(t)?t===W||null==t||""===t?(this._$AH!==W&&this._$AR(),this._$AH=W):t!==this._$AH&&t!==U&&this.g(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>k(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==W&&A(this._$AH)?this._$AA.nextSibling.data=t:this.T(_.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r="number"==typeof n?this._$AC(t):(void 0===n.el&&(n.el=H.createElement(n.h,this.options)),n);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===r)this._$AH.p(i);else{const t=new j(r,this),e=t.v(this.options);t.p(i),this.T(e),this._$AH=t}}_$AC(t){let e=I.get(t.strings);return void 0===e&&I.set(t.strings,e=new H(t)),e}k(t){k(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new V(this.O(D()),this.O(D()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cm=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class q{constructor(t,e,i,n,r){this.type=1,this._$AH=W,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=W}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,n){const r=this.strings;let s=!1;if(void 0===r)t=z(this,t,e,0),s=!A(t)||t!==this._$AH&&t!==U,s&&(this._$AH=t);else{const n=t;let o,a;for(t=r[0],o=0;o<r.length-1;o++)a=z(this,n[i+o],e,o),a===U&&(a=this._$AH[o]),s||(s=!A(a)||a!==this._$AH[o]),a===W?t=W:t!==W&&(t+=(null!=a?a:"")+r[o+1]),this._$AH[o]=a}s&&!n&&this.j(t)}j(t){t===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class G extends q{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===W?void 0:t}}const X=C?C.emptyScript:"";class Y extends q{constructor(){super(...arguments),this.type=4}j(t){t&&t!==W?this.element.setAttribute(this.name,X):this.element.removeAttribute(this.name)}}class Z extends q{constructor(t,e,i,n,r){super(t,e,i,n,r),this.type=5}_$AI(t,e=this){var i;if((t=null!==(i=z(this,t,e,0))&&void 0!==i?i:W)===U)return;const n=this._$AH,r=t===W&&n!==W||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==W&&(n===W||r);r&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this._$AH.handleEvent(t)}}class Q{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){z(this,t)}}const K=y.litHtmlPolyfillSupport;null==K||K(H,V),(null!==(w=y.litHtmlVersions)&&void 0!==w?w:y.litHtmlVersions=[]).push("2.6.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var J,tt;class et extends v{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=i.firstChild),i}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,i)=>{var n,r;const s=null!==(n=null==i?void 0:i.renderBefore)&&void 0!==n?n:e;let o=s._$litPart$;if(void 0===o){const t=null!==(r=null==i?void 0:i.renderBefore)&&void 0!==r?r:null;s._$litPart$=o=new V(e.insertBefore(D(),t),t,void 0,null!=i?i:{})}return o._$AI(t),o})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return U}}et.finalized=!0,et._$litElement$=!0,null===(J=globalThis.litElementHydrateSupport)||void 0===J||J.call(globalThis,{LitElement:et});const it=globalThis.litElementPolyfillSupport;null==it||it({LitElement:et}),(null!==(tt=globalThis.litElementVersions)&&void 0!==tt?tt:globalThis.litElementVersions=[]).push("3.2.2");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function nt(t,e){return(({finisher:t,descriptor:e})=>(i,n)=>{var r;if(void 0===n){const n=null!==(r=i.originalKey)&&void 0!==r?r:i.key,s=null!=e?{kind:"method",placement:"prototype",key:n,descriptor:e(i.key)}:{...i,key:n};return null!=t&&(s.finisher=function(e){t(e,n)}),s}{const r=i.constructor;void 0!==e&&Object.defineProperty(i,n,e(n)),null==t||t(r,n)}})({descriptor:i=>{const n={get(){var e,i;return null!==(i=null===(e=this.renderRoot)||void 0===e?void 0:e.querySelector(t))&&void 0!==i?i:null},enumerable:!0,configurable:!0};if(e){const e="symbol"==typeof i?Symbol():"__"+i;n.get=function(){var i,n;return void 0===this[e]&&(this[e]=null!==(n=null===(i=this.renderRoot)||void 0===i?void 0:i.querySelector(t))&&void 0!==n?n:null),this[e]}}return n}})}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var rt;null===(rt=window.HTMLSlotElement)||void 0===rt||rt.prototype.assignedElements;class st{}st.defaultCardinalDirectionLetters="NESW",st.defaultWindspeedBarLocation="bottom",st.defaultHoursToShow=4,st.defaultRefreshInterval=300,st.defaultWindDirectionCount=16,st.defaultInputSpeedUnit="auto",st.defaultOutputSpeedUnit="mps",st.defaultWindspeedBarFull=!0,st.defaultMatchingStategy="direction-first",st.defaultCenterCalmPercentage=!0,st.defaultSpeedRangeBeaufort=!0,st.defaultCurrentDirectionArrowSize=50,st.defaultCurrentDirectionCircleSize=30;class ot{constructor(t,e,i,n){this.range=t,this.minSpeed=e,this.maxSpeed=i,this.color=n}isRangeMatch(t){return t>=this.minSpeed&&(t<this.maxSpeed||-1===this.maxSpeed)}}class at{constructor(){const t=getComputedStyle(document.documentElement).getPropertyValue("--primary-text-color");this.roseLines="rgb(160, 160, 160)",this.roseDirectionLetters=t,this.roseCenterPercentage="auto",this.rosePercentages=t,this.roseCurrentDirectionArrow="red",this.barBorder="rgb(160, 160, 160)",this.barUnitName=t,this.barName=t,this.barUnitValues=t,this.barPercentages="auto"}}class ht{static setLevel(t){switch(t){case"NONE":this.level=0;break;case"ERROR":this.level=1;break;case"WARN":this.level=2;break;case"INFO":this.level=3;break;case"DEBUG":this.level=4;break;case"TRACE":this.level=5;break;default:this.level=0,this.error("Unkonwn log level set: ",t," default to WARN")}this.level>2&&console.log("WR LOG level set to:",t)}static checkLogLevel(t){if(void 0===t)return"WARN";if("NONE"===t||"ERROR"===t||"WARN"===t||"INFO"===t||"DEBUG"===t||"TRACE"===t)return t;throw new Error("Unkonwn log level configurated: "+t)}static error(t,...e){this.level>=1&&(0===e.length?console.error("WR ERROR "+t):console.error("WR ERROR "+t,e[0]))}static warn(t,...e){this.level>=2&&(0===e.length?console.warn("WR WARN "+t):console.warn("WR WARN "+t,e[0]))}static info(t,...e){this.level>=3&&this.log("INFO "+t,e)}static debug(t,...e){this.level>=4&&this.log("DEBUG "+t,e)}static trace(t,...e){5===this.level&&this.log("TRACE "+t,e)}static log(t,...e){0===e[0].length?console.log("WR "+t):console.log("WR "+t,e[0])}}ht.level=0;class ct{constructor(t,e,i,n,r){this.entity=t,this.name=e,this.useStatistics=i,this.renderRelativeScale=n,this.speedUnit=r}}class lt{constructor(t,e,i,n){this.entity=t,this.useStatistics=e,this.directionCompensation=i,this.directionLetters=n}}class dt{constructor(t,e){this.hourstoShow=t,this.fromHourOfDay=e}}class ut{constructor(t,e){this.autoRotate=t,this.entity=e}}class ft{constructor(t,e,i){this.showArrow=t,this.arrowSize=e,this.centerCircleSize=i}}class gt{constructor(){this.show=!1}}class pt{constructor(t,e,i,n){this.topLeftInfo=t,this.topRightInfo=e,this.bottomLeftInfo=i,this.bottomRightInfo=n}isCornerInfoSet(){var t,e,i,n;return(null===(t=this.topLeftInfo)||void 0===t?void 0:t.show)||(null===(e=this.topRightInfo)||void 0===e?void 0:e.show)||(null===(i=this.bottomLeftInfo)||void 0===i?void 0:i.show)||(null===(n=this.bottomRightInfo)||void 0===n?void 0:n.show)}static create(t){return null==t?this.createAllDisabled():new pt(this.checkCornerInfo(t.top_left),this.checkCornerInfo(t.top_right),this.checkCornerInfo(t.bottom_left),this.checkCornerInfo(t.bottom_right))}static createAllDisabled(){const t=new gt;return new pt(t,t,t,t)}static checkCornerInfo(t){const e=getComputedStyle(document.documentElement).getPropertyValue("--primary-text-color"),i=new gt;return i.entity=null==t?void 0:t.entity,i.color=void 0===(null==t?void 0:t.color)?e:t.color,i.label=null==t?void 0:t.label,i.unit=null==t?void 0:t.unit,(i.entity||i.label)&&(i.show=!0),i}}class mt{static checkNummerOrDefault(t,e){return isNaN(t)?e:+t}static checkBooleanDefaultFalse(t){return null!=t&&t}static checkBooleanDefaultTrue(t){return null==t||t}}class vt{static exampleConfig(){return{title:"Wind direction",data_period:{hours_to_show:st.defaultHoursToShow},refresh_interval:st.defaultRefreshInterval,windspeed_bar_location:st.defaultWindspeedBarLocation,windspeed_bar_full:st.defaultWindspeedBarFull,wind_direction_entity:{entity:"",use_statistics:!1,direction_compensation:0},windspeed_entities:[{entity:"",name:"",speed_unit:st.defaultInputSpeedUnit,use_statistics:!1}],output_speed_unit:st.defaultOutputSpeedUnit,speed_range_beaufort:st.defaultSpeedRangeBeaufort,speed_range_step:void 0,speed_range_max:void 0,speed_ranges:void 0,windrose_draw_north_offset:0,current_direction:{show_arrow:!1,arrow_size:50,center_circle_size:30},compass_direction:{auto_rotate:!1,entity:""},cardinal_direction_letters:st.defaultCardinalDirectionLetters,matching_strategy:st.defaultMatchingStategy,center_calm_percentage:st.defaultCenterCalmPercentage,log_level:st.defaultLogLevel}}constructor(t){this.cardConfig=t,this.speedRanges=[],this.title=this.cardConfig.title,this.dataPeriod=this.checkDataPeriod(t.hours_to_show,t.data_period),this.refreshInterval=this.checkRefreshInterval(),this.windDirectionEntity=this.checkWindDirectionEntity(),this.windspeedEntities=this.checkWindspeedEntities(),this.windRoseDrawNorthOffset=this.checkwindRoseDrawNorthOffset(),this.currentDirection=this.checkCurrentDirection(),this.windspeedBarLocation=this.checkWindspeedBarLocation(),this.windspeedBarFull=mt.checkBooleanDefaultTrue(t.windspeed_bar_full),this.hideWindspeedBar=mt.checkBooleanDefaultFalse(t.hide_windspeed_bar),this.centerCalmPercentage=mt.checkBooleanDefaultTrue(t.center_calm_percentage),this.cardinalDirectionLetters=this.checkCardinalDirectionLetters(),this.windDirectionCount=this.checkWindDirectionCount(),this.outputSpeedUnit=this.checkOutputSpeedUnit(),this.outputSpeedUnitLabel=this.checkOutputSpeedUnitLabel(),this.speedRangeBeaufort=mt.checkBooleanDefaultTrue(t.speed_range_beaufort),this.speedRangeStep=this.checkSpeedRangeStep(),this.speedRangeMax=this.checkSpeedRangeMax(),this.speedRanges=this.checkSpeedRanges(),this.checkSpeedRangeCombi(),this.matchingStrategy=this.checkMatchingStrategy(),this.filterEntitiesQueryParameter=this.createEntitiesQueryParameter(),this.cardColor=this.checkCardColors(),this.compassConfig=this.checkCompassConfig(t.compass_direction),this.cornersInfo=pt.create(t.corner_info),this.logLevel=ht.checkLogLevel(this.cardConfig.log_level),ht.info("Config check OK")}windBarCount(){return this.hideWindspeedBar?0:this.windspeedEntities.length}checkDataPeriod(t,e){const i=this.checkHoursToShow(t),n=this.checkHoursToShow(null==e?void 0:e.hours_to_show),r=this.checkFromHourOfDay(null==e?void 0:e.from_hour_of_day);if(i)return ht.warn("WindRoseCard: hours_to_show config is deprecated, use the data_period object."),new dt(t,void 0);if(n&&r)throw new Error("WindRoseCard: Only one is allowed: hours_to_show or from_hour_of_day");if(!n&&!r)throw new Error("WindRoseCard: One config option object data_period should be filled.");return new dt(e.hours_to_show,e.from_hour_of_day)}checkHoursToShow(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number above 0.");return!!t}checkFromHourOfDay(t){if(t&&(isNaN(t)||t<0||t>23))throw new Error("WindRoseCard: Invalid hours_to_show, should be a number between 0 and 23, hour of the day..");return null!=t&&t>=0}checkRefreshInterval(){if(this.cardConfig.refresh_interval&&isNaN(this.cardConfig.refresh_interval))throw new Error("WindRoseCard: Invalid refresh_interval, should be a number in seconds.");return this.cardConfig.refresh_interval?this.cardConfig.refresh_interval:st.defaultRefreshInterval}checkWindDirectionEntity(){if(this.cardConfig.wind_direction_entity){const t=this.cardConfig.wind_direction_entity;if(void 0===t.entity)throw new Error("WindRoseCard: No wind_direction_entity.entity configured.");const e=t.entity,i=mt.checkBooleanDefaultFalse(t.use_statistics),n=this.checkDirectionCompensation(t.direction_compensation),r=this.checkDirectionLetters(t.direction_letters);return new lt(e,i,n,r)}throw new Error("WindRoseCard: No wind_direction_entity configured.")}checkCurrentDirection(){return this.cardConfig.current_direction?new ft(mt.checkBooleanDefaultFalse(this.cardConfig.current_direction.show_arrow),mt.checkNummerOrDefault(this.cardConfig.current_direction.arrow_size,st.defaultCurrentDirectionArrowSize),mt.checkNummerOrDefault(this.cardConfig.current_direction.center_circle_size,st.defaultCurrentDirectionCircleSize)):new ft(!1,void 0,void 0)}checkWindspeedEntities(){if(!this.cardConfig.windspeed_entities||0==this.cardConfig.windspeed_entities.length)throw new Error("WindRoseCard: No wind_speed_entities configured, minimal 1 needed.");const t=[];for(const e of this.cardConfig.windspeed_entities){const i=e.entity,n=e.name,r=mt.checkBooleanDefaultFalse(e.use_statistics),s=this.checkInputSpeedUnit(e.speed_unit),o=mt.checkBooleanDefaultTrue(e.render_relative_scale);t.push(new ct(i,n,r,o,s))}return t}checkInputSpeedUnit(t){if(t){if("mps"!==t&&"bft"!==t&&"kph"!==t&&"mph"!==t&&"fps"!==t&&"knots"!==t&&"auto"!==t)throw new Error("Invalid windspeed unit configured: "+t+". Valid options: mps, bft, fps, kph, mph, knots, auto");return t}return st.defaultInputSpeedUnit}checkDirectionCompensation(t){if(t&&isNaN(t))throw new Error("WindRoseCard: Invalid direction compensation, should be a number in degress between 0 and 360.");return t||0}checkDirectionLetters(t){if(t){if(t&&5===t.length)return t.toUpperCase();throw new Error("WindRoseCard: direction_letters config should be 5 letters.")}}checkwindRoseDrawNorthOffset(){if(this.cardConfig.windrose_draw_north_offset&&isNaN(this.cardConfig.windrose_draw_north_offset))throw new Error("WindRoseCard: Invalid render direction offset, should be a number in degress between 0 and 360.");return this.cardConfig.windrose_draw_north_offset?this.cardConfig.windrose_draw_north_offset:0}checkWindspeedBarLocation(){if(this.cardConfig.windspeed_bar_location){if("bottom"!==this.cardConfig.windspeed_bar_location&&"right"!==this.cardConfig.windspeed_bar_location)throw new Error("Invalid windspeed bar location "+this.cardConfig.windspeed_bar_location+". Valid options: bottom, right");return this.cardConfig.windspeed_bar_location}return st.defaultWindspeedBarLocation}checkCardinalDirectionLetters(){if(this.cardConfig.cardinal_direction_letters){if(4!==this.cardConfig.cardinal_direction_letters.length)throw new Error("Cardinal direction letters option should contain 4 letters.");return this.cardConfig.cardinal_direction_letters}return st.defaultCardinalDirectionLetters}checkWindDirectionCount(){if(this.cardConfig.wind_direction_count){if(isNaN(this.cardConfig.wind_direction_count)||this.cardConfig.wind_direction_count<4||this.cardConfig.wind_direction_count>32)throw new Error("Wind direction count can a number between 4 and 32");return this.cardConfig.wind_direction_count}return st.defaultWindDirectionCount}checkOutputSpeedUnit(){if(this.cardConfig.output_speed_unit){if("mps"!==this.cardConfig.output_speed_unit&&"kph"!==this.cardConfig.output_speed_unit&&"mph"!==this.cardConfig.output_speed_unit&&"fps"!==this.cardConfig.output_speed_unit&&"knots"!==this.cardConfig.output_speed_unit)throw new Error("Invalid output windspeed unit configured: "+this.cardConfig.output_speed_unit+". Valid options: mps, fps, kph, mph, knots");return this.cardConfig.output_speed_unit}return st.defaultOutputSpeedUnit}checkOutputSpeedUnitLabel(){if(this.cardConfig.output_speed_unit_label)return this.cardConfig.output_speed_unit_label}checkSpeedRangeStep(){if(this.cardConfig.speed_range_step&&isNaN(this.cardConfig.speed_range_step))throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step<=0)throw new Error("WindRoseCard: Invalid speed_range_step, should be a positive number.");if(this.cardConfig.speed_range_step)return this.cardConfig.speed_range_step}checkSpeedRangeMax(){if(this.cardConfig.speed_range_max&&isNaN(this.cardConfig.speed_range_max))throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max<=0)throw new Error("WindRoseCard: Invalid speed_range_max, should be a positive number.");if(this.cardConfig.speed_range_max)return this.cardConfig.speed_range_max}checkSpeedRanges(){const t=[];if(this.cardConfig.speed_ranges&&this.cardConfig.speed_ranges.length>0){const e=this.cardConfig.speed_ranges.slice();e.sort(((t,e)=>t.from_value-e.from_value));const i=e.length-1;for(let n=0;n<i;n++)t.push(new ot(n,e[n].from_value,e[n+1].from_value,e[n].color));t.push(new ot(i,e[i].from_value,-1,e[i].color))}return t}checkSpeedRangeCombi(){if("bft"===this.outputSpeedUnit&&(this.speedRangeStep||this.speedRangeMax))throw new Error("WindRoseCard: speed_range_step and/or speed_range_max should not be set when using output speed unit Beaufort (bft). Beaufort uses fixed speed ranges.");if(this.speedRangeStep&&!this.speedRangeMax||!this.speedRangeStep&&this.speedRangeMax)throw new Error("WindRoseCard: speed_range_step and speed_range_max should both be set.")}checkMatchingStrategy(){if(this.cardConfig.matching_strategy){if("direction-first"!==this.cardConfig.matching_strategy&&"speed-first"!==this.cardConfig.matching_strategy)throw new Error("Invalid matching stategy "+this.cardConfig.matching_strategy+". Valid options: direction-first, speed-first");return this.cardConfig.matching_strategy}return st.defaultMatchingStategy}createEntitiesQueryParameter(){return this.windDirectionEntity+","+this.windspeedEntities.map((t=>t.entity)).join(",")}checkCompassConfig(t){let e,i=!1;if(t&&(i=mt.checkBooleanDefaultFalse(t.auto_rotate),i)){if(!t.entity)throw new Error("WindRoseCard: compass direction auto rotate set to true, but no entity configured.");e=t.entity}return new ut(i,e)}createRawEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics||t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>!t.useStatistics)).map((t=>t.entity)))}createStatisticsEntitiesArray(){const t=[];return this.windDirectionEntity.useStatistics&&t.push(this.windDirectionEntity.entity),t.concat(this.windspeedEntities.filter((t=>t.useStatistics)).map((t=>t.entity)))}checkCardColors(){const t=new at;return this.cardConfig.colors&&(this.cardConfig.colors.rose_direction_letters&&(t.roseDirectionLetters=this.cardConfig.colors.rose_direction_letters),this.cardConfig.colors.rose_lines&&(t.roseLines=this.cardConfig.colors.rose_lines),this.cardConfig.colors.rose_percentages&&(t.rosePercentages=this.cardConfig.colors.rose_percentages),this.cardConfig.colors.rose_center_percentage&&(t.roseCenterPercentage=this.cardConfig.colors.rose_center_percentage),this.cardConfig.colors.rose_current_direction_arrow&&(t.roseCurrentDirectionArrow=this.cardConfig.colors.rose_current_direction_arrow),this.cardConfig.colors.bar_border&&(t.barBorder=this.cardConfig.colors.bar_border),this.cardConfig.colors.bar_name&&(t.barName=this.cardConfig.colors.bar_name),this.cardConfig.colors.bar_percentages&&(t.barPercentages=this.cardConfig.colors.bar_percentages),this.cardConfig.colors.bar_unit_name&&(t.barUnitName=this.cardConfig.colors.bar_unit_name),this.cardConfig.colors.bar_unit_values&&(t.barUnitValues=this.cardConfig.colors.bar_unit_values)),t}}class wt{static toRadians(t){return t*(Math.PI/180)}}var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ct(t,e){return t(e={exports:{}},e.exports),e.exports}var bt=Ct((function(t){!function(e){var i,n,r="0.5.4",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,h=function(t,e){return t-e},c={n:{}},l=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},d=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=Object.prototype.toString,f=String,g=Array.isArray||function(t){return t instanceof Array||"[object Array]"==u.call(t)},p=function(t,e){var r,s=n,o=Array.prototype.slice.call(arguments,2),a=p.listeners(t),c=0,u=[],f={},g=[],m=i;g.firstDefined=l,g.lastDefined=d,i=t,n=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(u.push(a[v].zIndex),a[v].zIndex<0&&(f[a[v].zIndex]=a[v]));for(u.sort(h);u[c]<0;)if(r=f[u[c++]],g.push(r.apply(e,o)),n)return n=s,g;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==u[c]){if(g.push(r.apply(e,o)),n)break;do{if((r=f[u[++c]])&&g.push(r.apply(e,o)),n)break}while(r)}else f[r.zIndex]=r;else if(g.push(r.apply(e,o)),n)break;return n=s,i=m,g};p._events=c,p.listeners=function(t){var e,i,n,r,s,a,h,l,d=g(t)?t:t.split(o),u=c,f=[u],p=[];for(r=0,s=d.length;r<s;r++){for(l=[],a=0,h=f.length;a<h;a++)for(i=[(u=f[a].n)[d[r]],u["*"]],n=2;n--;)(e=i[n])&&(l.push(e),p=p.concat(e.f||[]));f=l}return p},p.separator=function(t){t?(t="["+(t=f(t).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",o=new RegExp(t)):o=/[\.\/]/},p.on=function(t,e){if("function"!=typeof e)return function(){};for(var i=g(t)?g(t[0])?t:[t]:f(t).split(a),n=0,r=i.length;n<r;n++)!function(t){for(var i,n=g(t)?t:f(t).split(o),r=c,s=0,a=n.length;s<a;s++)r=(r=r.n).hasOwnProperty(n[s])&&r[n[s]]||(r[n[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){i=!0;break}!i&&r.f.push(e)}(i[n]);return function(t){+t==+t&&(e.zIndex=+t)}},p.f=function(t){var e=[].slice.call(arguments,1);return function(){p.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},p.stop=function(){n=1},p.nt=function(t){var e=g(i)?i.join("."):i;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},p.nts=function(){return g(i)?i:i.split(o)},p.off=p.unbind=function(t,e){if(t){var i=g(t)?g(t[0])?t:[t]:f(t).split(a);if(i.length>1)for(var n=0,r=i.length;n<r;n++)p.off(i[n],e);else{i=g(t)?t:f(t).split(o);var h,l,d,u,m,v=[c],w=[];for(n=0,r=i.length;n<r;n++)for(u=0;u<v.length;u+=d.length-2){if(d=[u,1],h=v[u].n,"*"!=i[n])h[i[n]]&&(d.push(h[i[n]]),w.unshift({n:h,name:i[n]}));else for(l in h)h[s](l)&&(d.push(h[l]),w.unshift({n:h,name:l}));v.splice.apply(v,d)}for(n=0,r=v.length;n<r;n++)for(h=v[n];h.n;){if(e){if(h.f){for(u=0,m=h.f.length;u<m;u++)if(h.f[u]==e){h.f.splice(u,1);break}!h.f.length&&delete h.f}for(l in h.n)if(h.n[s](l)&&h.n[l].f){var y=h.n[l].f;for(u=0,m=y.length;u<m;u++)if(y[u]==e){y.splice(u,1);break}!y.length&&delete h.n[l].f}}else for(l in delete h.f,h.n)h.n[s](l)&&h.n[l].f&&delete h.n[l].f;h=h.n}t:for(n=0,r=w.length;n<r;n++){for(l in(h=w[n]).n[h.name].f)continue t;for(l in h.n[h.name].n)continue t;delete h.n[h.name]}}}else p._events=c={n:{}}},p.once=function(t,e){var i=function(){return p.off(t,i),e.apply(this,arguments)};return p.on(t,i)},p.version=r,p.toString=function(){return"You are running Eve "+r},e.eve=p,t.exports?t.exports=p:e.eve=p}("undefined"!=typeof window?window:yt)})),xt=Ct((function(t,e){var i,n;!function(e){var i,n,r="0.4.2",s="hasOwnProperty",o=/[\.\/]/,a=/\s*,\s*/,h=function(t,e){return t-e},c={n:{}},l=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},d=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=function(t,e){t=String(t);var r,s=n,o=Array.prototype.slice.call(arguments,2),a=u.listeners(t),c=0,f=[],g={},p=[],m=i;p.firstDefined=l,p.lastDefined=d,i=t,n=0;for(var v=0,w=a.length;v<w;v++)"zIndex"in a[v]&&(f.push(a[v].zIndex),a[v].zIndex<0&&(g[a[v].zIndex]=a[v]));for(f.sort(h);f[c]<0;)if(r=g[f[c++]],p.push(r.apply(e,o)),n)return n=s,p;for(v=0;v<w;v++)if("zIndex"in(r=a[v]))if(r.zIndex==f[c]){if(p.push(r.apply(e,o)),n)break;do{if((r=g[f[++c]])&&p.push(r.apply(e,o)),n)break}while(r)}else g[r.zIndex]=r;else if(p.push(r.apply(e,o)),n)break;return n=s,i=m,p};u._events=c,u.listeners=function(t){var e,i,n,r,s,a,h,l,d=t.split(o),u=c,f=[u],g=[];for(r=0,s=d.length;r<s;r++){for(l=[],a=0,h=f.length;a<h;a++)for(i=[(u=f[a].n)[d[r]],u["*"]],n=2;n--;)(e=i[n])&&(l.push(e),g=g.concat(e.f||[]));f=l}return g},u.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var i=t.split(a),n=0,r=i.length;n<r;n++)!function(t){for(var i,n=t.split(o),r=c,s=0,a=n.length;s<a;s++)r=(r=r.n).hasOwnProperty(n[s])&&r[n[s]]||(r[n[s]]={n:{}});for(r.f=r.f||[],s=0,a=r.f.length;s<a;s++)if(r.f[s]==e){i=!0;break}!i&&r.f.push(e)}(i[n]);return function(t){+t==+t&&(e.zIndex=+t)}},u.f=function(t){var e=[].slice.call(arguments,1);return function(){u.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},u.stop=function(){n=1},u.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(i):i},u.nts=function(){return i.split(o)},u.off=u.unbind=function(t,e){if(t){var i=t.split(a);if(i.length>1)for(var n=0,r=i.length;n<r;n++)u.off(i[n],e);else{i=t.split(o);var h,l,d,f,g,p=[c];for(n=0,r=i.length;n<r;n++)for(f=0;f<p.length;f+=d.length-2){if(d=[f,1],h=p[f].n,"*"!=i[n])h[i[n]]&&d.push(h[i[n]]);else for(l in h)h[s](l)&&d.push(h[l]);p.splice.apply(p,d)}for(n=0,r=p.length;n<r;n++)for(h=p[n];h.n;){if(e){if(h.f){for(f=0,g=h.f.length;f<g;f++)if(h.f[f]==e){h.f.splice(f,1);break}!h.f.length&&delete h.f}for(l in h.n)if(h.n[s](l)&&h.n[l].f){var m=h.n[l].f;for(f=0,g=m.length;f<g;f++)if(m[f]==e){m.splice(f,1);break}!m.length&&delete h.n[l].f}}else for(l in delete h.f,h.n)h.n[s](l)&&h.n[l].f&&delete h.n[l].f;h=h.n}}}else u._events=c={n:{}}},u.once=function(t,e){var i=function(){return u.unbind(t,i),e.apply(this,arguments)};return u.on(t,i)},u.version=r,u.toString=function(){return"You are running Eve "+r},t.exports?t.exports=u:e.eve=u}(yt),i=window||yt,n=bt,t.exports=function(t,e){var i=function(e){var i={},n=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},r=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},s=0,o="M"+(+new Date).toString(36),a=function(){return o+(s++).toString(36)},h=Date.now||function(){return+new Date},c=function(t){var e=this;if(null==t)return e.s;var i=e.s-t;e.b+=e.dur*i,e.B+=e.dur*i,e.s=t},l=function(t){var e=this;if(null==t)return e.spd;e.spd=t},d=function(t){var e=this;if(null==t)return e.dur;e.s=e.s*t/e.dur,e.dur=t},u=function(){var t=this;delete i[t.id],t.update(),e("mina.stop."+t.id,t)},f=function(){var t=this;t.pdif||(delete i[t.id],t.update(),t.pdif=t.get()-t.b)},g=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,i[t.id]=t)},p=function(){var t,e=this;if(r(e.start)){t=[];for(var i=0,n=e.start.length;i<n;i++)t[i]=+e.start[i]+(e.end[i]-e.start[i])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},m=function(){var t=0;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],o=s.get();t++,s.s=(o-s.b)/(s.dur/s.spd),s.s>=1&&(delete i[r],s.s=1,t--,function(t){setTimeout((function(){e("mina.finish."+t.id,t)}))}(s)),s.update()}t&&n(m)},v=function(t,e,r,s,o,h,w){var y={id:a(),start:t,end:e,b:r,s:0,dur:s-r,spd:1,get:o,set:h,easing:w||v.linear,status:c,speed:l,duration:d,stop:u,pause:f,resume:g,update:p};i[y.id]=y;var C,b=0;for(C in i)if(i.hasOwnProperty(C)&&2==++b)break;return 1==b&&n(m),y};return v.time=h,v.getById=function(t){return i[t]||null},v.linear=function(t){return t},v.easeout=function(t){return Math.pow(t,1.7)},v.easein=function(t){return Math.pow(t,.48)},v.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,i=Math.sqrt(.1734+e*e),n=i-e,r=-i-e,s=Math.pow(Math.abs(n),1/3)*(n<0?-1:1)+Math.pow(Math.abs(r),1/3)*(r<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},v.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},v.backout=function(t){if(0==t)return 0;var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},v.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},v.bounce=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},t.mina=v,v}(void 0===e?function(){}:e),n=function(t){function i(t,e){if(t){if(t.nodeType)return it(t);if(L(t,"array")&&i.set)return i.set.apply(i,t);if(t instanceof K)return t;if(null==e)return it(t=n.doc.querySelector(String(t)))}return new et(t=null==t?"100%":t,e=null==e?"100%":e)}i.version="0.4.0",i.toString=function(){return"Snap v"+this.version},i._={};var n={win:t.window,doc:t.window.document};i._.glob=n;var r="hasOwnProperty",s=String,o=parseFloat,a=parseInt,h=Math,c=h.max,l=h.min,d=h.abs,u=h.PI,f="",p=Object.prototype.toString,m=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i;i._.separator=/[,\s]+/;var v,w,y,C=/[\s]*,[\s]*/,b={hs:1,rg:1},x=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,R=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,S=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,_=0,D="S"+(+new Date).toString(36),A=function(t){return(t&&t.type?t.type:f)+D+(_++).toString(36)},k="http://www.w3.org/1999/xlink",E="http://www.w3.org/2000/svg",B={};function T(t,e){if(e){if("#text"==t&&(t=n.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=n.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=T(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(k,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(E,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var i in e)if(e[r](i)){var o=s(e[i]);o?"xlink:"==i.substring(0,6)?t.setAttributeNS(k,i.substring(6),o):"xml:"==i.substring(0,4)?t.setAttributeNS(E,i.substring(4),o):t.setAttribute(i,o):t.removeAttribute(i)}}else"text"in e&&(t.nodeValue=e.text)}else t=n.doc.createElementNS(E,t);return t}function L(t,e){return"finite"==(e=s.prototype.toLowerCase.call(e))?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||p.call(t).slice(8,-1).toLowerCase()==e}function N(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[r](i)&&(e[i]=N(t[i]));return e}function $(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function P(t,e,i){function n(){var s=Array.prototype.slice.call(arguments,0),o=s.join("␀"),a=n.cache=n.cache||{},h=n.count=n.count||[];return a[r](o)?($(h,o),i?i(a[o]):a[o]):(h.length>=1e3&&delete a[h.shift()],h.push(o),a[o]=t.apply(e,s),i?i(a[o]):a[o])}return n}function M(t,e,i,n,r,s){if(null==r){var o=t-i,a=e-n;return o||a?(180+180*h.atan2(-a,-o)/u+360)%360:0}return M(t,e,r,s)-M(i,n,r,s)}function U(t){return t%360*u/180}function W(t){return 180*t/u%360}i.url=function(t){return"url('#"+t+"')"},i._.$=T,i._.id=A,i.format=(v=/\{([^\}]+)\}/g,w=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,y=function(t,e,i){var n=i;return e.replace(w,(function(t,e,i,r,s){e=e||r,n&&(e in n&&(n=n[e]),"function"==typeof n&&s&&(n=n()))})),n=(null==n||n==i?t:n)+""},function(t,e){return s(t).replace(v,(function(t,i){return y(t,i,e)}))}),i._.clone=N,i._.cacher=P,i.rad=U,i.deg=W,i.sin=function(t){return h.sin(i.rad(t))},i.tan=function(t){return h.tan(i.rad(t))},i.cos=function(t){return h.cos(i.rad(t))},i.asin=function(t){return i.deg(h.asin(t))},i.acos=function(t){return i.deg(h.acos(t))},i.atan=function(t){return i.deg(h.atan(t))},i.atan2=function(t){return i.deg(h.atan2(t))},i.angle=M,i.len=function(t,e,n,r){return Math.sqrt(i.len2(t,e,n,r))},i.len2=function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},i.closestPoint=function(t,e,i){function n(t){var n=t.x-e,r=t.y-i;return n*n+r*r}for(var r,s,o,a,h=t.node,c=h.getTotalLength(),l=c/h.pathSegList.numberOfItems*.125,d=1/0,u=0;u<=c;u+=l)(a=n(o=h.getPointAtLength(u)))<d&&(r=o,s=u,d=a);for(l*=.5;l>.5;){var f,g,p,m,v,w;(p=s-l)>=0&&(v=n(f=h.getPointAtLength(p)))<d?(r=f,s=p,d=v):(m=s+l)<=c&&(w=n(g=h.getPointAtLength(m)))<d?(r=g,s=m,d=w):l*=.5}return r={x:r.x,y:r.y,length:s,distance:Math.sqrt(d)}},i.is=L,i.snapTo=function(t,e,i){if(i=L(i,"finite")?i:10,L(t,"array")){for(var n=t.length;n--;)if(d(t[n]-e)<=i)return t[n]}else{var r=e%(t=+t);if(r<i)return e-r;if(r>t-i)return e-r+t}return e},i.getRGB=P((function(t){if(!t||(t=s(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:H};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:H};if(!b[r](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=I(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:H};var e,n,d,u,f,g,p=t.match(m);return p?(p[2]&&(d=a(p[2].substring(5),16),n=a(p[2].substring(3,5),16),e=a(p[2].substring(1,3),16)),p[3]&&(d=a((f=p[3].charAt(3))+f,16),n=a((f=p[3].charAt(2))+f,16),e=a((f=p[3].charAt(1))+f,16)),p[4]&&(g=p[4].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e*=2.55),n=o(g[1]),"%"==g[1].slice(-1)&&(n*=2.55),d=o(g[2]),"%"==g[2].slice(-1)&&(d*=2.55),"rgba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100)),p[5]?(g=p[5].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),n=o(g[1]),"%"==g[1].slice(-1)&&(n/=100),d=o(g[2]),"%"==g[2].slice(-1)&&(d/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsba"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),i.hsb2rgb(e,n,d,u)):p[6]?(g=p[6].split(C),e=o(g[0]),"%"==g[0].slice(-1)&&(e/=100),n=o(g[1]),"%"==g[1].slice(-1)&&(n/=100),d=o(g[2]),"%"==g[2].slice(-1)&&(d/=100),("deg"==g[0].slice(-3)||"°"==g[0].slice(-1))&&(e/=360),"hsla"==p[1].toLowerCase().slice(0,4)&&(u=o(g[3])),g[3]&&"%"==g[3].slice(-1)&&(u/=100),i.hsl2rgb(e,n,d,u)):(e=l(h.round(e),255),n=l(h.round(n),255),d=l(h.round(d),255),u=l(c(u,0),1),(p={r:e,g:n,b:d,toString:H}).hex="#"+(16777216|d|n<<8|e<<16).toString(16).slice(1),p.opacity=L(u,"finite")?u:1,p)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:H}}),i),i.hsb=P((function(t,e,n){return i.hsb2rgb(t,e,n).hex})),i.hsl=P((function(t,e,n){return i.hsl2rgb(t,e,n).hex})),i.rgb=P((function(t,e,i,n){if(L(n,"finite")){var r=h.round;return"rgba("+[r(t),r(e),r(i),+n.toFixed(2)]+")"}return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)}));var I=function(t){var e=n.doc.getElementsByTagName("head")[0]||n.doc.getElementsByTagName("svg")[0],i="rgb(255, 0, 0)";return I=P((function(t){if("red"==t.toLowerCase())return i;e.style.color=i,e.style.color=t;var r=n.doc.defaultView.getComputedStyle(e,f).getPropertyValue("color");return r==i?null:r})),I(t)},O=function(){return"hsb("+[this.h,this.s,this.b]+")"},F=function(){return"hsl("+[this.h,this.s,this.l]+")"},H=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},z=function(t,e,n){if(null==e&&L(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(n=t.b,e=t.g,t=t.r),null==e&&L(t,string)){var r=i.getRGB(t);t=r.r,e=r.g,n=r.b}return(t>1||e>1||n>1)&&(t/=255,e/=255,n/=255),[t,e,n]},j=function(t,e,n,r){var s={r:t=h.round(255*t),g:e=h.round(255*e),b:n=h.round(255*n),opacity:L(r,"finite")?r:1,hex:i.rgb(t,e,n),toString:H};return L(r,"finite")&&(s.opacity=r),s};i.color=function(t){var e;return L(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=i.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):L(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=i.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):(L(t,"string")&&(t=i.getRGB(t)),L(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(e=i.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=i.rgb2hsb(t),t.v=e.b):((t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=H,t},i.hsb2rgb=function(t,e,i,n){var r,s,o,a,h;return L(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,n=t.o,t=t.h),a=(h=i*e)*(1-d((t=(t*=360)%360/60)%2-1)),r=s=o=i-h,j(r+=[h,a,0,0,a,h][t=~~t],s+=[a,h,h,a,0,0][t],o+=[0,0,a,h,h,a][t],n)},i.hsl2rgb=function(t,e,i,n){var r,s,o,a,h;return L(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),a=(h=2*e*(i<.5?i:1-i))*(1-d((t=(t*=360)%360/60)%2-1)),r=s=o=i-h/2,j(r+=[h,a,0,0,a,h][t=~~t],s+=[a,h,h,a,0,0][t],o+=[0,0,a,h,h,a][t],n)},i.rgb2hsb=function(t,e,i){var n,r;return t=(i=z(t,e,i))[0],e=i[1],i=i[2],{h:((0==(r=(n=c(t,e,i))-l(t,e,i))?null:n==t?(e-i)/r:n==e?(i-t)/r+2:(t-e)/r+4)+360)%6*60/360,s:0==r?0:r/n,b:n,toString:O}},i.rgb2hsl=function(t,e,i){var n,r,s,o;return t=(i=z(t,e,i))[0],e=i[1],i=i[2],n=((r=c(t,e,i))+(s=l(t,e,i)))/2,{h:((0==(o=r-s)?null:r==t?(e-i)/o:r==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360,s:0==o?0:n<.5?o/(2*n):o/(2-2*n),l:n,toString:F}},i.parsePathString=function(t){if(!t)return null;var e=i.path(t);if(e.arr)return i.path.clone(e.arr);var n={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return L(t,"array")&&L(t[0],"array")&&(r=i.path.clone(t)),r.length||s(t).replace(x,(function(t,e,i){var s=[],o=e.toLowerCase();if(i.replace(S,(function(t,e){e&&s.push(+e)})),"m"==o&&s.length>2&&(r.push([e].concat(s.splice(0,2))),o="l",e="m"==e?"l":"L"),"o"==o&&1==s.length&&r.push([e,s[0]]),"r"==o)r.push([e].concat(s));else for(;s.length>=n[o]&&(r.push([e].concat(s.splice(0,n[o]))),n[o]););})),r.toString=i.path.toString,e.arr=i.path.clone(r),r};var V=i.parseTransformString=function(t){if(!t)return null;var e=[];return L(t,"array")&&L(t[0],"array")&&(e=i.path.clone(t)),e.length||s(t).replace(R,(function(t,i,n){var r=[];i.toLowerCase(),n.replace(S,(function(t,e){e&&r.push(+e)})),e.push([i].concat(r))})),e.toString=i.path.toString,e};function q(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,(function(t,i,n){return n=n.split(/\s*,\s*|\s+/),"rotate"==i&&1==n.length&&n.push(0,0),"scale"==i&&(n.length>2?n=n.slice(0,2):2==n.length&&n.push(0,0),1==n.length&&n.push(n[0],0,0)),"skewX"==i?e.push(["m",1,0,h.tan(U(n[0])),1,0,0]):"skewY"==i?e.push(["m",1,h.tan(U(n[0])),0,1,0,0]):e.push([i.charAt(0)].concat(n)),t})),e}function G(t,e){var n=V(t),r=new i.Matrix;if(n)for(var o=0,a=n.length;o<a;o++){var h,c,l,d,u,f=n[o],g=f.length,p=s(f[0]).toLowerCase(),m=f[0]!=p,v=m?r.invert():0;"t"==p&&2==g?r.translate(f[1],0):"t"==p&&3==g?m?(h=v.x(0,0),c=v.y(0,0),l=v.x(f[1],f[2]),d=v.y(f[1],f[2]),r.translate(l-h,d-c)):r.translate(f[1],f[2]):"r"==p?2==g?(u=u||e,r.rotate(f[1],u.x+u.width/2,u.y+u.height/2)):4==g&&(m?(l=v.x(f[2],f[3]),d=v.y(f[2],f[3]),r.rotate(f[1],l,d)):r.rotate(f[1],f[2],f[3])):"s"==p?2==g||3==g?(u=u||e,r.scale(f[1],f[g-1],u.x+u.width/2,u.y+u.height/2)):4==g?m?(l=v.x(f[2],f[3]),d=v.y(f[2],f[3]),r.scale(f[1],f[1],l,d)):r.scale(f[1],f[1],f[2],f[3]):5==g&&(m?(l=v.x(f[3],f[4]),d=v.y(f[3],f[4]),r.scale(f[1],f[2],l,d)):r.scale(f[1],f[2],f[3],f[4])):"m"==p&&7==g&&r.add(f[1],f[2],f[3],f[4],f[5],f[6])}return r}function X(t){var e=t.node.ownerSVGElement&&it(t.node.ownerSVGElement)||t.node.parentNode&&it(t.node.parentNode)||i.select("svg")||i(0,0),n=e.select("defs"),r=null!=n&&n.node;return r||(r=tt("defs",e.node).node),r}function Y(t){return t.node.ownerSVGElement&&it(t.node.ownerSVGElement)||i.select("svg")}function Z(t,e,i){var n=Y(t).node,r={},s=n.querySelector(".svg---mgr");function o(t){if(null==t)return f;if(t==+t)return t;T(s,{width:t});try{return s.getBBox().width}catch(t){return 0}}function a(t){if(null==t)return f;if(t==+t)return t;T(s,{height:t});try{return s.getBBox().height}catch(t){return 0}}function h(n,s){null==e?r[n]=s(t.attr(n)||0):n==e&&(r=s(null==i?t.attr(n)||0:i))}switch(s||(s=T("rect"),T(s,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),n.appendChild(s)),t.type){case"rect":h("rx",o),h("ry",a);case"image":h("width",o),h("height",a);case"text":h("x",o),h("y",a);break;case"circle":h("cx",o),h("cy",a),h("r",o);break;case"ellipse":h("cx",o),h("cy",a),h("rx",o),h("ry",a);break;case"line":h("x1",o),h("x2",o),h("y1",a),h("y2",a);break;case"marker":h("refX",o),h("markerWidth",o),h("refY",a),h("markerHeight",a);break;case"radialGradient":h("fx",o),h("fy",a);break;case"tspan":h("dx",o),h("dy",a);break;default:h(e,o)}return n.removeChild(s),r}function Q(t){L(t,"array")||(t=Array.prototype.slice.call(arguments,0));for(var e=0,i=0,n=this.node;this[e];)delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach((function(t){n.appendChild(t.node)})):n.appendChild(t[e].node);var r=n.childNodes;for(e=0;e<r.length;e++)this[i++]=it(r[e]);return this}function K(t){if(t.snap in B)return B[t.snap];var e;try{e=t.ownerSVGElement}catch(t){}this.node=t,e&&(this.paper=new et(e)),this.type=t.tagName||t.nodeName;var i=this.id=A(this);if(this.anims={},this._={transform:[]},t.snap=i,B[i]=this,"g"==this.type&&(this.add=Q),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var n in et.prototype)et.prototype[r](n)&&(this[n]=et.prototype[n])}function J(t){this.node=t}function tt(t,e){var i=T(t);return e.appendChild(i),it(i)}function et(t,e){var i,s,o,a=et.prototype;if(t&&"svg"==t.tagName){if(t.snap in B)return B[t.snap];var h=t.ownerDocument;for(var c in i=new K(t),s=t.getElementsByTagName("desc")[0],o=t.getElementsByTagName("defs")[0],s||((s=T("desc")).appendChild(h.createTextNode("Created with Snap")),i.node.appendChild(s)),o||(o=T("defs"),i.node.appendChild(o)),i.defs=o,a)a[r](c)&&(i[c]=a[c]);i.paper=i.root=i}else T((i=tt("svg",n.doc.body)).node,{height:e,version:1.1,width:t,xmlns:E});return i}function it(t){return t?t instanceof K||t instanceof J?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new et(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new et(t.contentDocument.getElementsByTagName("svg")[0]):new K(t):t}function nt(t,e){for(var i=0,n=t.length;i<n;i++){var r={type:t[i].type,attr:t[i].attr()},s=t[i].children();e.push(r),s.length&&nt(s,r.childNodes=[])}}i._.svgTransform2string=q,i._.rgTransform=/^[a-z][\s]*-?\.?\d/i,i._.transform2matrix=G,i._unit2px=Z,n.doc.contains||n.doc.compareDocumentPosition,i._.getSomeDefs=X,i._.getSomeSVG=Y,i.select=function(t){return t=s(t).replace(/([^\\]):/g,"$1\\:"),it(n.doc.querySelector(t))},i.selectAll=function(t){for(var e=n.doc.querySelectorAll(t),r=(i.set||Array)(),s=0;s<e.length;s++)r.push(it(e[s]));return r},setInterval((function(){for(var t in B)if(B[r](t)){var e=B[t],i=e.node;("svg"!=e.type&&!i.ownerSVGElement||"svg"==e.type&&(!i.parentNode||"ownerSVGElement"in i.parentNode&&!i.ownerSVGElement))&&delete B[t]}}),1e4),K.prototype.attr=function(t,i){var n=this,s=n.node;if(!t){if(1!=s.nodeType)return{text:s.nodeValue};for(var o=s.attributes,a={},h=0,c=o.length;h<c;h++)a[o[h].nodeName]=o[h].nodeValue;return a}if(L(t,"string")){if(!(arguments.length>1))return e("snap.util.getattr."+t,n).firstDefined();var l={};l[t]=i,t=l}for(var d in t)t[r](d)&&e("snap.util.attr."+d,n,t[d]);return n},i.parse=function(t){var e=n.doc.createDocumentFragment(),i=!0,r=n.doc.createElement("div");if((t=s(t)).match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",i=!1),r.innerHTML=t,t=r.getElementsByTagName("svg")[0])if(i)e=t;else for(;t.firstChild;)e.appendChild(t.firstChild);return new J(e)},i.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),e=n.doc.createDocumentFragment(),r=0,s=t.length;r<s;r++){var o=t[r];o.node&&o.node.nodeType&&e.appendChild(o.node),o.nodeType&&e.appendChild(o),"string"==typeof o&&e.appendChild(i.parse(o).node)}return new J(e)},i._.make=tt,i._.wrap=it,et.prototype.el=function(t,e){var i=tt(t,this.node);return e&&i.attr(e),i},K.prototype.children=function(){for(var t=[],e=this.node.childNodes,n=0,r=e.length;n<r;n++)t[n]=i(e[n]);return t},K.prototype.toJSON=function(){var t=[];return nt([this],t),t[0]},e.on("snap.util.getattr",(function(){var t=e.nt(),i=(t=t.substring(t.lastIndexOf(".")+1)).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return rt[r](i)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(i):T(this.node,t)}));var rt={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",(function(t){var i=e.nt(),n={};n[i=i.substring(i.lastIndexOf(".")+1)]=t;var s=i.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()})),o=i.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));rt[r](o)?this.node.style[s]=null==t?f:t:T(this.node,n)})),et.prototype,i.ajax=function(t,i,n,r){var s=new XMLHttpRequest,o=A();if(s){if(L(i,"function"))r=n,n=i,i=null;else if(L(i,"object")){var a=[];for(var h in i)i.hasOwnProperty(h)&&a.push(encodeURIComponent(h)+"="+encodeURIComponent(i[h]));i=a.join("&")}return s.open(i?"POST":"GET",t,!0),i&&(s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),n&&(e.once("snap.ajax."+o+".0",n),e.once("snap.ajax."+o+".200",n),e.once("snap.ajax."+o+".304",n)),s.onreadystatechange=function(){4==s.readyState&&e("snap.ajax."+o+"."+s.status,r,s)},4==s.readyState||s.send(i),s}},i.load=function(t,e,n){i.ajax(t,(function(t){var r=i.parse(t.responseText);n?e.call(n,r):e(r)}))};var st=function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,r=i.documentElement,s=r.clientTop||n.clientTop||0,o=r.clientLeft||n.clientLeft||0;return{y:e.top+(g.win.pageYOffset||r.scrollTop||n.scrollTop)-s,x:e.left+(g.win.pageXOffset||r.scrollLeft||n.scrollLeft)-o}};return i.getElementByPoint=function(t,e){this.canvas;var i=n.doc.elementFromPoint(t,e);if(n.win.opera&&"svg"==i.tagName){var r=st(i),s=i.createSVGRect();s.x=t-r.x,s.y=e-r.y,s.width=s.height=1;var o=i.getIntersectionList(s,null);o.length&&(i=o[o.length-1])}return i?it(i):null},i.plugin=function(t){t(i,K,et,n,J)},n.win.Snap=i,i}(t||this);return n.plugin((function(n,r,s,o,a){var h=r.prototype,c=n.is,l=String,d=n._unit2px,u=n._.$,f=n._.make,g=n._.getSomeDefs,p="hasOwnProperty",m=n._.wrap;h.getBBox=function(t){if(!n.Matrix||!n.path)return this.node.getBBox();var e=this,i=new n.Matrix;if(e.removed)return n._.box();for(;"use"==e.type;)if(t||(i=i.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else{var r=e.attr("xlink:href");e=e.original=e.node.ownerDocument.getElementById(r.substring(r.indexOf("#")+1))}var s=e._,o=n.path.get[e.type]||n.path.get.deflt;try{return t?(s.bboxwt=o?n.path.getBBox(e.realPath=o(e)):n._.box(e.node.getBBox()),n._.box(s.bboxwt)):(e.realPath=o(e),e.matrix=e.transform().localMatrix,s.bbox=n.path.getBBox(n.path.map(e.realPath,i.add(e.matrix))),n._.box(s.bbox))}catch(t){return n._.box()}};var v=function(){return this.string};function w(t,e){if(null==e){var i=!0;if(!(e="linearGradient"==t.type||"radialGradient"==t.type?t.node.getAttribute("gradientTransform"):"pattern"==t.type?t.node.getAttribute("patternTransform"):t.node.getAttribute("transform")))return new n.Matrix;e=n._.svgTransform2string(e)}else e=n._.rgTransform.test(e)?l(e).replace(/\.{3}|\u2026/g,t._.transform||""):n._.svgTransform2string(e),c(e,"array")&&(e=n.path?n.path.toString.call(e):l(e)),t._.transform=e;var r=n._.transform2matrix(e,t.getBBox(1));if(i)return r;t.matrix=r}function y(t){var e,i=t.selectAll("*"),n=/^\s*url\(("|'|)(.*)\1\)\s*$/,r=[],s={};function o(t,e){var i=u(t.node,e);(i=(i=i&&i.match(n))&&i[2])&&"#"==i.charAt()&&(i=i.substring(1))&&(s[i]=(s[i]||[]).concat((function(i){var n={};n[e]=URL(i),u(t.node,n)})))}function a(t){var e=u(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1))&&(s[e]=(s[e]||[]).concat((function(e){t.attr("xlink:href","#"+e)})))}for(var h=0,c=i.length;h<c;h++){o(e=i[h],"fill"),o(e,"stroke"),o(e,"filter"),o(e,"mask"),o(e,"clip-path"),a(e);var l=u(e.node,"id");l&&(u(e.node,{id:e.id}),r.push({old:l,id:e.id}))}for(h=0,c=r.length;h<c;h++){var d=s[r[h].old];if(d)for(var f=0,g=d.length;f<g;f++)d[f](r[h].id)}}function C(t,e,i){return function(n){var r=n.slice(t,e);return 1==r.length&&(r=r[0]),i?i(r):r}}h.transform=function(t){var e=this._;if(null==t){for(var i,r=this,s=new n.Matrix(this.node.getCTM()),o=w(this),a=[o],h=new n.Matrix,c=o.toTransformString(),d=l(o)==l(this.matrix)?l(e.transform):c;"svg"!=r.type&&(r=r.parent());)a.push(w(r));for(i=a.length;i--;)h.add(a[i]);return{string:d,globalMatrix:s,totalMatrix:h,localMatrix:o,diffMatrix:s.clone().add(o.invert()),global:s.toTransformString(),total:h.toTransformString(),local:c,toString:v}}return t instanceof n.Matrix?(this.matrix=t,this._.transform=t.toTransformString()):w(this,t),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?u(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?u(this.node,{patternTransform:this.matrix}):u(this.node,{transform:this.matrix})),this},h.parent=function(){return m(this.node.parentNode)},h.append=h.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach((function(t){e.add(t)})),this}t=m(t),this.node.appendChild(t.node),t.paper=this.paper}return this},h.appendTo=function(t){return t&&(t=m(t)).append(this),this},h.prepend=function(t){if(t){if("set"==t.type){var e,i=this;return t.forEach((function(t){e?e.after(t):i.prepend(t),e=t})),this}var n=(t=m(t)).parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),n&&n.add()}return this},h.prependTo=function(t){return(t=m(t)).prepend(this),this},h.before=function(t){if("set"==t.type){var e=this;return t.forEach((function(t){var i=t.parent();e.node.parentNode.insertBefore(t.node,e.node),i&&i.add()})),this.parent().add(),this}var i=(t=m(t)).parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),i&&i.add(),t.paper=this.paper,this},h.after=function(t){var e=(t=m(t)).parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},h.insertBefore=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},h.insertAfter=function(t){t=m(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},h.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},h.select=function(t){return m(this.node.querySelector(t))},h.selectAll=function(t){for(var e=this.node.querySelectorAll(t),i=(n.set||Array)(),r=0;r<e.length;r++)i.push(m(e[r]));return i},h.asPX=function(t,e){return null==e&&(e=this.attr(t)),+d(this,t,e)},h.use=function(){var t,e=this.node.id;return e||(e=this.id,u(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?f(this.type,this.node.parentNode):f("use",this.node.parentNode),u(t.node,{"xlink:href":"#"+e}),t.original=this,t},h.clone=function(){var t=m(this.node.cloneNode(!0));return u(t.node,"id")&&u(t.node,{id:t.id}),y(t),t.insertAfter(this),t},h.toDefs=function(){return g(this).appendChild(this.node),this},h.pattern=h.toPattern=function(t,e,i,n){var r=f("pattern",g(this));return null==t&&(t=this.getBBox()),c(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,t=t.x),u(r.node,{x:t,y:e,width:i,height:n,patternUnits:"userSpaceOnUse",id:r.id,viewBox:[t,e,i,n].join(" ")}),r.node.appendChild(this.node),r},h.marker=function(t,e,i,n,r,s){var o=f("marker",g(this));return null==t&&(t=this.getBBox()),c(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,r=t.refX||t.cx,s=t.refY||t.cy,t=t.x),u(o.node,{viewBox:[t,e,i,n].join(" "),markerWidth:i,markerHeight:n,orient:"auto",refX:r||0,refY:s||0,id:o.id}),o.node.appendChild(this.node),o};var b=function(t,e,n,r){"function"!=typeof n||n.length||(r=n,n=i.linear),this.attr=t,this.dur=e,n&&(this.easing=n),r&&(this.callback=r)};n._.Animation=b,n.animation=function(t,e,i,n){return new b(t,e,i,n)},h.inAnim=function(){var t=this,e=[];for(var i in t.anims)t.anims[p](i)&&function(t){e.push({anim:new b(t._attrs,t.dur,t.easing,t._callback),mina:t,curStatus:t.status(),status:function(e){return t.status(e)},stop:function(){t.stop()}})}(t.anims[i]);return e},n.animate=function(t,n,r,s,o,a){"function"!=typeof o||o.length||(a=o,o=i.linear);var h=i.time(),c=i(t,n,h,h+s,i.time,r,o);return a&&e.once("mina.finish."+c.id,a),c},h.stop=function(){for(var t=this.inAnim(),e=0,i=t.length;e<i;e++)t[e].stop();return this},h.animate=function(t,n,r,s){"function"!=typeof r||r.length||(s=r,r=i.linear),t instanceof b&&(s=t.callback,r=t.easing,n=t.dur,t=t.attr);var o,a,h,d,u=[],f=[],g={},m=this;for(var v in t)if(t[p](v)){m.equal?(o=(d=m.equal(v,l(t[v]))).from,a=d.to,h=d.f):(o=+m.attr(v),a=+t[v]);var w=c(o,"array")?o.length:1;g[v]=C(u.length,u.length+w,h),u=u.concat(o),f=f.concat(a)}var y=i.time(),x=i(u,f,y,y+n,i.time,(function(t){var e={};for(var i in g)g[p](i)&&(e[i]=g[i](t));m.attr(e)}),r);return m.anims[x.id]=x,x._attrs=t,x._callback=s,e("snap.animcreated."+m.id,x),e.once("mina.finish."+x.id,(function(){delete m.anims[x.id],s&&s.call(m)})),e.once("mina.stop."+x.id,(function(){delete m.anims[x.id]})),m};var x={};function R(t){return function(){var e=t?"<"+this.type:"",i=this.node.attributes,n=this.node.childNodes;if(t)for(var r=0,s=i.length;r<s;r++)e+=" "+i[r].name+'="'+i[r].value.replace(/"/g,'\\"')+'"';if(n.length){for(t&&(e+=">"),r=0,s=n.length;r<s;r++)3==n[r].nodeType?e+=n[r].nodeValue:1==n[r].nodeType&&(e+=m(n[r]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}h.data=function(t,i){var r=x[this.id]=x[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,r,null),r;if(1==arguments.length){if(n.is(t,"object")){for(var s in t)t[p](s)&&this.data(s,t[s]);return this}return e("snap.data.get."+this.id,this,r[t],t),r[t]}return r[t]=i,e("snap.data.set."+this.id,this,i,t),this},h.removeData=function(t){return null==t?x[this.id]={}:x[this.id]&&delete x[this.id][t],this},h.outerSVG=h.toString=R(1),h.innerSVG=R(),h.toDataURL=function(){if(t&&t.btoa){var e=this.getBBox(),i=n.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))}},a.prototype.select=h.select,a.prototype.selectAll=h.selectAll})),n.plugin((function(t,e,i,n,r){var s=Object.prototype.toString,o=String,a=Math,h="";function c(t,e,i,n,r,o){if(null==e&&"[object SVGMatrix]"==s.call(t))return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f);null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+n,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}!function(e){function i(t){return t[0]*t[0]+t[1]*t[1]}function n(t){var e=a.sqrt(i(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,i,n,r,s){var o,a,h,l,d=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[t,i,r],[e,n,s],[0,0,1]];for(t&&t instanceof c&&(f=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;o<3;o++)for(a=0;a<3;a++){for(l=0,h=0;h<3;h++)l+=u[o][h]*f[h][a];d[o][a]=l}return this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2],this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new c(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new c(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.add(1,0,0,1,t,e)},e.scale=function(t,e,i,n){return null==e&&(e=t),(i||n)&&this.add(1,0,0,1,i,n),this.add(t,0,0,e,0,0),(i||n)&&this.add(1,0,0,1,-i,-n),this},e.rotate=function(e,i,n){e=t.rad(e),i=i||0,n=n||0;var r=+a.cos(e).toFixed(9),s=+a.sin(e).toFixed(9);return this.add(r,s,-s,r,i,n),this.add(1,0,0,1,-i,-n)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[o.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var r=[[this.a,this.c],[this.b,this.d]];e.scalex=a.sqrt(i(r[0])),n(r[0]),e.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*e.shear,r[1][1]-r[0][1]*e.shear],e.scaley=a.sqrt(i(r[1])),n(r[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var s=-r[0][1],o=r[1][1];return o<0?(e.rotate=t.deg(a.acos(o)),s<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(a.asin(s)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:h)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:h)+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:h))}}(c.prototype),t.Matrix=c,t.matrix=function(t,e,i,n,r,s){return new c(t,e,i,n,r,s)}})),n.plugin((function(t,i,n,r,s){var o,a=t._.make,h=t._.wrap,c=t.is,l=t._.getSomeDefs,d=/^url\(#?([^)]+)\)$/,u=t._.$,f=t.url,g=String,p=t._.separator,m="";function v(n){return function(r){if(e.stop(),r instanceof s&&1==r.node.childNodes.length&&("radialGradient"==r.node.firstChild.tagName||"linearGradient"==r.node.firstChild.tagName||"pattern"==r.node.firstChild.tagName)&&(r=r.node.firstChild,l(this).appendChild(r),r=h(r)),r instanceof i)if("radialGradient"==r.type||"linearGradient"==r.type||"pattern"==r.type){r.node.id||u(r.node,{id:r.id});var o=f(r.node.id)}else o=r.attr(n);else if((o=r).error){var a=t(l(this).ownerSVGElement).gradient(r);a?(a.node.id||u(a.node,{id:a.id}),o=f(a.node.id)):o=r}else o=g(o);var c={};c[n]=o,u(this.node,c),this.node.style[n]=m}}e.on("snap.util.attr.mask",(function(t){if(t instanceof i||t instanceof s){if(e.stop(),t instanceof s&&1==t.node.childNodes.length&&(t=t.node.firstChild,l(this).appendChild(t),t=h(t)),"mask"==t.type)var n=t;else(n=a("mask",l(this))).node.appendChild(t.node);!n.node.id&&u(n.node,{id:n.id}),u(this.node,{mask:f(n.id)})}})),o=function(t){if(t instanceof i||t instanceof s){if(e.stop(),"clipPath"==t.type)var n=t;else(n=a("clipPath",l(this))).node.appendChild(t.node),!n.node.id&&u(n.node,{id:n.id});u(this.node,{"clip-path":f(n.node.id||n.id)})}},e.on("snap.util.attr.clip",o),e.on("snap.util.attr.clip-path",o),e.on("snap.util.attr.clipPath",o),e.on("snap.util.attr.fill",v("fill")),e.on("snap.util.attr.stroke",v("stroke"));var w=/^([lr])(?:\(([^)]*)\))?(.*)$/i;function y(t){e.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function C(t){for(var e=[],i=t.childNodes,n=0,r=i.length;n<r;n++){var s=i[n];3==s.nodeType&&e.push(s.nodeValue),"tspan"==s.tagName&&(1==s.childNodes.length&&3==s.firstChild.nodeType?e.push(s.firstChild.nodeValue):e.push(C(s)))}return e}function b(){return e.stop(),this.node.style.fontSize}e.on("snap.util.grad.parse",(function(t){var e=(t=g(t)).match(w);if(!e)return null;var i=e[1],n=e[2],r=e[3];return 1==(n=n.split(/\s*,\s*/).map((function(t){return+t==t?+t:t}))).length&&0==n[0]&&(n=[]),{type:i,params:n,stops:r=(r=r.split("-")).map((function(t){var e={color:(t=t.split(":"))[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}))}})),e.on("snap.util.attr.d",(function(i){e.stop(),c(i,"array")&&c(i[0],"array")&&(i=t.path.toString.call(i)),(i=g(i)).match(/[ruo]/i)&&(i=t.path.toAbsolute(i)),u(this.node,{d:i})}))(-1),e.on("snap.util.attr.#text",(function(t){e.stop(),t=g(t);for(var i=r.doc.createTextNode(t);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(i)}))(-1),e.on("snap.util.attr.path",(function(t){e.stop(),this.attr({d:t})}))(-1),e.on("snap.util.attr.class",(function(t){e.stop(),this.node.className.baseVal=t}))(-1),e.on("snap.util.attr.viewBox",(function(t){var i;i=c(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):c(t,"array")?t.join(" "):t,u(this.node,{viewBox:i}),e.stop()}))(-1),e.on("snap.util.attr.transform",(function(t){this.transform(t),e.stop()}))(-1),e.on("snap.util.attr.r",(function(t){"rect"==this.type&&(e.stop(),u(this.node,{rx:t,ry:t}))}))(-1),e.on("snap.util.attr.textpath",(function(t){if(e.stop(),"text"==this.type){var n,r,s;if(!t&&this.textPath){for(r=this.textPath;r.node.firstChild;)this.node.appendChild(r.node.firstChild);return r.remove(),void delete this.textPath}if(c(t,"string")){var o=l(this),a=h(o.parentNode).path(t);o.appendChild(a.node),n=a.id,a.attr({id:n})}else(t=h(t))instanceof i&&((n=t.attr("id"))||(n=t.id,t.attr({id:n})));if(n)if(r=this.textPath,s=this.node,r)r.attr({"xlink:href":"#"+n});else{for(r=u("textPath",{"xlink:href":"#"+n});s.firstChild;)r.appendChild(s.firstChild);s.appendChild(r),this.textPath=h(r)}}}))(-1),e.on("snap.util.attr.text",(function(t){if("text"==this.type){for(var i=this.node,n=function(t){var e=u("tspan");if(c(t,"array"))for(var i=0;i<t.length;i++)e.appendChild(n(t[i]));else e.appendChild(r.doc.createTextNode(t));return e.normalize&&e.normalize(),e};i.firstChild;)i.removeChild(i.firstChild);for(var s=n(t);s.firstChild;)i.appendChild(s.firstChild)}e.stop()}))(-1),e.on("snap.util.attr.fontSize",y)(-1),e.on("snap.util.attr.font-size",y)(-1),e.on("snap.util.getattr.transform",(function(){return e.stop(),this.transform()}))(-1),e.on("snap.util.getattr.textpath",(function(){return e.stop(),this.textPath}))(-1),function(){function i(i){return function(){e.stop();var n=r.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+i);return"none"==n?n:t(r.doc.getElementById(n.match(d)[1]))}}function n(t){return function(i){e.stop();var n="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""!=i&&i){if("marker"==i.type){var r=i.node.id;return r||u(i.node,{id:i.id}),void(this.node.style[n]=f(r))}}else this.node.style[n]="none"}}e.on("snap.util.getattr.marker-end",i("end"))(-1),e.on("snap.util.getattr.markerEnd",i("end"))(-1),e.on("snap.util.getattr.marker-start",i("start"))(-1),e.on("snap.util.getattr.markerStart",i("start"))(-1),e.on("snap.util.getattr.marker-mid",i("mid"))(-1),e.on("snap.util.getattr.markerMid",i("mid"))(-1),e.on("snap.util.attr.marker-end",n("end"))(-1),e.on("snap.util.attr.markerEnd",n("end"))(-1),e.on("snap.util.attr.marker-start",n("start"))(-1),e.on("snap.util.attr.markerStart",n("start"))(-1),e.on("snap.util.attr.marker-mid",n("mid"))(-1),e.on("snap.util.attr.markerMid",n("mid"))(-1)}(),e.on("snap.util.getattr.r",(function(){if("rect"==this.type&&u(this.node,"rx")==u(this.node,"ry"))return e.stop(),u(this.node,"rx")}))(-1),e.on("snap.util.getattr.text",(function(){if("text"==this.type||"tspan"==this.type){e.stop();var t=C(this.node);return 1==t.length?t[0]:t}}))(-1),e.on("snap.util.getattr.#text",(function(){return this.node.textContent}))(-1),e.on("snap.util.getattr.viewBox",(function(){e.stop();var i=u(this.node,"viewBox");return i?(i=i.split(p),t._.box(+i[0],+i[1],+i[2],+i[3])):void 0}))(-1),e.on("snap.util.getattr.points",(function(){var t=u(this.node,"points");return e.stop(),t?t.split(p):void 0}))(-1),e.on("snap.util.getattr.path",(function(){var t=u(this.node,"d");return e.stop(),t}))(-1),e.on("snap.util.getattr.class",(function(){return this.node.className.baseVal}))(-1),e.on("snap.util.getattr.fontSize",b)(-1),e.on("snap.util.getattr.font-size",b)(-1)})),n.plugin((function(t,e,i,n,r){var s=/\S+/g,o=String,a=e.prototype;a.addClass=function(t){var e,i,n,r=o(t||"").match(s)||[],a=this.node,h=a.className.baseVal,c=h.match(s)||[];if(r.length){for(e=0;i=r[e++];)~c.indexOf(i)||c.push(i);h!=(n=c.join(" "))&&(a.className.baseVal=n)}return this},a.removeClass=function(t){var e,i,n,r,a=o(t||"").match(s)||[],h=this.node,c=h.className.baseVal,l=c.match(s)||[];if(l.length){for(e=0;n=a[e++];)~(i=l.indexOf(n))&&l.splice(i,1);c!=(r=l.join(" "))&&(h.className.baseVal=r)}return this},a.hasClass=function(t){return!!~(this.node.className.baseVal.match(s)||[]).indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var i,n,r,o,a=(t||"").match(s)||[],h=this.node,c=h.className.baseVal,l=c.match(s)||[];for(i=0;r=a[i++];)~(n=l.indexOf(r))?l.splice(n,1):l.push(r);return c!=(o=l.join(" "))&&(h.className.baseVal=o),this}})),n.plugin((function(t,i,n,r,s){var o={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},a=String,h=/[a-z]+$/i,c=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;function l(t){return t}function d(t){return function(e){return+e.toFixed(3)+t}}e.on("snap.util.attr",(function(t){var i=a(t).match(c);if(i){var n=e.nt(),r=n.substring(n.lastIndexOf(".")+1),s=this.attr(r),l={};e.stop();var d=i[3]||"",u=s.match(h),f=o[i[1]];if(u&&u==d?t=f(parseFloat(s),+i[2]):(s=this.asPX(r),t=f(this.asPX(r),this.asPX(r,i[2]+d))),isNaN(s)||isNaN(t))return;l[r]=t,this.attr(l)}}))(-10),e.on("snap.util.equal",(function(t,i){var n=a(this.attr(t)||""),r=a(i).match(c);if(r){e.stop();var s=r[3]||"",u=n.match(h),f=o[r[1]];return u&&u==s?{from:parseFloat(n),to:f(parseFloat(n),+r[2]),f:d(u)}:{from:n=this.asPX(t),to:f(n,this.asPX(t,r[2]+s)),f:l}}}))(-10)})),n.plugin((function(i,n,r,s,o){var a=r.prototype,h=i.is;a.rect=function(t,e,i,n,r,s){var o;return null==s&&(s=r),h(t,"object")&&"[object Object]"==t?o=t:null!=t&&(o={x:t,y:e,width:i,height:n},null!=r&&(o.rx=r,o.ry=s)),this.el("rect",o)},a.circle=function(t,e,i){var n;return h(t,"object")&&"[object Object]"==t?n=t:null!=t&&(n={cx:t,cy:e,r:i}),this.el("circle",n)};var c=function(){function t(){this.parentNode.removeChild(this)}return function(e,i){var n=s.doc.createElement("img"),r=s.doc.body;n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){i.call(n),n.onload=n.onerror=null,r.removeChild(n)},n.onerror=t,r.appendChild(n),n.src=e}}();a.image=function(t,e,n,r,s){var o=this.el("image");if(h(t,"object")&&"src"in t)o.attr(t);else if(null!=t){var a={"xlink:href":t,preserveAspectRatio:"none"};null!=e&&null!=n&&(a.x=e,a.y=n),null!=r&&null!=s?(a.width=r,a.height=s):c(t,(function(){i._.$(o.node,{width:this.offsetWidth,height:this.offsetHeight})})),i._.$(o.node,a)}return o},a.ellipse=function(t,e,i,n){var r;return h(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,rx:i,ry:n}),this.el("ellipse",r)},a.path=function(t){var e;return h(t,"object")&&!h(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},a.group=a.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.svg=function(t,e,i,n,r,s,o,a){var c={};return h(t,"object")&&null==e?c=t:(null!=t&&(c.x=t),null!=e&&(c.y=e),null!=i&&(c.width=i),null!=n&&(c.height=n),null!=r&&null!=s&&null!=o&&null!=a&&(c.viewBox=[r,s,o,a])),this.el("svg",c)},a.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.ptrn=function(t,e,i,n,r,s,o,a){if(h(t,"object"))var c=t;else c={patternUnits:"userSpaceOnUse"},t&&(c.x=t),e&&(c.y=e),null!=i&&(c.width=i),null!=n&&(c.height=n),c.viewBox=null!=r&&null!=s&&null!=o&&null!=a?[r,s,o,a]:[t||0,e||0,i||0,n||0];return this.el("pattern",c)},a.use=function(t){return null!=t?(t instanceof n&&(t.attr("id")||t.attr({id:i._.id(t)}),t=t.attr("id")),"#"==String(t).charAt()&&(t=t.substring(1)),this.el("use",{"xlink:href":"#"+t})):n.prototype.use.call(this)},a.symbol=function(t,e,i,n){var r={};return null!=t&&null!=e&&null!=i&&null!=n&&(r.viewBox=[t,e,i,n]),this.el("symbol",r)},a.text=function(t,e,i){var n={};return h(t,"object")?n=t:null!=t&&(n={x:t,y:e,text:i||""}),this.el("text",n)},a.line=function(t,e,i,n){var r={};return h(t,"object")?r=t:null!=t&&(r={x1:t,x2:i,y1:e,y2:n}),this.el("line",r)},a.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return h(t,"object")&&!h(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},a.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return h(t,"object")&&!h(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){var n=i._.$;function r(){return this.selectAll("stop")}function s(t,e){var r=n("stop"),s={offset:+e+"%"};return t=i.color(t),s["stop-color"]=t.hex,t.opacity<1&&(s["stop-opacity"]=t.opacity),n(r,s),this.node.appendChild(r),this}function o(){if("linearGradient"==this.type){var t=n(this.node,"x1")||0,e=n(this.node,"x2")||1,r=n(this.node,"y1")||0,s=n(this.node,"y2")||0;return i._.box(t,r,math.abs(e-t),math.abs(s-r))}var o=this.node.cx||.5,a=this.node.cy||.5,h=this.node.r||0;return i._.box(o-h,a-h,2*h,2*h)}function h(t,i){var r,s=e("snap.util.grad.parse",null,i).firstDefined();if(!s)return null;s.params.unshift(t),r="l"==s.type.toLowerCase()?c.apply(0,s.params):l.apply(0,s.params),s.type!=s.type.toLowerCase()&&n(r.node,{gradientUnits:"userSpaceOnUse"});var o=s.stops,a=o.length,h=0,d=0;function u(t,e){for(var i=(e-h)/(t-d),n=d;n<t;n++)o[n].offset=+(+h+i*(n-d)).toFixed(2);d=t,h=e}a--;for(var f=0;f<a;f++)"offset"in o[f]&&u(f,o[f].offset);for(o[a].offset=o[a].offset||100,u(a,o[a].offset),f=0;f<=a;f++){var g=o[f];r.addStop(g.color,g.offset)}return r}function c(t,e,a,h,c){var l=i._.make("linearGradient",t);return l.stops=r,l.addStop=s,l.getBBox=o,null!=e&&n(l.node,{x1:e,y1:a,x2:h,y2:c}),l}function l(t,e,a,h,c,l){var d=i._.make("radialGradient",t);return d.stops=r,d.addStop=s,d.getBBox=o,null!=e&&n(d.node,{cx:e,cy:a,r:h}),null!=c&&null!=l&&n(d.node,{fx:c,fy:l}),d}a.gradient=function(t){return h(this.defs,t)},a.gradientLinear=function(t,e,i,n){return c(this.defs,t,e,i,n)},a.gradientRadial=function(t,e,i,n,r){return l(this.defs,t,e,i,n,r)},a.toString=function(){var t,e=this.node.ownerDocument,n=e.createDocumentFragment(),r=e.createElement("div"),s=this.node.cloneNode(!0);return n.appendChild(r),r.appendChild(s),i._.$(s,{xmlns:"http://www.w3.org/2000/svg"}),t=r.innerHTML,n.removeChild(n.firstChild),t},a.toDataURL=function(){if(t&&t.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){for(var t,e=this.node.firstChild;e;)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):a.clear.call({node:e}),e=t}}()})),n.plugin((function(t,e,i,n){var r=e.prototype,s=t.is,o=t._.clone,a="hasOwnProperty",h=/,?([a-z]),?/gi,c=parseFloat,l=Math,d=l.PI,u=l.min,f=l.max,g=l.pow,p=l.abs;function m(t){var e=m.ps=m.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var i in e)e[a](i)&&i!=t&&(e[i].sleep--,!e[i].sleep&&delete e[i])})),e[t]}function v(t,e,i,n){return null==t&&(t=e=i=n=0),null==e&&(e=t.y,i=t.width,n=t.height,t=t.x),{x:t,y:e,width:i,w:i,height:n,h:n,x2:t+i,y2:e+n,cx:t+i/2,cy:e+n/2,r1:l.min(i,n)/2,r2:l.max(i,n)/2,r0:l.sqrt(i*i+n*n)/2,path:I(t,e,i,n),vb:[t,e,i,n].join(" ")}}function w(){return this.join(",").replace(h,"$1")}function y(t){var e=o(t);return e.toString=w,e}function C(t,e,i,n,r,s,o,a,h){return null==h?B(t,e,i,n,r,s,o,a):_(t,e,i,n,r,s,o,a,T(t,e,i,n,r,s,o,a,h))}function b(i,n){function r(t){return+(+t).toFixed(3)}return t._.cacher((function(t,s,o){t instanceof e&&(t=t.attr("d"));for(var a,h,c,l,d,u="",f={},g=0,p=0,m=(t=Y(t)).length;p<m;p++){if("M"==(c=t[p])[0])a=+c[1],h=+c[2];else{if(g+(l=C(a,h,c[1],c[2],c[3],c[4],c[5],c[6]))>s){if(n&&!f.start){if(u+=["C"+r((d=C(a,h,c[1],c[2],c[3],c[4],c[5],c[6],s-g)).start.x),r(d.start.y),r(d.m.x),r(d.m.y),r(d.x),r(d.y)],o)return u;f.start=u,u=["M"+r(d.x),r(d.y)+"C"+r(d.n.x),r(d.n.y),r(d.end.x),r(d.end.y),r(c[5]),r(c[6])].join(),g+=l,a=+c[5],h=+c[6];continue}if(!i&&!n)return d=C(a,h,c[1],c[2],c[3],c[4],c[5],c[6],s-g)}g+=l,a=+c[5],h=+c[6]}u+=c.shift()+c}return f.end=u,d=i?g:n?f:_(a,h,c[0],c[1],c[2],c[3],c[4],c[5],1)}),null,t._.clone)}var x=b(1),R=b(),S=b(0,1);function _(t,e,i,n,r,s,o,a,h){var c=1-h,u=g(c,3),f=g(c,2),p=h*h,m=p*h,v=t+2*h*(i-t)+p*(r-2*i+t),w=e+2*h*(n-e)+p*(s-2*n+e),y=i+2*h*(r-i)+p*(o-2*r+i),C=n+2*h*(s-n)+p*(a-2*s+n);return{x:u*t+3*f*h*i+3*c*h*h*r+m*o,y:u*e+3*f*h*n+3*c*h*h*s+m*a,m:{x:v,y:w},n:{x:y,y:C},start:{x:c*t+h*i,y:c*e+h*n},end:{x:c*r+h*o,y:c*s+h*a},alpha:90-180*l.atan2(v-y,w-C)/d}}function D(e,i,n,r,s,o,a,h){t.is(e,"array")||(e=[e,i,n,r,s,o,a,h]);var c=X.apply(null,e);return v(c.min.x,c.min.y,c.max.x-c.min.x,c.max.y-c.min.y)}function A(t,e,i){return e>=t.x&&e<=t.x+t.width&&i>=t.y&&i<=t.y+t.height}function k(t,e){return t=v(t),A(e=v(e),t.x,t.y)||A(e,t.x2,t.y)||A(e,t.x,t.y2)||A(e,t.x2,t.y2)||A(t,e.x,e.y)||A(t,e.x2,e.y)||A(t,e.x,e.y2)||A(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function E(t,e,i,n,r){return t*(t*(-3*e+9*i-9*n+3*r)+6*e-12*i+6*n)-3*e+3*i}function B(t,e,i,n,r,s,o,a,h){null==h&&(h=1);for(var c=(h=h>1?1:h<0?0:h)/2,d=12,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],g=0,p=0;p<d;p++){var m=c*u[p]+c,v=E(m,t,i,r,o),w=E(m,e,n,s,a),y=v*v+w*w;g+=f[p]*l.sqrt(y)}return c*g}function T(t,e,i,n,r,s,o,a,h){if(!(h<0||B(t,e,i,n,r,s,o,a)<h)){var c,l=1,d=l/2,u=l-d,f=.01;for(c=B(t,e,i,n,r,s,o,a,u);p(c-h)>f;)c=B(t,e,i,n,r,s,o,a,u+=(c<h?1:-1)*(d/=2));return u}}function L(t,e,i,n,r,s,o,a){if(!(f(t,i)<u(r,o)||u(t,i)>f(r,o)||f(e,n)<u(s,a)||u(e,n)>f(s,a))){var h=(t-i)*(s-a)-(e-n)*(r-o);if(h){var c=((t*n-e*i)*(r-o)-(t-i)*(r*a-s*o))/h,l=((t*n-e*i)*(s-a)-(e-n)*(r*a-s*o))/h,d=+c.toFixed(2),g=+l.toFixed(2);if(!(d<+u(t,i).toFixed(2)||d>+f(t,i).toFixed(2)||d<+u(r,o).toFixed(2)||d>+f(r,o).toFixed(2)||g<+u(e,n).toFixed(2)||g>+f(e,n).toFixed(2)||g<+u(s,a).toFixed(2)||g>+f(s,a).toFixed(2)))return{x:c,y:l}}}}function N(t,e,i){if(!k(D(t),D(e)))return i?0:[];for(var n=~~(B.apply(0,t)/8),r=~~(B.apply(0,e)/8),s=[],o=[],a={},h=i?0:[],c=0;c<n+1;c++){var l=_.apply(0,t.concat(c/n));s.push({x:l.x,y:l.y,t:c/n})}for(c=0;c<r+1;c++)l=_.apply(0,e.concat(c/r)),o.push({x:l.x,y:l.y,t:c/r});for(c=0;c<n;c++)for(var d=0;d<r;d++){var u=s[c],f=s[c+1],g=o[d],m=o[d+1],v=p(f.x-u.x)<.001?"y":"x",w=p(m.x-g.x)<.001?"y":"x",y=L(u.x,u.y,f.x,f.y,g.x,g.y,m.x,m.y);if(y){if(a[y.x.toFixed(4)]==y.y.toFixed(4))continue;a[y.x.toFixed(4)]=y.y.toFixed(4);var C=u.t+p((y[v]-u[v])/(f[v]-u[v]))*(f.t-u.t),b=g.t+p((y[w]-g[w])/(m[w]-g[w]))*(m.t-g.t);C>=0&&C<=1&&b>=0&&b<=1&&(i?h++:h.push({x:y.x,y:y.y,t1:C,t2:b}))}}return h}function $(t,e){return M(t,e)}function P(t,e){return M(t,e,1)}function M(t,e,i){t=Y(t),e=Y(e);for(var n,r,s,o,a,h,c,l,d,u,f=i?0:[],g=0,p=t.length;g<p;g++){var m=t[g];if("M"==m[0])n=a=m[1],r=h=m[2];else{"C"==m[0]?(d=[n,r].concat(m.slice(1)),n=d[6],r=d[7]):(d=[n,r,n,r,a,h,a,h],n=a,r=h);for(var v=0,w=e.length;v<w;v++){var y=e[v];if("M"==y[0])s=c=y[1],o=l=y[2];else{"C"==y[0]?(u=[s,o].concat(y.slice(1)),s=u[6],o=u[7]):(u=[s,o,s,o,c,l,c,l],s=c,o=l);var C=N(d,u,i);if(i)f+=C;else{for(var b=0,x=C.length;b<x;b++)C[b].segment1=g,C[b].segment2=v,C[b].bez1=d,C[b].bez2=u;f=f.concat(C)}}}}}return f}function U(t,e,i){var n=W(t);return A(n,e,i)&&M(t,[["M",e,i],["H",n.x2+10]],1)%2==1}function W(t){var e=m(t);if(e.bbox)return o(e.bbox);if(!t)return v();for(var i,n=0,r=0,s=[],a=[],h=0,c=(t=Y(t)).length;h<c;h++)if("M"==(i=t[h])[0])n=i[1],r=i[2],s.push(n),a.push(r);else{var l=X(n,r,i[1],i[2],i[3],i[4],i[5],i[6]);s=s.concat(l.min.x,l.max.x),a=a.concat(l.min.y,l.max.y),n=i[5],r=i[6]}var d=u.apply(0,s),g=u.apply(0,a),p=v(d,g,f.apply(0,s)-d,f.apply(0,a)-g);return e.bbox=o(p),p}function I(t,e,i,n,r){if(r)return[["M",+t+ +r,e],["l",i-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-i,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]];var s=[["M",t,e],["l",i,0],["l",0,n],["l",-i,0],["z"]];return s.toString=w,s}function O(t,e,i,n,r){if(null==r&&null==n&&(n=i),t=+t,e=+e,i=+i,n=+n,null!=r)var s=Math.PI/180,o=t+i*Math.cos(-n*s),a=t+i*Math.cos(-r*s),h=[["M",o,e+i*Math.sin(-n*s)],["A",i,i,0,+(r-n>180),0,a,e+i*Math.sin(-r*s)]];else h=[["M",t,e],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]];return h.toString=w,h}var F=t._unit2px,H={path:function(t){return t.attr("path")},circle:function(t){var e=F(t);return O(e.cx,e.cy,e.r)},ellipse:function(t){var e=F(t);return O(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=F(t);return I(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=F(t);return I(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return I(e.x,e.y,e.width,e.height)}};function z(e){var i=m(e),n=String.prototype.toLowerCase;if(i.rel)return y(i.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var r=[],s=0,o=0,a=0,h=0,c=0;"M"==e[0][0]&&(a=s=e[0][1],h=o=e[0][2],c++,r.push(["M",s,o]));for(var l=c,d=e.length;l<d;l++){var u=r[l]=[],f=e[l];if(f[0]!=n.call(f[0]))switch(u[0]=n.call(f[0]),u[0]){case"a":u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=+(f[6]-s).toFixed(3),u[7]=+(f[7]-o).toFixed(3);break;case"v":u[1]=+(f[1]-o).toFixed(3);break;case"m":a=f[1],h=f[2];default:for(var g=1,p=f.length;g<p;g++)u[g]=+(f[g]-(g%2?s:o)).toFixed(3)}else{u=r[l]=[],"m"==f[0]&&(a=f[1]+s,h=f[2]+o);for(var v=0,C=f.length;v<C;v++)r[l][v]=f[v]}var b=r[l].length;switch(r[l][0]){case"z":s=a,o=h;break;case"h":s+=+r[l][b-1];break;case"v":o+=+r[l][b-1];break;default:s+=+r[l][b-2],o+=+r[l][b-1]}}return r.toString=w,i.rel=y(r),r}function j(e){var i=m(e);if(i.abs)return y(i.abs);if(s(e,"array")&&s(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n,r=[],o=0,a=0,h=0,c=0,l=0;"M"==e[0][0]&&(h=o=+e[0][1],c=a=+e[0][2],l++,r[0]=["M",o,a]);for(var d,u,f=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),g=l,p=e.length;g<p;g++){if(r.push(d=[]),(n=(u=e[g])[0])!=n.toUpperCase())switch(d[0]=n.toUpperCase(),d[0]){case"A":d[1]=u[1],d[2]=u[2],d[3]=u[3],d[4]=u[4],d[5]=u[5],d[6]=+u[6]+o,d[7]=+u[7]+a;break;case"V":d[1]=+u[1]+a;break;case"H":d[1]=+u[1]+o;break;case"R":for(var v=[o,a].concat(u.slice(1)),C=2,b=v.length;C<b;C++)v[C]=+v[C]+o,v[++C]=+v[C]+a;r.pop(),r=r.concat(Q(v,f));break;case"O":r.pop(),(v=O(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);break;case"U":r.pop(),r=r.concat(O(o,a,u[1],u[2],u[3])),d=["U"].concat(r[r.length-1].slice(-2));break;case"M":h=+u[1]+o,c=+u[2]+a;default:for(C=1,b=u.length;C<b;C++)d[C]=+u[C]+(C%2?o:a)}else if("R"==n)v=[o,a].concat(u.slice(1)),r.pop(),r=r.concat(Q(v,f)),d=["R"].concat(u.slice(-2));else if("O"==n)r.pop(),(v=O(o,a,u[1],u[2])).push(v[0]),r=r.concat(v);else if("U"==n)r.pop(),r=r.concat(O(o,a,u[1],u[2],u[3])),d=["U"].concat(r[r.length-1].slice(-2));else for(var x=0,R=u.length;x<R;x++)d[x]=u[x];if("O"!=(n=n.toUpperCase()))switch(d[0]){case"Z":o=+h,a=+c;break;case"H":o=d[1];break;case"V":a=d[1];break;case"M":h=d[d.length-2],c=d[d.length-1];default:o=d[d.length-2],a=d[d.length-1]}}return r.toString=w,i.abs=y(r),r}function V(t,e,i,n){return[t,e,i,n,i,n]}function q(t,e,i,n,r,s){var o=1/3,a=2/3;return[o*t+a*i,o*e+a*n,o*r+a*i,o*s+a*n,r,s]}function G(e,i,n,r,s,o,a,h,c,u){var f,g=120*d/180,m=d/180*(+s||0),v=[],w=t._.cacher((function(t,e,i){return{x:t*l.cos(i)-e*l.sin(i),y:t*l.sin(i)+e*l.cos(i)}}));if(u)A=u[0],k=u[1],_=u[2],D=u[3];else{e=(f=w(e,i,-m)).x,i=f.y;var y=(e-(h=(f=w(h,c,-m)).x))/2,C=(i-(c=f.y))/2,b=y*y/(n*n)+C*C/(r*r);b>1&&(n*=b=l.sqrt(b),r*=b);var x=n*n,R=r*r,S=(o==a?-1:1)*l.sqrt(p((x*R-x*C*C-R*y*y)/(x*C*C+R*y*y))),_=S*n*C/r+(e+h)/2,D=S*-r*y/n+(i+c)/2,A=l.asin(((i-D)/r).toFixed(9)),k=l.asin(((c-D)/r).toFixed(9));(A=e<_?d-A:A)<0&&(A=2*d+A),(k=h<_?d-k:k)<0&&(k=2*d+k),a&&A>k&&(A-=2*d),!a&&k>A&&(k-=2*d)}var E=k-A;if(p(E)>g){var B=k,T=h,L=c;k=A+g*(a&&k>A?1:-1),v=G(h=_+n*l.cos(k),c=D+r*l.sin(k),n,r,s,0,a,T,L,[k,B,_,D])}E=k-A;var N=l.cos(A),$=l.sin(A),P=l.cos(k),M=l.sin(k),U=l.tan(E/4),W=4/3*n*U,I=4/3*r*U,O=[e,i],F=[e+W*$,i-I*N],H=[h+W*M,c-I*P],z=[h,c];if(F[0]=2*O[0]-F[0],F[1]=2*O[1]-F[1],u)return[F,H,z].concat(v);for(var j=[],V=0,q=(v=[F,H,z].concat(v).join().split(",")).length;V<q;V++)j[V]=V%2?w(v[V-1],v[V],m).y:w(v[V],v[V+1],m).x;return j}function X(t,e,i,n,r,s,o,a){for(var h,c,d,g,m,v,w,y,C=[],b=[[],[]],x=0;x<2;++x)if(0==x?(c=6*t-12*i+6*r,h=-3*t+9*i-9*r+3*o,d=3*i-3*t):(c=6*e-12*n+6*s,h=-3*e+9*n-9*s+3*a,d=3*n-3*e),p(h)<1e-12){if(p(c)<1e-12)continue;0<(g=-d/c)&&g<1&&C.push(g)}else w=c*c-4*d*h,y=l.sqrt(w),w<0||(0<(m=(-c+y)/(2*h))&&m<1&&C.push(m),0<(v=(-c-y)/(2*h))&&v<1&&C.push(v));for(var R,S=C.length,_=S;S--;)R=1-(g=C[S]),b[0][S]=R*R*R*t+3*R*R*g*i+3*R*g*g*r+g*g*g*o,b[1][S]=R*R*R*e+3*R*R*g*n+3*R*g*g*s+g*g*g*a;return b[0][_]=t,b[1][_]=e,b[0][_+1]=o,b[1][_+1]=a,b[0].length=b[1].length=_+2,{min:{x:u.apply(0,b[0]),y:u.apply(0,b[1])},max:{x:f.apply(0,b[0]),y:f.apply(0,b[1])}}}function Y(t,e){var i=!e&&m(t);if(!e&&i.curve)return y(i.curve);for(var n=j(t),r=e&&j(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,i){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(G.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*e.x-e.bx,r=2*e.y-e.by):(n=e.x,r=e.y),t=["C",n,r].concat(t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(q(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(q(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(V(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(V(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(V(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(V(e.x,e.y,e.X,e.Y))}return t},h=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)d[e]="A",r&&(u[e]="A"),t.splice(e++,0,["C"].concat(i.splice(0,6)));t.splice(e,1),w=f(n.length,r&&r.length||0)}},l=function(t,e,i,s,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],w=f(n.length,r&&r.length||0))},d=[],u=[],g="",p="",v=0,w=f(n.length,r&&r.length||0);v<w;v++){n[v]&&(g=n[v][0]),"C"!=g&&(d[v]=g,v&&(p=d[v-1])),n[v]=a(n[v],s,p),"A"!=d[v]&&"C"==g&&(d[v]="C"),h(n,v),r&&(r[v]&&(g=r[v][0]),"C"!=g&&(u[v]=g,v&&(p=u[v-1])),r[v]=a(r[v],o,p),"A"!=u[v]&&"C"==g&&(u[v]="C"),h(r,v)),l(n,r,s,o,v),l(r,n,o,s,v);var C=n[v],b=r&&r[v],x=C.length,R=r&&b.length;s.x=C[x-2],s.y=C[x-1],s.bx=c(C[x-4])||s.x,s.by=c(C[x-3])||s.y,o.bx=r&&(c(b[R-4])||o.x),o.by=r&&(c(b[R-3])||o.y),o.x=r&&b[R-2],o.y=r&&b[R-1]}return r||(i.curve=y(n)),r?[n,r]:n}function Z(t,e){if(!e)return t;var i,n,r,s,o,a,h;for(r=0,o=(t=Y(t)).length;r<o;r++)for(s=1,a=(h=t[r]).length;s<a;s+=2)i=e.x(h[s],h[s+1]),n=e.y(h[s],h[s+1]),h[s]=i,h[s+1]=n;return t}function Q(t,e){for(var i=[],n=0,r=t.length;r-2*!e>n;n+=2){var s=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?r-4==n?s[3]={x:+t[0],y:+t[1]}:r-2==n&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[r-2],y:+t[r-1]}:r-4==n?s[3]=s[2]:n||(s[0]={x:+t[n],y:+t[n+1]}),i.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return i}t.path=m,t.path.getTotalLength=x,t.path.getPointAtLength=R,t.path.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return S(t,e).end;var n=S(t,i,1);return e?S(n,e).end:n},r.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},r.getPointAtLength=function(t){return R(this.attr("d"),t)},r.getSubpath=function(e,i){return t.path.getSubpath(this.attr("d"),e,i)},t._.box=v,t.path.findDotsAtSegment=_,t.path.bezierBBox=D,t.path.isPointInsideBBox=A,t.closest=function(e,i,n,r){for(var s=100,o=v(e-s/2,i-s/2,s,s),a=[],h=n[0].hasOwnProperty("x")?function(t){return{x:n[t].x,y:n[t].y}}:function(t){return{x:n[t],y:r[t]}},c=0;s<=1e6&&!c;){for(var l=0,d=n.length;l<d;l++){var u=h(l);if(A(o,u.x,u.y)){c++,a.push(u);break}}c||(o=v(e-(s*=2)/2,i-s/2,s,s))}if(1e6!=s){var f,g=1/0;for(l=0,d=a.length;l<d;l++){var p=t.len(e,i,a[l].x,a[l].y);g>p&&(g=p,a[l].len=p,f=a[l])}return f}},t.path.isBBoxIntersect=k,t.path.intersection=$,t.path.intersectionNumber=P,t.path.isPointInside=U,t.path.getBBox=W,t.path.get=H,t.path.toRelative=z,t.path.toAbsolute=j,t.path.toCubic=Y,t.path.map=Z,t.path.toString=w,t.path.clone=y})),n.plugin((function(t,n,r,s){var o=Math.max,a=Math.min,h=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,i=t.length;e<i;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},c=h.prototype;c.push=function(){for(var t,e,i=0,n=arguments.length;i<n;i++)(t=arguments[i])&&(this[e=this.items.length]=this.items[e]=t,this.length++);return this},c.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},c.forEach=function(t,e){for(var i=0,n=this.items.length;i<n;i++)if(!1===t.call(e,this.items[i],i))return this;return this},c.animate=function(n,r,s,o){"function"!=typeof s||s.length||(o=s,s=i.linear),n instanceof t._.Animation&&(o=n.callback,s=n.easing,r=s.dur,n=n.attr);var a=arguments;if(t.is(n,"array")&&t.is(a[a.length-1],"array"))var h=!0;var c,l=function(){c?this.b=c:c=this.b},d=0,u=this,f=o&&function(){++d==u.length&&o.call(this)};return this.forEach((function(t,i){e.once("snap.animcreated."+t.id,l),h?a[i]&&t.animate.apply(t,a[i]):t.animate(n,r,s,f)}))},c.remove=function(){for(;this.length;)this.pop().remove();return this},c.bind=function(t,e,i){var n={};if("function"==typeof e)this.bindings[t]=e;else{var r=i||t;this.bindings[t]=function(t){n[r]=t,e.attr(n)}}return this},c.attr=function(t){var e={};for(var i in t)this.bindings[i]?this.bindings[i](t[i]):e[i]=t[i];for(var n=0,r=this.items.length;n<r;n++)this.items[n].attr(e);return this},c.clear=function(){for(;this.length;)this.pop()},c.splice=function(t,e,i){t=t<0?o(this.length+t,0):t,e=o(0,a(this.length-t,e));var n,r=[],s=[],c=[];for(n=2;n<arguments.length;n++)c.push(arguments[n]);for(n=0;n<e;n++)s.push(this[t+n]);for(;n<this.length-t;n++)r.push(this[t+n]);var l=c.length;for(n=0;n<l+r.length;n++)this.items[t+n]=this[t+n]=n<l?c[n]:r[n-l];for(n=this.items.length=this.length-=e-l;this[n];)delete this[n++];return new h(s)},c.exclude=function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},c.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},c.getBBox=function(){for(var t=[],e=[],i=[],n=[],r=this.items.length;r--;)if(!this.items[r].removed){var s=this.items[r].getBBox();t.push(s.x),e.push(s.y),i.push(s.x+s.width),n.push(s.y+s.height)}return{x:t=a.apply(0,t),y:e=a.apply(0,e),x2:i=o.apply(0,i),y2:n=o.apply(0,n),width:i-t,height:n-e,cx:t+(i-t)/2,cy:e+(n-e)/2}},c.clone=function(t){t=new h;for(var e=0,i=this.items.length;e<i;e++)t.push(this.items[e].clone());return t},c.toString=function(){return"Snap‘s set"},c.type="set",t.Set=h,t.set=function(){var t=new h;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}})),n.plugin((function(t,i,n,r){var s={},o=/[a-z]+$/i,a=String;function h(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function c(e,i,n){i=a(i).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],i=t.parseTransformString(i)||[];for(var r,s,o,c,l=Math.max(e.length,i.length),d=[],u=[],f=0;f<l;f++){if(o=e[f]||h(i[f]),c=i[f]||h(o),o[0]!=c[0]||"r"==o[0].toLowerCase()&&(o[2]!=c[2]||o[3]!=c[3])||"s"==o[0].toLowerCase()&&(o[3]!=c[3]||o[4]!=c[4])){e=t._.transform2matrix(e,n()),i=t._.transform2matrix(i,n()),d=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],u=[["m",i.a,i.b,i.c,i.d,i.e,i.f]];break}for(d[f]=[],u[f]=[],r=0,s=Math.max(o.length,c.length);r<s;r++)r in o&&(d[f][r]=o[r]),r in c&&(u[f][r]=c[r])}return{from:p(d),to:p(u),f:g(d)}}function l(t){return t}function d(t){return function(e){return+e.toFixed(3)+t}}function u(t){return t.join(" ")}function f(e){return t.rgb(e[0],e[1],e[2])}function g(t){var e,i,n,r,s,o,a=0,h=[];for(e=0,i=t.length;e<i;e++){for(s="[",o=['"'+t[e][0]+'"'],n=1,r=t[e].length;n<r;n++)o[n]="val["+a+++"]";s+=o+"]",h[e]=s}return Function("val","return Snap.path.toString.call(["+h+"])")}function p(t){for(var e=[],i=0,n=t.length;i<n;i++)for(var r=1,s=t[i].length;r<s;r++)e.push(t[i][r]);return e}function m(t){return isFinite(parseFloat(t))}function v(e,i){return!(!t.is(e,"array")||!t.is(i,"array"))&&e.toString()==i.toString()}s.stroke=s.fill="colour",i.prototype.equal=function(t,i){return e("snap.util.equal",this,t,i).firstDefined()},e.on("snap.util.equal",(function(e,i){var n,r,h=a(this.attr(e)||""),w=this;if(m(h)&&m(i))return{from:parseFloat(h),to:parseFloat(i),f:l};if("colour"==s[e])return n=t.color(h),r=t.color(i),{from:[n.r,n.g,n.b,n.opacity],to:[r.r,r.g,r.b,r.opacity],f:f};if("viewBox"==e)return{from:n=this.attr(e).vb.split(" ").map(Number),to:r=i.split(" ").map(Number),f:u};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return i instanceof t.Matrix&&(i=i.toTransformString()),t._.rgTransform.test(i)||(i=t._.svgTransform2string(i)),c(h,i,(function(){return w.getBBox(1)}));if("d"==e||"path"==e)return{from:p((n=t.path.toCubic(h,i))[0]),to:p(n[1]),f:g(n[0])};if("points"==e)return{from:n=a(h).split(t._.separator),to:r=a(i).split(t._.separator),f:function(t){return t}};var y=h.match(o),C=a(i).match(o);return y&&v(y,C)?{from:parseFloat(h),to:parseFloat(i),f:d(y)}:{from:this.asPX(e),to:this.asPX(e,i),f:l}}))})),n.plugin((function(t,i,n,r){for(var s=i.prototype,o="hasOwnProperty",a=("createTouch"in r.doc),h=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],c={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},l=function(t,e){var i="y"==t?"scrollTop":"scrollLeft",n=e&&e.node?e.node.ownerDocument:r.doc;return n[i in n.documentElement?"documentElement":"body"][i]},d=function(){return this.originalEvent.preventDefault()},u=function(){return this.originalEvent.stopPropagation()},f=function(t,e,i,n){var r=a&&c[e]?c[e]:e,s=function(r){var s=l("y",n),h=l("x",n);if(a&&c[o](e))for(var f=0,g=r.targetTouches&&r.targetTouches.length;f<g;f++)if(r.targetTouches[f].target==t||t.contains(r.targetTouches[f].target)){var p=r;(r=r.targetTouches[f]).originalEvent=p,r.preventDefault=d,r.stopPropagation=u;break}var m=r.clientX+h,v=r.clientY+s;return i.call(n,r,m,v)};return e!==r&&t.addEventListener(e,s,!1),t.addEventListener(r,s,!1),function(){return e!==r&&t.removeEventListener(e,s,!1),t.removeEventListener(r,s,!1),!0}},g=[],p=function(t){for(var i,n=t.clientX,r=t.clientY,s=l("y"),o=l("x"),h=g.length;h--;){if(i=g[h],a){for(var c,d=t.touches&&t.touches.length;d--;)if((c=t.touches[d]).identifier==i.el._drag.id||i.el.node.contains(c.target)){n=c.clientX,r=c.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var u=i.el.node;u.nextSibling,u.parentNode,u.style.display,n+=o,r+=s,e("snap.drag.move."+i.el.id,i.move_scope||i.el,n-i.el._drag.x,r-i.el._drag.y,n,r,t)}},m=function(i){t.unmousemove(p).unmouseup(m);for(var n,r=g.length;r--;)(n=g[r]).el._drag={},e("snap.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,i),e.off("snap.drag.*."+n.el.id);g=[]},v=h.length;v--;)!function(e){t[e]=s[e]=function(i,n){if(t.is(i,"function"))this.events=this.events||[],this.events.push({name:e,f:i,unbind:f(this.node||document,e,i,n||this)});else for(var r=0,s=this.events.length;r<s;r++)if(this.events[r].name==e)try{this.events[r].f.call(this)}catch(t){}return this},t["un"+e]=s["un"+e]=function(t){for(var i=this.events||[],n=i.length;n--;)if(i[n].name==e&&(i[n].f==t||!t))return i[n].unbind(),i.splice(n,1),!i.length&&delete this.events,this;return this}}(h[v]);s.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},s.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var w=[];s.drag=function(i,n,r,s,o,a){var h,c=this;if(!arguments.length)return c.drag((function(t,e){this.attr({transform:h+(h?"T":"t")+[t,e]})}),(function(){h=this.transform().local}));function l(h,l,d){(h.originalEvent||h).preventDefault(),c._drag.x=l,c._drag.y=d,c._drag.id=h.identifier,!g.length&&t.mousemove(p).mouseup(m),g.push({el:c,move_scope:s,start_scope:o,end_scope:a}),n&&e.on("snap.drag.start."+c.id,n),i&&e.on("snap.drag.move."+c.id,i),r&&e.on("snap.drag.end."+c.id,r),e("snap.drag.start."+c.id,o||s||c,l,d,h)}function d(t,i,n){e("snap.draginit."+c.id,c,t,i,n)}return e.on("snap.draginit."+c.id,l),c._drag={},w.push({el:c,start:l,init:d}),c.mousedown(d),c},s.undrag=function(){for(var i=w.length;i--;)w[i].el==this&&(this.unmousedown(w[i].init),w.splice(i,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!w.length&&t.unmousemove(p).unmouseup(m),this}})),n.plugin((function(t,i,n,r){i.prototype;var s=n.prototype,o=/^\s*url\((.+)\)/,a=String,h=t._.$;t.filter={},s.filter=function(e){var n=this;"svg"!=n.type&&(n=n.paper);var r=t.parse(a(e)),s=t._.id();n.node.offsetWidth,n.node.offsetHeight;var o=h("filter");return h(o,{id:s,filterUnits:"userSpaceOnUse"}),o.appendChild(r.node),n.defs.appendChild(o),new i(o)},e.on("snap.util.getattr.filter",(function(){e.stop();var i=h(this.node,"filter");if(i){var n=a(i).match(o);return n&&t.select(n[1])}})),e.on("snap.util.attr.filter",(function(n){if(n instanceof i&&"filter"==n.type){e.stop();var r=n.node.id;r||(h(n.node,{id:n.id}),r=n.id),h(this.node,{filter:t.url(r)})}n&&"none"!=n||(e.stop(),this.node.removeAttribute("filter"))})),t.filter.blur=function(e,i){null==e&&(e=2);var n=null==i?e:[e,i];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:n})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,i,n,r,s){return"string"==typeof n&&(s=r=n,n=4),"string"!=typeof r&&(s=r,r="#000"),r=r||"#000",null==n&&(n=4),null==s&&(s=1),null==e&&(e=0,i=2),null==i&&(i=e),r=t.color(r),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:r,dx:e,dy:i,blur:n,opacity:s})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}})),n.plugin((function(t,e,i,n,r){var s=t._.box,o=t.is,a=/^[^a-z]*([tbmlrc])/i,h=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&o(t,"string")&&(e=t,t=null);var i=(t=t||this.paper).getBBox?t.getBBox():s(t),n=this.getBBox(),r={};switch(e=(e=e&&e.match(a))?e[1].toLowerCase():"c"){case"t":r.dx=0,r.dy=i.y-n.y;break;case"b":r.dx=0,r.dy=i.y2-n.y2;break;case"m":r.dx=0,r.dy=i.cy-n.cy;break;case"l":r.dx=i.x-n.x,r.dy=0;break;case"r":r.dx=i.x2-n.x2,r.dy=0;break;default:r.dx=i.cx-n.cx,r.dy=0}return r.toString=h,r},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}})),n}(i,n)}));class Rt{static infoCornerAttribute(t){return{fill:t,"font-size":80,"font-family":"arial"}}static infoCornerLabelAttribute(t){return{fill:t,"font-size":50,"font-family":"arial"}}static roseLegendAttribute(t){return{fill:t,"font-size":25,"font-family":"arial","text-anchor":"middle","dominant-baseline":"middle"}}static windBarAttribute(t,e,i,n){return{fill:t,"font-size":e,"font-family":"Arial","text-anchor":n,"dominant-baseline":i}}}Rt.directionLettersAttribute={fill:"white","font-size":50,"font-family":"arial"};class St{constructor(t){this.svg=t}drawLine(t){return this.svg.line(t.startPoint.x,t.startPoint.y,t.endPoint.x,t.endPoint.y)}drawRect(t){return this.svg.rect(t.startPoint.x,t.startPoint.y,t.width,t.height)}drawPolyRect(t){return this.svg.path(xt.format("M {x} {y} l {w} 0 l 0 {h} l {wn} 0 Z",{x:t.startPoint.x,y:t.startPoint.y,w:t.width,wn:-1*t.width,h:t.height}))}drawTriangle(t,e,i,n,r,s){return this.svg.path(xt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} Z",{x:t,y:e,dx1:i,dy1:n,dx2:r,dy2:s}))}drawArrow(t,e,i){return this.svg.path(xt.format("M {x} {y} l {dx1} {dy1} l {dx2} {dy2} l {dx3} {dy3} Z",{x:t,y:e,dx1:i,dy1:-i/2,dx2:-i/4,dy2:i/2,dx3:i/4,dy3:i/2}))}drawWindDirectionText(t,e,i,n){var r=this.drawText(t,e,Rt.windBarAttribute(n,50,"middle","middle"));return this.rotate(r,i,t),r}rotate(t,e,i){t.transform(xt.format("r{deg},{x},{y}",{deg:e,x:i.x,y:i.y}))}drawCircle(t){return this.svg.circle(t.centerPoint.x,t.centerPoint.y,t.radius)}drawText(t,e,i){var n=this.svg.text(t.x,t.y,e);return n.attr(i),n}}class _t{constructor(t,e){this.startPoint=t,this.endPoint=e}}class Dt{constructor(t,e){this.x=t,this.y=e}}class At{constructor(t,e){this.centerPoint=t,this.radius=e}}class kt{constructor(t){this.cfg=t}roseCenter(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius)}crossHorizontalLine(){var t=this.cfg.marginTop+this.cfg.roseRadius;return new _t(new Dt(this.cfg.marginLeft,t),new Dt(this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius,t))}crossVerticalLine(){var t=this.cfg.marginLeft+this.cfg.roseRadius;return new _t(new Dt(t,this.cfg.marginTop),new Dt(t,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius))}roseCircle(t){return new At(new Dt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius),t)}viewBox(){if("right"===this.cfg.barLocation)return this.viewBoxBarRight();if("bottom"===this.cfg.barLocation)return this.viewBoxBarBotton();throw new Error("Bar location should be right or bottom not: "+this.cfg.barLocation)}viewBoxBarRight(){var t=this.cfg.barRight,e=this.cfg.roseRadius+this.cfg.roseRadius,i=this.cfg.marginTop+e+this.cfg.marginBottom;return"0 0 "+(1===this.cfg.barCount?this.cfg.marginLeft+e+this.cfg.marginRight+t.barMarginLeft+t.barWidth+t.barMarginRight:this.cfg.marginLeft+e+this.cfg.marginRight+t.barMarginLeft+t.barWidth*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+this.cfg.marginRight)+" "+i}viewBoxBarBotton(){var t=this.cfg.barBottom,e=this.cfg.roseRadius+this.cfg.roseRadius;return"0 0 "+(this.cfg.marginLeft+e+this.cfg.marginRight)+" "+(1===this.cfg.barCount?this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight+t.barMarginBottom:this.cfg.marginTop+e+this.cfg.marginBottom+t.barHeight*this.cfg.barCount+t.multiBarSpacing*(this.cfg.barCount-1)+t.barMarginBottom)}north(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop-this.cfg.directionLetterMargin)}east(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}south(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.directionLetterMargin)}west(){return new Dt(this.cfg.marginLeft-this.cfg.directionLetterMargin,this.cfg.marginTop+this.cfg.roseRadius)}infoCornerLeftTop(){return new Dt(.1*this.cfg.marginLeft,this.cfg.marginTop)}infoCornerRightTop(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+.9*this.cfg.marginRight,this.cfg.marginTop)}infoCornetLeftBottom(){return new Dt(.1*this.cfg.marginLeft,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius-30)}infoCornetRightBottom(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+.9*this.cfg.marginRight,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius-30)}infoCornerLabelLeftTop(){return new Dt(.1*this.cfg.marginLeft,.1*this.cfg.marginTop)}infoCornerLabelRightTop(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+.9*this.cfg.marginRight,.1*this.cfg.marginTop)}infoCornetLabelLeftBottom(){return new Dt(.1*this.cfg.marginLeft,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius)}infoCornetLabelRightBottom(){return new Dt(this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+.9*this.cfg.marginRight,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius)}}class Et{constructor(t,e,i,n,r){this.config=t,this.speedRanges=i,this.svg=n,this.degreesCalculator=r,this.svgUtil=new St(n),this.dimensionCalculator=new kt(e),this.roseCenter=this.dimensionCalculator.roseCenter()}drawWindRose(t){if(void 0===t)return void ht.error("drawWindRose(): Can't draw, no windrose data set.");ht.trace("drawWindRose()",t),this.svg.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const e=this.drawBackgroundLines(),i=this.drawWindDirectionText(),n=this.drawWindDirections();this.roseGroup=this.svg.group(e,i,n),this.roseGroup.transform("R"+this.degreesCalculator.getRoseRenderDegrees()+","+this.roseCenter.x+","+this.roseCenter.y),this.drawCircleLegend()}rotateWindRose(){if(void 0===this.roseGroup)return;const t=this.degreesCalculator.getRoseRenderDegrees(),e="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;this.roseGroup.animate({transform:e},700,mina.easeinout);const i="R"+-t+","+this.dimensionCalculator.north().x+","+this.dimensionCalculator.north().y;this.northText.animate({transform:i},700,mina.easeinout);const n="R"+-t+","+this.dimensionCalculator.east().x+","+this.dimensionCalculator.east().y;this.eastText.animate({transform:n},700,mina.easeinout);const r="R"+-t+","+this.dimensionCalculator.south().x+","+this.dimensionCalculator.south().y;this.southText.animate({transform:r},700,mina.easeinout);const s="R"+-t+","+this.dimensionCalculator.west().x+","+this.dimensionCalculator.west().y;this.westText.animate({transform:s},700,mina.easeinout)}drawWindDirections(){const t=this.svg.group();for(let e=0;e<this.windRoseData.directionPercentages.length;e++)t.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[e],this.windRoseData.directionPercentages[e],this.windRoseData.directionDegrees[e]));return t}drawWindDirection(t,e,i){const n=this.svg.group();if(0===e)return n;const r=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(r[e]=t[e],t[e]>0)for(let i=e-1;i>=0;i--)r[e]+=t[i];const s=e*this.dimensionCalculator.cfg.roseRadius/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=s*(r[t]/100);e>0&&(ht.trace("Degrees: "+(i-90)+" radius: "+e+" percentage: "+r[t]),n.add(this.drawSpeedPart(this.svg,i-90,e,this.speedRanges[t].color)))}return n}drawSpeedPart(t,e,i,n){ht.trace("Degrees 1"+(e-this.config.leaveArc/2)),ht.trace("Degrees 2"+(e+this.config.leaveArc/2)),ht.trace("Color: "+n);var r=wt.toRadians(e-this.config.leaveArc/2),s=wt.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*i),h=o.y+Math.round(Math.sin(r)*i),c=o.x+Math.round(Math.cos(s)*i),l=o.y+Math.round(Math.sin(s)*i);return ht.trace("Coords: ",o.x,o.y,a,h,c,l,n),t.path(xt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:h,x2:c,y2:l,radius:i})).attr({fill:n,stroke:this.config.roseLinesColor})}drawBackgroundLines(){var t=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),e=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=this.svg.group(t,e);const n=this.windRoseData.circleCount,r=this.dimensionCalculator.cfg.roseRadius/n;for(let t=1;t<=n;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(r*t)));return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(){const t=this.degreesCalculator.getRoseRenderDegrees();return this.config.cardinalDirectionLetters,this.northText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-t,this.config.roseDirectionLettersColor),this.eastText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-t,this.config.roseDirectionLettersColor),this.southText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-t,this.config.roseDirectionLettersColor),this.westText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-t,this.config.roseDirectionLettersColor),this.svg.group(this.northText,this.eastText,this.southText,this.westText)}drawCircleLegend(){const t=this.svg.group(),e=this.dimensionCalculator.cfg.roseRadius/this.windRoseData.circleCount,i=Math.cos(wt.toRadians(45))*e,n=this.dimensionCalculator.roseCenter();for(let e=1;e<=this.windRoseData.circleCount;e++){const r=new Dt(n.x+i*e,n.y+i*e),s=this.svgUtil.drawText(r,this.windRoseData.percentagePerCircle*e+"%",Rt.roseLegendAttribute(this.config.rosePercentagesColor));t.add(s)}return t}}class Bt{constructor(t,e,i){this.startPoint=t,this.width=e,this.height=i}}class Tt{constructor(t){this.cfg=t}barRectBottom(t){var e=this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginBottom;return t>0&&(e+=(this.cfg.barBottom.barHeight+this.cfg.barBottom.multiBarSpacing)*t),new Bt(new Dt(this.cfg.barBottom.barMarginLeft,e),this.cfg.barBottom.barLength,this.cfg.barBottom.barHeight)}barRectRight(t){var e=this.cfg.marginLeft+this.cfg.roseRadius+this.cfg.roseRadius+this.cfg.marginRight+this.cfg.barRight.barMarginLeft;return t>0&&(e+=(this.cfg.barRight.barWidth+this.cfg.barRight.multiBarSpacing)*t),new Bt(new Dt(e,this.cfg.marginTop+this.cfg.roseRadius+this.cfg.roseRadius),this.cfg.barRight.barWidth,this.cfg.barRight.barHeight)}}class Lt{getColorArray(t){const e=[];for(let i=0;i<t;i++){const n=240-240/(t-1)*i;e.push(`hsl(${n}, 100%, 60%)`)}return e}static getTextColorBasedOnBackground(t){const e=Lt.getRgbColor(t);if(void 0===e)return"black";let i=e[0],n=e[1],r=e[2];return i/=255,n/=255,r/=255,i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*i+.7152*n+.0722*r>.179?"#000000":"#FFFFFF"}static getRgbColor(t){let e=document.createElement("div");e.style.color=t,document.body.appendChild(e);let i=window.getComputedStyle(e).color;if(document.body.removeChild(e),i)return i.match(/\d+/g).map(Number)}}class Nt{constructor(t,e,i,n,r){ht.debug("WindBarRenderer init",t,i),this.config=t,this.svg=r,t.outputUnitLabel?this.outputUnitName=t.outputUnitLabel:t.speedRangeBeaufort?this.outputUnitName="Beaufort":this.outputUnitName=i.name,this.speedRanges=i.speedRanges,this.positionIndex=n,this.svgUtil=new St(this.svg),this.dimensionCalculator=new Tt(e)}drawWindBar(t){void 0!==t?(ht.trace("drawWindBar(): ",t),"horizontal"===this.config.orientation?this.drawBarLegendHorizontal(t.speedRangePercentages):"vertical"===this.config.orientation&&this.drawBarLegendVertical(t.speedRangePercentages)):ht.error("drawWindBar(): Can't draw bar, windRoseData not set.")}drawBarLegendVertical(t){const e=40,i=this.dimensionCalculator.barRectRight(this.positionIndex);let n=t.length;this.config.full||(n=this.getIndexHighestRangeWithMeasurements(t));const r=this.dimensionCalculator.cfg.barRight.barHeight/n,s=this.speedRanges[n-1].minSpeed;this.svgUtil.drawText(new Dt(i.startPoint.x-10,i.startPoint.y),this.config.label,Rt.windBarAttribute(this.config.barNameColor,e,"auto","left")).transform("r270,"+(i.startPoint.x-10)+","+i.startPoint.y);const o=i.startPoint.x;let a=i.startPoint.y;for(let l=0;l<n;l++){this.config.renderRelativeScale&&l!==n-1?length=(this.speedRanges[l+1].minSpeed-this.speedRanges[l].minSpeed)*((this.dimensionCalculator.cfg.barRight.barHeight-r)/s)*-1:length=-1*r;if(this.svgUtil.drawPolyRect(new Bt(new Dt(o,a),i.width,length)).attr({fill:this.speedRanges[l].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort?12==l?this.svgUtil.drawText(new Dt(o+i.width+10,a),l+"",Rt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new Dt(o+i.width+10,a+length/2),l+"",Rt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")):this.svgUtil.drawText(new Dt(o+i.width+10,a),this.speedRanges[l].minSpeed+"",Rt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),t[l]>0){var h=Math.round(t[l]),c=100===h?35:e;let n=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[l].color);this.svgUtil.drawText(new Dt(o+i.width/2,a+length/2),`${h}%`,Rt.windBarAttribute(n,c,"middle","middle"))}a+=length}!this.config.speedRangeBeaufort&&!this.config.full&&n<t.length&&this.svgUtil.drawText(new Dt(o+i.width+10,a),this.speedRanges[n].minSpeed+"",Rt.windBarAttribute(this.config.barUnitValuesColor,e,"middle","left")),this.svgUtil.drawText(new Dt(o+i.width/2,i.startPoint.y-i.height-15),this.outputUnitName,Rt.windBarAttribute(this.config.barUnitNameColor,e,"auto","middle"))}drawBarLegendHorizontal(t){const e=this.dimensionCalculator.barRectBottom(this.positionIndex);let i=t.length;this.config.full||(i=this.getIndexHighestRangeWithMeasurements(t));const n=this.dimensionCalculator.cfg.barBottom.barLength/i,r=this.speedRanges[i-1].minSpeed,s=new Dt(e.startPoint.x,e.startPoint.y-10);this.svgUtil.drawText(s,this.config.label,Rt.windBarAttribute(this.config.barNameColor,35,"auto","start"));let o=e.startPoint.x;const a=e.startPoint.y;for(let s=0;s<i;s++){if(this.config.renderRelativeScale&&s!==i-1?length=(this.speedRanges[s+1].minSpeed-this.speedRanges[s].minSpeed)*((this.dimensionCalculator.cfg.barBottom.barLength-n)/r):length=n,this.svgUtil.drawRect(new Bt(new Dt(o,a),length,e.height)).attr({fill:this.speedRanges[s].color,stroke:this.config.barBorderColor}),this.config.speedRangeBeaufort){const t=new Dt(o+length/2,a+e.height+10);this.svgUtil.drawText(t,s+"",Rt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}else{const t=new Dt(o,a+e.height+10);this.svgUtil.drawText(t,this.speedRanges[s].minSpeed+"",Rt.windBarAttribute(this.config.barUnitValuesColor,30,"hanging","middle"))}if(t[s]>0){const i=new Dt(o+length/2,a+e.height/2+2);let n=this.getPercentageTextColor(this.config.barPercentagesColor,this.speedRanges[s].color);this.svgUtil.drawText(i,`${Math.round(t[s])}%`,Rt.windBarAttribute(n,35,"middle","middle"))}o+=length}if(!this.config.speedRangeBeaufort&&!this.config.full&&i<t.length){const t=new Dt(o,a+e.height+3);this.svgUtil.drawText(t,this.speedRanges[i].minSpeed+"",Rt.windBarAttribute(this.config.barUnitValuesColor,35,"hanging","middle"))}const h=new Dt(e.startPoint.x+e.width,e.startPoint.y-10);this.svgUtil.drawText(h,this.outputUnitName,Rt.windBarAttribute(this.config.barUnitNameColor,35,"auto","end"))}getIndexHighestRangeWithMeasurements(t){for(let e=t.length-1;e>=0;e--)if(t[e]>0)return e+1;return t.length}getPercentageTextColor(t,e){return"auto"===t?Lt.getTextColorBasedOnBackground(e):t}}class $t{constructor(t,e,i,n,r,s,o){this.speedRangePercentages=t,this.directionSpeedRangePercentages=e,this.directionPercentages=i,this.directionDegrees=n,this.circleCount=r,this.percentagePerCircle=s,this.maxCirclePercentage=o}}class Pt{calculate(t){const e=Math.max(...t.directionTotals);ht.trace("Max direction total:",e);const i=this.calculateSpeedRangePercentages(t.speedRangeCounts,t.total);ht.trace("Speed range percentages:",i);const n=this.calculateDirectionSpeedRangePercentages(t.directionSpeedRangeCounts,t.directionTotals);ht.trace("Direction speed range percentages:",n);const r=this.calculateDirectionPercentages(t.directionTotals,t.total);ht.trace("Direction percentages:",r);const s=t.speedRangeDegrees;ht.trace("Direction degrees:",s);const o=this.calculateCirclePercentages(e,t.total);return ht.trace("Number of circles:",o[0]),ht.trace("Percentage per circle:",o[1]),ht.trace("Max circle percentage:",o[2]),new $t(i,n,r,s,o[0],o[1],o[2])}calculateSpeedRangePercentages(t,e){const i=e/100,n=[];for(const e of t)n.push(e/i);return n}calculateDirectionSpeedRangePercentages(t,e){const i=[];for(let n=0;n<e.length;n++){const r=[],s=e[n]/100;for(const e of t[n])0===s?r.push(0):r.push(e/s);i.push(r)}return i}calculateDirectionPercentages(t,e){const i=e/100,n=[];for(const e of t)n.push(e/i);return n}calculateCirclePercentages(t,e){const i=t/(e/100);let n=0,r=0;return 0===i?(n=25,r=4):i>0&&i<=30?(n=Math.ceil(i/6),r=Math.ceil(i/n)):(n=Math.ceil(i/5),r=5),[r,n,r*n]}}class Mt{constructor(t,e,i,n,r,s){this.name=t,this.configs=e,this.toMpsFunc=i,this.fromMpsFunc=n,this.speedRangeStep=r,this.speedRangeMax=s,this.speedRanges=[]}}class Ut{constructor(t,e,i,n,r){this.outputUnit=t,this.rangeBeaufort=e,this.rangeStep=i,this.rangeMax=n,this.speedRanges=r,this.bft=new Mt("Beaufort",["bft","Beaufort"],(t=>{switch(t){case 0:default:return 0;case 1:return 1;case 2:return 2.5;case 3:return 4;case 4:return 6.5;case 5:return 9;case 6:return 12;case 7:return 15.5;case 8:return 18.5;case 9:return 22.5;case 10:return 26.5;case 11:return 30;case 12:return 34}}),(t=>t),void 0,void 0),this.mps=new Mt("m/s",["mps","m/s"],(t=>t),(t=>t),5,30),this.kph=new Mt("km/h",["kph","km/h"],(t=>t/3.6),(t=>3.6*t),10,100),this.mph=new Mt("m/h",["mph","m/h"],(t=>t/2.2369),(t=>2.2369*t),10,70),this.fps=new Mt("ft/s",["fps","ft/s"],(t=>t/3.2808399),(t=>3.2808399*t),10,100),this.knots=new Mt("knots",["knots","kts","knts","kn"],(t=>t/1.9438444924406),(t=>1.9438444924406*t),5,60),this.units=[this.bft,this.mps,this.kph,this.mph,this.fps,this.knots],this.outputSpeedUnit=this.getSpeedUnit(this.outputUnit),!0===e?this.outputSpeedUnit.speedRanges=this.generateBeaufortSpeedRanges(t):r&&r.length>0?this.outputSpeedUnit.speedRanges=r:this.outputSpeedUnit.speedRanges=i&&n?this.generateSpeedRanges(i,n):this.generateSpeedRanges(this.outputSpeedUnit.speedRangeStep,this.outputSpeedUnit.speedRangeMax),ht.trace("Speed ranges: ",this.outputSpeedUnit.speedRanges)}getOutputSpeedUnit(){return this.outputSpeedUnit}getSpeedConverter(t){if(t===this.outputUnit)return t=>t;if("mps"===t)return this.outputSpeedUnit.fromMpsFunc;const e=this.getSpeedUnit(t).toMpsFunc,i=this.outputSpeedUnit.fromMpsFunc;return t=>i(e(t))}getRangeFunction(){return t=>{const e=this.outputSpeedUnit.speedRanges.find((e=>e.isRangeMatch(t)));if(e)return e.range;throw new Error("Speed is not in a speedrange: "+t+" unit: "+this.outputUnit)}}getSpeedRanges(){return this.outputSpeedUnit.speedRanges}getSpeedUnit(t){const e=this.units.find((e=>e.configs.includes(t)));if(void 0===e)throw new Error("Unknown speed unit: "+t);return ht.debug(`Matched speedunit ${e.name}`),e}generateSpeedRanges(t,e){const i=(new Lt).getColorArray(Math.floor(e/t)+1),n=[];let r=0,s=0;for(;r<=e-t;)n.push(new ot(s,r,r+t,i[s])),s++,r+=t;return n.push(new ot(s,r,-1,i[s])),n}generateBeaufortSpeedRanges(t){const e=(new Lt).getColorArray(13);if(void 0===t||"mps"===t)return[new ot(0,0,.5,e[0]),new ot(1,.5,1.6,e[1]),new ot(2,1.6,3.4,e[2]),new ot(3,3.4,5.5,e[3]),new ot(4,5.5,8,e[4]),new ot(5,8,10.8,e[5]),new ot(6,10.8,13.9,e[6]),new ot(7,13.9,17.2,e[7]),new ot(8,17.2,20.8,e[8]),new ot(9,20.8,24.5,e[9]),new ot(10,24.5,28.5,e[10]),new ot(11,28.5,32.7,e[11]),new ot(12,32.7,-1,e[12])];if("kph"===t)return[new ot(0,0,2,e[0]),new ot(1,2,6,e[1]),new ot(2,6,12,e[2]),new ot(3,12,20,e[3]),new ot(4,20,29,e[4]),new ot(5,29,39,e[5]),new ot(6,39,50,e[6]),new ot(7,50,62,e[7]),new ot(8,62,75,e[8]),new ot(9,75,89,e[9]),new ot(10,89,103,e[10]),new ot(11,103,118,e[11]),new ot(12,118,-1,e[12])];if("mph"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,8,e[2]),new ot(3,8,13,e[3]),new ot(4,13,19,e[4]),new ot(5,19,25,e[5]),new ot(6,25,32,e[6]),new ot(7,32,39,e[7]),new ot(8,39,47,e[8]),new ot(9,47,55,e[9]),new ot(10,55,64,e[10]),new ot(11,64,73,e[11]),new ot(12,73,-1,e[12])];if("fps"===t)return[new ot(0,0,1.6,e[0]),new ot(1,1.6,5.2,e[1]),new ot(2,5.2,11.2,e[2]),new ot(3,11.2,18,e[3]),new ot(4,18,26.2,e[4]),new ot(5,26.2,35.4,e[5]),new ot(6,35.4,45.6,e[6]),new ot(7,45.6,56.4,e[7]),new ot(8,56.4,68.2,e[8]),new ot(9,68.2,80.4,e[9]),new ot(10,80.4,93.5,e[10]),new ot(11,93.5,107,e[11]),new ot(12,107,-1,e[12])];if("knots"===t)return[new ot(0,0,1,e[0]),new ot(1,1,4,e[1]),new ot(2,4,7,e[2]),new ot(3,7,11,e[3]),new ot(4,11,17,e[4]),new ot(5,17,22,e[5]),new ot(6,22,28,e[6]),new ot(7,28,34,e[7]),new ot(8,34,41,e[8]),new ot(9,41,48,e[9]),new ot(10,48,56,e[10]),new ot(11,56,64,e[11]),new ot(12,64,-1,e[12])];throw new Error("No Bft reanges for type: "+t)}}class Wt{constructor(t,e,i,n,r,s,o,a,h,c,l,d,u,f,g,p){this.centerRadius=t,this.windDirectionCount=e,this.windDirectionLetters=i,this.leaveArc=n,this.cardinalDirectionLetters=r,this.directionCompensation=s,this.windRoseDrawNorthOffset=o,this.centerCalmPercentage=a,this.currentDirectionArrowSize=h,this.currentDirectionCenterCircleSize=c,this.cornersInfo=l,this.roseLinesColor=d,this.roseDirectionLettersColor=u,this.roseCenterPercentageColor=f,this.rosePercentagesColor=g,this.roseCurrentDirectionArrowColor=p}}class It{constructor(t,e,i,n,r,s,o,a,h,c,l){this.label=t,this.orientation=e,this.full=i,this.renderRelativeScale=n,this.outputUnitLabel=r,this.speedRangeBeaufort=s,this.barBorderColor=o,this.barUnitNameColor=a,this.barNameColor=h,this.barUnitValuesColor=c,this.barPercentagesColor=l}}class Ot{constructor(t){this.cardConfig=t}createWindRoseConfig(){return new Wt(60,this.cardConfig.windDirectionCount,this.cardConfig.windDirectionEntity.directionLetters,360/this.cardConfig.windDirectionCount-8,this.cardConfig.cardinalDirectionLetters,this.cardConfig.windDirectionEntity.directionCompensation,this.cardConfig.windRoseDrawNorthOffset,this.cardConfig.centerCalmPercentage,this.cardConfig.currentDirection.arrowSize,this.cardConfig.currentDirection.centerCircleSize,this.cardConfig.cornersInfo,this.cardConfig.cardColor.roseLines,this.cardConfig.cardColor.roseDirectionLetters,this.cardConfig.cardColor.roseCenterPercentage,this.cardConfig.cardColor.rosePercentages,this.cardConfig.cardColor.roseCurrentDirectionArrow)}createWindBarConfigs(){const t=[];for(let e=0;e<this.cardConfig.windspeedEntities.length;e++){const i=this.cardConfig.windspeedEntities[e];let n;if("bottom"===this.cardConfig.windspeedBarLocation)n=new It(i.name,"horizontal",this.cardConfig.windspeedBarFull,i.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages);else{if("right"!==this.cardConfig.windspeedBarLocation)throw Error("Unknown windspeed bar location: "+this.cardConfig.windspeedBarLocation);n=new It(i.name,"vertical",this.cardConfig.windspeedBarFull,i.renderRelativeScale,this.cardConfig.outputSpeedUnitLabel,this.cardConfig.speedRangeBeaufort,this.cardConfig.cardColor.barBorder,this.cardConfig.cardColor.barUnitName,this.cardConfig.cardColor.barName,this.cardConfig.cardColor.barUnitValues,this.cardConfig.cardColor.barPercentages)}t.push(n)}return t}}class Ft{constructor(){this.total=0,this.speedRangeDegrees=[],this.speedRangeCounts=[],this.directionTotals=[],this.directionSpeedRangeCounts=[]}init(t,e){this.total=0,this.speedRangeCounts=new Array(t).fill(0),this.directionTotals=new Array(e).fill(0),this.directionSpeedRangeCounts=new Array(e).fill([]);for(let e=0;e<this.directionSpeedRangeCounts.length;e++)this.directionSpeedRangeCounts[e]=new Array(t).fill(0)}add(t,e){this.total++,this.speedRangeCounts[e]++,this.directionTotals[t]++,ht.trace("Add "+t+" - "+e,this.directionSpeedRangeCounts),this.directionSpeedRangeCounts[t][e]++}}class Ht{constructor(t,e){this.minDegrees=t,this.maxDegrees=e}checkDirection(t){return this.minDegrees<0?t-360>this.minDegrees||t<=this.maxDegrees:t>this.minDegrees&&t<=this.maxDegrees}}class zt{constructor(t){this.windDirectionLetters=t,this.defaultLetters=["N","E","S","W"],this.directions={N:0,NXE:11.25,NNE:22.5,NEXN:33.75,NE:45,NEXE:56.25,ENE:67.5,EXN:78.75,E:90,EXS:101.25,ESE:112.5,SEXE:123.75,SE:135,SEXS:146.25,SSE:157.5,SXE:168.75,S:180,SXW:191.25,SSW:202.5,SWXS:213.75,SW:225,SWXW:236.25,WSW:247.5,WXS:258.75,W:270,WXN:281.25,WNW:292.5,NWXW:303.75,NW:315,NWXN:326.25,NNW:337.5,NXW:348.5,CALM:void 0,VRB:void 0}}getDirection(t){let e=t.toUpperCase();return this.windDirectionLetters&&(e=this.convertDirectionLetters(t)),this.directions[e]}convertDirectionLetters(t){let e="";for(let i=0;i<t.length;i++){const n=this.windDirectionLetters.indexOf(t[i]);n<0&&ht.info("Could not translate cardinal direction, letters not found in config wind_direction_entity.direction_letters"),e+=this.defaultLetters[n]}return e}}class jt{constructor(t){this.config=t,this.windDirectionLettersConverter=new zt(t.cardinalDirectionLetters)}convertDirection(t){let e;if(null!=t&&""!==t){if(Number.isNaN(Number(t))){if(e=this.windDirectionLettersConverter.getDirection(t),isNaN(e))return void ht.info("Could not convert direction "+t+" to degrees.")}else e=+t;if(void 0!==e)return this.compensateDirection(e)}}compensateDirection(t){let e=t;return 0!==this.config.directionCompensation&&(e=+e+this.config.directionCompensation,e<0?e=360+e:e>=360&&(e-=360)),e}}class Vt{constructor(t,e){this.windDirections=[],this.windData=new Ft,this.config=t,this.windSpeedConverter=e,this.windDirectionConverter=new jt(t),this.speedRangeFunction=this.windSpeedConverter.getRangeFunction();const i=360/t.windDirectionCount;for(let e=0;e<t.windDirectionCount;e++){const t=e*i,n=t-i/2,r=t+i/2;this.windDirections.push(new Ht(n,r)),this.windData.speedRangeDegrees.push(t)}}init(t){this.windData.init(this.windSpeedConverter.getSpeedRanges().length,this.config.windDirectionCount),this.speedConverterFunction=this.windSpeedConverter.getSpeedConverter(t)}getMeasurementCounts(){return ht.debug("Wind counts: ",this.windData),this.windData}addWindMeasurements(t,e){const i=this.speedConverterFunction(e),n=this.speedRangeFunction(i),r=this.windDirectionConverter.convertDirection(t);if(void 0===r)return;const s=this.windDirections.findIndex((t=>t.checkDirection(r)));s<0?ht.info("Wind direction not found: "+r):(ht.trace("Wind measurement: ",t,e,s,n),this.windData.add(s,n))}}class qt{constructor(t,e,i,n,r){this.config=t,this.speedRanges=i,this.svg=n,this.svgUtil=new St(n),this.dimensionCalculator=new kt(e),this.degreesCalculator=r,this.roseCenter=this.dimensionCalculator.roseCenter()}drawWindRose(t){if(void 0===t)return void ht.error("drawWindRose(): Can't draw, no windrose data.");ht.trace("drawWindRose()",t),this.svg.attr({viewBox:this.dimensionCalculator.viewBox(),preserveAspectRatio:"xMidYMid meet"}),this.windRoseData=t;const e=this.drawWindDirectionText(),i=this.drawWindDirections(),n=this.drawBackground();this.roseGroup=this.svg.group(n,e,i),this.roseGroup.transform("R"+this.degreesCalculator.getRoseRenderDegrees()+","+this.roseCenter.x+","+this.roseCenter.y),this.drawCircleLegend(),this.drawCenterZeroSpeed()}rotateWindRose(){if(void 0===this.roseGroup)return;const t=this.degreesCalculator.getRoseRenderDegrees(),e="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;this.roseGroup.animate({transform:e},700,mina.easeinout);const i="R"+-t+","+this.dimensionCalculator.north().x+","+this.dimensionCalculator.north().y;this.northText.animate({transform:i},700,mina.easeinout);const n="R"+-t+","+this.dimensionCalculator.east().x+","+this.dimensionCalculator.east().y;this.eastText.animate({transform:n},700,mina.easeinout);const r="R"+-t+","+this.dimensionCalculator.south().x+","+this.dimensionCalculator.south().y;this.southText.animate({transform:r},700,mina.easeinout);const s="R"+-t+","+this.dimensionCalculator.west().x+","+this.dimensionCalculator.west().y;this.westText.animate({transform:s},700,mina.easeinout)}drawWindDirections(){const t=this.svg.group();for(let e=0;e<this.windRoseData.directionPercentages.length;e++)t.add(this.drawWindDirection(this.windRoseData.directionSpeedRangePercentages[e],this.windRoseData.directionPercentages[e],this.windRoseData.directionDegrees[e]));return t}drawWindDirection(t,e,i){const n=this.svg.group();if(0===e)return n;const r=Array(t.length).fill(0);for(let e=t.length-1;e>=0;e--)if(r[e]=t[e],t[e]>0)for(let i=e-1;i>=0;i--)r[e]+=t[i];const s=e*(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.maxCirclePercentage;for(let t=this.speedRanges.length-1;t>=0;t--){const e=this.drawSpeedPart(this.svg,i-90,s*(r[t]/100)+this.config.centerRadius,this.speedRanges[t].color);n.add(e)}return n}drawSpeedPart(t,e,i,n){var r=wt.toRadians(e-this.config.leaveArc/2),s=wt.toRadians(e+this.config.leaveArc/2),o=this.dimensionCalculator.roseCenter(),a=o.x+Math.round(Math.cos(r)*i),h=o.y+Math.round(Math.sin(r)*i),c=o.x+Math.round(Math.cos(s)*i),l=o.y+Math.round(Math.sin(s)*i);return t.path(xt.format("M {centerX} {centerY} L {x1} {y1} A{radius} {radius} 0 0 1 {x2} {y2} Z ",{centerX:o.x,centerY:o.y,x1:a,y1:h,x2:c,y2:l,radius:i})).attr({fill:n,stroke:this.config.roseLinesColor})}drawBackground(){var t=this.svgUtil.drawLine(this.dimensionCalculator.crossHorizontalLine()),e=this.svgUtil.drawLine(this.dimensionCalculator.crossVerticalLine()),i=this.svg.group(t,e);const n=this.windRoseData.circleCount,r=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/n;let s=this.config.centerRadius+r;for(let t=1;t<=n;t++)i.add(this.svgUtil.drawCircle(this.dimensionCalculator.roseCircle(s))),s+=r;return i.attr({stroke:this.config.roseLinesColor,strokeWidth:1,fill:"none"}),i}drawWindDirectionText(){const t=this.degreesCalculator.getRoseRenderDegrees();return this.config.cardinalDirectionLetters,this.northText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.north(),this.config.cardinalDirectionLetters[0],-t,this.config.roseDirectionLettersColor),this.eastText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.east(),this.config.cardinalDirectionLetters[1],-t,this.config.roseDirectionLettersColor),this.southText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.south(),this.config.cardinalDirectionLetters[2],-t,this.config.roseDirectionLettersColor),this.westText=this.svgUtil.drawWindDirectionText(this.dimensionCalculator.west(),this.config.cardinalDirectionLetters[3],-t,this.config.roseDirectionLettersColor),this.svg.group(this.northText,this.eastText,this.southText,this.westText)}drawCircleLegend(){const t=this.svg.group(),e=this.dimensionCalculator.roseCenter(),i=(this.dimensionCalculator.cfg.roseRadius-this.config.centerRadius)/this.windRoseData.circleCount,n=Math.cos(wt.toRadians(45))*this.config.centerRadius,r=Math.cos(wt.toRadians(45))*i;for(let i=1;i<=this.windRoseData.circleCount;i++){const s=n+r*i+e.x,o=n+r*i+e.y,a=this.svgUtil.drawText(new Dt(s,o),this.windRoseData.percentagePerCircle*i+"%",Rt.roseLegendAttribute(this.config.rosePercentagesColor));t.add(a)}return t}drawCenterZeroSpeed(){const t=this.dimensionCalculator.roseCenter(),e=this.svgUtil.drawCircle(new At(t,this.config.centerRadius));e.attr({fill:this.speedRanges[0].color});let i=this.config.roseCenterPercentageColor;"auto"===this.config.roseCenterPercentageColor&&(i=Lt.getTextColorBasedOnBackground(this.speedRanges[0].color));const n=this.svgUtil.drawText(t,Math.round(this.windRoseData.speedRangePercentages[0])+"%",Rt.windBarAttribute(i,40,"middle","middle"));return this.svg.group(e,n)}}class Gt extends Pt{calculate(t){for(let e=0;e<t.directionTotals.length;e++){t.directionSpeedRangeCounts[e][0]=0;const i=t.directionSpeedRangeCounts[e].reduce(((t,e)=>t+e),0);t.directionTotals[e]=i}return super.calculate(t)}}class Xt{constructor(t,e){this.barCount=t,this.barLocation=e,this.roseRadius=500,this.marginLeft=80,this.marginRight=80,this.marginTop=80,this.marginBottom=120,this.directionLetterMargin=45,this.barBottom={barLength:2*this.roseRadius+(this.marginLeft-10)+(this.marginRight-10),barHeight:40,barMarginLeft:10,barMarginBottom:40,multiBarSpacing:90},this.barRight={barWidth:90,barHeight:2*this.roseRadius,barMarginLeft:40,barMarginRight:80,multiBarSpacing:100}}}class Yt{constructor(t,e,i){this.arrowElement=void 0,this.centerElement=void 0,this.config=t,this.dimensionCalculator=new kt(e),this.svgUtil=new St(i),this.cfg=this.dimensionCalculator.cfg,this.roseCenter=this.dimensionCalculator.roseCenter()}drawCurrentWindDirection(t,e){if((void 0===this.arrowElement||e)&&this.drawArrow(),(void 0===this.centerElement||e)&&this.drawCenter(),void 0===t)this.arrowElement.attr({visibility:"hidden"}),this.centerElement.attr({visibility:"visible"}),ht.debug("No direction, show circle",this.arrowElement,this.centerElement);else{this.arrowElement.attr({visibility:"visible"}),this.centerElement.attr({visibility:"hidden"});var i="R"+t+","+this.roseCenter.x+","+this.roseCenter.y;ht.debug("Animate",t,i),this.arrowElement.animate({transform:i},700,mina.easeinout)}}drawArrow(){const t=this.roseCenter.x+this.cfg.roseRadius-this.config.currentDirectionArrowSize/2,e=this.roseCenter.y;this.arrowElement=this.svgUtil.drawArrow(t,e,this.config.currentDirectionArrowSize),this.arrowElement.attr({stroke:this.config.roseCurrentDirectionArrowColor,fill:this.config.roseCurrentDirectionArrowColor})}drawCenter(){this.config.centerCalmPercentage?(this.centerElement=this.svgUtil.drawCircle(new At(this.roseCenter,this.config.centerRadius)),this.centerElement.attr({stroke:this.config.roseCurrentDirectionArrowColor,strokeWidth:4,fill:"none"})):(this.centerElement=this.svgUtil.drawCircle(new At(this.roseCenter,this.config.currentDirectionCenterCircleSize)),this.centerElement.attr({stroke:this.config.roseCurrentDirectionArrowColor,fill:this.config.roseCurrentDirectionArrowColor}))}}class Zt{static setLevel(t){switch(t){case"NONE":this.level=0;break;case"ERROR":this.level=1;break;case"WARN":this.level=2;break;case"INFO":this.level=3;break;case"DEBUG":this.level=4;break;case"TRACE":this.level=5;break;default:this.level=0,console.log("WR ERROR Unkonwn log level set: ",t," default to WARN")}this.level>2&&console.log("WR LOG level set to:",t)}static checkLogLevel(t){if(void 0===t)return"WARN";if("NONE"===t||"ERROR"===t||"WARN"===t||"INFO"===t||"DEBUG"===t||"TRACE"===t)return t;throw new Error("Unkonwn log level configurated: "+t)}constructor(t){this.prefix=t}error(t,...e){Zt.level>=1&&this.log("ERROR",t,e)}warn(t,...e){Zt.level>=2&&this.log("WARN",t,e)}info(t,...e){Zt.level>=3&&this.log("INFO",t,e)}debug(t,...e){Zt.level>=4&&this.log("DEBUG",t,e)}trace(t,...e){5===Zt.level&&this.log("TRACE",t,e)}log(t,e,...i){0===i[0].length?console.log("WR "+t+" "+this.prefix+": "+e):console.log("WR "+t+" "+this.prefix+": "+e,i[0])}}Zt.level=0;class Qt{constructor(t,e){this.northOfffset=t,this.autoRotate=e,this.log=new Zt("DegreesCalculator"),this.compassDegrees=0,this.roseRenderDegrees=0,this.log.debug("constructor"),this.updateRenderDegrees()}updateRenderDegrees(){this.autoRotate?(this.roseRenderDegrees=+this.northOfffset+this.compassDegrees,void 0===this.windDirectionDegrees?this.windDirectionRenderDegrees=void 0:this.windDirectionRenderDegrees=-90+this.northOfffset+this.compassDegrees+this.windDirectionDegrees):(this.roseRenderDegrees=this.northOfffset,void 0===this.windDirectionDegrees?this.windDirectionRenderDegrees=void 0:this.windDirectionRenderDegrees=-90+this.northOfffset+this.windDirectionDegrees),this.log.debug("updateRenderDegrees: Degrees sensor: ",this.windDirectionDegrees,this.compassDegrees),this.log.debug("updateRenderDegrees: Degrees for rendering: ",this.roseRenderDegrees,this.windDirectionRenderDegrees)}getWindDirectionRenderDegrees(){return this.windDirectionRenderDegrees}getRoseRenderDegrees(){return this.roseRenderDegrees}setWindDirectionDegrees(t){this.log.debug("setWindDirectionDegrees: Set windsensor degrees: "+t),this.windDirectionDegrees=t,this.updateRenderDegrees()}setCompassDegrees(t){this.compassDegrees=t,this.updateRenderDegrees()}}class Kt{constructor(t,e,i){this.config=t,this.dimensionCalculator=new kt(e),this.svg=i,this.svgUtil=new St(i),this.cfg=this.dimensionCalculator.cfg,this.roseCenter=this.dimensionCalculator.roseCenter(),this.leftTopCoor=this.dimensionCalculator.infoCornerLeftTop(),this.rightTopCoor=this.dimensionCalculator.infoCornerRightTop(),this.leftBottomCoor=this.dimensionCalculator.infoCornetLeftBottom(),this.rightBottomCoor=this.dimensionCalculator.infoCornetRightBottom(),this.leftTopConfig=t.cornersInfo.topLeftInfo,this.rightTopConfig=t.cornersInfo.topRightInfo,this.leftBottomConfig=t.cornersInfo.bottomLeftInfo,this.rightBottomConfig=t.cornersInfo.bottomRightInfo}drawCornerLabel(){if(this.leftTopConfig.label){this.svgUtil.drawText(this.dimensionCalculator.infoCornerLabelLeftTop(),this.leftTopConfig.label,Rt.infoCornerLabelAttribute(this.leftTopConfig.color)).attr({"text-anchor":"left","dominant-baseline":"hanging"})}if(this.rightTopConfig.label){this.svgUtil.drawText(this.dimensionCalculator.infoCornerLabelRightTop(),this.rightTopConfig.label,Rt.infoCornerLabelAttribute(this.rightTopConfig.color)).attr({"text-anchor":"end","dominant-baseline":"hanging"})}if(this.leftBottomConfig.label){this.svgUtil.drawText(this.dimensionCalculator.infoCornetLabelLeftBottom(),this.leftBottomConfig.label,Rt.infoCornerLabelAttribute(this.leftBottomConfig.color)).attr({"text-anchor":"left","dominant-baseline":"hanging"})}if(this.rightBottomConfig.label){this.svgUtil.drawText(this.dimensionCalculator.infoCornetLabelRightBottom(),this.rightBottomConfig.label,Rt.infoCornerLabelAttribute(this.rightBottomConfig.color)).attr({"text-anchor":"end","dominant-baseline":"hanging"})}}drawCornerValues(t){this.leftTopConfig.show&&t[0].active&&(this.leftTopelement=this.svgUtil.drawText(this.leftTopCoor,this.getText(t[0],this.leftTopConfig),Rt.infoCornerAttribute(this.leftTopConfig.color)),this.leftTopelement.attr({"text-anchor":"left","dominant-baseline":"hanging"})),t[1].active&&(this.rightTopElement=this.svgUtil.drawText(this.rightTopCoor,this.getText(t[1],this.rightTopConfig),Rt.infoCornerAttribute(this.rightTopConfig.color)),this.rightTopElement.attr({"text-anchor":"end","dominant-baseline":"hanging"})),t[2].active&&(this.leftBottomElement=this.svgUtil.drawText(this.leftBottomCoor,this.getText(t[2],this.leftBottomConfig),Rt.infoCornerAttribute(this.leftBottomConfig.color)),this.leftBottomElement.attr({"text-anchor":"left","dominant-baseline":"auto"})),t[3].active&&(this.rightBottomElement=this.svgUtil.drawText(this.rightBottomCoor,this.getText(t[3],this.rightBottomConfig),Rt.infoCornerAttribute(this.rightBottomConfig.color)),this.rightBottomElement.attr({"text-anchor":"end","dominant-baseline":"auto"}))}updateCornerValues(t){var e,i,n,r;null===(e=this.leftTopelement)||void 0===e||e.remove(),null===(i=this.rightTopElement)||void 0===i||i.remove(),null===(n=this.leftBottomElement)||void 0===n||n.remove(),null===(r=this.rightBottomElement)||void 0===r||r.remove(),this.drawCornerValues(t)}getText(t,e){return null==t?"":e.unit?t.state+e.unit:t.state}}class Jt{constructor(t){this.log=new Zt("WindRoseDirigent"),this.windBarRenderers=[],this.windRoseData=[],this.initReady=!1,this.measurementsReady=!1,this.svg=t}init(t,e,i){this.log.debug("init()"),this.initReady=!0,this.measurementsReady=!1,this.cardConfig=t,this.measurementProvider=e,this.entityStatesProcessor=i,this.configFactory=new Ot(t);const n=this.configFactory.createWindRoseConfig();if(this.windSpeedConverter=new Ut(t.outputSpeedUnit,t.speedRangeBeaufort,t.speedRangeStep,t.speedRangeMax,t.speedRanges),this.measurementCounter=new Vt(n,this.windSpeedConverter),this.dimensionConfig=new Xt(t.windBarCount(),t.windspeedBarLocation),this.degreesCalculator=new Qt(t.windRoseDrawNorthOffset,t.compassConfig.autoRotate),this.cardConfig.centerCalmPercentage?(this.percentageCalculator=new Gt,this.windRoseRenderer=new qt(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges(),this.svg,this.degreesCalculator)):(this.percentageCalculator=new Pt,this.windRoseRenderer=new Et(n,this.dimensionConfig,this.windSpeedConverter.getSpeedRanges(),this.svg,this.degreesCalculator)),this.cardConfig.currentDirection.showArrow&&(this.currentDirectionRenderer=new Yt(n,this.dimensionConfig,this.svg)),this.cardConfig.cornersInfo.isCornerInfoSet()&&(this.infoCornersRendeerer=new Kt(n,this.dimensionConfig,this.svg)),this.windBarRenderers=[],!t.hideWindspeedBar){const e=this.configFactory.createWindBarConfigs();for(let i=0;i<t.windBarCount();i++)this.windBarRenderers.push(new Nt(e[i],this.dimensionConfig,this.windSpeedConverter.getOutputSpeedUnit(),i,this.svg))}this.windRoseData=[]}refreshData(){return this.initReady?(this.log.debug("refreshData()"),this.measurementProvider.getMeasurements().then((t=>{this.windRoseData=[],this.log.debug("Matched measurements:",t);for(let e=0;e<t.length;e++){this.measurementCounter.init(this.cardConfig.windspeedEntities[e].speedUnit);for(const i of t[e])this.measurementCounter.addWindMeasurements(i.direction,i.speed);const i=this.measurementCounter.getMeasurementCounts();this.windRoseData.push(this.percentageCalculator.calculate(i))}return this.measurementsReady=!0,Promise.resolve(!0)}))):(this.log.debug("refreshData() ignored, not inited yet"),Promise.resolve(!1))}render(){var t,e,i;if(this.svg.clear(),this.initReady&&this.measurementsReady){this.log.debug("render()",this.svg,this.windRoseData,this.windBarRenderers),this.windRoseRenderer.drawWindRose(this.windRoseData[0]);for(let t=0;t<this.windBarRenderers.length;t++)this.windBarRenderers[t].drawWindBar(this.windRoseData[t]);null===(t=this.currentDirectionRenderer)||void 0===t||t.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!0),null===(e=this.infoCornersRendeerer)||void 0===e||e.drawCornerLabel(),null===(i=this.infoCornersRendeerer)||void 0===i||i.drawCornerValues(this.entityStatesProcessor.getCornerInfoStates())}else this.log.error("render(): Could not render, init or measurements not ready "+this.initReady+" - "+this.measurementsReady)}updateRender(){this.entityStatesProcessor.hasWindDirectionUpdate()&&(this.degreesCalculator.setWindDirectionDegrees(this.entityStatesProcessor.getWindDirection()),this.currentDirectionRenderer.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!1)),this.entityStatesProcessor.hasCompassDirectionUpdate()&&(this.degreesCalculator.setCompassDegrees(this.entityStatesProcessor.getCompassDirection()),this.currentDirectionRenderer.drawCurrentWindDirection(this.degreesCalculator.getWindDirectionRenderDegrees(),!1),this.windRoseRenderer.rotateWindRose()),this.entityStatesProcessor.hasCornerInfoUpdates()&&this.infoCornersRendeerer.updateCornerValues(this.entityStatesProcessor.getCornerInfoStates())}}class te{constructor(t,e){this.direction=t,this.speed=e}}class ee{constructor(t){if(this.matchingStrategy=t,ht.debug("Matching init:",t),"direction-first"!==this.matchingStrategy&&"speed-first"!==this.matchingStrategy)throw Error("Unkown matchfing strategy: "+this.matchingStrategy)}matchStatsHistory(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findHistoryInPeriod(n,e);t?this.isInvalidSpeed(t.s)?ht.warn("Speed "+t.s+" at timestamp "+n.start+" is not a number."):i.push(new te(n.mean,+t.s)):ht.trace("No matching speed found for direction "+n.mean+" at timestamp "+n.start)}else for(const n of e){const e=this.findStatsAtTime(1e3*n.lu,t);e?(i.push(new te(e.mean,+n.s)),""===n.s||null===n.s||isNaN(+n.s)?ht.warn("Speed "+n.s+" at timestamp "+e.start+" is not a number."):i.push(new te(e.mean,+n.s))):ht.trace("No matching direction found for speed "+n.s+" at timestamp "+n.lu)}return i}matchHistoryStats(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findStatsAtTime(1e3*n.lu,e);t?i.push(new te(n.s,t.mean)):ht.trace("No matching speed found for direction "+n.s+" at timestamp "+n.lu)}else for(const n of e){const e=this.findHistoryInPeriod(n,t);e?""===e.s||null===e.s||isNaN(+e.s)?ht.warn("Direction "+e.s+" at timestamp "+e.lu+" is not a number."):i.push(new te(e.s,n.mean)):ht.trace("No matching direction found for speed "+n.start+" at timestamp "+n.mean)}return i}matchHistoryHistory(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findHistoryBackAtTime(n.lu,e);t?this.isInvalidSpeed(t.s)?ht.warn("Speed "+t.s+" at timestamp "+t.lu+" is not a number."):i.push(new te(n.s,+t.s)):ht.trace("No matching speed found for direction "+n.s+" at timestamp "+n.lu)}else for(const n of e)if(this.isValidSpeed(n.s)){const e=this.findHistoryBackAtTime(n.lu,t);e?""===e.s||null===e.s||isNaN(+e.s)?ht.warn("Speed "+n.s+" at timestamp "+n.lu+" is not a number."):i.push(new te(e.s,+n.s)):ht.trace("No matching direction found for speed "+n.s+" at timestamp "+n.lu)}return i}matchStatsStats(t,e){const i=[];if("direction-first"==this.matchingStrategy)for(const n of t){const t=this.findMatchingStatistic(n,e);t?i.push(new te(n.mean,t.mean)):ht.trace(`No matching speed found for direction ${n.mean} at timestamp start:${n.start} end:${n.end}`)}else for(const n of e){const e=this.findMatchingStatistic(n,t);e?i.push(new te(e.mean,n.mean)):ht.trace(`No matching direction found for speed ${n.mean} at timestamp start:${n.start} end:${n.end}`)}return i}findStatsAtTime(t,e){return e.find((e=>e.start<=t&&t<=e.end))}findHistoryInPeriod(t,e){const i=t.start/1e3,n=t.end/1e3,r=e.filter((t=>i<t.lu&&n>=t.lu));return 1==r.length?r[0]:r.length>1?(r.sort(((t,e)=>e.lu-t.lu)),r[Math.trunc(r.length/2)]):void 0}findMatchingStatistic(t,e){return e.find((e=>t.start===e.start&&t.end===e.end))}findHistoryBackAtTime(t,e){let i;for(const n of e){if(!(n.lu<=t))break;i=n}return i}isInvalidSpeed(t){return""===t||null==t||isNaN(+t)}isValidSpeed(t){return""!==t&&null!=t&&!isNaN(+t)}}class ie{constructor(t){this.waitingForMeasurements=!1,this.cardConfig=t,this.rawEntities=t.createRawEntitiesArray(),this.statsEntities=t.createStatisticsEntitiesArray(),this.measurementMatcher=new ee(this.cardConfig.matchingStrategy)}setHass(t){this.hass=t}getMeasurements(){return ht.debug("getMeasurements()"),void 0===this.hass?(ht.error("Cant read measurements, HASS not set."),Promise.resolve([])):this.waitingForMeasurements?(ht.error("Measurements already requested, waiting"),Promise.resolve([])):(this.waitingForMeasurements=!0,Promise.all([this.getHistory(),this.getStatistics()]).then((t=>{this.checkLoadedData(t),this.waitingForMeasurements=!1,ht.debug("Measurements loaded:",t);const e=[];if(this.cardConfig.windDirectionEntity.useStatistics){const i=t[1][this.cardConfig.windDirectionEntity.entity];for(let n of this.cardConfig.windspeedEntities)if(n.useStatistics){const r=t[1][n.entity],s=this.measurementMatcher.matchStatsStats(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}else{const r=t[0][n.entity],s=this.measurementMatcher.matchStatsHistory(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}}else{const i=t[0][this.cardConfig.windDirectionEntity.entity];for(let n of this.cardConfig.windspeedEntities)if(n.useStatistics){const r=t[1][n.entity],s=this.measurementMatcher.matchHistoryStats(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}else{const r=t[0][n.entity],s=this.measurementMatcher.matchHistoryHistory(i,r);e.push(s),this.logMatchingStats(n.entity,i.length,r.length,s.length)}}return Promise.resolve(e)})))}checkLoadedData(t){const e=this.cardConfig.windDirectionEntity.entity;if(void 0===t[0][e]&&void 0===t[1][e])throw new Error(`Entity ${e} did not return data, is this the correct entity name?`);for(const e of this.cardConfig.windspeedEntities)if(void 0===t[0][e.entity]&&void 0===t[1][e.entity])throw new Error(`Entity ${e.entity} did not return data, is this the correct entity name?`)}logMatchingStats(t,e,i,n){ht.info(`Loaded measurements: directions: ${e}, speeds: ${i}, entity: ${t}`),"direction-first"===this.cardConfig.matchingStrategy?n<e?ht.warn(`Matching results entity ${t}, ${e-n} not matched of total ${e} direction measurements`):ht.info(`Matched measurements, direction-first: ${n}`):n<i?ht.warn(`Matching results entity ${t}, ${i-n}  not matched of total ${i} speed measurements`):ht.info(`Matched measurements, speed-first: ${n}`)}getHistory(){if(0===this.rawEntities.length)return Promise.resolve({});const t={type:"history/history_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),end_time:new Date,minimal_response:!0,no_attributes:!0,entity_ids:this.rawEntities};return this.hass.callWS(t)}getStatistics(){if(0===this.statsEntities.length)return Promise.resolve({});const t={type:"recorder/statistics_during_period",start_time:this.calculateStartTime(this.cardConfig.dataPeriod),period:"5minute",statistic_ids:this.statsEntities,types:["mean"]};return this.hass.callWS(t)}calculateStartTime(t){const e=new Date;if(t.hourstoShow)e.setHours(e.getHours()-t.hourstoShow);else{if(!(t.fromHourOfDay&&t.fromHourOfDay>0||0===t.fromHourOfDay))throw new Error("No data period config option available.");e.getHours()<t.fromHourOfDay&&e.setDate(e.getDate()-1),e.setHours(t.fromHourOfDay,0,0,0)}return ht.info("Using start time for data query",e),e}}class ne{checkEntities(t,e){this.checkEntity(t.windDirectionEntity.entity,e);for(const i of t.windspeedEntities)this.checkEntity(i.entity,e),"auto"===i.speedUnit&&void 0!==e.states[i.entity].attributes.unit_of_measurement&&(i.speedUnit=e.states[i.entity].attributes.unit_of_measurement);t.compassConfig&&t.compassConfig.autoRotate&&t.compassConfig.entity&&this.checkEntity(t.compassConfig.entity,e),this.checkCornerInfo(t.cornersInfo.topLeftInfo,e),this.checkCornerInfo(t.cornersInfo.topRightInfo,e),this.checkCornerInfo(t.cornersInfo.bottomLeftInfo,e),this.checkCornerInfo(t.cornersInfo.bottomRightInfo,e)}checkCornerInfo(t,e){t.show&&t.entity&&this.checkEntity(t.entity,e)}checkEntity(t,e){if(void 0===e.states[t])throw new Error(`Entity ${t} not found.`)}}class re{constructor(t,e){this.active=t,this.entity=e,this.state=void 0,this.updated=!1}}class se{constructor(){this.log=new Zt("EntityStatesProcessor"),this.initReady=!1,this.entityStates=[],this.cornerInfoStates=[]}init(t){this.cardConfig=t,this.windDirectionConverter=new jt(new Ot(t).createWindRoseConfig()),this.windDirectionState=new re(this.cardConfig.currentDirection.showArrow,this.cardConfig.windDirectionEntity.entity),this.compassDirectionState=new re(this.cardConfig.compassConfig.autoRotate,this.cardConfig.compassConfig.entity);const e=this.cardConfig.cornersInfo;this.cornerTopLeftState=new re(e.topLeftInfo.show,e.topLeftInfo.entity),this.cornerTopRightState=new re(e.topRightInfo.show,e.topRightInfo.entity),this.cornerBottomLeftState=new re(e.bottomLeftInfo.show,e.bottomLeftInfo.entity),this.cornerBottomRightState=new re(e.bottomRightInfo.show,e.bottomRightInfo.entity),this.cornerInfoStates=[this.cornerTopLeftState,this.cornerTopRightState,this.cornerBottomLeftState,this.cornerBottomRightState],this.entityStates=[this.windDirectionState,this.compassDirectionState,this.cornerTopLeftState,this.cornerTopRightState,this.cornerBottomLeftState,this.cornerBottomRightState],this.initReady=!0}updateHass(t){this.initReady&&(this.windDirectionState.updated=!1,this.compassDirectionState.updated=!1,this.entityStates.forEach((e=>{this.procesState(t,e)})),this.log.debug("Updated wind values: "+this.windDirectionState.updated+"  "+this.windDirectionState.state),this.log.debug("Updated compass values: "+this.compassDirectionState.updated+"  "+this.compassDirectionState.state))}procesState(t,e){if(void 0===e.entity||!e.active)return;const i=t.states[e.entity].state;void 0!==i&&e.state!=i&&(e.updated=!0,e.state=i)}hasUpdates(){return this.entityStates.some((t=>t.updated))}hasWindDirectionUpdate(){return this.windDirectionState.updated}getWindDirection(){if(void 0===this.windDirectionState.state)return;const t=this.windDirectionConverter.convertDirection(this.windDirectionState.state);return this.log.debug("Wind state: "+this.windDirectionState.state+" Converted: "+t),void 0!==t?(this.windDirectionState.updated=!1,+t):void 0}hasCompassDirectionUpdate(){return this.compassDirectionState.updated}getCompassDirection(){return void 0===this.compassDirectionState.state&&(ht.warn("Current compass direction is undefined, showing north"),this.compassDirectionState.state="0"),this.compassDirectionState.updated=!1,+this.compassDirectionState.state}hasCornerInfoUpdates(){return this.cornerInfoStates.some((t=>t.updated))}getCornerInfoStates(){return[this.cornerTopLeftState,this.cornerTopRightState,this.cornerBottomLeftState,this.cornerBottomRightState]}}window.customCards=window.customCards||[],window.customCards.push({type:"windrose-card",name:"Windrose Card",description:"A card to show wind speed and direction in a windrose."}),console.info("%c  WINROSE-CARD  %c Version 1.6.0 ","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray");let oe=class extends et{static getStubConfig(){return vt.exampleConfig()}constructor(){super(),this.log=new Zt("WindRoseCard"),this.refreshCardConfigOnHass=!1,this.svg=xt("100%","100%"),this.windRoseDirigent=new Jt(this.svg),this.entityStateProcessor=new se,this.entityChecker=new ne}setConfig(t){this.config=t,this.cardConfig=new vt(t),ht.setLevel(this.cardConfig.logLevel),Zt.setLevel(this.cardConfig.logLevel),this.log.debug("setConfig(): ",t,this._hass),this._hass?this.refreshCardConfig():this.refreshCardConfigOnHass=!0}set hass(t){this.refreshCardConfigOnHass&&(ht.debug("hass(), refreshCardConfigOnHass"),this.refreshCardConfigOnHass=!1,this._hass=t,this.refreshCardConfig()),this._hass=t,this.entityStateProcessor.updateHass(t),this.entityStateProcessor.hasUpdates()&&this.windRoseDirigent.updateRender()}refreshCardConfig(){this.log.debug("refreshCardConfig()");try{this.entityChecker.checkEntities(this.cardConfig,this._hass),this.measurementProvider=new ie(this.cardConfig),this.measurementProvider.setHass(this._hass),this.windRoseDirigent.init(this.cardConfig,this.measurementProvider,this.entityStateProcessor),this.entityStateProcessor.init(this.cardConfig),this.refreshMeasurements()}catch(t){ht.error("Error during init: ",t),this.svg.remove()}}render(){var t;return super.render(),this.log.debug("card render()"),M`
            <ha-card header="${null===(t=this.cardConfig)||void 0===t?void 0:t.title}">
                <div class="card-content" id="svg-container">
                </div>
            </ha-card>
        `}firstUpdated(){this.log.debug("firstUpdated()"),this.log.debug("SVG container found: ",this.svgContainer,this.measurementProvider),this.svgContainer.appendChild(this.svg.node)}update(t){this.log.debug("update()"),super.update(t),this.windRoseDirigent.render()}initInterval(){this.log.debug("initInterval()"),this.cardConfig&&void 0===this.updateInterval&&(this.updateInterval=setInterval((()=>this.refreshMeasurements()),1e3*this.cardConfig.refreshInterval),this.log.info("Interval running with "+this.cardConfig.refreshInterval+" seconds."))}static get styles(){return o`
          :host {
            display: block;
          }
          canvas {
            background-color: var(--ha-card-background);
            max-height: var(--chart-max-height);
          }`}connectedCallback(){super.connectedCallback(),this.log.debug("connectedCallBack()"),this.initInterval()}disconnectedCallback(){super.disconnectedCallback(),this.log.debug("disconnectedCallback()"),clearInterval(this.updateInterval)}getCardSize(){return this.log.debug("getCardSize()"),9}refreshMeasurements(){this.windRoseDirigent.refreshData().then((t=>{this.log.debug("refreshData() ready, requesting update."),t&&this.requestUpdate()}))}};t([nt("#svg-container")],oe.prototype,"svgContainer",void 0),t([nt(".card-content")],oe.prototype,"parentDiv",void 0),oe=t([(t=>e=>"function"==typeof e?((t,e)=>(customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:i,elements:n}=e;return{kind:i,elements:n,finisher(e){customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */)("windrose-card")],oe);export{ht as Log,oe as WindRoseCard};
